@using StockportWebapp.ProcessedModels
@using StockportWebapp.Extensions
@using StockportWebapp.ViewModels
@using StockportWebapp.FeatureToggling
@using StockportWebapp.Models
@using StockportWebapp.Utils
@using System.Text.RegularExpressions

@inject FeatureToggles FeatureToggles
@inject ICookiesHelper CookiesHelper

@model ProcessedShowcase
@{
    ViewData["BannerTypeformUrl"] = Model.TypeformUrl;
    ViewData["Title"] = Model.Title;
    ViewData["FullWidth"] = "full-width";
    ViewData["additionalClass"] = "showcase";
    ViewData["og:title"] = Model.Title;
    ViewData["Description"] = Model.Teaser;
    ViewData["Slug"] = Model.Slug;
    Layout = "../Shared/_LayoutSemantic.cshtml";
    var emailBanner = new EmailBannerViewModel(Model.EmailAlertsText, Model.EmailAlertsTopicId);
}
@section Breadcrumbs {
    <partial name="SemanticBreadcrumb" model='Model.Breadcrumbs' />
}

<div tabindex="-1" id="content"></div>


@if (Model.Alerts != null)
{
    var alertCookies = CookiesHelper.GetCookies<Alert>("alerts");
    if (alertCookies == null || alertCookies.Count() != Model.Alerts.Count())
    {
        <div class="alert-container">
            @foreach (var alert in Model.Alerts)
            {
                if (alertCookies == null || !alertCookies.Contains(alert.Slug))
                {
                    <partial name="Semantic/GlobalAlert" model='alert' />
                }
            }
        </div>
    }
}

@foreach (var field in Model.FieldOrder.Items)
{
    switch (field)
    {
        case "Primary Items":
            <div class="full-width">
                <partial name="Semantic/Showcase/PrimaryItems" model='Model' />
            </div>
            break;

        case "Secondary Items":

            if (Model.SecondaryItems.Any())
            {
                <div class="showcase-section">
                    <div class="center-wrapper">
                        <div class="secondary-item-header">
                            <h2 class="sr-only">Popular Services</h2>
                            @if (!string.IsNullOrEmpty(@Model.Subheading))
                            {
                                <h2>@Model.Subheading</h2>
                            }
                        </div>
                        <div class="secondary-item-body">
                            @foreach (var item in Model.SecondaryItems)
                            {
                                <div class="grid-20 tablet-grid-25 mobile-grid-33 secondary-item matchbox-child">
                                    <div class="secondary-item-content">
                                        <a href="@item.NavigationLink">
                                            <div class="secondary-item-icon">
                                                <i class="@item.Icon si-default" aria-hidden="true"></i>
                                            </div>
                                            <div class="secondary-item-name"><h3>@item.Title</h3></div>
                                        </a>
                                        @if (item.SubItems.Any())
                                        {
                                            <p class="hide-on-mobile hide-on-tablet secondary-item-description">
                                                <span>Including</span>
                                                @foreach (var subItem in item.SubItems.Take(2))
                                                {
                                                    <br />
                                                    <a href="@subItem.NavigationLink">@subItem.Title</a>
                                                }
                                            </p>
                                        }
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            }

            break;

        case "Featured Items":
            if (Model.FeaturedItems.AnyOrDefault())
            {
            <div class="showcase-section">
                <div class="center-wrapper">
                    <div class="featured-item-container">
                        <h2 class="featured-item-header">@Model.FeaturedItemsSubheading</h2>
                        <ul class="featured-item-body">
                            @foreach (var item in Model.FeaturedItems)
                            {
                                <li>
                                    <a href="@item.NavigationLink">
                                        <img src="@item.Image" />
                                        <h3>@item.Title</h3>
                                        <p>@item.Teaser</p>
                                    </a>
                                </li>

                            }
                        </ul>
                    </div>
                </div>
            </div>
            }
            break;

        case "Consultations":
            if (Model.Consultations.AnyOrDefault())
            {
                <div class="showcase-section">
                    <div class="center-wrapper">
                        <partial name="Semantic/Showcase/Consultations" model='Model.Consultations' />
                    </div>
                </div>
            }
            break;

        case "News":
            if (Model.NewsArticle != null)
            {
                <div class="showcase-section">
                    <div class="center-wrapper">
                        <partial name="Semantic/Showcase/NewsArticle" model='Model' />
                    </div>
                </div>
            }
            break;

        case "Events":
            if (Model.Events.AnyOrDefault())
            {
                var eventsListViewModel = new EventsListViewModel
                {
                    Events = Model.Events,
                    Heading = Model.EventSubheading,
                    Link = Model.EventsCategoryOrTag == "T" ? $"{Url.Action("Index", "Events")}?tag={Model.EventCategory}" : $"{Url.Action("Index", "Events")}?category={Model.EventCategory}",
                    LinkText = Model.EventsReadMoreText
                };

                <div class="showcase-section">
                    <div class="center-wrapper relative">
                        <partial name="Semantic/Showcase/EventsList" model="eventsListViewModel" />
                    </div>
                </div>
            }
            break;

        case "Profile":
            if (Model.Profile != null)
            {
                <div class="showcase-section">
                    <div class="showcase-profile showcase-news-events">
                        <div class="center-wrapper">
                            @await Component.InvokeAsync("ProfileInline", new
                            {
                                profile = Model.Profile,
                                withoutBody = string.IsNullOrEmpty(Model.Profile.Body)
                            })
                        </div>
                    </div>
                </div>
            }
            break;

        case "Profiles":
            if (Model.Profiles.AnyOrDefault())
            {
                var profileViewModel = new ProfileListViewModel
                {
                    Profiles = Model.Profiles,
                    Link = Model.ProfileLink,
                    Heading = Model.ProfileHeading
                };

                <div class="showcase-section">
                    <div class="center-wrapper">
                        <partial name="Semantic/Showcase/ProfilesList" model="profileViewModel" />
                    </div>
                </div>
            }
            break;

        case "Social Media":
            if (Model.SocialMediaLinks.AnyOrDefault())
            {
                var socialMediaLinksViewModel = new SocialMediaLinksViewModel
                {
                    SocialMediaLinksSubheading = Model.SocialMediaLinksSubheading != String.Empty ? Model.SocialMediaLinksSubheading : "Get in touch",
                    SocialMediaLinks = Model.SocialMediaLinks
                };

                <div class="showcase-section">
                    <div class="center-wrapper">
                        <partial name="Semantic/Showcase/SocialMediaLinks" model="socialMediaLinksViewModel" />
                    </div>
                </div>
            }
            break;

        case "Body":
            if (!string.IsNullOrWhiteSpace(Model.Body) && !string.Equals("<p></p>\n", Model.Body))
            {
                <div class="showcase-section">
                    <div class="center-wrapper">
                        <partial name="Semantic/Showcase/Body" model='Model' />
                    </div>
                </div>
            }
            break;

        case "Trivia":
            if (Model.TriviaSubheading != null && Model.TriviaSection.AnyOrDefault())
            {
                <div class="showcase-section">
                    <div class="center-wrapper">
                        <hr class="thick-divider" />
                        @await Component.InvokeAsync("InformationList", new
                       {
                           model = Model.TriviaSection,
                           heading = Model.TriviaSubheading,
                           additionalClasses = "showcase"
                       })
                    </div>
                </div>
            }
            break;

        case "Call to action banner":
            if (Model.CallToActionBanner != null)
            {
                <div class="showcase-section">
                    <div class="showcase-banner">
                        <div class="center-wrapper">
                            <a class="call-to-action-banner-container" href="@Model.CallToActionBanner.Link">
                                <div>
                                    <h2>@Model.CallToActionBanner.Title</h2>
                                    <div class="button-tertiary">@Model.CallToActionBanner.ButtonText</div>
                                </div>
                                <img src="@Model.CallToActionBanner.Image" alt="@Model.CallToActionBanner.AltText" />
                            </a>
                        </div>
                    </div>
                </div>
            }
            break;

        case "Video":
            if (Model.Video != null)
            {
                <div class="showcase-section">
                    <div class="showcase-banner">
                        <div class="video-section">
                            @if (!string.IsNullOrEmpty(Model.Video.Heading))
                        {
                            <h2>@Model.Video.Heading</h2>
                        }
                            @if (!string.IsNullOrEmpty(Model.Video.Text))
                        {
                            <p>@Model.Video.Text</p>
                        }
                            @if (!string.IsNullOrEmpty(Model.Video.Heading) || !string.IsNullOrEmpty(Model.Video.Text))
                        {
                            <hr class="thin-divider" />
                        }
                                @{
                                    var videoCode = new Regex("(width=|height=)\"((?!\").)*\"").Replace(Model.Video.VideoEmbedCode, "");
                                }
                                @Html.Raw(videoCode)
                        </div>
                    </div>
                </div>
            }
            break;
    }
}


@if (!string.IsNullOrEmpty(Model.EmailAlertsText) && !(string.IsNullOrEmpty(Model.EmailAlertsTopicId)))
{
    <div class="showcase-section">
        <div class="center-wrapper">
            <partial name="Semantic/EmailBanner" model="emailBanner" />
        </div>
    </div>
}

<script>
    require(['alerts'], function (alerts) {
        alerts.Init();
    });
</script>
