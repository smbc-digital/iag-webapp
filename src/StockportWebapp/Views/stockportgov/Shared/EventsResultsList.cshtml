@using Google.Apis.Calendar.v3.Data
@using StockportWebapp.ViewModels;
@using StockportWebapp.Utils
@inject ViewHelpers viewHelper
@model EventCalendar
@{
    DateTime previousEnteredDate = DateTime.MinValue;
    var hasEvents = Model.Events.Any();

}
<div class="grid-container" id="event-listing-container">
    
@if (!hasEvents)
{
    <div class="grid-container grid-100">
        <h1>There are currently no events matching your search.</h1>
        <p>Please edit your search and try again.</p>
    </div>
}

@foreach (var eventItem in Model.Events)
{
    var start = string.Empty;
    var end = string.Empty;
    if (previousEnteredDate != eventItem.EventDate)
    {
        if (previousEnteredDate != DateTime.MinValue)
        {
            end = "</div>";
        }

        <h2>@viewHelper.FormatEventDate(eventItem.EventDate)</h2>
        start = "<div class=\"event-container-row matchbox-parent\">";
    }

    @Html.Raw(end);
    @Html.Raw(start);
    <div class="group-li grid-33 tablet-grid-50 mobile-grid-100">
        <a class="group-card matchbox-child" href="@Url.Action("Detail", "Events", new {slug = eventItem.Slug, date = eventItem.EventDate.ToString("yyyy-MM-dd")})">
            <div class="group-image" style="background-image: url(@eventItem.ThumbnailImageUrl)"></div>
            <div class="group-card-information grid-100">
                <div class="grid-100 group-title">
                    <h3>@eventItem.Title</h3>
                </div>
                <div class="grid-10 tablet-grid-10 mobile-grid-10 group-card-icon">
                    <i class="fa fa-gbp" aria-hidden="true"></i>
                </div>
                <div class="grid-90 tablet-grid-90 mobile-grid-90 group-card-text">
                    @eventItem.Fee
                </div>
                <div class="grid-10 tablet-grid-10 mobile-grid-10 group-card-icon">
                    <i class="fa fa-clock-o" aria-hidden="true"></i>
                </div>
                <div class="grid-90 tablet-grid-90 mobile-grid-90 group-card-text">
                    @viewHelper.FormatEventDate(eventItem.EventDate, eventItem.StartTime)
                </div>
                <div class="grid-10 tablet-grid-10 mobile-grid-10 group-card-icon">
                    <i class="fa fa-map-marker" aria-hidden="true"></i>
                </div>
                <div class="grid-90 tablet-grid-90 mobile-grid-90 group-card-text">
                    @eventItem.Location
                </div>
            </div>
        </a>
    </div>

    previousEnteredDate = eventItem.EventDate.Date;
}
@if (hasEvents)
{
    @Html.Raw("</div>")
    @Html.Partial("Pagination", Model.Pagination)
}
</div>