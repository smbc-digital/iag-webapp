define(["jquery"],function(e){function H(i,e,t){var n=i.children(e.headerTag),s=i.children(e.bodyTag),r=(n.length>s.length?A(N,"contents"):n.length<s.length&&A(N,"titles"),e.startIndex);t.stepCount=n.length,e.saveState&&w.cookie&&(e=w.cookie(k+f(i)),e=parseInt(e,0),!isNaN(e))&&e<t.stepCount&&(r=e),t.currentIndex=r,n.each(function(e){var t=w(this),e=s.eq(e),n=e.data("mode"),n=null==n?D.html:C(D,/^\s*$/.test(n)||isNaN(n)?n:parseInt(n,0)),r=n===D.html||e.data("url")===F?"":e.data("url"),a=n!==D.html&&"1"===e.data("loaded"),t=w.extend({},O,{title:t.html(),content:n===D.html?e.html():"",contentUrl:r,contentMode:n,contentLoaded:a});e=t,l(i).push(e)})}function a(e,t){var n=e.find(".steps li").eq(t.currentIndex);e.triggerHandler("finishing",[t.currentIndex])?(n.addClass("done").removeClass("error"),e.triggerHandler("finished",[t.currentIndex])):n.addClass("error")}function c(e){var t=e.data("eventNamespace");return null==t&&(t="."+f(e),e.data("eventNamespace",t)),t}function u(e,t){var n=f(e);return e.find("#"+n+S+t)}function d(e,t){var n=f(e);return e.find("#"+n+q+t)}function i(e){return e.data("options")}function v(e){return e.data("state")}function l(e){return e.data("steps")}function s(e,t){e=l(e);return(t<0||t>=e.length)&&A(M),e[t]}function f(e){var t=e.data("uid");return null==t&&(null==(t=e._id())&&(t="steps-uid-".concat(T),e._id(t)),T++,e.data("uid",t)),t}function C(e,t){var n;if($("enumType",e),$("keyOrValue",t),"string"==typeof t)return(n=e[t])===F&&A("The enum key '{0}' does not exist.",t),n;if("number"==typeof t){for(var r in e)if(e[r]===t)return t;A("Invalid enum value '{0}'.",t)}else A("Invalid key or value type.")}function o(e,t,n){return r(e,t,n,(e=1,n.currentIndex+e))}function p(e,t,n){return r(e,t,n,(e=1,n.currentIndex-e))}function P(e,t,n,r){if((r<0||r>=n.stepCount)&&A(M),!(t.forceMoveForward&&r<n.currentIndex)){var a=n.currentIndex;if(e.triggerHandler("stepChanging",[n.currentIndex,r])){n.currentIndex=r,_(e,t,n),x(e,t,n,a),g(e,t,n),b(e,t,n);var i=n,s=r,o=a,d=function(){e.triggerHandler("stepChanged",[r,a])},n=(n=e).find(".content > .body"),l=C(B,t.transitionEffect),c=t.transitionEffectSpeed,u=n.eq(s),f=n.eq(o);switch(l){case B.fade:case B.slide:var p=l===B.fade?"fadeOut":"slideUp",h=l===B.fade?"fadeIn":"slideDown";i.transitionElement=u,f[p](c,function(){var e=v(w(this)._showAria(!1).parent().parent());e.transitionElement&&(e.transitionElement[h](c,function(){w(this)._showAria()}).promise().done(d),e.transitionElement=null)});break;case B.slideLeft:var p=f.outerWidth(!0),m=o<s?-p:p,p=o<s?p:-p;w.when(f.animate({left:m},c,function(){w(this)._showAria(!1)}),u.css("left",p+"px")._showAria().animate({left:0},c)).done(d);break;default:w.when(f._showAria(!1),u._showAria()).done(d)}}else e.find(".steps li").eq(a).addClass("error")}}function t(e){var l=w.extend(!0,{},Q,e);return this.each(function(){var t,n,r,e,a,i=w(this),s={currentIndex:l.startIndex,currentStep:null,stepCount:0,transitionElement:null},s=(i.data("options",l),i.data("state",s),i.data("steps",[]),H(i,l,s),t=i,r=s,s='<{0} class="{1}">{2}</{0}>',d=C(L,(n=l).stepsOrientation)===L.vertical?" vertical":"",o=t.wrapInner(s.format(n.contentContainerTag,"content "+n.clearFixCssClass,"")).children().first(),s=w(s.format(n.stepsContainerTag,"steps "+n.clearFixCssClass,'<ul role="tablist"></ul>')),a=o.children(n.headerTag),e=o.children(n.bodyTag),t.attr("role","application").empty().append(s).append(o).addClass(n.cssClass+" "+n.clearFixCssClass+d),e.each(function(e){m(t,r,w(this),e)}),a.each(function(e){y(t,n,r,w(this),e)}),x(t,n,r),t),o=n,d=r;o.enablePagination&&(e="",e+=(a='<li role="none"><a href="#{0}" role="menuitem">{1}</a></li>').format("next",o.labels.next),o.forceMoveForward||(e+=a.format("previous",o.labels.previous)),o.enableFinishButton&&(e+=a.format("finish",o.labels.finish)),o.enableCancelButton&&(e+=a.format("cancel",o.labels.cancel)),s.append('<{0} class="actions {1}"><ul role="menu" aria-label="{2}">{3}</ul></{0}>'.format(o.actionContainerTag,o.clearFixCssClass,o.labels.pagination,e)),g(s,o,d),b(s,o,d)),a=l,s=c(e=i),e.bind("canceled"+s,a.onCanceled),e.bind("contentLoaded"+s,a.onContentLoaded),e.bind("finishing"+s,a.onFinishing),e.bind("finished"+s,a.onFinished),e.bind("init"+s,a.onInit),e.bind("stepChanging"+s,a.onStepChanging),e.bind("stepChanged"+s,a.onStepChanged),e.find(".actions a").bind("click"+s,j),l.autoFocus&&0===T&&u(i,l.startIndex).focus(),i.triggerHandler("init",[l.startIndex])})}function n(e,t,n,r,a){(r<0||r>n.stepCount)&&A(M),a=w.extend({},O,a),i=r,s=a,l(e).splice(i,0,s),n.currentIndex!==n.stepCount&&n.currentIndex>=r&&(n.currentIndex++,_(e,t,n)),n.stepCount++;var i=e.find(".content"),s=w("<{0}>{1}</{0}>".format(t.headerTag,a.title)),o=w("<{0}></{0}>".format(t.bodyTag));return null!=a.contentMode&&a.contentMode!==D.html||o.html(a.content),0===r?i.prepend(o).prepend(s):d(e,r-1).after(o).after(s),m(e,n,o,r),y(e,t,n,s,r),h(e,t,n,r),r===n.currentIndex&&x(e,t,n),g(e,t,n),e}function b(t,e,n){if(0<n.stepCount){var r=n.currentIndex,a=s(t,r);if(!e.enableContentCache||!a.contentLoaded)switch(C(D,a.contentMode)){case D.iframe:t.find(".content > .body").eq(n.currentIndex).empty().html('<iframe src="'+a.contentUrl+'" frameborder="0" scrolling="no" />').data("loaded","1");break;case D.async:var i=d(t,r)._aria("busy","true").empty().append(I(e.loadingTemplate,{text:e.labels.loading}));w.ajax({url:a.contentUrl,cache:!1}).done(function(e){i.empty().html(e)._aria("busy","false").data("loaded","1"),t.triggerHandler("contentLoaded",[r])})}}}function r(e,t,n,r){var a=n.currentIndex;return 0<=r&&r<n.stepCount&&!(t.forceMoveForward&&r<n.currentIndex||(r=(e=(t=u(e,r)).parent()).hasClass("disabled"),e._enableAria(),t.click(),a===n.currentIndex&&r&&(e._enableAria(!1),1)))}function j(e){e.preventDefault();var e=w(this),t=e.parent().parent().parent().parent(),n=i(t),r=v(t),e=e.attr("href");switch(e.substring(e.lastIndexOf("#")+1)){case"cancel":t.triggerHandler("canceled");break;case"finish":a(t,r);break;case"next":o(t,n,r);break;case"previous":p(t,n,r)}}function g(e,t,n){var r,a;t.enablePagination&&(r=e.find(".actions a[href$='#finish']").parent(),a=e.find(".actions a[href$='#next']").parent(),t.forceMoveForward||e.find(".actions a[href$='#previous']").parent()._enableAria(0<n.currentIndex),t.enableFinishButton&&t.showFinishButtonAlways?(r._enableAria(0<n.stepCount),a._enableAria(1<n.stepCount&&n.stepCount>n.currentIndex+1)):(r._showAria(t.enableFinishButton&&n.stepCount===n.currentIndex+1),a._showAria(0===n.stepCount||n.stepCount>n.currentIndex+1)._enableAria(n.stepCount>n.currentIndex+1||!t.enableFinishButton)))}function x(e,t,n,r){var a=u(e,n.currentIndex),t=w('<span class="current-info audible">'+t.labels.current+" </span>"),i=e.find(".content > .title");null!=r&&((e=u(e,r)).parent().addClass("done").removeClass("error")._selectAria(!1),i.eq(r).removeClass("current").next(".body").removeClass("current"),t=e.find(".current-info"),a.focus()),a.prepend(t).parent()._selectAria().removeClass("done")._enableAria(),i.eq(n.currentIndex).addClass("current").next(".body").addClass("current")}function h(e,t,n,r){for(var a=f(e),i=r;i<n.stepCount;i++){var s=a+S+i,o=a+q+i,d=a+E+i,l=e.find(".title").eq(i)._id(d);e.find(".steps a").eq(i)._id(s)._aria("controls",o).attr("href","#"+d).html(I(t.titleTemplate,{index:i+1,title:l.html()})),e.find(".body").eq(i)._id(o)._aria("labelledby",d)}}function U(e,t,n,r){var a,i,s;return!(r<0||r>=n.stepCount||n.currentIndex===r||(i=r,l(e).splice(i,1),n.currentIndex>r&&(n.currentIndex--,_(e,t,n)),n.stepCount--,i=r,s=f(a=e),a.find("#"+s+E+i).remove(),d(e,r).remove(),u(e,r).parent().remove(),0===r&&e.find(".steps li").first().addClass("first"),r===n.stepCount&&e.find(".steps li").eq(r).addClass("last"),h(e,t,n,r),g(e,t,n),0))}function m(e,t,n,r){var e=f(e),a=e+E+r;n._id(e+q+r).attr("role","tabpanel")._aria("labelledby",a).addClass("body")._showAria(t.currentIndex===r)}function I(e,t){for(var n=e.match(/#([a-z]*)#/gi),r=0;r<n.length;r++){var a=n[r],i=a.substring(1,a.length-1);t[i]===F&&A("The key '{0}' does not exist in the substitute collection!",i),e=e.replace(a,t[i])}return e}function y(e,t,n,r,a){var i=f(e),s=i+S+a,o=i+q+a,i=i+E+a,d=e.find(".steps > ul"),l=I(t.titleTemplate,{index:a+1,title:r.html()}),s=w('<li role="tab"><a id="'+s+'" href="#'+i+'" aria-controls="'+o+'">'+l+"</a></li>");s._enableAria(t.enableAllSteps||n.currentIndex>a),n.currentIndex>a&&s.addClass("done"),r._id(i).attr("tabindex","-1").addClass("title"),0===a?d.prepend(s):d.find("li").eq(a-1).after(s),0===a&&d.find("li").removeClass("first").eq(a).addClass("first"),a===n.stepCount-1&&d.find("li").removeClass("last").eq(a).addClass("last"),s.children("a").bind("click"+c(e),z)}function _(e,t,n){t.saveState&&w.cookie&&w.cookie(k+f(e),n.currentIndex)}function z(e){e.preventDefault();var e=w(this),t=e.parent().parent().parent().parent(),n=i(t),r=v(t),a=r.currentIndex;if(e.parent().is(":not(.disabled):not(.current)")&&(e=e.attr("href"),P(t,n,r,parseInt(e.substring(e.lastIndexOf("-")+1),0))),a===r.currentIndex)return u(t,a).focus(),!1}function A(e){throw 1<arguments.length&&(e=e.format(Array.prototype.slice.call(arguments,1))),new Error(e)}function $(e,t){null==t&&A("The argument '{0}' is null or undefined.",e)}var w,F,T,k,S,q,E,M,N,D,L,B,O,Q;(w=e).fn.extend({_aria:function(e,t){return this.attr("aria-"+e,t)},_removeAria:function(e){return this.removeAttr("aria-"+e)},_enableAria:function(e){return null==e||e?this.removeClass("disabled")._aria("disabled","false").find("a").attr("tabindex",0):this.addClass("disabled")._aria("disabled","true").find("a").attr("tabindex",-1)},_showAria:function(e){return null==e||e?this.show()._aria("hidden","false"):this.hide()._aria("hidden","true")},_selectAria:function(e){return null==e||e?this.addClass("current")._aria("selected","true"):this.removeClass("current")._aria("selected","false")},_id:function(e){return e?this.attr("id",e):this.attr("id")}}),String.prototype.format||(String.prototype.format=function(){for(var e=1===arguments.length&&w.isArray(arguments[0])?arguments[0]:arguments,t=this,n=0;n<e.length;n++)var r=new RegExp("\\{"+n+"\\}","gm"),t=t.replace(r,e[n]);return t}),T=0,k="jQu3ry_5teps_St@te_",S="-t-",q="-p-",E="-h-",M="Index out of range.",N="One or more corresponding step {0} are missing.",w.fn.steps=function(e){return w.fn.steps[e]?w.fn.steps[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void w.error("Method "+e+" does not exist on jQuery.steps"):t.apply(this,arguments)},w.fn.steps.add=function(e){var t=v(this);return n(this,i(this),t,t.stepCount,e)},w.fn.steps.destroy=function(){var e=this,t=i(this),n=c(e);return e.unbind(n).removeData("uid").removeData("options").removeData("state").removeData("steps").removeData("eventNamespace").find(".actions a").unbind(n),e.removeClass(t.clearFixCssClass+" vertical"),(n=e.find(".content > *")).removeData("loaded").removeData("mode").removeData("url"),n.removeAttr("id").removeAttr("role").removeAttr("tabindex").removeAttr("class").removeAttr("style")._removeAria("labelledby")._removeAria("hidden"),e.find(".content > [data-mode='async'],.content > [data-mode='iframe']").empty(),t=w('<{0} class="{1}"></{0}>'.format(e.get(0).tagName,e.attr("class"))),null!=(n=e._id())&&""!==n&&t._id(n),t.html(e.find(".content").html()),e.after(t),e.remove(),t},w.fn.steps.finish=function(){a(this,v(this))},w.fn.steps.getCurrentIndex=function(){return v(this).currentIndex},w.fn.steps.getCurrentStep=function(){return s(this,v(this).currentIndex)},w.fn.steps.getStep=function(e){return s(this,e)},w.fn.steps.insert=function(e,t){return n(this,i(this),v(this),e,t)},w.fn.steps.next=function(){return o(this,i(this),v(this))},w.fn.steps.previous=function(){return p(this,i(this),v(this))},w.fn.steps.remove=function(e){return U(this,i(this),v(this),e)},w.fn.steps.setStep=function(e,t){throw new Error("Not yet implemented!")},w.fn.steps.skip=function(e){throw new Error("Not yet implemented!")},D=w.fn.steps.contentMode={html:0,iframe:1,async:2},L=w.fn.steps.stepsOrientation={horizontal:0,vertical:1},B=w.fn.steps.transitionEffect={none:0,fade:1,slide:2,slideLeft:3},O=w.fn.steps.stepModel={title:"",content:"",contentUrl:"",contentMode:D.html,contentLoaded:!1},Q=w.fn.steps.defaults={headerTag:"h1",bodyTag:"div",contentContainerTag:"div",actionContainerTag:"div",stepsContainerTag:"div",cssClass:"wizard",clearFixCssClass:"clearfix",stepsOrientation:L.horizontal,titleTemplate:'<span class="number">#index#.</span> #title#',loadingTemplate:'<span class="spinner"></span> #text#',autoFocus:!1,enableAllSteps:!1,enableKeyNavigation:!0,enablePagination:!0,suppressPaginationOnFocus:!0,enableContentCache:!0,enableCancelButton:!1,enableFinishButton:!0,preloadContent:!1,showFinishButtonAlways:!1,forceMoveForward:!1,saveState:!1,startIndex:0,transitionEffect:B.none,transitionEffectSpeed:200,onStepChanging:function(e,t,n){return!0},onStepChanged:function(e,t,n){},onCanceled:function(e){},onFinishing:function(e,t){return!0},onFinished:function(e,t){},onContentLoaded:function(e,t){},onInit:function(e,t){},labels:{cancel:"Cancel",current:"current step:",pagination:"Pagination",finish:"Finish",next:"Next",previous:"Previous",loading:"Loading ..."}}});