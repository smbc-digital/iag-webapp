define(["jquery"],function(e){var t;Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(Element.prototype,"textContent").get&&(t=Object.getOwnPropertyDescriptor(Element.prototype,"innerText"),Object.defineProperty(Element.prototype,"textContent",{get:function(){return t.get.call(this)},set:function(e){return t.set.call(this,e)}})),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var n,o={version:"0.4.13",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\ufeff",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};n=function(){var e="object",t="function",n="undefined",o=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],r=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],i=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],a=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function s(n,o){var r=typeof n[o];return r==t||!(r!=e||!n[o])||"unknown"==r}function l(t,n){return!(typeof t[n]!=e||!t[n])}function c(e,t){return typeof e[t]!=n}function d(e){return function(t,n){for(var o=n.length;o--;)if(!e(t,n[o]))return!1;return!0}}var u=d(s),f=d(l),h=d(c);function m(e){return e&&u(e,a)&&h(e,i)}function p(e){return l(e,"body")?e.body:e.getElementsByTagName("body")[0]}var g,y={},v={version:"1.3alpha.20140804",initialized:!1,supported:!0,util:{isHostMethod:s,isHostObject:l,isHostProperty:c,areHostMethods:u,areHostObjects:f,areHostProperties:h,isTextRange:m,getBody:p},features:{},modules:y,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==n||rangyAutoInitialize}};function b(e){l(window,"console")&&s(window.console,"log")&&window.console.log(e)}function w(e,t){t?window.alert(e):b(e)}function C(e){v.initialized=!0,v.supported=!1,w("Rangy is not supported on this page in your browser. Reason: "+e,v.config.alertOnFail)}v.fail=C,v.warn=function(e){w("Rangy warning: "+e,v.config.alertOnWarn)},!{}.hasOwnProperty?C("hasOwnProperty not supported"):v.util.extend=function(e,t,n){var o,r;for(var i in t)t.hasOwnProperty(i)&&(o=e[i],r=t[i],n&&null!==o&&"object"==typeof o&&null!==r&&"object"==typeof r&&v.util.extend(o,r,!0),e[i]=r);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},function(){var e=document.createElement("div");e.appendChild(document.createElement("span"));var t,n=[].slice;try{1==n.call(e.childNodes,0)[0].nodeType&&(t=function(e){return n.call(e,0)})}catch(e){}t||(t=function(e){for(var t=[],n=0,o=e.length;n<o;++n)t[n]=e[n];return t}),v.util.toArray=t}(),s(document,"addEventListener")?g=function(e,t,n){e.addEventListener(t,n,!1)}:s(document,"attachEvent")?g=function(e,t,n){e.attachEvent("on"+t,n)}:C("Document does not have required addEventListener or attachEvent method"),v.util.addListener=g;var N=[];function x(e){return e.message||e.description||String(e)}function E(){if(!v.initialized){var e,t=!1,n=!1;s(document,"createRange")&&(e=document.createRange(),u(e,r)&&h(e,o)&&(t=!0));var i=p(document);if(i&&"body"==i.nodeName.toLowerCase())if(i&&s(i,"createTextRange")&&m(e=i.createTextRange())&&(n=!0),t||n){var a;v.initialized=!0,v.features={implementsDomRange:t,implementsTextRange:n};for(var l in y)(a=y[l])instanceof T&&a.init(a,v);for(var c=0,d=N.length;c<d;++c)try{N[c](v)}catch(e){b("Rangy init listener threw an exception. Continuing. Detail: "+x(e))}}else C("Neither Range nor TextRange are available");else C("No body element found")}}v.init=E,v.addInitListener=function(e){v.initialized?e(v):N.push(e)};var S=[];function T(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function R(e,t,n,o){var r=new T(t,n,function(e){if(!e.initialized){e.initialized=!0;try{o(v,e),e.supported=!0}catch(e){b("Module '"+t+"' failed to load: "+x(e))}}});y[t]=r}function A(){}v.addShimListener=function(e){S.push(e)},v.shim=v.createMissingNativeApi=function(e){e=e||window,E();for(var t=0,n=S.length;t<n;++t)S[t](e)},T.prototype={init:function(){for(var e,t,n=this.dependencies||[],o=0,r=n.length;o<r;++o){if(t=n[o],!((e=y[t])&&e instanceof T))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){v.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){v.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},v.createModule=function(e){var t,n;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var o=R(0,e,n,t);v.initialized&&o.init()},v.createCoreModule=function(e,t,n){R(0,e,t,n)},v.RangePrototype=A,v.rangePrototype=new A,v.selectionPrototype=new function(){};var _=!1,I=function(e){_||(_=!0,!v.initialized&&v.config.autoInitialize&&E())};if(typeof window!=n){if(typeof document!=n)return s(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",I,!1),g(window,"load",I),v.createCoreModule("DomUtil",[],function(e,t){var n="undefined",o=e.util;o.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),o.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var r=document.createElement("div");o.areHostMethods(r,["insertBefore","appendChild","cloneNode"]||!o.areHostObjects(r,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),o.isHostProperty(r,"innerHTML")||t.fail("Element is missing innerHTML property");var i=document.createTextNode("test");o.areHostMethods(i,["splitText","deleteData","insertData","appendData","cloneNode"]||!o.areHostObjects(r,["previousSibling","nextSibling","childNodes","parentNode"])||!o.areHostProperties(i,["data"]))||t.fail("Incomplete Text Node implementation");var a=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1};function s(e){for(var t=0;e=e.previousSibling;)++t;return t}function l(e,t){var n,o=[];for(n=e;n;n=n.parentNode)o.push(n);for(n=t;n;n=n.parentNode)if(a(o,n))return n;return null}function c(e,t,n){for(var o=n?t:t.parentNode;o;){if(o===e)return!0;o=o.parentNode}return!1}function d(e,t,n){for(var o,r=n?e:e.parentNode;r;){if((o=r.parentNode)===t)return r;r=o}return null}function u(e){var t=e.nodeType;return 3==t||4==t||8==t}function f(e,t){var n=t.nextSibling,o=t.parentNode;return n?o.insertBefore(e,n):o.appendChild(e),e}function h(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=n)return e.ownerDocument;if(typeof e.document!=n)return e.document;if(e.parentNode)return h(e.parentNode);throw t.createError("getDocument: no document found for node")}function m(e){var o=h(e);if(typeof o.defaultView!=n)return o.defaultView;if(typeof o.parentWindow!=n)return o.parentWindow;throw t.createError("Cannot get a window object for node")}function p(e){if(typeof e.contentDocument!=n)return e.contentDocument;if(typeof e.contentWindow!=n)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function g(e){return e&&o.isHostMethod(e,"setTimeout")&&o.isHostObject(e,"document")}var y,v=!1;function b(e){try{return e.parentNode,!1}catch(e){return!0}}function w(e){if(!e)return"[No node]";if(v&&b(e))return"[Broken node]";if(u(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+s(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function C(e){this.root=e,this._next=e}function N(e,t){this.node=e,this.offset=t}function x(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br>",v=b(n),e.features.crashyTextNodes=v}(),typeof window.getComputedStyle!=n?y=function(e,t){return m(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=n?y=function(e,t){return e.currentStyle[t]}:t.fail("No means of obtaining computed style properties found"),C.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},N.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+w(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},x.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},x.prototype.toString=function(){return this.message},e.dom={arrayContains:a,isHtmlNamespace:function(e){var t;return typeof e.namespaceURI==n||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t},parentElement:function(e){var t=e.parentNode;return 1==t.nodeType?t:null},getNodeIndex:s,getNodeLength:function(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}},getCommonAncestor:l,isAncestorOf:c,isOrIsAncestorOf:function(e,t){return c(e,t,!0)},getClosestAncestorIn:d,isCharacterDataNode:u,isTextOrCommentNode:function(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t},insertAfter:f,splitDataNode:function(e,t,n){var o=e.cloneNode(!1);if(o.deleteData(0,t),e.deleteData(t,e.length-t),f(o,e),n)for(var r,i=0;r=n[i++];)r.node==e&&r.offset>t?(r.node=o,r.offset-=t):r.node==e.parentNode&&r.offset>s(e)&&++r.offset;return o},getDocument:h,getWindow:m,getIframeWindow:function(e){if(typeof e.contentWindow!=n)return e.contentWindow;if(typeof e.contentDocument!=n)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")},getIframeDocument:p,getBody:o.getBody,isWindow:g,getContentDocument:function(e,t,n){var r;if(e?o.isHostProperty(e,"nodeType")?r=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?p(e):h(e):g(e)&&(r=e.document):r=document,!r)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return r},getRootContainer:function(e){for(var t;t=e.parentNode;)e=t;return e},comparePoints:function(e,n,o,r){var i,a,c,u,f;if(e==o)return n===r?0:n<r?-1:1;if(i=d(o,e,!0))return n<=s(i)?-1:1;if(i=d(e,o,!0))return s(i)<r?-1:1;if(!(a=l(e,o)))throw new Error("comparePoints error: nodes have no common ancestor");if((c=e===a?a:d(e,a,!0))===(u=o===a?a:d(o,a,!0)))throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(f=a.firstChild;f;){if(f===c)return-1;if(f===u)return 1;f=f.nextSibling}},isBrokenNode:b,inspectNode:w,getComputedStyleProperty:y,fragmentFromNodeChildren:function(e){for(var t,n=h(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n},createIterator:function(e){return new C(e)},DomPosition:N},e.DOMException=x}),v.createCoreModule("DomRange",["DomUtil"],function(e,t){var n=e.dom,o=e.util,r=n.DomPosition,i=e.DOMException,a=n.isCharacterDataNode,s=n.getNodeIndex,l=n.isOrIsAncestorOf,c=n.getDocument,d=n.comparePoints,u=n.splitDataNode,f=n.getClosestAncestorIn,h=n.getNodeLength,m=n.arrayContains,p=n.getRootContainer,g=e.features.crashyTextNodes;function y(e,t){return 3!=e.nodeType&&(l(e,t.startContainer)||l(e,t.endContainer))}function v(e){return e.document||c(e.startContainer)}function b(e){return new r(e.parentNode,s(e))}function w(e){return new r(e.parentNode,s(e)+1)}function C(e,t,o){var r=11==e.nodeType?e.firstChild:e;return a(t)?o==t.length?n.insertAfter(e,t):t.parentNode.insertBefore(e,0==o?t:u(t,o)):o>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[o]),r}function N(e,t,n){if(F(e),F(t),v(t)!=v(e))throw new i("WRONG_DOCUMENT_ERR");var o=d(e.startContainer,e.startOffset,t.endContainer,t.endOffset),r=d(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?o<=0&&r>=0:o<0&&r>0}function x(e,t,o){var r,i,a,s;for(o=o||{stop:!1};a=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===t(a))return void(o.stop=!0);if(x(s=e.getSubtreeIterator(),t,o),s.detach(),o.stop)return}else for(r=n.createIterator(a);i=r.next();)if(!1===t(i))return void(o.stop=!0)}function E(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(E(t=e.getSubtreeIterator()),t.detach()):e.remove()}function S(e){for(var t,n,o=v(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(S(n)),n.detach()):e.remove(),10==t.nodeType)throw new i("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function T(e){return"["+(void 0===e.getName?"Range":e.getName())+"("+n.inspectNode(e.startContainer)+":"+e.startOffset+", "+n.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function R(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&a(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||a(this.sc)?f(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||a(this.ec)?f(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}R.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,a(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!a(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0)!=(t=n===this.ec?this.eo:n.length)&&n.deleteData(e,t-e)},isPartiallySelectedSubtree:function(){return y(this._current,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)(e=this.range.cloneRange()).collapse(!1);else{e=new fe(v(this.range));var t=this._current,n=t,o=0,r=t,i=h(t);l(t,this.sc)&&(n=this.sc,o=this.so),l(t,this.ec)&&(r=this.ec,i=this.eo),ue(e,n,o,r,i)}return new R(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var A=[1,3,4,5,7,8,10],_=[2,9,11],I=[1,3,4,5,7,8,10,11],O=[1,3,4,5,7,8];function L(e){return function(t,n){for(var o,r=n?t:t.parentNode;r;){if(o=r.nodeType,m(e,o))return r;r=r.parentNode}return null}}var k=L([9,11]),D=L([5,6,10,12]),M=L([6,10,12]);function B(e,t){if(M(e,t))throw new i("INVALID_NODE_TYPE_ERR")}function P(e,t){if(!m(t,e.nodeType))throw new i("INVALID_NODE_TYPE_ERR")}function H(e,t){if(t<0||t>(a(e)?e.length:e.childNodes.length))throw new i("INDEX_SIZE_ERR")}function z(e,t){if(k(e,!0)!==k(t,!0))throw new i("WRONG_DOCUMENT_ERR")}function q(e){if(D(e,!0))throw new i("NO_MODIFICATION_ALLOWED_ERR")}function V(e,t){if(!e)throw new i(t)}function W(e){return g&&n.isBrokenNode(e)||!m(_,e.nodeType)&&!k(e,!0)}function U(e,t){return t<=(a(e)?e.length:e.childNodes.length)}function j(e){return!!e.startContainer&&!!e.endContainer&&!W(e.startContainer)&&!W(e.endContainer)&&U(e.startContainer,e.startOffset)&&U(e.endContainer,e.endOffset)}function F(e){if(!j(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}var K=document.createElement("style"),G=!1;try{K.innerHTML="<b>x</b>",G=3==K.firstChild.nodeType}catch(e){}e.features.htmlParsingConforms=G;var $=G?function(e){var t=this.startContainer,o=c(t);if(!t)throw new i("INVALID_STATE_ERR");var r=null;return 1==t.nodeType?r=t:a(t)&&(r=n.parentElement(t)),(r=null===r||"HTML"==r.nodeName&&n.isHtmlNamespace(c(r).documentElement)&&n.isHtmlNamespace(r)?o.createElement("body"):r.cloneNode(!1)).innerHTML=e,n.fragmentFromNodeChildren(r)}:function(e){var t=v(this).createElement("body");return t.innerHTML=e,n.fragmentFromNodeChildren(t)};function X(e,t){F(e);var n=e.startContainer,o=e.startOffset,r=e.endContainer,i=e.endOffset,l=n===r;a(r)&&i>0&&i<r.length&&u(r,i,t),a(n)&&o>0&&o<n.length&&(n=u(n,o,t),l?(i-=o,r=n):r==n.parentNode&&i>=s(n)&&i++,o=0),e.setStartAndEnd(n,o,r,i)}function Y(e){F(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}var Q=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],Z=0,J=1,ee=2,te=3,ne=0,oe=1,re=2,ie=3;function ae(e){e.START_TO_START=Z,e.START_TO_END=J,e.END_TO_END=ee,e.END_TO_START=te,e.NODE_BEFORE=ne,e.NODE_AFTER=oe,e.NODE_BEFORE_AND_AFTER=re,e.NODE_INSIDE=ie}function se(e){ae(e),ae(e.prototype)}function le(e,t){return function(){F(this);var n,o=this.startContainer,r=this.startOffset,i=this.commonAncestorContainer,a=new R(this,!0);o!==i&&(o=(n=w(f(o,i,!0))).node,r=n.offset),x(a,q),a.reset();var s=e(a);return a.detach(),t(this,o,r,o,r),s}}function ce(t,n){function r(e,t){return function(n){P(n,A),P(p(n),_);var o=(e?b:w)(n);(t?i:l)(this,o.node,o.offset)}}function i(e,t,o){var r=e.endContainer,i=e.endOffset;t===e.startContainer&&o===e.startOffset||(p(t)==p(r)&&1!=d(t,o,r,i)||(r=t,i=o),n(e,t,o,r,i))}function l(e,t,o){var r=e.startContainer,i=e.startOffset;t===e.endContainer&&o===e.endOffset||(p(t)==p(r)&&-1!=d(t,o,r,i)||(r=t,i=o),n(e,r,i,t,o))}var c=function(){};c.prototype=e.rangePrototype,t.prototype=new c,o.extend(t.prototype,{setStart:function(e,t){B(e,!0),H(e,t),i(this,e,t)},setEnd:function(e,t){B(e,!0),H(e,t),l(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],o=e[1],r=t,i=o;switch(e.length){case 3:i=e[2];break;case 4:r=e[2],i=e[3]}n(this,t,o,r,i)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:r(!0,!0),setStartAfter:r(!1,!0),setEndBefore:r(!0,!1),setEndAfter:r(!1,!1),collapse:function(e){F(this),e?n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){B(e,!0),n(this,e,0,e,h(e))},selectNode:function(e){B(e,!1),P(e,A);var t=b(e),o=w(e);n(this,t.node,t.offset,o.node,o.offset)},extractContents:le(S,n),deleteContents:le(E,n),canSurroundContents:function(){F(this),q(this.startContainer),q(this.endContainer);var e=new R(this,!0),t=e._first&&y(e._first,this)||e._last&&y(e._last,this);return e.detach(),!t},splitBoundaries:function(){X(this)},splitBoundariesPreservingPositions:function(e){X(this,e)},normalizeBoundaries:function(){F(this);var e=this.startContainer,t=this.startOffset,o=this.endContainer,r=this.endOffset,i=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(o=e,r=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},l=function(n){var i=n.previousSibling;if(i&&i.nodeType==n.nodeType){e=n;var a=n.length;if(t=i.length,n.insertData(0,i.data),i.parentNode.removeChild(i),e==o)r+=t,o=e;else if(o==n.parentNode){var l=s(n);r==l?(o=n,r=a):r>l&&r--}}},c=!0;if(a(o))o.length==r&&i(o);else{if(r>0){var d=o.childNodes[r-1];d&&a(d)&&i(d)}c=!this.collapsed}if(c){if(a(e))0==t&&l(e);else if(t<e.childNodes.length){var u=e.childNodes[t];u&&a(u)&&l(u)}}else e=o,t=r;n(this,e,t,o,r)},collapseToPoint:function(e,t){B(e,!0),H(e,t),this.setStartAndEnd(e,t)}}),se(t)}function de(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:n.getCommonAncestor(e.startContainer,e.endContainer)}function ue(e,t,o,r,i){e.startContainer=t,e.startOffset=o,e.endContainer=r,e.endOffset=i,e.document=n.getDocument(t),de(e)}function fe(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,de(this)}o.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){var n,o,r,i;F(this),z(this.startContainer,t.startContainer);var a=e==te||e==Z?"start":"end",s=e==J||e==Z?"start":"end";return n=this[a+"Container"],o=this[a+"Offset"],r=t[s+"Container"],i=t[s+"Offset"],d(n,o,r,i)},insertNode:function(e){if(F(this),P(e,I),q(this.startContainer),l(e,this.startContainer))throw new i("HIERARCHY_REQUEST_ERR");var t=C(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){var e,t;if(F(this),this.collapsed)return v(this).createDocumentFragment();if(this.startContainer===this.endContainer&&a(this.startContainer))return(e=this.startContainer.cloneNode(!0)).data=e.data.slice(this.startOffset,this.endOffset),(t=v(this).createDocumentFragment()).appendChild(e),t;var n=new R(this,!0);return e=function e(t){for(var n,o,r,a=v(t.range).createDocumentFragment();o=t.next();){if(n=t.isPartiallySelectedSubtree(),o=o.cloneNode(!n),n&&(r=t.getSubtreeIterator(),o.appendChild(e(r)),r.detach()),10==o.nodeType)throw new i("HIERARCHY_REQUEST_ERR");a.appendChild(o)}return a}(n),n.detach(),e},canSurroundContents:function(){F(this),q(this.startContainer),q(this.endContainer);var e=new R(this,!0),t=e._first&&y(e._first,this)||e._last&&y(e._last,this);return e.detach(),!t},surroundContents:function(e){if(P(e,O),!this.canSurroundContents())throw new i("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);C(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){F(this);for(var e,t=new fe(v(this)),n=Q.length;n--;)t[e=Q[n]]=this[e];return t},toString:function(){F(this);var e=this.startContainer;if(e===this.endContainer&&a(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new R(this,!0);return x(n,function(e){3!=e.nodeType&&4!=e.nodeType||t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){F(this);var t=e.parentNode,n=s(e);if(!t)throw new i("NOT_FOUND_ERR");var o=this.comparePoint(t,n),r=this.comparePoint(t,n+1);return o<0?r>0?re:ne:r>0?oe:ie},comparePoint:function(e,t){return F(this),V(e,"HIERARCHY_REQUEST_ERR"),z(e,this.startContainer),d(e,t,this.startContainer,this.startOffset)<0?-1:d(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:$,toHtml:function(){return Y(this)},intersectsNode:function(e,t){if(F(this),V(e,"NOT_FOUND_ERR"),c(e)!==v(this))return!1;var n=e.parentNode,o=s(e);V(n,"NOT_FOUND_ERR");var r=d(n,o,this.endContainer,this.endOffset),i=d(n,o+1,this.startContainer,this.startOffset);return t?r<=0&&i>=0:r<0&&i>0},isPointInRange:function(e,t){return F(this),V(e,"HIERARCHY_REQUEST_ERR"),z(e,this.startContainer),d(e,t,this.startContainer,this.startOffset)>=0&&d(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return N(this,e,!1)},intersectsOrTouchesRange:function(e){return N(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=d(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=d(this.endContainer,this.endOffset,e.endContainer,e.endOffset),o=this.cloneRange();return-1==t&&o.setStart(e.startContainer,e.startOffset),1==n&&o.setEnd(e.endContainer,e.endOffset),o}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==d(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==d(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new i("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==ie},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,h(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var o=n.pop();return t.setEnd(o,o.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return F(this),function(e,t,n){var o,r=!(!t||!t.length),i=!!n;r&&(o=new RegExp("^("+t.join("|")+")$"));var s=[];return x(new R(e,!1),function(t){if((!r||o.test(t.nodeType))&&(!i||n(t))){var l=e.startContainer;if(t!=l||!a(l)||e.startOffset!=l.length){var c=e.endContainer;t==c&&a(c)&&0==e.endOffset||s.push(t)}}}),s}(this,e,t)},getDocument:function(){return v(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var o=v(this),r=e.createRange(o);t=t||n.getBody(o),r.selectNodeContents(t);var i=this.intersection(r),a=0,s=0;return i&&(r.setEnd(i.startContainer,i.startOffset),s=(a=r.toString().length)+i.toString().length),{start:a,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var o,r,i,a,s=[t],l=!1,c=!1;!c&&(o=s.pop());)if(3==o.nodeType)r=n+o.length,!l&&e.start>=n&&e.start<=r&&(this.setStart(o,e.start-n),l=!0),l&&e.end>=n&&e.end<=r&&(this.setEnd(o,e.end-n),c=!0),n=r;else for(i=(a=o.childNodes).length;i--;)s.push(a[i])},getName:function(){return"DomRange"},equals:function(e){return fe.rangesEqual(this,e)},isValid:function(){return j(this)},inspect:function(){return T(this)},detach:function(){}}),ce(fe,ue),o.extend(fe,{rangeProperties:Q,RangeIterator:R,copyComparisonConstants:se,createPrototypeRange:ce,inspect:T,toHtml:Y,getRangeDocument:v,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=fe}),v.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,o,r=e.dom,i=e.util,a=r.DomPosition,s=e.DomRange,l=r.getBody,c=r.getContentDocument,d=r.isCharacterDataNode;if(e.features.implementsDomRange&&function(){var o,a,d=s.rangeProperties;function u(e){for(var t,n=d.length;n--;)e[t=d[n]]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,u(this)},s.createPrototypeRange(n,function(e,t,n,o,r){var i=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==o||e.endOffset!=r,s=!e.equals(e.nativeRange);(i||a||s)&&(e.setEnd(o,r),e.setStart(t,n))}),(o=n.prototype).selectNode=function(e){this.nativeRange.selectNode(e),u(this)},o.cloneContents=function(){return this.nativeRange.cloneContents()},o.surroundContents=function(e){this.nativeRange.surroundContents(e),u(this)},o.collapse=function(e){this.nativeRange.collapse(e),u(this)},o.cloneRange=function(){return new n(this.nativeRange.cloneRange())},o.refresh=function(){u(this)},o.toString=function(){return this.nativeRange.toString()};var f=document.createTextNode("test");l(document).appendChild(f);var h=document.createRange();h.setStart(f,0),h.setEnd(f,0);try{h.setStart(f,1),o.setStart=function(e,t){this.nativeRange.setStart(e,t),u(this)},o.setEnd=function(e,t){this.nativeRange.setEnd(e,t),u(this)},a=function(e){return function(t){this.nativeRange[e](t),u(this)}}}catch(e){o.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}u(this)},o.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}u(this)},a=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(o){this.nativeRange[t](n),this.nativeRange[e](n)}u(this)}}}o.setStartBefore=a("setStartBefore","setEndBefore"),o.setStartAfter=a("setStartAfter","setEndAfter"),o.setEndBefore=a("setEndBefore","setStartBefore"),o.setEndAfter=a("setEndAfter","setStartAfter"),o.selectNodeContents=function(e){this.setStartAndEnd(e,0,r.getNodeLength(e))},h.selectNodeContents(f),h.setEnd(f,3);var m=document.createRange();m.selectNodeContents(f),m.setEnd(f,4),m.setStart(f,2),-1==h.compareBoundaryPoints(h.START_TO_END,m)&&1==h.compareBoundaryPoints(h.END_TO_START,m)?o.compareBoundaryPoints=function(e,t){return e==(t=t.nativeRange||t).START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:o.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var p=document.createElement("div");p.innerHTML="123";var g=p.firstChild,y=l(document);y.appendChild(p),h.setStart(g,1),h.setEnd(g,2),h.deleteContents(),"13"==g.data&&(o.deleteContents=function(){this.nativeRange.deleteContents(),u(this)},o.extractContents=function(){var e=this.nativeRange.extractContents();return u(this),e}),y.removeChild(p),y=null,i.isHostMethod(h,"createContextualFragment")&&(o.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),l(document).removeChild(f),o.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return(e=c(e,t,"createNativeRange")).createRange()}}(),e.features.implementsTextRange){var u=function(e,t,n,o,i){var s=e.duplicate();s.collapse(n);var l=s.parentElement();if(r.isOrIsAncestorOf(t,l)||(l=t),!l.canHaveHTML){var c=new a(l.parentNode,r.getNodeIndex(l));return{boundaryPosition:c,nodeInfo:{nodeIndex:c.offset,containerElement:c.node}}}var u=r.getDocument(l).createElement("span");u.parentNode&&u.parentNode.removeChild(u);for(var f,h,m,p,g,y=n?"StartToStart":"StartToEnd",v=i&&i.containerElement==l?i.nodeIndex:0,b=l.childNodes.length,w=b,C=w;C==b?l.appendChild(u):l.insertBefore(u,l.childNodes[C]),s.moveToElementText(u),0!=(f=s.compareEndPoints(y,e))&&v!=w;){if(-1==f){if(w==v+1)break;v=C}else w=w==v+1?v:C;C=Math.floor((v+w)/2),l.removeChild(u)}if(g=u.nextSibling,-1==f&&g&&d(g)){var N;if(s.setEndPoint(n?"EndToStart":"EndToEnd",e),/[\r\n]/.test(g.data)){var x=s.duplicate(),E=x.text.replace(/\r\n/g,"\r").length;for(N=x.moveStart("character",E);-1==(f=x.compareEndPoints("StartToEnd",x));)N++,x.moveStart("character",1)}else N=s.text.length;p=new a(g,N)}else h=(o||!n)&&u.previousSibling,p=(m=(o||n)&&u.nextSibling)&&d(m)?new a(m,0):h&&d(h)?new a(h,h.data.length):new a(l,r.getNodeIndex(u));return u.parentNode.removeChild(u),{boundaryPosition:p,nodeInfo:{nodeIndex:C,containerElement:l}}},f=function(e,t){var n,o,i,a,s=e.offset,c=r.getDocument(e.node),u=l(c).createTextRange(),f=d(e.node);return f?o=(n=e.node).parentNode:(n=s<(a=e.node.childNodes).length?a[s]:null,o=e.node),(i=c.createElement("span")).innerHTML="&#feff;",n?o.insertBefore(i,n):o.appendChild(i),u.moveToElementText(i),u.collapse(!t),o.removeChild(i),f&&u[t?"moveStart":"moveEnd"]("character",s),u};(o=function(e){this.textRange=e,this.refresh()}).prototype=new s(document),o.prototype.refresh=function(){var e,t,n,o,i=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var o=n.parentElement();(n=e.duplicate()).collapse(!1);var i=n.parentElement(),a=o==i?o:r.getCommonAncestor(o,i);return a==t?a:r.getCommonAncestor(t,a)}(this.textRange);0==(o=this.textRange).compareEndPoints("StartToEnd",o)?t=e=u(this.textRange,i,!0,!0).boundaryPosition:(e=(n=u(this.textRange,i,!0,!1)).boundaryPosition,t=u(this.textRange,i,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},o.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(o);var h=function(e){if(e.collapsed)return f(new a(e.startContainer,e.startOffset),!0);var t=f(new a(e.startContainer,e.startOffset),!0),n=f(new a(e.endContainer,e.endOffset),!1),o=l(s.getRangeDocument(e)).createTextRange();return o.setEndPoint("StartToStart",t),o.setEndPoint("EndToEnd",n),o};if(o.rangeToTextRange=h,o.prototype.toTextRange=function(){return h(this)},e.WrappedTextRange=o,!e.features.implementsDomRange||e.config.preferTextRange){var m=function(){return this}();void 0===m.Range&&(m.Range=o),e.createNativeRange=function(e){return e=c(e,t,"createNativeRange"),l(e).createTextRange()},e.WrappedRange=o}}e.createRange=function(n){return n=c(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=c(e,t,"createRangyRange"),new s(e)},e.createIframeRange=function(n){return t.deprecationNotice("createIframeRange()","createRange(iframeEl)"),e.createRange(n)},e.createIframeRangyRange=function(n){return t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),e.createRangyRange(n)},e.addShimListener(function(t){var n=t.document;void 0===n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),v.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){e.config.checkSelectionRanges=!0;var n,o,r="boolean",i="number",a=e.dom,s=e.util,l=s.isHostMethod,c=e.DomRange,d=e.WrappedRange,u=e.DOMException,f=a.DomPosition,h=e.features,m="Control",p=a.getDocument,g=a.getBody,y=c.rangesEqual;function v(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function b(e,n){if(e){if(a.isWindow(e))return e;if(e instanceof F)return e.win;var o=a.getContentDocument(e,t,n);return a.getWindow(o)}return window}function w(e){return b(e,"getDocSelection").document.selection}function C(e){var t=!1;return e.anchorNode&&(t=1==a.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}var N=l(window,"getSelection"),x=s.isHostObject(document,"selection");h.implementsWinGetSelection=N,h.implementsDocSelection=x;var E=x&&(!N||e.config.preferTextRange);E?(n=w,e.isSelectionValid=function(e){var t=b(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||p(n.createRange().parentElement())==t}):N?(n=function(e){return b(e,"getWinSelection").getSelection()},e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=n;var S=n(),T=e.createNativeRange(document),R=g(document),A=s.areHostProperties(S,["anchorNode","focusNode","anchorOffset","focusOffset"]);h.selectionHasAnchorAndFocus=A;var _=l(S,"extend");h.selectionHasExtend=_;var I=typeof S.rangeCount==i;h.selectionHasRangeCount=I;var O=!1,L=!0,k=_?function(t,n){var o=c.getRangeDocument(n),r=e.createRange(o);r.collapseToPoint(n.endContainer,n.endOffset),t.addRange(z(r)),t.extend(n.startContainer,n.startOffset)}:null;s.areHostMethods(S,["addRange","getRangeAt","removeAllRanges"])&&typeof S.rangeCount==i&&h.implementsDomRange&&function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,o=n>1,r=[],i=C(t),a=0;a<n;++a)r[a]=t.getRangeAt(a);var s=g(document),l=s.appendChild(document.createElement("div"));l.contentEditable="false";var c=l.appendChild(document.createTextNode("   ")),d=document.createRange();if(d.setStart(c,1),d.collapse(!0),t.addRange(d),L=1==t.rangeCount,t.removeAllRanges(),!o){var u=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(u&&parseInt(u[1])>=36)O=!1;else{var f=d.cloneRange();d.setStart(c,0),f.setEnd(c,3),f.setStart(c,2),t.addRange(d),t.addRange(f),O=2==t.rangeCount}}for(s.removeChild(l),t.removeAllRanges(),a=0;a<n;++a)0==a&&i?k?k(t,r[a]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(r[a])):t.addRange(r[a])}}(),h.selectionSupportsMultipleRanges=O,h.collapsedNonEditableSelectionsSupported=L;var D,M,B=!1;function P(e,t,n){var o=n?"end":"start",r=n?"start":"end";e.anchorNode=t[o+"Container"],e.anchorOffset=t[o+"Offset"],e.focusNode=t[r+"Container"],e.focusOffset=t[r+"Offset"]}function H(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function z(t){var n;return t instanceof c?((n=e.createNativeRange(t.getDocument())).setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof d?n=t.nativeRange:h.implementsDomRange&&t instanceof a.getWindow(t.startContainer).Range&&(n=t),n}function q(e){var n=e.getNodes();if(!function(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;t<n;++t)if(!a.isAncestorOf(e[0],e[t]))return!1;return!0}(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function V(e){return!!e&&void 0!==e.text}function W(e,t){var n=new d(t);e._ranges=[n],P(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function U(t){if(t._ranges.length=0,"None"==t.docSelection.type)H(t);else{var n=t.docSelection.createRange();if(V(n))W(t,n);else{t.rangeCount=n.length;for(var o,r=p(n.item(0)),i=0;i<t.rangeCount;++i)(o=e.createRange(r)).selectNode(n.item(i)),t._ranges.push(o);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,P(t,t._ranges[t.rangeCount-1],!1)}}}function j(e,n){for(var o=e.docSelection.createRange(),r=q(n),i=p(o.item(0)),a=g(i).createControlRange(),s=0,l=o.length;s<l;++s)a.add(o.item(s));try{a.add(r)}catch(e){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),U(e)}function F(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function K(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}R&&l(R,"createControlRange")&&(D=R.createControlRange(),s.areHostProperties(D,["item","add"])&&(B=!0)),h.implementsControlRange=B,o=A?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed},l(S,"getRangeAt")?M=function(e,t){try{return e.getRangeAt(t)}catch(e){return null}}:A&&(M=function(t){var n=p(t.anchorNode),o=e.createRange(n);return o.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),o.collapsed!==this.isCollapsed&&o.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),o}),F.prototype=e.selectionPrototype;var G=[];function $(e,t){for(var n,o,r=G.length;r--;)if(o=(n=G[r]).selection,"deleteAll"==t)K(o);else if(n.win==e)return"delete"==t?(G.splice(r,1),!0):o;return"deleteAll"==t&&(G.length=0),null}var X=function(e){if(e&&e instanceof F)return e.refresh(),e;var t=$(e=b(e,"getNativeSelection")),o=n(e),r=x?w(e):null;return t?(t.nativeSelection=o,t.docSelection=r,t.refresh()):(t=new F(o,r,e),G.push({win:e,selection:t})),t};e.getSelection=X,e.getIframeSelection=function(n){return t.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),e.getSelection(a.getIframeWindow(n))};var Y,Q=F.prototype;function Z(e,n){for(var o,r=p(n[0].startContainer),i=g(r).createControlRange(),a=0,s=n.length;a<s;++a){o=q(n[a]);try{i.add(o)}catch(e){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),U(e)}if(!E&&A&&s.areHostMethods(S,["removeAllRanges","addRange"])){Q.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),H(this)};var J=function(e,t){k(e.nativeSelection,t),e.refresh()};Q.addRange=I?function(t,n){var r;if(B&&x&&this.docSelection.type==m)j(this,t);else if(v(n)&&_)J(this,t);else if(O?r=this.rangeCount:(this.removeAllRanges(),r=0),this.nativeSelection.addRange(z(t).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==r+1){if(e.config.checkSelectionRanges){var i=M(this.nativeSelection,this.rangeCount-1);i&&!y(i,t)&&(t=new d(i))}this._ranges[this.rangeCount-1]=t,P(this,t,ee(this.nativeSelection)),this.isCollapsed=o(this)}else this.refresh()}:function(e,t){v(t)&&_?J(this,e):(this.nativeSelection.addRange(z(e)),this.refresh())},Q.setRanges=function(e){if(B&&x&&e.length>1)Z(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(l(S,"empty")&&l(T,"select")&&B&&E))return t.fail("No means of selecting a Range or TextRange was found"),!1;Q.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=p(this.anchorNode);else if(this.docSelection.type==m){var t=this.docSelection.createRange();t.length&&(e=p(t.item(0)))}if(e)g(e).createTextRange().select(),this.docSelection.empty()}}catch(e){}H(this)},Q.addRange=function(t){this.docSelection.type==m?j(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,P(this,t,!1))},Q.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?Z(this,e):t&&this.addRange(e[0])}}if(Q.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new u("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()},E)Y=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=g(t.win.document).createTextRange()).collapse(!0),t.docSelection.type==m?U(t):V(n)?W(t,n):H(t)};else if(l(S,"getRangeAt")&&typeof S.rangeCount==i)Y=function(t){if(B&&x&&t.docSelection.type==m)U(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,r=t.rangeCount;n<r;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));P(t,t._ranges[t.rangeCount-1],ee(t.nativeSelection)),t.isCollapsed=o(t)}else H(t)};else{if(!A||typeof S.isCollapsed!=r||typeof T.collapsed!=r||!h.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;Y=function(e){var t,n,r,i=e.nativeSelection;i.anchorNode?(t=M(i,0),e._ranges=[t],e.rangeCount=1,r=(n=e).nativeSelection,n.anchorNode=r.anchorNode,n.anchorOffset=r.anchorOffset,n.focusNode=r.focusNode,n.focusOffset=r.focusOffset,e.isCollapsed=o(e)):H(e)}}Q.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,o=this.anchorOffset;if(Y(this),e){var r=t.length;if(r!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=o)return!0;for(;r--;)if(!y(t[r],this._ranges[r]))return!0;return!1}};var ee,te=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var o=0,r=n.length;o<r;++o)y(t,n[o])||e.addRange(n[o]);e.rangeCount||H(e)};function ne(e,t){if(e.win.document!=p(t))throw new u("WRONG_DOCUMENT_ERR")}function oe(t){return function(n,o){var r;this.rangeCount?(r=this.getRangeAt(0))["set"+(t?"Start":"End")](n,o):(r=e.createRange(this.win.document)).setStartAndEnd(n,o),this.setSingleRange(r,this.isBackward())}}function re(e){var t=[],n=new f(e.anchorNode,e.anchorOffset),o=new f(e.focusNode,e.focusOffset),r="function"==typeof e.getName?e.getName():"Selection";if(void 0!==e.rangeCount)for(var i=0,a=e.rangeCount;i<a;++i)t[i]=c.inspect(e.getRangeAt(i));return"["+r+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+o.inspect()+"]"}Q.removeRange=B&&x?function(e){if(this.docSelection.type==m){for(var t=this.docSelection.createRange(),n=q(e),o=p(t.item(0)),r=g(o).createControlRange(),i=!1,a=0,s=t.length;a<s;++a)t.item(a)!==n||i?r.add(t.item(a)):i=!0;r.select(),U(this)}else te(this,e)}:function(e){te(this,e)},!E&&A&&h.implementsDomRange?(ee=C,Q.isBackward=function(){return ee(this)}):ee=Q.isBackward=function(){return!1},Q.isBackwards=Q.isBackward,Q.toString=function(){for(var e=[],t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},Q.collapse=function(t,n){ne(this,t);var o=e.createRange(t);o.collapseToPoint(t,n),this.setSingleRange(o),this.isCollapsed=!0},Q.collapseToStart=function(){if(!this.rangeCount)throw new u("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},Q.collapseToEnd=function(){if(!this.rangeCount)throw new u("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},Q.selectAllChildren=function(t){ne(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},Q.deleteFromDocument=function(){if(B&&x&&this.docSelection.type==m){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var o=0,r=n.length;o<r;++o)n[o].deleteContents();this.addRange(n[r-1])}}},Q.eachRange=function(e,t){for(var n=0,o=this._ranges.length;n<o;++n)if(e(this.getRangeAt(n)))return t},Q.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},Q.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},Q.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(o){n.push(o[e].apply(o,t))}),n},Q.setStart=oe(!0),Q.setEnd=oe(!1),e.rangePrototype.select=function(e){X(this.getDocument()).setSingleRange(this,e)},Q.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},Q.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)||!1},Q.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},Q.moveToBookmark=function(t){for(var n,o,r=[],i=0;n=t.rangeBookmarks[i++];)(o=e.createRange(this.win)).moveToBookmark(n),r.push(o);t.backward?this.setSingleRange(r[0],"backward"):this.setRanges(r)},Q.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(c.toHtml(t))}),e.join("")},h.implementsTextRange&&(Q.getNativeTextRange=function(){var n;if(n=this.docSelection){var o=n.createRange();if(V(o))return o;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),Q.getName=function(){return"WrappedSelection"},Q.inspect=function(){return re(this)},Q.detach=function(){$(this.win,"delete"),K(this)},F.detachAll=function(){$(null,"deleteAll")},F.inspect=re,F.isDirectionBackward=v,e.Selection=F,e.selectionPrototype=Q,e.addShimListener(function(e){void 0===e.getSelection&&(e.getSelection=function(){return X(e)}),e=null})}),v;C("No document found")}else C("No window found")},this.rangy=n(),function(e){e.createModule("SaveRestore",["WrappedRange"],function(e,t){var n=e.dom,o="\ufeff";function r(e,t){return(t||document).getElementById(e)}function i(e,t){var r,i="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),a=n.getDocument(e.startContainer),s=e.cloneRange();return s.collapse(t),(r=a.createElement("span")).id=i,r.style.lineHeight="0",r.style.display="none",r.className="rangySelectionBoundary",r.appendChild(a.createTextNode(o)),s.insertNode(r),r}function a(e,n,o,i){var a=r(o,e);a?(n[i?"setStartBefore":"setEndBefore"](a),a.parentNode.removeChild(a)):t.warn("Marker element has been removed. Cannot restore selection.")}function s(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function l(t,n){var o,r=e.DomRange.getRangeDocument(t),a=t.toString();return t.collapsed?{document:r,markerId:(o=i(t,!1)).id,collapsed:!0}:(o=i(t,!1),{document:r,startMarkerId:i(t,!0).id,endMarkerId:o.id,collapsed:!1,backward:n,toString:function(){return"original text: '"+a+"', new text: '"+t.toString()+"'"}})}function c(n,o){var i=n.document;void 0===o&&(o=!0);var s=e.createRange(i);if(n.collapsed){var l=r(n.markerId,i);if(l){l.style.display="inline";var c=l.previousSibling;c&&3==c.nodeType?(l.parentNode.removeChild(l),s.collapseToPoint(c,c.length)):(s.collapseBefore(l),l.parentNode.removeChild(l))}else t.warn("Marker element has been removed. Cannot restore selection.")}else a(i,s,n.startMarkerId,!0),a(i,s,n.endMarkerId,!1);return o&&s.normalizeBoundaries(),s}function d(t,n){var o,i,a=[];(t=t.slice(0)).sort(s);for(var c=0,d=t.length;c<d;++c)a[c]=l(t[c],n);for(c=d-1;c>=0;--c)o=t[c],i=e.DomRange.getRangeDocument(o),o.collapsed?o.collapseAfter(r(a[c].markerId,i)):(o.setEndBefore(r(a[c].endMarkerId,i)),o.setStartAfter(r(a[c].startMarkerId,i)));return a}function u(e){for(var t=[],n=e.length-1;n>=0;n--)t[n]=c(e[n],!0);return t}function f(e,t){var n=r(t,e);n&&n.parentNode.removeChild(n)}e.util.extend(e,{saveRange:l,restoreRange:c,saveRanges:d,restoreRanges:u,saveSelection:function(n){if(!e.isSelectionValid(n))return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var o=e.getSelection(n),r=o.getAllRanges(),i=1==r.length&&o.isBackward(),a=d(r,i);return i?o.setSingleRange(r[0],"backward"):o.setRanges(r),{win:n,rangeInfos:a,restored:!1}},restoreSelection:function(t,n){if(!t.restored){var o=t.rangeInfos,r=e.getSelection(t.win),i=u(o);1==o.length&&n&&e.features.selectionHasExtend&&o[0].backward?(r.removeAllRanges(),r.addRange(i[0],!0)):r.setRanges(i),t.restored=!0}},removeMarkerElement:f,removeMarkers:function(e){for(var t,n=e.rangeInfos,o=0,r=n.length;o<r;++o)(t=n[o]).collapsed?f(e.doc,t.markerId):(f(e.doc,t.startMarkerId),f(e.doc,t.endMarkerId))}})})}(this.rangy);var r,i,a,s,l,d,u,f,h,m,p,g,y,v,b,w,C,N,x,E,S,T,R,A,_,I,O,L,k,D,M,B,P,H,z,q,V,W,U,j,F,K,G,$,X,Y,Q,Z,J,ee,te,ne,oe,re,ie,ae,se,le,ce,de,ue,fe,he,me,pe,ge,ye,ve,be,we,Ce,Ne,xe,Ee,Se,Te,Re,Ae,_e,Ie,Oe,Le,ke,De,Me,Be,Pe,He,ze,qe,Ve,We,Ue,je,Fe,Ke,Ge,$e,Xe,Ye,Qe,Ze,Je,et,tt,nt,ot,rt,it,at,st,lt=function(){};lt.extend=function(e,t){var n=lt.prototype.extend;lt._prototyping=!0;var o=new this;n.call(o,e),o.base=function(){},delete lt._prototyping;var r=o.constructor,i=o.constructor=function(){if(!lt._prototyping)if(this._constructing||this.constructor==i)this._constructing=!0,r.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||n).call(arguments[0],o)};return i.ancestor=this,i.extend=this.extend,i.forEach=this.forEach,i.implement=this.implement,i.prototype=o,i.toString=this.toString,i.valueOf=function(e){return"object"==e?i:r.valueOf()},n.call(i,t),"function"==typeof i.init&&i.init(),i},lt.prototype={extend:function(e,t){if(arguments.length>1){var n=this[e];if(n&&"function"==typeof t&&(!n.valueOf||n.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)){var o=t.valueOf();(t=function(){var e=this.base||lt.prototype.base;this.base=n;var t=o.apply(this,arguments);return this.base=e,t}).valueOf=function(e){return"object"==e?t:o},t.toString=lt.toString}this[e]=t}else if(e){var r=lt.prototype.extend;lt._prototyping||"function"==typeof this||(r=this.extend||r);for(var i={toSource:null},a=["constructor","toString","valueOf"],s=lt._prototyping?0:1;l=a[s++];)e[l]!=i[l]&&r.call(this,l,e[l]);for(var l in e)i[l]||r.call(this,l,e[l])}return this}},lt=lt.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,n){for(var o in e)void 0===this.prototype[o]&&t.call(n,e[o],o,e)},implement:function(){for(var e=0;e<arguments.length;e++)"function"==typeof arguments[e]?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return String(this.valueOf())}}),o.browser=function(){var e,t,n=navigator.userAgent,o=document.createElement("div"),r=-1!==n.indexOf("Gecko")&&-1===n.indexOf("KHTML"),i=-1!==n.indexOf("AppleWebKit/"),a=-1!==n.indexOf("Chrome/"),s=-1!==n.indexOf("Opera/");function l(e,t){var n,o=-1;return"Microsoft Internet Explorer"==navigator.appName?n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):"Netscape"==navigator.appName&&(n=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")),n&&null!=n.exec(navigator.userAgent)&&(o=parseFloat(RegExp.$1)),-1!==o&&(!e||(t?"<"===t?e<o:">"===t?e>o:"<="===t?e<=o:">="===t?e>=o:void 0:e===o))}return{USER_AGENT:n,supported:function(){var e,t=this.USER_AGENT.toLowerCase(),n="contentEditable"in o,r=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,i=document.querySelector&&document.querySelectorAll,a=this.isIos()&&+(/ipad|iphone|ipod/.test(e=t)&&e.match(/ os (\d+).+? like mac os x/)||[void 0,0])[1]<5||this.isAndroid()&&+(t.match(/android (\d+)/)||[void 0,0])[1]<4||-1!==t.indexOf("opera mobi")||-1!==t.indexOf("hpwos/");return n&&r&&i&&!a},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},supportsSandboxedIframes:function(){return l()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return l()},hasCurrentStyleProperty:function(){return"currentStyle"in o},hasHistoryIssue:function(){return r&&"Mac"===navigator.platform.substr(0,3)},insertsLineBreaksOnReturn:function(){return r},supportsPlaceholderAttributeOn:function(e){return"placeholder"in e},supportsEvent:function(e){return"on"+e in o||(o.setAttribute("on"+e,"return;"),"function"==typeof o["on"+e])},supportsEventsInIframeCorrectly:function(){return!s},supportsHTML5Tags:function(e){var t=e.createElement("div"),n="<article>foo</article>";return t.innerHTML=n,t.innerHTML.toLowerCase()===n},supportsCommand:(e={formatBlock:l(10,"<="),insertUnorderedList:l(),insertOrderedList:l()},t={insertHTML:r},function(n,o){if(!e[o]){try{return n.queryCommandSupported(o)}catch(e){}try{return n.queryCommandEnabled(o)}catch(e){return!!t[o]}}return!1}),doesAutoLinkingInContentEditable:function(){return l()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return r||s||i},supportsGetAttributeCorrectly:function(){return"1"!=document.createElement("td").getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return r||l()||s},autoScrollsToCaret:function(){return!i},autoClosesUnclosedTags:function(){var e,t,n=o.cloneNode(!1);return n.innerHTML="<p><div></div>",t=n.innerHTML.toLowerCase(),e="<p></p><div></div>"===t||"<p><div></div></p>"===t,this.autoClosesUnclosedTags=function(){return e},e},supportsNativeGetElementsByClassName:function(){return-1!==String(document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return s},supportsSpeechApiOn:function(e){return(n.match(/Chrome\/(\d+)/)||[void 0,0])[1]>=11&&("onwebkitspeechchange"in e||"speech"in e)},crashesWhenDefineProperty:function(e){return l(9)&&("XMLHttpRequest"===e||"XDomainRequest"===e)},doesAsyncFocus:function(){return l()},hasProblemsSettingCaretAfterImg:function(){return l()},hasUndoInContextMenu:function(){return r||a||s},hasInsertNodeIssue:function(){return s},hasIframeFocusIssue:function(){return l()},createsNestedInvalidMarkupAfterPaste:function(){return i},supportsMutationEvents:function(){return"MutationEvent"in window}}}(),o.lang.array=function(e){return{contains:function(t){if(Array.isArray(t)){for(var n=t.length;n--;)if(-1!==o.lang.array(e).indexOf(t[n]))return!0;return!1}return-1!==o.lang.array(e).indexOf(t)},indexOf:function(t){if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1},without:function(t){t=o.lang.array(t);for(var n=[],r=0,i=e.length;r<i;r++)t.contains(e[r])||n.push(e[r]);return n},get:function(){for(var t=0,n=e.length,o=[];t<n;t++)o.push(e[t]);return o},map:function(t,n){if(Array.prototype.map)return e.map(t,n);for(var o=e.length>>>0,r=new Array(o),i=0;i<o;i++)r[i]=t.call(n,e[i],i,e);return r},unique:function(){for(var t=[],n=e.length,r=0;r<n;)o.lang.array(t).contains(e[r])||t.push(e[r]),r++;return t}}},o.lang.Dispatcher=lt.extend({on:function(e,t){return this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t),this},off:function(e,t){this.events=this.events||{};var n,o,r=0;if(e){for(n=this.events[e]||[],o=[];r<n.length;r++)n[r]!==t&&t&&o.push(n[r]);this.events[e]=o}else this.events={};return this},fire:function(e,t){this.events=this.events||{};for(var n=this.events[e]||[],o=0;o<n.length;o++)n[o].call(this,t);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),o.lang.object=function(e){return{merge:function(t){for(var n in t)e[n]=t[n];return this},get:function(){return e},clone:function(){var t,n={};for(t in e)n[t]=e[t];return n},isArray:function(){return"[object Array]"===Object.prototype.toString.call(e)}}},r=/^\s+/,i=/\s+$/,a=/[&<>"]/g,s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},o.lang.string=function(e){return e=String(e),{trim:function(){return e.replace(r,"").replace(i,"")},interpolate:function(t){for(var n in t)e=this.replace("#{"+n+"}").by(t[n]);return e},replace:function(t){return{by:function(n){return e.split(t).join(n)}}},escapeHTML:function(){return e.replace(a,function(e){return s[e]})}}},function(e){var t=e.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),n=/((https?:\/\/|www\.)[^\s<]{3,})/gi,o=/([^\w\/\-](,?))$/i,r=100,i={")":"(","]":"[","}":"{"};e.dom.autoLink=function(a,s){return function(n,o){for(var r;n.parentNode;){if(n=n.parentNode,r=n.nodeName,n.className&&e.lang.array(n.className.split(" ")).contains(o))return!0;if(t.contains(r))return!0;if("body"===r)return!1}return!1}(a,s)?a:(a===a.ownerDocument.documentElement&&(a=a.ownerDocument.body),function a(s,l){if(!(t.contains(s.nodeName)||s.className&&e.lang.array(s.className.split(" ")).contains(l))){if(s.nodeType!==e.TEXT_NODE||!s.data.match(n)){for(var c=e.lang.array(s.childNodes).get(),d=c.length,u=0;u<d;u++)a(c[u],l);return s}!function(t){var a=t.parentNode,s=e.lang.string(t.data).escapeHTML(),l=function(e){var t=e._wysihtml5_tempElement;return t||(t=e._wysihtml5_tempElement=e.createElement("div")),t}(a.ownerDocument);for(l.innerHTML="<span></span>"+s.replace(n,function(e,t){var n=(t.match(o)||[])[1]||"",a=i[n];(t=t.replace(o,"")).split(a).length>t.split(n).length&&(t+=n,n="");var s=t,l=t;return t.length>r&&(l=l.substr(0,r)+"..."),"www."===s.substr(0,4)&&(s="http://"+s),'<a href="'+s+'">'+l+"</a>"+n}),l.removeChild(l.firstChild);l.firstChild;)a.insertBefore(l.firstChild,t);a.removeChild(t)}(s)}}(a,s))},e.dom.autoLink.URL_REG_EXP=n}(o),(l=o.dom).addClass=function(e,t){var n=e.classList;if(n)return n.add(t);l.hasClass(e,t)||(e.className+=" "+t)},l.removeClass=function(e,t){var n=e.classList;if(n)return n.remove(t);e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ")},l.hasClass=function(e,t){var n=e.classList;if(n)return n.contains(t);var o=e.className;return o.length>0&&(o==t||new RegExp("(^|\\s)"+t+"(\\s|$)").test(o))},o.dom.contains=(d=document.documentElement).contains?function(e,t){return t.nodeType!==o.ELEMENT_NODE&&(t=t.parentNode),e!==t&&e.contains(t)}:d.compareDocumentPosition?function(e,t){return!!(16&e.compareDocumentPosition(t))}:void 0,o.dom.convertToList=function(){function e(e,t){var n=e.createElement("li");return t.appendChild(n),n}return function(t,n,r){if("UL"===t.nodeName||"OL"===t.nodeName||"MENU"===t.nodeName)return t;var i,a,s,l,c,d,u,f,h,m,p=t.ownerDocument,g=(m=n,p.createElement(m)),y=t.querySelectorAll("br"),v=y.length;for(h=0;h<v;h++)for(l=y[h];(c=l.parentNode)&&c!==t&&c.lastChild===l;){if("block"===o.dom.getStyle("display").from(c)){c.removeChild(l);break}o.dom.insert(l).after(l.parentNode)}for(a=(i=o.lang.array(t.childNodes).get()).length,h=0;h<a;h++)f=f||e(p,g),s=i[h],d="block"===o.dom.getStyle("display").from(s),u="BR"===s.nodeName,!d||r&&o.dom.hasClass(s,r)?u?f=f.firstChild?null:f:f.appendChild(s):((f=f.firstChild?e(p,g):f).appendChild(s),f=null);return 0===i.length&&e(p,g),t.parentNode.replaceChild(g,t),g}}(),o.dom.copyAttributes=function(e){return{from:function(t){return{to:function(n){for(var o,r=0,i=e.length;r<i;r++)o=e[r],void 0!==t[o]&&""!==t[o]&&(n[o]=t[o]);return{andTo:arguments.callee}}}}}},u=o.dom,f=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],h=function(e){for(var t=0,n=f.length;t<n;t++)if("border-box"===u.getStyle(f[t]).from(e))return f[t]},u.copyStyles=function(e){return{from:function(t){var n;h(n=t)&&parseInt(u.getStyle("width").from(n),10)<n.offsetWidth&&(e=o.lang.array(e).without(f));for(var r,i="",a=e.length,s=0;s<a;s++)r=e[s],i+=r+":"+u.getStyle(r).from(t)+";";return{to:function(e){return u.setStyles(i).on(e),{andTo:arguments.callee}}}}}},(m=o).dom.delegate=function(e,t,n,o){return m.dom.observe(e,n,function(n){for(var r=n.target,i=m.lang.array(e.querySelectorAll(t));r&&r!==e;){if(i.contains(r)){o.call(r,n);break}r=r.parentNode}})},(p=o).dom.domNode=function(e){var t=[p.ELEMENT_NODE,p.TEXT_NODE],n=function(e){return e.nodeType===p.TEXT_NODE&&/^\s*$/g.test(e.data)};return{prev:function(o){var r=e.previousSibling,i=o&&o.nodeTypes?o.nodeTypes:t;return r?!p.lang.array(i).contains(r.nodeType)||o&&o.ignoreBlankTexts&&n(r)?p.dom.domNode(r).prev(o):r:null},next:function(o){var r=e.nextSibling,i=o&&o.nodeTypes?o.nodeTypes:t;return r?!p.lang.array(i).contains(r.nodeType)||o&&o.ignoreBlankTexts&&n(r)?p.dom.domNode(r).next(o):r:null}}},o.dom.getAsDom=(g=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"],function(e,t){var n;return t=t||document,"object"==typeof e&&e.nodeType?(n=t.createElement("div")).appendChild(e):o.browser.supportsHTML5Tags(t)?(n=t.createElement("div")).innerHTML=e:(function(e){if(!e._wysihtml5_supportsHTML5Tags){for(var t=0,n=g.length;t<n;t++)e.createElement(g[t]);e._wysihtml5_supportsHTML5Tags=!0}}(t),n=function(e,t){var n=t.createElement("div");n.style.display="none",t.body.appendChild(n);try{n.innerHTML=e}catch(e){}return t.body.removeChild(n),n}(e,t)),n}),o.dom.getParentElement=function(){return function(e,t,n,r){var i,a,s,l,c,d,u,f,h,m,p=t.cssStyle||t.styleRegExp,g=t.className||t.classRegExp;for(n=n||50;n--&&e&&"BODY"!==e.nodeName&&(!r||e!==r);){if(e.nodeType===o.ELEMENT_NODE&&(h=e.nodeName,!(m=t.nodeName)||!m.length||("string"==typeof m?h===m:o.lang.array(m).contains(h)))&&(!p||(c=e,d=t.cssStyle,u=t.styleRegExp,void 0,f=(c.getAttribute("style")||"").match(u)||[],d?f[f.length-1]===d:f.length))&&(!g||(i=e,a=t.className,s=t.classRegExp,void 0,l=(i.className||"").match(s)||[],a?l[l.length-1]===a:l.length)))return e;e=e.parentNode}return null}}(),o.dom.getStyle=function(){var e={float:"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},t=/\-[a-z]/g;return function(n){return{from:function(r){if(r.nodeType===o.ELEMENT_NODE){var i=r.ownerDocument,a=e[n]||n.replace(t,function(e){return e.charAt(1).toUpperCase()}),s=r.style,l=r.currentStyle,c=s[a];if(c)return c;if(l)try{return l[a]}catch(e){}var d,u,f=i.defaultView||i.parentWindow,h=("height"===n||"width"===n)&&"TEXTAREA"===r.nodeName;return f.getComputedStyle?(h&&(d=s.overflow,s.overflow="hidden"),u=f.getComputedStyle(r,null).getPropertyValue(n),h&&(s.overflow=d||""),u):void 0}}}}}(),o.dom.getTextNodes=function(e,t){var n=[];for(e=e.firstChild;e;e=e.nextSibling)3==e.nodeType?t&&/^\s*$/.test(e.innerText||e.textContent)||n.push(e):n=n.concat(o.dom.getTextNodes(e,t));return n},o.dom.hasElementWithTagName=function(){var e={},t=1;return function(n,o){var r,i=((r=n)._wysihtml5_identifier||(r._wysihtml5_identifier=t++))+":"+o,a=e[i];return a||(a=e[i]=n.getElementsByTagName(o)),a.length>0}}(),function(e){var t={},n=1;e.dom.hasElementWithClassName=function(o,r){if(!e.browser.supportsNativeGetElementsByClassName())return!!o.querySelector("."+r);var i,a=((i=o)._wysihtml5_identifier||(i._wysihtml5_identifier=n++))+":"+r,s=t[a];return s||(s=t[a]=o.getElementsByClassName(r)),s.length>0}}(o),o.dom.insert=function(e){return{after:function(t){t.parentNode.insertBefore(e,t.nextSibling)},before:function(t){t.parentNode.insertBefore(e,t)},into:function(t){t.appendChild(e)}}},o.dom.insertCSS=function(e){return e=e.join("\n"),{into:function(t){var n=t.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.appendChild(t.createTextNode(e));var o=t.querySelector("head link");if(o)o.parentNode.insertBefore(n,o);else{var r=t.querySelector("head");r&&r.appendChild(n)}}}},(y=o).dom.lineBreaks=function(e){function t(e){return"BR"===e.nodeName}function n(e){return!!t(e)||"block"===y.dom.getStyle("display").from(e)}return{add:function(t){var o=e.ownerDocument,r=y.dom.domNode(e).next({ignoreBlankTexts:!0}),i=y.dom.domNode(e).prev({ignoreBlankTexts:!0});r&&!n(r)&&y.dom.insert(o.createElement("br")).after(e),i&&!n(i)&&y.dom.insert(o.createElement("br")).before(e)},remove:function(n){var o=y.dom.domNode(e).next({ignoreBlankTexts:!0}),r=y.dom.domNode(e).prev({ignoreBlankTexts:!0});o&&t(o)&&o.parentNode.removeChild(o),r&&t(r)&&r.parentNode.removeChild(r)}}},o.dom.observe=function(e,t,n){for(var o,r,i=0,a=(t="string"==typeof t?[t]:t).length;i<a;i++)r=t[i],e.addEventListener?e.addEventListener(r,n,!1):(o=function(t){"target"in t||(t.target=t.srcElement),t.preventDefault=t.preventDefault||function(){this.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){this.cancelBubble=!0},n.call(e,t)},e.attachEvent("on"+r,o));return{stop:function(){for(var r,i=0,a=t.length;i<a;i++)r=t[i],e.removeEventListener?e.removeEventListener(r,n,!1):e.detachEvent("on"+r,o)}}},o.dom.parse=function(){var e={1:function(e,r){var a,s,c=i.tags,u=e.nodeName.toLowerCase(),f=e.scopeName;if(e._wysihtml5)return null;if(e._wysihtml5=1,"wysihtml5-temp"===e.className)return null;f&&"HTML"!=f&&(u=f+":"+u);"outerHTML"in e&&(o.browser.autoClosesUnclosedTags()||"P"!==e.nodeName||"</p>"===e.outerHTML.slice(-4).toLowerCase()||(u="div"));if(u in c){if(!(a=c[u])||a.remove)return null;if(a.unwrap)return!1;a="string"==typeof a?{rename_tag:a}:a}else{if(!e.firstChild)return null;a={rename_tag:t}}if(s=e.ownerDocument.createElement(a.rename_tag||u),function(e,t,r,a){var s,l,c,u,f,h,m,p={},g=r.set_class,y=r.add_class,v=r.add_style,b=r.set_attributes,w=r.check_attributes,C=i.classes,N=0,x=[],R=[],A=[],_=[];if(b&&(p=o.lang.object(b).clone()),w)for(u in w)(h=E[w[u]])&&((m=d(e,u))||"alt"===u&&"IMG"==e.nodeName)&&"string"==typeof(f=h(m))&&(p[u]=f);if(g&&x.push(g),y)for(u in y)(h=T[y[u]])&&"string"==typeof(c=h(d(e,u)))&&x.push(c);if(v)for(u in v)(h=S[v[u]])&&(newStyle=h(d(e,u)),"string"==typeof newStyle&&R.push(newStyle));if("string"==typeof C&&"any"===C&&e.getAttribute("class"))p.class=e.getAttribute("class");else{for(a||(C["_wysihtml5-temp-placeholder"]=1,C._rangySelectionBoundary=1,C["wysiwyg-tmp-selected-cell"]=1),(_=e.getAttribute("class"))&&(x=x.concat(_.split(n))),s=x.length;N<s;N++)l=x[N],C[l]&&A.push(l);A.length&&(p.class=o.lang.array(A).unique().join(" "))}p.class&&a&&(p.class=p.class.replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(p.class)&&delete p.class),R.length&&(p.style=o.lang.array(R).unique().join(" "));for(u in p)try{t.setAttribute(u,p[u])}catch(e){}p.src&&(void 0!==p.width&&t.setAttribute("width",p.width),void 0!==p.height&&t.setAttribute("height",p.height))}(e,s,a,r),function(e,t,n){var o;if(n&&n.keep_styles)for(o in n.keep_styles)n.keep_styles.hasOwnProperty(o)&&("float"==o?(e.style.styleFloat&&(t.style.styleFloat=e.style.styleFloat),e.style.cssFloat&&(t.style.cssFloat=e.style.cssFloat)):e.style[o]&&(t.style[o]=e.style[o]))}(e,s,a),a.one_of_type&&!function(e,t,n,o){var r,i;if("SPAN"===e.nodeName&&!o&&("_wysihtml5-temp-placeholder"===e.className||"rangySelectionBoundary"===e.className))return!0;for(i in n)if(n.hasOwnProperty(i)&&t.type_definitions&&t.type_definitions[i]&&(r=t.type_definitions[i],l(e,r)))return!0;return!1}(e,i,a.one_of_type,r))return(!a.remove_action||"unwrap"!=a.remove_action)&&null;e=null,s.normalize&&s.normalize();return s},3:function(e){var t=e.nextSibling;{if(!t||t.nodeType!==o.TEXT_NODE){var n=e.data.replace(u,"");return e.ownerDocument.createTextNode(n)}t.data=e.data.replace(u,"")+t.data.replace(u,"")}},8:function(e){if(i.comments)return e.ownerDocument.createComment(e.nodeValue)}},t="span",n=/\s+/,r={tags:{},classes:{}},i={},a=!1;function s(n,r,i){var l,c,d,u=n.nodeType,f=n.childNodes,h=f.length,m=e[u],p=0;if(a&&1===u&&o.dom.hasClass(n,a))return n;if(!(c=m&&m(n,i))){if(!1===c){for(l=n.ownerDocument.createDocumentFragment(),p=h;p--;)f[p]&&(d=s(f[p],r,i))&&(f[p]===d&&p--,l.insertBefore(d,l.firstChild));return o.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(n.nodeName.toLowerCase())&&n.parentNode.lastChild!==n&&(n.nextSibling&&3===n.nextSibling.nodeType&&/^\s/.test(n.nextSibling.nodeValue)||l.appendChild(n.ownerDocument.createTextNode(" "))),l.normalize&&l.normalize(),l}return null}for(p=0;p<h;p++)f[p]&&(d=s(f[p],r,i))&&(f[p]===d&&p--,c.appendChild(d));if(r&&c.nodeName.toLowerCase()===t&&(!c.childNodes.length||/^\s*$/gi.test(c.innerHTML)&&(i||"_wysihtml5-temp-placeholder"!==n.className&&"rangySelectionBoundary"!==n.className)||!c.attributes.length)){for(l=c.ownerDocument.createDocumentFragment();c.firstChild;)l.appendChild(c.firstChild);return l.normalize&&l.normalize(),l}return c.normalize&&c.normalize(),c}function l(e,t){var r,i,a,s,l,c=e.getAttribute("class"),u=e.getAttribute("style");if(t.methods)for(var f in t.methods)if(t.methods.hasOwnProperty(f)&&R[f]&&R[f](e))return!0;if(c&&t.classes){r=(c=c.replace(/^\s+/g,"").replace(/\s+$/g,"").split(n)).length;for(var h=0;h<r;h++)if(t.classes[c[h]])return!0}if(u&&t.styles){u=u.split(";");for(i in t.styles)if(t.styles.hasOwnProperty(i))for(var m=u.length;m--;)if((l=u[m].split(":"))[0].replace(/\s/g,"").toLowerCase()===i&&(!0===t.styles[i]||1===t.styles[i]||o.lang.array(t.styles[i]).contains(l[1].replace(/\s/g,"").toLowerCase())))return!0}if(t.attrs)for(a in t.attrs)if(t.attrs.hasOwnProperty(a)&&"string"==typeof(s=d(e,a))&&s.search(t.attrs[a])>-1)return!0;return!1}var c=!o.browser.supportsGetAttributeCorrectly();function d(e,t){return t=t.toLowerCase(),"IMG"==e.nodeName&&"src"==t&&!0===function(e){try{return e.complete&&!e.mozMatchesSelector(":-moz-broken")}catch(t){if(e.complete&&"complete"===e.readyState)return!0}}(e)?e.src:c&&"outerHTML"in e?-1!=e.outerHTML.toLowerCase().indexOf(" "+t+"=")?e.getAttribute(t):null:e.getAttribute(t)}var u=/\uFEFF/g;var f,h,m,p,g,y,v,b,w,C,N,x,E={url:(g=/^https?:\/\//i,function(e){return e&&e.match(g)?e.replace(g,function(e){return e.toLowerCase()}):null}),src:(p=/^(\/|https?:\/\/)/i,function(e){return e&&e.match(p)?e.replace(p,function(e){return e.toLowerCase()}):null}),href:(m=/^(#|\/|https?:\/\/|mailto:)/i,function(e){return e&&e.match(m)?e.replace(m,function(e){return e.toLowerCase()}):null}),alt:(h=/[^ a-z0-9_\-]/gi,function(e){return e?e.replace(h,""):""}),numbers:(f=/\D/g,function(e){return(e=(e||"").replace(f,""))||null}),any:function(e){return e}},S={align_text:(y={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"},function(e){return y[String(e).toLowerCase()]})},T={align_img:(C={left:"wysiwyg-float-left",right:"wysiwyg-float-right"},function(e){return C[String(e).toLowerCase()]}),align_text:(w={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"},function(e){return w[String(e).toLowerCase()]}),clear_br:(b={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"},function(e){return b[String(e).toLowerCase()]}),size_font:(v={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"},function(e){return v[String(e).charAt(0)]})},R={has_visible_contet:(x=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"],function(e){if((N=(e.innerText||e.textContent).replace(/\s/g,""))&&N.length>0)return!0;for(var t=x.length;t--;)if(e.querySelector(x[t]))return!0;return!!(e.offsetWidth&&e.offsetWidth>0&&e.offsetHeight&&e.offsetHeight>0)})};return function(e,t){o.lang.object(i).merge(r).merge(t.rules).get();var n,l,c,d=t.context||e.ownerDocument||document,u=d.createDocumentFragment(),f="string"==typeof e,h=!1;for(!0===t.clearInternals&&(h=!0),t.uneditableClass&&(a=t.uneditableClass),n=f?o.dom.getAsDom(e,d):e;n.firstChild;)(l=s(c=n.firstChild,t.cleanUp,h))&&u.appendChild(l),c!==l&&n.removeChild(c);return n.innerHTML="",n.appendChild(u),f?o.quirks.getCorrectInnerHTML(n):n}}(),o.dom.removeEmptyTextNodes=function(e){for(var t,n=o.lang.array(e.childNodes).get(),r=n.length,i=0;i<r;i++)(t=n[i]).nodeType===o.TEXT_NODE&&""===t.data&&t.parentNode.removeChild(t)},o.dom.renameElement=function(e,t){for(var n,r=e.ownerDocument.createElement(t);n=e.firstChild;)r.appendChild(n);return o.dom.copyAttributes(["align","className"]).from(e).to(r),e.parentNode.replaceChild(r,e),r},o.dom.replaceWithChildNodes=function(e){if(e.parentNode)if(e.firstChild){for(var t=e.ownerDocument.createDocumentFragment();e.firstChild;)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e),e=t=null}else e.parentNode.removeChild(e)},function(e){function t(t){return"block"===e.getStyle("display").from(t)}function n(e){return"BR"===e.nodeName}function r(e){var t=e.ownerDocument.createElement("br");e.appendChild(t)}e.resolveList=function(e,i){if(e.nodeName.match(/^(MENU|UL|OL)$/)){var a,s,l,c,d,u=e.ownerDocument,f=u.createDocumentFragment(),h=o.dom.domNode(e).prev({ignoreBlankTexts:!0});if(i)for(!h||t(h)||n(h)||r(f);d=e.firstElementChild||e.firstChild;){for(s=d.lastChild;a=d.firstChild;)l=a===s&&!t(a)&&!n(a),f.appendChild(a),l&&r(f);d.parentNode.removeChild(d)}else for(;d=e.firstElementChild||e.firstChild;){if(d.querySelector&&d.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;a=d.firstChild;)f.appendChild(a);else{for(c=u.createElement("p");a=d.firstChild;)c.appendChild(a);f.appendChild(c)}d.parentNode.removeChild(d)}e.parentNode.replaceChild(f,e)}}}(o.dom),v=o,b=document,w=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],C=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],N=["referrer","write","open","close"],v.dom.Sandbox=lt.extend({constructor:function(e,t){this.callback=e||v.EMPTY_FUNCTION,this.config=v.lang.object({}).merge(t).get(),this.editableArea=this._createIframe()},insertInto:function(e){"string"==typeof e&&(e=b.getElementById(e)),e.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var e=this.getIframe();e.parentNode.removeChild(e)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var e=this,t=b.createElement("iframe");return t.className="wysihtml5-sandbox",v.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(t),v.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(t.src="javascript:'<html></html>'"),t.onload=function(){t.onreadystatechange=t.onload=null,e._onLoadIframe(t)},t.onreadystatechange=function(){/loaded|complete/.test(t.readyState)&&(t.onreadystatechange=t.onload=null,e._onLoadIframe(t))},t},_onLoadIframe:function(e){if(v.dom.contains(b.documentElement,e)){var t=this,n=e.contentWindow,o=e.contentWindow.document,r=b.characterSet||b.charset||"utf-8",i=this._getHtml({charset:r,stylesheets:this.config.stylesheets});if(o.open("text/html","replace"),o.write(i),o.close(),this.getWindow=function(){return e.contentWindow},this.getDocument=function(){return e.contentWindow.document},n.onerror=function(e,t,n){throw new Error("wysihtml5.Sandbox: "+e,t,n)},!v.browser.supportsSandboxedIframes()){var a,s;for(a=0,s=w.length;a<s;a++)this._unset(n,w[a]);for(a=0,s=C.length;a<s;a++)this._unset(n,C[a],v.EMPTY_FUNCTION);for(a=0,s=N.length;a<s;a++)this._unset(o,N[a]);this._unset(o,"cookie","",!0)}this.loaded=!0,setTimeout(function(){t.callback(t)},0)}},_getHtml:function(e){var t,n=e.stylesheets,o="",r=0;if(n="string"==typeof n?[n]:n)for(t=n.length;r<t;r++)o+='<link rel="stylesheet" href="'+n[r]+'">';return e.stylesheets=o,v.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(e)},_unset:function(e,t,n,o){try{e[t]=n}catch(e){}try{e.__defineGetter__(t,function(){return n})}catch(e){}if(o)try{e.__defineSetter__(t,function(){})}catch(e){}if(!v.browser.crashesWhenDefineProperty(t))try{var r={get:function(){return n}};o&&(r.set=function(){}),Object.defineProperty(e,t,r)}catch(e){}}}),x=o,E=document,x.dom.ContentEditableArea=lt.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView},getDocument:function(){return this.element.ownerDocument},constructor:function(e,t,n){this.callback=e||x.EMPTY_FUNCTION,this.config=x.lang.object({}).merge(t).get(),this.element=n?this._bindElement(n):this._createElement()},_createElement:function(){var e=E.createElement("div");return e.className="wysihtml5-sandbox",this._loadElement(e),e},_bindElement:function(e){return e.className=e.className&&""!=e.className?e.className+" wysihtml5-sandbox":"wysihtml5-sandbox",this._loadElement(e,!0),e},_loadElement:function(e,t){var n=this;if(!t){var o=this._getHtml();e.innerHTML=o}this.getWindow=function(){return e.ownerDocument.defaultView},this.getDocument=function(){return e.ownerDocument},this.loaded=!0,setTimeout(function(){n.callback(n)},0)},_getHtml:function(e){return""}}),S={className:"class"},o.dom.setAttributes=function(e){return{on:function(t){for(var n in e)t.setAttribute(S[n]||n,e[n])}}},o.dom.setStyles=function(e){return{on:function(t){var n=t.style;if("string"!=typeof e)for(var o in e)"float"===o?(n.cssFloat=e[o],n.styleFloat=e[o]):n[o]=e[o];else n.cssText+=";"+e}}},(T=o.dom).simulatePlaceholder=function(e,t,n){var o="placeholder",r=function(){var e=t.element.offsetWidth>0&&t.element.offsetHeight>0;t.hasPlaceholderSet()&&(t.clear(),t.element.focus(),e&&setTimeout(function(){var e=t.selection.getSelection();e.focusNode&&e.anchorNode||t.selection.selectNode(t.element.firstChild||t.element)},0)),t.placeholderSet=!1,T.removeClass(t.element,o)},i=function(){t.isEmpty()&&(t.placeholderSet=!0,t.setValue(n),T.addClass(t.element,o))};e.on("set_placeholder",i).on("unset_placeholder",r).on("focus:composer",r).on("paste:composer",r).on("blur:composer",i),i()},R=o.dom,"textContent"in(A=document.documentElement)?(R.setTextContent=function(e,t){e.textContent=t},R.getTextContent=function(e){return e.textContent}):"innerText"in A?(R.setTextContent=function(e,t){e.innerText=t},R.getTextContent=function(e){return e.innerText}):(R.setTextContent=function(e,t){e.nodeValue=t},R.getTextContent=function(e){return e.nodeValue}),o.dom.getAttribute=function(e,t){var n=!o.browser.supportsGetAttributeCorrectly();return t=t.toLowerCase(),"IMG"==e.nodeName&&"src"==t&&!0===_isLoadedImage(e)?e.src:n&&"outerHTML"in e?-1!=e.outerHTML.toLowerCase().indexOf(" "+t+"=")?e.getAttribute(t):null:e.getAttribute(t)},function(e){var t=e.dom,n=function(e){this.el=e,this.isColspan=!1,this.isRowspan=!1,this.firstCol=!0,this.lastCol=!0,this.firstRow=!0,this.lastRow=!0,this.isReal=!0,this.spanCollection=[],this.modified=!1},o=function(e,n){e?(this.cell=e,this.table=t.getParentElement(e,{nodeName:["TABLE"]})):n&&(this.table=n,this.cell=this.table.querySelectorAll("th, td")[0])};function r(e,t){for(var n,o=[],r=0,i=e.length;r<i;r++)if(n=e[r].querySelectorAll(t))for(var a=n.length;a--;o.unshift(n[a]));return o}function i(e){e.parentNode.removeChild(e)}function a(e,t){e.parentNode.insertBefore(t,e.nextSibling)}function s(e,t){for(var n=e.nextSibling;1!=n.nodeType;)if(n=n.nextSibling,!t||t==n.tagName.toLowerCase())return n;return null}o.prototype={addSpannedCellToMap:function(e,t,o,r,i,a){for(var s=[],l=o+(a?parseInt(a,10)-1:0),c=r+(i?parseInt(i,10)-1:0),d=o;d<=l;d++){void 0===t[d]&&(t[d]=[]);for(var u=r;u<=c;u++)t[d][u]=new n(e),t[d][u].isColspan=i&&parseInt(i,10)>1,t[d][u].isRowspan=a&&parseInt(a,10)>1,t[d][u].firstCol=u==r,t[d][u].lastCol=u==c,t[d][u].firstRow=d==o,t[d][u].lastRow=d==l,t[d][u].isReal=u==r&&d==o,t[d][u].spanCollection=s,s.push(t[d][u])}},setCellAsModified:function(e){if(e.modified=!0,e.spanCollection.length>0)for(var t=0,n=e.spanCollection.length;t<n;t++)e.spanCollection[t].modified=!0},setTableMap:function(){var e,o,r,i,a,s,l,c,d=[],u=this.getTableRows();for(e=0;e<u.length;e++)for(o=u[e],r=this.getRowCells(o),s=0,void 0===d[e]&&(d[e]=[]),i=0;i<r.length;i++){for(a=r[i];void 0!==d[e][s];)s++;l=t.getAttribute(a,"colspan"),c=t.getAttribute(a,"rowspan"),l||c?(this.addSpannedCellToMap(a,d,e,s,l,c),s+=l?parseInt(l,10):1):(d[e][s]=new n(a),s++)}return this.map=d,d},getRowCells:function(t){var n=this.table.querySelectorAll("table"),o=n?r(n,"th, td"):[],i=t.querySelectorAll("th, td");return o.length>0?e.lang.array(i).without(o):i},getTableRows:function(){var t=this.table.querySelectorAll("table"),n=t?r(t,"tr"):[],o=this.table.querySelectorAll("tr");return n.length>0?e.lang.array(o).without(n):o},getMapIndex:function(e){for(var t=this.map.length,n=this.map&&this.map[0]?this.map[0].length:0,o=0;o<t;o++)for(var r=0;r<n;r++)if(this.map[o][r].el===e)return{row:o,col:r};return!1},getElementAtIndex:function(e){return this.setTableMap(),this.map[e.row]&&this.map[e.row][e.col]&&this.map[e.row][e.col].el?this.map[e.row][e.col].el:null},getMapElsTo:function(e){var t=[];if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(e),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var n=this.idx_start;this.idx_start=this.idx_end,this.idx_end=n}if(this.idx_start.col>this.idx_end.col){var o=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=o}if(null!=this.idx_start&&null!=this.idx_end)for(var r=this.idx_start.row,i=this.idx_end.row;r<=i;r++)for(var a=this.idx_start.col,s=this.idx_end.col;a<=s;a++)t.push(this.map[r][a].el);return t},orderSelectionEnds:function(e){if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(e),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var t=this.idx_start;this.idx_start=this.idx_end,this.idx_end=t}if(this.idx_start.col>this.idx_end.col){var n=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=n}return{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(e,t,n){for(var o,r=this.table.ownerDocument,i=r.createDocumentFragment(),a=0;a<t;a++){if(o=r.createElement(e),n)for(var s in n)n.hasOwnProperty(s)&&o.setAttribute(s,n[s]);o.appendChild(document.createTextNode(" ")),i.appendChild(o)}return i},correctColIndexForUnreals:function(e,t){for(var n=this.map[t],o=-1,r=0;r<e;r++)n[r].isReal&&o++;return o},getLastNewCellOnRow:function(e,t){for(var n,o,r=this.getRowCells(e),i=0,a=r.length;i<a;i++)if(n=r[i],!1===(o=this.getMapIndex(n))||void 0!==t&&o.row!=t)return n;return null},removeEmptyTable:function(){var e=this.table.querySelectorAll("td, th");return(!e||0==e.length)&&(i(this.table),!0)},splitRowToCells:function(e){if(e.isColspan){var n=parseInt(t.getAttribute(e.el,"colspan")||1,10),o=e.el.tagName.toLowerCase();if(n>1){var r=this.createCells(o,n-1);a(e.el,r)}e.el.removeAttribute("colspan")}},getRealRowEl:function(e,n){var o=null,r=null;n=n||this.idx;for(var i=0,a=this.map[n.row].length;i<a;i++)if((r=this.map[n.row][i]).isReal&&(o=t.getParentElement(r.el,{nodeName:["TR"]})))return o;return null===o&&e&&(o=t.getParentElement(this.map[n.row][n.col].el,{nodeName:["TR"]})||null),o},injectRowAt:function(e,n,o,r,i){var s=this.getRealRowEl(!1,{row:e,col:n}),l=this.createCells(r,o);if(s){var c=this.correctColIndexForUnreals(n,e);c>=0?a(this.getRowCells(s)[c],l):s.insertBefore(l,s.firstChild)}else{var d=this.table.ownerDocument.createElement("tr");d.appendChild(l),a(t.getParentElement(i.el,{nodeName:["TR"]}),d)}},canMerge:function(e){if(this.to=e,this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(this.to),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var t=this.idx_start;this.idx_start=this.idx_end,this.idx_end=t}if(this.idx_start.col>this.idx_end.col){var n=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=n}for(var o=this.idx_start.row,r=this.idx_end.row;o<=r;o++)for(var i=this.idx_start.col,a=this.idx_end.col;i<=a;i++)if(this.map[o][i].isColspan||this.map[o][i].isRowspan)return!1;return!0},decreaseCellSpan:function(e,n){var o=parseInt(t.getAttribute(e.el,n),10)-1;o>=1?e.el.setAttribute(n,o):(e.el.removeAttribute(n),"colspan"==n&&(e.isColspan=!1),"rowspan"==n&&(e.isRowspan=!1),e.firstCol=!0,e.lastCol=!0,e.firstRow=!0,e.lastRow=!0,e.isReal=!0)},removeSurplusLines:function(){var e,n,o,r,a,s,l;if(this.setTableMap(),this.map){for(o=0,r=this.map.length;o<r;o++){for(l=!0,a=0,s=(e=this.map[o]).length;a<s;a++)if(n=e[a],!(t.getAttribute(n.el,"rowspan")&&parseInt(t.getAttribute(n.el,"rowspan"),10)>1&&!0!==n.firstRow)){l=!1;break}if(l)for(a=0;a<s;a++)this.decreaseCellSpan(e[a],"rowspan")}var c=this.getTableRows();for(o=0,r=c.length;o<r;o++)0==(e=c[o]).childNodes.length&&/^\s*$/.test(e.textContent||e.innerText)&&i(e)}},fillMissingCells:function(){var e=0,t=0,o=null;if(this.setTableMap(),this.map){e=this.map.length;for(var r=0;r<e;r++)this.map[r].length>t&&(t=this.map[r].length);for(var i=0;i<e;i++)for(var s=0;s<t;s++)this.map[i]&&!this.map[i][s]&&s>0&&(this.map[i][s]=new n(this.createCells("td",1)),(o=this.map[i][s-1])&&o.el&&o.el.parent&&a(this.map[i][s-1].el,this.map[i][s].el))}},rectify:function(){return!this.removeEmptyTable()&&(this.removeSurplusLines(),this.fillMissingCells(),!0)},unmerge:function(){if(this.rectify()&&(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx)){var e=this.map[this.idx.row][this.idx.col],n=t.getAttribute(e.el,"colspan")?parseInt(t.getAttribute(e.el,"colspan"),10):1,o=e.el.tagName.toLowerCase();if(e.isRowspan){var r=parseInt(t.getAttribute(e.el,"rowspan"),10);if(r>1)for(var i=1,a=r-1;i<=a;i++)this.injectRowAt(this.idx.row+i,this.idx.col,n,o,e);e.el.removeAttribute("rowspan")}this.splitRowToCells(e)}},merge:function(e){if(this.rectify())if(this.canMerge(e)){for(var t=this.idx_end.row-this.idx_start.row+1,n=this.idx_end.col-this.idx_start.col+1,o=this.idx_start.row,r=this.idx_end.row;o<=r;o++)for(var a=this.idx_start.col,s=this.idx_end.col;a<=s;a++)o==this.idx_start.row&&a==this.idx_start.col?(t>1&&this.map[o][a].el.setAttribute("rowspan",t),n>1&&this.map[o][a].el.setAttribute("colspan",n)):(/^\s*<br\/?>\s*$/.test(this.map[o][a].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[o][a].el.innerHTML),i(this.map[o][a].el));this.rectify()}else window.console&&console.log("Do not know how to merge allready merged cells.")},collapseCellToNextRow:function(e){var n=this.getMapIndex(e.el),o=n.row+1,r={row:o,col:n.col};if(o<this.map.length){var i=this.getRealRowEl(!1,r);if(null!==i){var s=this.correctColIndexForUnreals(r.col,r.row);if(s>=0)a(this.getRowCells(i)[s],e.el);else{var l=this.getLastNewCellOnRow(i,o);null!==l?a(l,e.el):i.insertBefore(e.el,i.firstChild)}parseInt(t.getAttribute(e.el,"rowspan"),10)>2?e.el.setAttribute("rowspan",parseInt(t.getAttribute(e.el,"rowspan"),10)-1):e.el.removeAttribute("rowspan")}}},removeRowCell:function(e){e.isReal?e.isRowspan?this.collapseCellToNextRow(e):i(e.el):parseInt(t.getAttribute(e.el,"rowspan"),10)>2?e.el.setAttribute("rowspan",parseInt(t.getAttribute(e.el,"rowspan"),10)-1):e.el.removeAttribute("rowspan")},getRowElementsByCell:function(){var e=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(var t=this.map[this.idx.row],n=0,o=t.length;n<o;n++)t[n].isReal&&e.push(t[n].el);return e},getColumnElementsByCell:function(){var e=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(var t=0,n=this.map.length;t<n;t++)this.map[t][this.idx.col]&&this.map[t][this.idx.col].isReal&&e.push(this.map[t][this.idx.col].el);return e},removeRow:function(){var e=t.getParentElement(this.cell,{nodeName:["TR"]});if(e){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(var n=this.map[this.idx.row],o=0,r=n.length;o<r;o++)n[o].modified||(this.setCellAsModified(n[o]),this.removeRowCell(n[o]));i(e)}},removeColCell:function(e){e.isColspan?parseInt(t.getAttribute(e.el,"colspan"),10)>2?e.el.setAttribute("colspan",parseInt(t.getAttribute(e.el,"colspan"),10)-1):e.el.removeAttribute("colspan"):e.isReal&&i(e.el)},removeColumn:function(){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(var e=0,t=this.map.length;e<t;e++)this.map[e][this.idx.col].modified||(this.setCellAsModified(this.map[e][this.idx.col]),this.removeColCell(this.map[e][this.idx.col]))},remove:function(e){if(this.rectify()){switch(e){case"row":this.removeRow();break;case"column":this.removeColumn()}this.rectify()}},addRow:function(e){var n=this.table.ownerDocument;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"below"==e&&t.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(t.getAttribute(this.cell,"rowspan"),10)-1),!1!==this.idx){for(var o=this.map[this.idx.row],r=n.createElement("tr"),i=0,s=o.length;i<s;i++)o[i].modified||(this.setCellAsModified(o[i]),this.addRowCell(o[i],r,e));switch(e){case"below":a(this.getRealRowEl(!0),r);break;case"above":var l=t.getParentElement(this.map[this.idx.row][this.idx.col].el,{nodeName:["TR"]});l&&l.parentNode.insertBefore(r,l)}}},addRowCell:function(e,n,o){var r=e.isColspan?{colspan:t.getAttribute(e.el,"colspan")}:null;e.isReal?"above"!=o&&e.isRowspan?e.el.setAttribute("rowspan",parseInt(t.getAttribute(e.el,"rowspan"),10)+1):n.appendChild(this.createCells("td",1,r)):"above"!=o&&e.isRowspan&&e.lastRow?n.appendChild(this.createCells("td",1,r)):c.isRowspan&&e.el.attr("rowspan",parseInt(t.getAttribute(e.el,"rowspan"),10)+1)},add:function(e){this.rectify()&&("below"!=e&&"above"!=e||this.addRow(e),"before"!=e&&"after"!=e||this.addColumn(e))},addColCell:function(e,n,o){var r,i=e.el.tagName.toLowerCase();switch(o){case"before":r=!e.isColspan||e.firstCol;break;case"after":r=!e.isColspan||e.lastCol||e.isColspan&&c.el==this.cell}if(r){switch(o){case"before":e.el.parentNode.insertBefore(this.createCells(i,1),e.el);break;case"after":a(e.el,this.createCells(i,1))}e.isRowspan&&this.handleCellAddWithRowspan(e,n+1,o)}else e.el.setAttribute("colspan",parseInt(t.getAttribute(e.el,"colspan"),10)+1)},addColumn:function(e){var n,o;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"after"==e&&t.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(t.getAttribute(this.cell,"colspan"),10)-1),!1!==this.idx)for(var r=0,i=this.map.length;r<i;r++)(n=this.map[r])[this.idx.col]&&((o=n[this.idx.col]).modified||(this.setCellAsModified(o),this.addColCell(o,r,e)))},handleCellAddWithRowspan:function(e,n,o){for(var r,i,l,c=parseInt(t.getAttribute(this.cell,"rowspan"),10)-1,d=t.getParentElement(e.el,{nodeName:["TR"]}),u=e.el.tagName.toLowerCase(),f=this.table.ownerDocument,h=0;h<c;h++)if(r=this.correctColIndexForUnreals(this.idx.col,n+h),d=s(d,"tr"))if(r>0)switch(o){case"before":i=this.getRowCells(d),r>0&&this.map[n+h][this.idx.col].el!=i[r]&&r==i.length-1?a(i[r],this.createCells(u,1)):i[r].parentNode.insertBefore(this.createCells(u,1),i[r]);break;case"after":a(this.getRowCells(d)[r],this.createCells(u,1))}else d.insertBefore(this.createCells(u,1),d.firstChild);else(l=f.createElement("tr")).appendChild(this.createCells(u,1)),this.table.appendChild(l)}},t.table={getCellsBetween:function(e,t){return new o(e).getMapElsTo(t)},addCells:function(e,t){new o(e).add(t)},removeCells:function(e,t){new o(e).remove(t)},mergeCellsBetween:function(e,t){new o(e).merge(t)},unmergeCell:function(e){new o(e).unmerge()},orderSelectionEnds:function(e,t){return new o(e).orderSelectionEnds(t)},indexOf:function(e){var t=new o(e);return t.setTableMap(),t.getMapIndex(e)},findCell:function(e,t){return new o(null,e).getElementAtIndex(t)},findRowByCell:function(e){return new o(e).getRowElementsByCell()},findColumnByCell:function(e){return new o(e).getColumnElementsByCell()},canMerge:function(e,t){return new o(e).canMerge(t)}}}(o),o.dom.query=function(e,t){var n,o=[];e.nodeType&&(e=[e]);for(var r=0,i=e.length;r<i;r++)if(n=e[r].querySelectorAll(t))for(var a=n.length;a--;o.unshift(n[a]));return o},o.dom.compareDocumentPosition=document.documentElement.compareDocumentPosition?function(e,t){return e.compareDocumentPosition(t)}:function(e,t){var n,r;if(n=9===e.nodeType?e:e.ownerDocument,r=9===t.nodeType?t:t.ownerDocument,e===t)return 0;if(e===t.ownerDocument)return 20;if(e.ownerDocument===t)return 10;if(n!==r)return 1;if(2===e.nodeType&&e.childNodes&&-1!==o.lang.array(e.childNodes).indexOf(t))return 20;if(2===t.nodeType&&t.childNodes&&-1!==o.lang.array(t.childNodes).indexOf(e))return 10;for(var i=e,a=[],s=null;i;){if(i==t)return 10;a.push(i),i=i.parentNode}for(i=t,s=null;i;){if(i==e)return 20;var l=o.lang.array(a).indexOf(i);if(-1!==l){var c=a[l];return o.lang.array(c.childNodes).indexOf(a[l-1])>o.lang.array(c.childNodes).indexOf(s)?2:4}s=i,i=i.parentNode}return 1},o.dom.unwrap=function(e){if(e.parentNode){for(;e.lastChild;)o.dom.insert(e.lastChild).after(e);e.parentNode.removeChild(e)}},o.quirks.cleanPastedHTML=function(){var e={"a u":o.dom.replaceWithChildNodes};return function(t,n,r){n=n||e,r=r||t.ownerDocument||document;var i,a,s,l,c,d,u="string"==typeof t,f=0;i=u?o.dom.getAsDom(t,r):t;for(c in n)for(s=i.querySelectorAll(c),a=n[c],l=s.length;f<l;f++)a(s[f]);var h=o.dom.getTextNodes(i);for(d=h.length;d--;)h[d].nodeValue=h[d].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ");return s=t=n=null,u?i.innerHTML:i}}(),o.quirks.ensureProperClearing=(_=function(){var e=this;setTimeout(function(){var t=e.innerHTML.toLowerCase();"<p>&nbsp;</p>"!=t&&"<p>&nbsp;</p><p>&nbsp;</p>"!=t||(e.innerHTML="")},0)},function(e){o.dom.observe(e.element,["cut","keydown"],_)}),(I=o).quirks.getCorrectInnerHTML=function(e){var t=e.innerHTML;if(-1===t.indexOf("%7E"))return t;var n,o,r,i,a=e.querySelectorAll("[href*='~'], [src*='~']");for(i=0,r=a.length;i<r;i++)n=a[i].href||a[i].src,o=I.lang.string(n).replace("~").by("%7E"),t=I.lang.string(t).replace(o).by(n);return t},L="wysihtml5-quirks-redraw",(O=o).quirks.redraw=function(e){O.dom.addClass(e,L),O.dom.removeClass(e,L);try{var t=e.ownerDocument;t.execCommand("italic",!1,null),t.execCommand("italic",!1,null)}catch(e){}},o.quirks.tableCellsSelection=function(e,t){var n=o.dom,r={table:null,start:null,end:null,cells:null,select:function(e,o){r.start=e,r.end=o,r.table=n.getParentElement(r.start,{nodeName:["TABLE"]}),selectedCells=n.table.getCellsBetween(r.start,r.end),c(selectedCells),f(),t.fire("tableselect").fire("tableselect:composer")}},i="wysiwyg-tmp-selected-cell",a=null,s=null;function l(){if(e){var t=e.querySelectorAll("."+i);if(t.length>0)for(var o=0;o<t.length;o++)n.removeClass(t[o],i)}}function c(e){for(var t=0;t<e.length;t++)n.addClass(e[t],i)}function d(e){var o,i=null,a=n.getParentElement(e.target,{nodeName:["TD","TH"]});a&&r.table&&r.start&&(i=n.getParentElement(a,{nodeName:["TABLE"]}))&&i===r.table&&(l(),o=r.end,r.end=a,r.cells=n.table.getCellsBetween(r.start,a),r.cells.length>1&&t.composer.selection.deselect(),c(r.cells),r.end!==o&&t.fire("tableselectchange").fire("tableselectchange:composer"))}function u(e){a.stop(),s.stop(),t.fire("tableselect").fire("tableselect:composer"),setTimeout(function(){f()},0)}function f(){var o=n.observe(e.ownerDocument,"click",function(e){o.stop(),n.getParentElement(e.target,{nodeName:["TABLE"]})!=r.table&&(l(),r.table=null,r.start=null,r.end=null,t.fire("tableunselect").fire("tableunselect:composer"))})}return n.observe(e,"mousedown",function(c){var f,h=o.dom.getParentElement(c.target,{nodeName:["TD","TH"]});h&&(f=h,r.start=f,r.end=f,r.cells=[f],r.table=n.getParentElement(r.start,{nodeName:["TABLE"]}),r.table&&(l(),n.addClass(f,i),a=n.observe(e,"mousemove",d),s=n.observe(e,"mouseup",u),t.fire("tableselectstart").fire("tableselectstart:composer")))}),r},D=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,M=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,B=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,P=/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,H=function(e){return new RegExp("(^|\\s|;)"+e+"\\s*:\\s*[^;$]+","gi")},(k=o).quirks.styleParser={parseColor:function(e,t){var n,o,r=H(t),i=e.match(r),a=10;if(i){for(var s=i.length;s--;)i[s]=k.lang.string(i[s].split(":")[1]).trim();if(n=i[i.length-1],D.test(n))o=n.match(D);else if(M.test(n))o=n.match(M);else if(B.test(n))o=n.match(B),a=16;else if(P.test(n))return(o=n.match(P)).shift(),o.push(1),k.lang.array(o).map(function(e,t){return t<3?16*parseInt(e,16)+parseInt(e,16):parseFloat(e)});if(o)return o.shift(),o[3]||o.push(1),k.lang.array(o).map(function(e,t){return t<3?parseInt(e,a):parseFloat(e)})}return!1},unparseColor:function(e,t){if(t){if("hex"==t)return e[0].toString(16).toUpperCase()+e[1].toString(16).toUpperCase()+e[2].toString(16).toUpperCase();if("hash"==t)return"#"+e[0].toString(16).toUpperCase()+e[1].toString(16).toUpperCase()+e[2].toString(16).toUpperCase();if("rgb"==t)return"rgb("+e[0]+","+e[1]+","+e[2]+")";if("rgba"==t)return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")";if("csv"==t)return e[0]+","+e[1]+","+e[2]+","+e[3]}return e[3]&&1!==e[3]?"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")":"rgb("+e[0]+","+e[1]+","+e[2]+")"},parseFontSize:function(e){var t=e.match(H("font-size"));return!!t&&k.lang.string(t[t.length-1].split(":")[1]).trim()}},function(e){var t=e.dom;function n(e,t){for(var n=0;t!==e;)if(n++,!(t=t.parentNode))throw new Error("not a descendant of ancestor!");return n}function o(e){if(!e.canSurroundContents())for(var t=e.commonAncestorContainer,o=n(t,e.startContainer),r=n(t,e.endContainer);!e.canSurroundContents();)o>r?(e.setStartBefore(e.startContainer),o=n(t,e.startContainer)):(e.setEndAfter(e.endContainer),r=n(t,e.endContainer))}e.Selection=lt.extend({constructor:function(e,t,n){window.rangy.init(),this.editor=e,this.composer=e.composer,this.doc=this.composer.doc,this.contain=t,this.unselectableClass=n||!1},getBookmark:function(){var e=this.getRange();return e&&o(e),e&&e.cloneRange()},setBookmark:function(e){e&&this.setSelection(e)},setBefore:function(e){var t=rangy.createRange(this.doc);return t.setStartBefore(e),t.setEndBefore(e),this.setSelection(t)},setAfter:function(e){var t=rangy.createRange(this.doc);return t.setStartAfter(e),t.setEndAfter(e),this.setSelection(t)},selectNode:function(n,o){var r=rangy.createRange(this.doc),i=n.nodeType===e.ELEMENT_NODE,a="canHaveHTML"in n?n.canHaveHTML:"IMG"!==n.nodeName,s=i?n.innerHTML:n.data,l=""===s||s===e.INVISIBLE_SPACE,c=t.getStyle("display").from(n),d="block"===c||"list-item"===c;if(l&&i&&a&&!o)try{n.innerHTML=e.INVISIBLE_SPACE}catch(e){}a?r.selectNodeContents(n):r.selectNode(n),a&&l&&i?r.collapse(d):a&&l&&(r.setStartAfter(n),r.setEndAfter(n)),this.setSelection(r)},getSelectedNode:function(e){var t,n;return e&&this.doc.selection&&"Control"===this.doc.selection.type&&(n=this.doc.selection.createRange())&&n.length?n.item(0):(t=this.getSelection(this.doc)).focusNode===t.anchorNode?t.focusNode:(n=this.getRange(this.doc))?n.commonAncestorContainer:this.doc.body},fixSelBorders:function(){var e=this.getRange();o(e),this.setSelection(e)},getSelectedOwnNodes:function(e){for(var t=this.getOwnRanges(),n=[],o=0,r=t.length;o<r;o++)n.push(t[o].commonAncestorContainer||this.doc.body);return n},findNodesInSelection:function(t){for(var n,o=this.getOwnRanges(),r=[],i=0,a=o.length;i<a;i++)n=o[i].getNodes([1],function(n){return e.lang.array(t).contains(n.nodeName)}),r=r.concat(n);return r},containsUneditable:function(){for(var e=this.getOwnUneditables(),t=this.getSelection(),n=0,o=e.length;n<o;n++)if(t.containsNode(e[n]))return!0;return!1},deleteContents:function(){for(var e=this.getOwnRanges(),t=e.length;t--;)e[t].deleteContents();this.setSelection(e[0])},getPreviousNode:function(t,n){t||(t=this.getSelection().anchorNode);if(t===this.contain)return!1;var o,r=t.previousSibling;return r!==this.contain&&(r&&3!==r.nodeType&&1!==r.nodeType?r=this.getPreviousNode(r,n):r&&3===r.nodeType&&/^\s*$/.test(r.textContent)?r=this.getPreviousNode(r,n):n&&r&&1===r.nodeType&&!e.lang.array(["BR","HR","IMG"]).contains(r.nodeName)&&/^[\s]*$/.test(r.innerHTML)?r=this.getPreviousNode(r,n):r||t===this.contain||(o=t.parentNode)!==this.contain&&(r=this.getPreviousNode(o,n)),r!==this.contain&&r)},getSelectionParentsByTag:function(t){for(var n,o=this.getSelectedOwnNodes(),r=[],i=0,a=o.length;i<a;i++)(n=o[i].nodeName&&"LI"===o[i].nodeName?o[i]:e.dom.getParentElement(o[i],{nodeName:["LI"]},!1,this.contain))&&r.push(n);return r.length?r:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var e=this.getRange(),t=e.startContainer,n=e.startOffset,o=rangy.createRange(this.doc);return o.selectNodeContents(t),o.setStart(t,n),o}},caretIsLastInSelection:function(){rangy.createRange(this.doc),this.getSelection();var e=this.getRangeToNodeEnd().cloneContents().textContent;return/^\s*$/.test(e)},caretIsFirstInSelection:function(){var t=rangy.createRange(this.doc),n=this.getSelection(),o=this.getRange(),r=o.startContainer;return r.nodeType===e.TEXT_NODE?this.isCollapsed()&&r.nodeType===e.TEXT_NODE&&/^\s*$/.test(r.data.substr(0,o.startOffset)):(t.selectNodeContents(this.getRange().commonAncestorContainer),t.collapse(!0),this.isCollapsed()&&(t.startContainer===n.anchorNode||t.endContainer===n.anchorNode)&&t.startOffset===n.anchorOffset)},caretIsInTheBeginnig:function(t){var n=this.getSelection(),o=n.anchorNode,r=n.anchorOffset;return t?0===r&&(o.nodeName&&o.nodeName===t.toUpperCase()||e.dom.getParentElement(o.parentNode,{nodeName:t},1)):0===r&&!this.getPreviousNode(o,!0)},caretIsBeforeUneditable:function(){var e=this.getSelection(),t=e.anchorNode;if(0===e.anchorOffset){var n=this.getPreviousNode(t,!0);if(n)for(var o=this.getOwnUneditables(),r=0,i=o.length;r<i;r++)if(n===o[r])return o[r]}return!1},executeAndRestoreRangy:function(e,t){var n=this.doc.defaultView||this.doc.parentWindow,o=rangy.saveSelection(n);if(o)try{e()}catch(e){setTimeout(function(){throw e},0)}else e();rangy.restoreSelection(o)},executeAndRestore:function(n,o){var r,i,a,s,l,c,d,u,f=this.doc.body,h=o&&f.scrollTop,m=o&&f.scrollLeft,p="_wysihtml5-temp-placeholder",g='<span class="'+p+'">'+e.INVISIBLE_SPACE+"</span>",y=this.getRange(!0);if(y){y.collapsed||(c=(d=y.cloneRange()).createContextualFragment(g),d.collapse(!1),d.insertNode(c),d.detach()),l=y.createContextualFragment(g),y.insertNode(l),c&&(r=this.contain.querySelectorAll("."+p),y.setStartBefore(r[0]),y.setEndAfter(r[r.length-1])),this.setSelection(y);try{n(y.startContainer,y.endContainer)}catch(e){setTimeout(function(){throw e},0)}if((r=this.contain.querySelectorAll("."+p))&&r.length){u=rangy.createRange(this.doc),a=r[0].nextSibling,r.length>1&&(s=r[r.length-1].previousSibling),s&&a?(u.setStartBefore(a),u.setEndAfter(s)):(i=this.doc.createTextNode(e.INVISIBLE_SPACE),t.insert(i).after(r[0]),u.setStartBefore(i),u.setEndAfter(i)),this.setSelection(u);for(var v=r.length;v--;)r[v].parentNode.removeChild(r[v])}else this.contain.focus();o&&(f.scrollTop=h,f.scrollLeft=m);try{r.parentNode.removeChild(r)}catch(e){}}else n(f,f)},set:function(e,t){var n=rangy.createRange(this.doc);n.setStart(e,t||0),this.setSelection(n)},insertHTML:function(e){var t=rangy.createRange(this.doc).createContextualFragment(e),n=t.lastChild;this.insertNode(t),n&&this.setAfter(n)},insertNode:function(e){var t=this.getRange();t&&t.insertNode(e)},surround:function(e){var t,n=this.getOwnRanges(),o=[];if(0==n.length)return o;for(var r=n.length;r--;){t=this.doc.createElement(e.nodeName),o.push(t),e.className&&(t.className=e.className),e.cssStyle&&t.setAttribute("style",e.cssStyle);try{n[r].surroundContents(t),this.selectNode(t)}catch(e){t.appendChild(n[r].extractContents()),n[r].insertNode(t)}}return o},deblockAndSurround:function(t){var n,o,r,i=this.doc.createElement("div"),a=rangy.createRange(this.doc);if(i.className=t.className,this.composer.commands.exec("formatBlock",t.nodeName,t.className),(n=this.contain.querySelectorAll("."+t.className))[0])for(n[0].parentNode.insertBefore(i,n[0]),a.setStartBefore(n[0]),a.setEndAfter(n[n.length-1]),o=a.extractContents();o.firstChild;)if(1==(r=o.firstChild).nodeType&&e.dom.hasClass(r,t.className)){for(;r.firstChild;)i.appendChild(r.firstChild);"BR"!==r.nodeName&&i.appendChild(this.doc.createElement("br")),o.removeChild(r)}else i.appendChild(r);else i=null;return i},scrollIntoView:function(){var t,n,o=this.doc,r=o.documentElement.scrollHeight>o.documentElement.offsetHeight,i=o._wysihtml5ScrollIntoViewElement=o._wysihtml5ScrollIntoViewElement||((n=o.createElement("span")).innerHTML=e.INVISIBLE_SPACE,n);r&&(this.insertNode(i),t=function(e){var t=0;if(e.parentNode)do{t+=e.offsetTop||0,e=e.offsetParent}while(e);return t}(i),i.parentNode.removeChild(i),t>=o.body.scrollTop+o.documentElement.offsetHeight-5&&(o.body.scrollTop=t))},selectLine:function(){e.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var e=this.doc.defaultView.getSelection();e.modify("move","left","lineboundary"),e.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var e,t,n,o,r,i=this.doc.selection.createRange(),a=i.boundingTop,s=this.doc.body.scrollWidth;if(i.moveToPoint){for(0===a&&(n=this.doc.createElement("span"),this.insertNode(n),a=n.offsetTop,n.parentNode.removeChild(n)),a+=1,o=-10;o<s;o+=2)try{i.moveToPoint(o,a);break}catch(e){}for(e=a,t=this.doc.selection.createRange(),r=s;r>=0;r--)try{t.moveToPoint(r,e);break}catch(e){}i.setEndPoint("EndToEnd",t),i.select()}},getText:function(){var e=this.getSelection();return e?e.toString():""},getNodes:function(e,t){var n=this.getRange();return n?n.getNodes([e],t):[]},fixRangeOverflow:function(e){if(this.contain&&this.contain.firstChild&&e){var t=e.compareNode(this.contain);if(2!==t)1===t&&e.setStartBefore(this.contain.firstChild),0===t&&e.setEndAfter(this.contain.lastChild),3===t&&(e.setStartBefore(this.contain.firstChild),e.setEndAfter(this.contain.lastChild));else if(this._detectInlineRangeProblems(e)){var n=e.endContainer.previousElementSibling;n&&e.setEnd(n,this._endOffsetForNode(n))}}},_endOffsetForNode:function(e){var t=document.createRange();return t.selectNodeContents(e),t.endOffset},_detectInlineRangeProblems:function(e){var n=t.compareDocumentPosition(e.startContainer,e.endContainer);return 0==e.endOffset&&4&n},getRange:function(e){var t=this.getSelection(),n=t&&t.rangeCount&&t.getRangeAt(0);return!0!==e&&this.fixRangeOverflow(n),n},getOwnUneditables:function(){var n=t.query(this.contain,"."+this.unselectableClass),o=t.query(n,"."+this.unselectableClass);return e.lang.array(n).without(o)},getOwnRanges:function(){var e,t=[],n=this.getRange();if(n&&t.push(n),this.unselectableClass&&this.contain&&n){var o,r=this.getOwnUneditables();if(r.length>0)for(var i=0,a=r.length;i<a;i++){e=[];for(var s=0,l=t.length;s<l;s++){if(t[s])switch(t[s].compareNode(r[i])){case 2:break;case 3:(o=t[s].cloneRange()).setEndBefore(r[i]),e.push(o),(o=t[s].cloneRange()).setStartAfter(r[i]),e.push(o);break;default:e.push(t[s])}t=e}}}return t},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(e){var t=this.doc.defaultView||this.doc.parentWindow;return rangy.getSelection(t).setSingleRange(e)},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},isEndToEndInNode:function(t){var n=this.getRange(),o=n.commonAncestorContainer,r=n.startContainer,i=n.endContainer;if(o.nodeType===e.TEXT_NODE&&(o=o.parentNode),r.nodeType===e.TEXT_NODE&&!/^\s*$/.test(r.data.substr(n.startOffset)))return!1;if(i.nodeType===e.TEXT_NODE&&!/^\s*$/.test(i.data.substr(n.endOffset)))return!1;for(;r&&r!==o;){if(r.nodeType!==e.TEXT_NODE&&!e.dom.contains(o,r))return!1;if(e.dom.domNode(r).prev({ignoreBlankTexts:!0}))return!1;r=r.parentNode}for(;i&&i!==o;){if(i.nodeType!==e.TEXT_NODE&&!e.dom.contains(o,i))return!1;if(e.dom.domNode(i).next({ignoreBlankTexts:!0}))return!1;i=i.parentNode}return!!e.lang.array(t).contains(o.nodeName)&&o},deselect:function(){var e=this.getSelection();e&&e.removeAllRanges()}})}(o),function(e,t){var n="span",o=/\s+/g;function r(e,t,n){if(!e.className)return!1;var o=e.className.match(n)||[];return o[o.length-1]===t}function i(e,t){if(!e.getAttribute||!e.getAttribute("style"))return!1;e.getAttribute("style").match(t);return!!e.getAttribute("style").match(t)}function a(e,t,n){e.getAttribute("style")?(l(e,n),e.getAttribute("style")&&!/^\s*$/.test(e.getAttribute("style"))?e.setAttribute("style",t+";"+e.getAttribute("style")):e.setAttribute("style",t)):e.setAttribute("style",t)}function s(e,t){e.className&&(e.className=e.className.replace(t,""))}function l(e,t){var n,o=[];if(e.getAttribute("style")){for(var r=(n=e.getAttribute("style").split(";")).length;r--;)n[r].match(t)||/^\s*$/.test(n[r])||o.push(n[r]);o.length?e.setAttribute("style",o.join(";")):e.removeAttribute("style")}}function c(e,t){var n=[],o=t.split(";"),r=e.getAttribute("style");if(r){r=r.replace(/\s/gi,"").toLowerCase(),n.push(new RegExp("(^|\\s|;)"+t.replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var i=o.length;i-- >0;)/^\s*$/.test(o[i])||n.push(new RegExp("(^|\\s|;)"+o[i].replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var a=0,s=n.length;a<s;a++)if(r.match(n[a]))return n[a]}return!1}function d(n,o,r,i){for(var a=n.length;a--;)if(s=n[a],l=o,u=i,!((d=r)?c(s,d):u?e.dom.hasClass(s,u):t.dom.arrayContains(l,s.tagName.toLowerCase())))return!1;var s,l,d,u;return!!n.length}function u(e,n){return t.dom.isCharacterDataNode(e)?0==n?!!e.previousSibling:n!=e.length||!!e.nextSibling:n>0&&n<e.childNodes.length}function f(e,n,o,r){var i;if(t.dom.isCharacterDataNode(n)&&(0==o?(o=t.dom.getNodeIndex(n),n=n.parentNode):o==n.length?(o=t.dom.getNodeIndex(n)+1,n=n.parentNode):i=t.dom.splitDataNode(n,o)),!(i||r&&n===r)){var a;for((i=n.cloneNode(!1)).id&&i.removeAttribute("id");a=n.childNodes[o];)i.appendChild(a);t.dom.insertAfter(i,n)}return n==e?i:f(e,i.parentNode,t.dom.getNodeIndex(i),r)}function h(t){this.isElementMerge=t.nodeType==e.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?t.lastChild:t,this.textNodes=[this.firstTextNode]}function m(e,t,o,r,i,a,s){this.tagNames=e||[n],this.cssClass=t||!1!==t&&"",this.similarClassRegExp=o,this.cssStyle=i||"",this.similarStyleRegExp=a,this.normalize=r,this.applyToAnyTagName=!1,this.container=s}h.prototype={doMerge:function(){for(var e,t,n,o=[],r=0,i=this.textNodes.length;r<i;++r)t=(e=this.textNodes[r]).parentNode,o[r]=e.data,r&&(t.removeChild(e),t.hasChildNodes()||t.parentNode.removeChild(t));return this.firstTextNode.data=n=o.join(""),n},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){for(var e=[],t=0,n=this.textNodes.length;t<n;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}},m.prototype={getAncestorWithClass:function(n){for(var o;n;){if(o=this.cssClass?r(n,this.cssClass,this.similarClassRegExp):""===this.cssStyle,n.nodeType==e.ELEMENT_NODE&&"false"!=n.getAttribute("contenteditable")&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&o)return n;n=n.parentNode}return!1},getAncestorWithStyle:function(n){for(var o;n;){if(o=!!this.cssStyle&&i(n,this.similarStyleRegExp),n.nodeType==e.ELEMENT_NODE&&"false"!=n.getAttribute("contenteditable")&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&o)return n;n=n.parentNode}return!1},getMatchingAncestor:function(e){var t=this.getAncestorWithClass(e),n=!1;return t?this.cssStyle&&(n="class"):(t=this.getAncestorWithStyle(e))&&(n="style"),{element:t,type:n}},postApply:function(e,t){for(var n,o,r,i=e[0],a=e[e.length-1],s=[],l=i,c=a,d=0,u=a.length,f=0,m=e.length;f<m;++f)r=null,(o=e[f])&&o.parentNode&&(r=this.getAdjacentMergeableTextNode(o.parentNode,!1)),r?(n||(n=new h(r),s.push(n)),n.textNodes.push(o),o===i&&(d=(l=n.firstTextNode).length),o===a&&(c=n.firstTextNode,u=n.getLength())):n=null;if(a&&a.parentNode){var p=this.getAdjacentMergeableTextNode(a.parentNode,!0);p&&(n||(n=new h(a),s.push(n)),n.textNodes.push(p))}if(s.length){for(f=0,m=s.length;f<m;++f)s[f].doMerge();t.setStart(l,d),t.setEnd(c,u)}},getAdjacentMergeableTextNode:function(t,n){var o,r=t.nodeType==e.TEXT_NODE,i=r?t.parentNode:t,a=n?"nextSibling":"previousSibling";if(r){if((o=t[a])&&o.nodeType==e.TEXT_NODE)return o}else if((o=i[a])&&this.areElementsMergeable(t,o))return o[n?"firstChild":"lastChild"];return null},areElementsMergeable:function(e,n){return t.dom.arrayContains(this.tagNames,(e.tagName||"").toLowerCase())&&t.dom.arrayContains(this.tagNames,(n.tagName||"").toLowerCase())&&(r=n,e.className.replace(o," ")==r.className.replace(o," "))&&function(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,o,r,i=0,a=e.attributes.length;i<a;++i)if("class"!=(r=(n=e.attributes[i]).name)){if(o=t.attributes.getNamedItem(r),n.specified!=o.specified)return!1;if(n.specified&&n.nodeValue!==o.nodeValue)return!1}return!0}(e,n);var r},createContainer:function(e){var t=e.createElement(this.tagNames[0]);return this.cssClass&&(t.className=this.cssClass),this.cssStyle&&t.setAttribute("style",this.cssStyle),t},applyToTextNode:function(e){var n,o,r,i=e.parentNode;if(1==i.childNodes.length&&t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase()))this.cssClass&&(n=i,o=this.cssClass,r=this.similarClassRegExp,n.className?(s(n,r),n.className+=" "+o):n.className=o),this.cssStyle&&a(i,this.cssStyle,this.similarStyleRegExp);else{var l=this.createContainer(t.dom.getDocument(e));e.parentNode.insertBefore(l,e),l.appendChild(e)}},isRemovable:function(n){return t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&""===e.lang.string(n.className).trim()&&(!n.getAttribute("style")||""===e.lang.string(n.getAttribute("style")).trim())},undoToTextNode:function(e,t,n,o){var r,i,d,h,m=!n,p=n||o,g=!1;if(!t.containsNode(p)){var y=t.cloneRange();y.selectNode(p),y.isPointInRange(t.endContainer,t.endOffset)&&u(t.endContainer,t.endOffset)&&(f(p,t.endContainer,t.endOffset,this.container),t.setEndAfter(p)),y.isPointInRange(t.startContainer,t.startOffset)&&u(t.startContainer,t.startOffset)&&(p=f(p,t.startContainer,t.startOffset,this.container))}!m&&this.similarClassRegExp&&s(p,this.similarClassRegExp),m&&this.similarStyleRegExp&&(g="change"==(r=p,i=this.cssStyle,d=this.similarStyleRegExp,(h=c(r,i))?(l(r,h),"remove"):(a(r,i,d),"change"))),this.isRemovable(p)&&!g&&function(e){for(var t=e.parentNode;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}(p)},applyToRange:function(t){for(var n,o=t.length;o--;){if(!(n=t[o].getNodes([e.TEXT_NODE])).length)try{var r=this.createContainer(t[o].endContainer.ownerDocument);return t[o].surroundContents(r),void this.selectNode(t[o],r)}catch(e){}if(t[o].splitBoundaries(),(n=t[o].getNodes([e.TEXT_NODE])).length){for(var i,a=0,s=n.length;a<s;++a)i=n[a],this.getMatchingAncestor(i).element||this.applyToTextNode(i);t[o].setStart(n[0],0),i=n[n.length-1],t[o].setEnd(i,i.length),this.normalize&&this.postApply(n,t[o])}}},undoToRange:function(t){for(var n,o,r,i=t.length;i--;){if((n=t[i].getNodes([e.TEXT_NODE])).length)t[i].splitBoundaries(),n=t[i].getNodes([e.TEXT_NODE]);else{var a=t[i].endContainer.ownerDocument.createTextNode(e.INVISIBLE_SPACE);t[i].insertNode(a),t[i].selectNode(a),n=[a]}for(var s=0,l=n.length;s<l;++s)t[i].isValid()&&(o=n[s],"style"===(r=this.getMatchingAncestor(o)).type?this.undoToTextNode(o,t[i],!1,r.element):r.element&&this.undoToTextNode(o,t[i],r.element));1==l?this.selectNode(t[i],n[0]):(t[i].setStart(n[0],0),o=n[n.length-1],t[i].setEnd(o,o.length),this.normalize&&this.postApply(n,t[i]))}},selectNode:function(t,n){var o=n.nodeType===e.ELEMENT_NODE,r=!("canHaveHTML"in n)||n.canHaveHTML,i=o?n.innerHTML:n.data,a=""===i||i===e.INVISIBLE_SPACE;if(a&&o&&r)try{n.innerHTML=e.INVISIBLE_SPACE}catch(e){}t.selectNodeContents(n),a&&o?t.collapse(!1):a&&(t.setStartAfter(n),t.setEndAfter(n))},getTextSelectedByRange:function(e,t){var n=t.cloneRange();n.selectNodeContents(e);var o=n.intersection(t),r=o?o.toString():"";return n.detach(),r},isAppliedToRange:function(t){for(var n,o,r=[],i="full",a=t.length;a--;){if(!(o=t[a].getNodes([e.TEXT_NODE])).length)return!!(n=this.getMatchingAncestor(t[a].startContainer).element)&&{elements:[n],coverage:i};for(var s,l=0,c=o.length;l<c;++l)s=this.getTextSelectedByRange(o[l],t[a]),(n=this.getMatchingAncestor(o[l]).element)&&""!=s?(r.push(n),1===e.dom.getTextNodes(n,!0).length?i="full":"full"===i&&(i="inline")):n||(i="partial")}return!!r.length&&{elements:r,coverage:i}},toggleRange:function(e){var t,n=this.isAppliedToRange(e);n?"full"===n.coverage?this.undoToRange(e):"inline"===n.coverage?(t=d(n.elements,this.tagNames,this.cssStyle,this.cssClass),this.undoToRange(e),t||this.applyToRange(e)):(d(n.elements,this.tagNames,this.cssStyle,this.cssClass)||this.undoToRange(e),this.applyToRange(e)):this.applyToRange(e)}},e.selection.HTMLApplier=m}(o,rangy),o.Commands=lt.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},support:function(e){return o.browser.supportsCommand(this.doc,e)},exec:function(e,t){var n=o.commands[e],r=o.lang.array(arguments).get(),i=n&&n.exec,a=null;if(this.editor.fire("beforecommand:composer"),i)r.unshift(this.composer),a=i.apply(n,r);else try{a=this.doc.execCommand(e,!1,t)}catch(e){}return this.editor.fire("aftercommand:composer"),a},state:function(e,t){var n=o.commands[e],r=o.lang.array(arguments).get(),i=n&&n.state;if(i)return r.unshift(this.composer),i.apply(n,r);try{return this.doc.queryCommandState(e)}catch(e){return!1}},stateValue:function(e){var t=o.commands[e],n=o.lang.array(arguments).get(),r=t&&t.stateValue;return!!r&&(n.unshift(this.composer),r.apply(t,n))}}),o.commands.bold={exec:function(e,t){o.commands.formatInline.execWithToggle(e,t,"b")},state:function(e,t){return o.commands.formatInline.state(e,t,"b")}},function(e){var t,n="A",o=e.dom;e.commands.createLink={exec:function(r,i,a){var s=this.state(r,i);s?r.selection.executeAndRestore(function(){!function(e,t,n){for(var o,r=t.length;r--;){for(var i=(o=t[r].attributes).length;i--;)t[r].removeAttribute(o.item(i).name);for(var a in n)n.hasOwnProperty(a)&&t[r].setAttribute(a,n[a])}}(0,s,a)}):function(r,i){var a,s,l,c,d,u,f,h,m,p=r.doc,g="_wysihtml5-temp-"+ +new Date,y=0;for(e.commands.formatInline.exec(r,t,n,g,/non-matching-class/g,t,t,!0,!0),a=(s=p.querySelectorAll(n+"."+g)).length;y<a;y++){(l=s[y]).removeAttribute("class");for(m in i)"text"!==m&&l.setAttribute(m,i[m])}u=l,1===a&&(f=o.getTextContent(l),c=!!l.querySelector("*"),d=""===f||f===e.INVISIBLE_SPACE,!c&&d&&(o.setTextContent(l,i.text||l.href),h=p.createTextNode(" "),r.selection.setAfter(l),o.insert(h).after(l),u=h)),r.selection.setAfter(u)}(r,a="object"==typeof a?a:{href:a})},state:function(t,n){return e.commands.formatInline.state(t,n,"A")}}}(o),function(e){var t=e.dom;e.commands.removeLink={exec:function(e,n){var o=this.state(e,n);o&&e.selection.executeAndRestore(function(){!function(e,n){for(var o,r,i=n.length,a=0;a<i;a++)o=n[a],r=t.getParentElement(o,{nodeName:"code"}),t.getTextContent(o).match(t.autoLink.URL_REG_EXP)&&!r?r=t.renameElement(o,"code"):t.replaceWithChildNodes(o)}(0,o)})},state:function(t,n){return e.commands.formatInline.state(t,n,"A")}}}(o),q=/wysiwyg-font-size-[0-9a-z\-]+/g,(z=o).commands.fontSize={exec:function(e,t,n){z.commands.formatInline.execWithToggle(e,t,"span","wysiwyg-font-size-"+n,q)},state:function(e,t,n){return z.commands.formatInline.state(e,t,"span","wysiwyg-font-size-"+n,q)}},W=/(\s|^)font-size\s*:\s*[^;\s]+;?/gi,(V=o).commands.fontSizeStyle={exec:function(e,t,n){n="object"==typeof n?n.size:n,/^\s*$/.test(n)||V.commands.formatInline.execWithToggle(e,t,"span",!1,!1,"font-size:"+n,W)},state:function(e,t,n){return V.commands.formatInline.state(e,t,"span",!1,!1,"font-size",W)},stateValue:function(e,t){var n,o=this.state(e,t);return o&&V.lang.object(o).isArray()&&(o=o[0]),!(!o||!(n=o.getAttribute("style")))&&V.quirks.styleParser.parseFontSize(n)}},j=/wysiwyg-color-[0-9a-z]+/g,(U=o).commands.foreColor={exec:function(e,t,n){U.commands.formatInline.execWithToggle(e,t,"span","wysiwyg-color-"+n,j)},state:function(e,t,n){return U.commands.formatInline.state(e,t,"span","wysiwyg-color-"+n,j)}},K=/(\s|^)color\s*:\s*[^;\s]+;?/gi,(F=o).commands.foreColorStyle={exec:function(e,t,n){var o,r=F.quirks.styleParser.parseColor("object"==typeof n?"color:"+n.color:"color:"+n,"color");r&&(o="color: rgb("+r[0]+","+r[1]+","+r[2]+");",1!==r[3]&&(o+="color: rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+");"),F.commands.formatInline.execWithToggle(e,t,"span",!1,!1,o,K))},state:function(e,t){return F.commands.formatInline.state(e,t,"span",!1,!1,"color",K)},stateValue:function(e,t,n){var o,r=this.state(e,t);return r&&F.lang.object(r).isArray()&&(r=r[0]),!!(r&&(o=r.getAttribute("style"))&&o)&&(val=F.quirks.styleParser.parseColor(o,"color"),F.quirks.styleParser.unparseColor(val,n))}},$=/(\s|^)background-color\s*:\s*[^;\s]+;?/gi,(G=o).commands.bgColorStyle={exec:function(e,t,n){var o,r=G.quirks.styleParser.parseColor("object"==typeof n?"background-color:"+n.color:"background-color:"+n,"background-color");r&&(o="background-color: rgb("+r[0]+","+r[1]+","+r[2]+");",1!==r[3]&&(o+="background-color: rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+");"),G.commands.formatInline.execWithToggle(e,t,"span",!1,!1,o,$))},state:function(e,t){return G.commands.formatInline.state(e,t,"span",!1,!1,"background-color",$)},stateValue:function(e,t,n){var o,r=this.state(e,t),i=!1;return r&&G.lang.object(r).isArray()&&(r=r[0]),!(!r||!(o=r.getAttribute("style")))&&(i=G.quirks.styleParser.parseColor(o,"background-color"),G.quirks.styleParser.unparseColor(i,n))}},function(e){var t=e.dom,n=["H1","H2","H3","H4","H5","H6","P","PRE","DIV"];function o(t,n){var o=n.test(t.className);return t.className=t.className.replace(n,""),""==e.lang.string(t.className).trim()&&t.removeAttribute("class"),o}function r(t,n){var o=n.test(t.getAttribute("style"));return t.setAttribute("style",(t.getAttribute("style")||"").replace(n,"")),""==e.lang.string(t.getAttribute("style")||"").trim()&&t.removeAttribute("style"),o}e.commands.formatBlock={exec:function(i,a,s,l,c,d,u){i.doc;var f,h,m,p,g,y=this.state(i,a,s,l,c,d,u),v=i.config.useLineBreaks,b=v?"DIV":"P";s="string"==typeof s?s.toUpperCase():s,y.length?i.selection.executeAndRestoreRangy(function(){for(var n=y.length;n--;){if(c&&(h=o(y[n],c)),u&&(p=r(y[n],u)),(p||h)&&null===s&&y[n].nodeName!=b)return;var i=(d=y[n],!!e.lang.string(d.className).trim()),a=(l=y[n],!!e.lang.string(l.getAttribute("style")||"").trim());i||a||!v&&"P"!==s?t.renameElement(y[n],"P"===s?"DIV":b):(e.dom.lineBreaks(y[n]).add(),t.replaceWithChildNodes(y[n]))}var l,d}):(null===s||e.lang.array(n).contains(s))&&(f=i.selection.findNodesInSelection(n).concat(i.selection.getSelectedOwnNodes()),i.selection.executeAndRestoreRangy(function(){for(var a=f.length;a--;)(g=t.getParentElement(f[a],{nodeName:n}))==i.element&&(g=null),g&&(s&&(g=t.renameElement(g,s)),l&&(v=l,b=c,(y=g).className?(o(y,b),y.className=e.lang.string(y.className+" "+v).trim()):y.className=v),d&&(p=d,r(h=g,u),h.getAttribute("style")?h.setAttribute("style",e.lang.string(h.getAttribute("style")+" "+p).trim()):h.setAttribute("style",p)),m=!0);var h,p,y,v,b}),m)||function(t,n){t.selection.isCollapsed()&&t.selection.selectLine();for(var o,r,i=t.selection.surround(n),a=0,s=i.length;a<s;a++)e.dom.lineBreaks(i[a]).remove(),o=i[a],r=void 0,(r=o.lastChild)&&"BR"===r.nodeName&&r.parentNode.removeChild(r)}(i,{nodeName:s||b,className:l||null,cssStyle:d||null})},state:function(n,o,r,i,a,s,l){var c,d=n.selection.getSelectedOwnNodes(),u=[];r="string"==typeof r?r.toUpperCase():r;for(var f=0,h=d.length;f<h;f++)(c=t.getParentElement(d[f],{nodeName:r,className:i,classRegExp:a,cssStyle:s,styleRegExp:l}))&&-1==e.lang.array(u).indexOf(c)&&u.push(c);return 0!=u.length&&u}}}(o),o.commands.formatCode={exec:function(e,t,n){var r,i,a,s=this.state(e);s?e.selection.executeAndRestore(function(){r=s.querySelector("code"),o.dom.replaceWithChildNodes(s),r&&o.dom.replaceWithChildNodes(r)}):(a=(i=e.selection.getRange()).extractContents(),s=e.doc.createElement("pre"),r=e.doc.createElement("code"),n&&(r.className=n),s.appendChild(r),r.appendChild(a),i.insertNode(s),e.selection.selectNode(s))},state:function(e){var t=e.selection.getSelectedNode();return t&&t.nodeName&&"PRE"==t.nodeName&&t.firstChild&&t.firstChild.nodeName&&"CODE"==t.firstChild.nodeName?t:o.dom.getParentElement(t,{nodeName:"CODE"})&&o.dom.getParentElement(t,{nodeName:"PRE"})}},function(e){var t={strong:"b",em:"i",b:"strong",i:"em"},n={};function o(o,r,i,a,s,l){var c,d,u=o;return r&&(u+=":"+r),a&&(u+=":"+a),n[u]||(n[u]=new e.selection.HTMLApplier((d=t[c=o])?[c.toLowerCase(),d.toLowerCase()]:[c.toLowerCase()],r,i,!0,a,s,l)),n[u]}e.commands.formatInline={exec:function(e,t,n,r,i,a,s,l,c){var d=e.selection.createRange(),u=e.selection.getOwnRanges();if(!u||0==u.length)return!1;e.selection.getSelection().removeAllRanges(),o(n,r,i,a,s,e.element).toggleRange(u),l?c||e.cleanUp():(d.setStart(u[0].startContainer,u[0].startOffset),d.setEnd(u[u.length-1].endContainer,u[u.length-1].endOffset),e.selection.setSelection(d),e.selection.executeAndRestore(function(){c||e.cleanUp()},!0,!0))},execWithToggle:function(t,n,o,r,i,a,s){if(this.state(t,n,o,r,i,a,s)&&t.selection.isCollapsed()&&!t.selection.caretIsLastInSelection()&&!t.selection.caretIsFirstInSelection()){var l=this.state(t,n,o,r,i)[0];t.selection.executeAndRestoreRangy(function(){l.parentNode;t.selection.selectNode(l,!0),e.commands.formatInline.exec(t,n,o,r,i,a,s,!0,!0)})}else this.state(t,n,o,r,i,a,s)&&!t.selection.isCollapsed()?t.selection.executeAndRestoreRangy(function(){e.commands.formatInline.exec(t,n,o,r,i,a,s,!0,!0)}):e.commands.formatInline.exec(t,n,o,r,i,a,s)},state:function(n,r,i,a,s,l,c){var d,u,f=n.doc,h=t[i]||i;return!(!e.dom.hasElementWithTagName(f,i)&&!e.dom.hasElementWithTagName(f,h))&&(!(a&&!e.dom.hasElementWithClassName(f,a))&&(!(!(d=n.selection.getOwnRanges())||0===d.length)&&(!(!(u=o(i,a,s,l,c,n.element).isAppliedToRange(d))||!u.elements)&&u.elements)))}}}(o),(X=o).commands.insertBlockQuote={exec:function(e,t){var n=this.state(e,t),o=e.selection.isEndToEndInNode(["H1","H2","H3","H4","H5","H6","P"]);e.selection.executeAndRestore(function(){if(n)e.config.useLineBreaks&&X.dom.lineBreaks(n).add(),X.dom.unwrap(n);else if(e.selection.isCollapsed()&&e.selection.selectLine(),o){var t=o.ownerDocument.createElement("blockquote");X.dom.insert(t).after(o),t.appendChild(o)}else e.selection.surround({nodeName:"blockquote"})})},state:function(e,t){var n=e.selection.getSelectedNode(),o=X.dom.getParentElement(n,{nodeName:"BLOCKQUOTE"},!1,e.element);return o||!1}},o.commands.insertHTML={exec:function(e,t,n){e.commands.support(t)?e.doc.execCommand(t,!1,n):e.selection.insertHTML(n)},state:function(){return!1}},(Y=o).commands.insertImage={exec:function(e,t,n){n="object"==typeof n?n:{src:n};var o,r,i=e.doc,a=this.state(e);if(a)return e.selection.setBefore(a),(r=a.parentNode).removeChild(a),Y.dom.removeEmptyTextNodes(r),"A"!==r.nodeName||r.firstChild||(e.selection.setAfter(r),r.parentNode.removeChild(r)),void Y.quirks.redraw(e.element);a=i.createElement("IMG");for(var s in n)a.setAttribute("className"===s?"class":s,n[s]);e.selection.insertNode(a),Y.browser.hasProblemsSettingCaretAfterImg()?(o=i.createTextNode(Y.INVISIBLE_SPACE),e.selection.insertNode(o),e.selection.setAfter(o)):e.selection.setAfter(a)},state:function(e){var t,n,o,r=e.doc;return!!Y.dom.hasElementWithTagName(r,"IMG")&&!!(t=e.selection.getSelectedNode())&&("IMG"===t.nodeName?t:t.nodeType===Y.ELEMENT_NODE&&(n=e.selection.getText(),!(n=Y.lang.string(n).trim())&&1===(o=e.selection.getNodes(Y.ELEMENT_NODE,function(e){return"IMG"===e.nodeName})).length&&o[0]))}},Z="<br>"+((Q=o).browser.needsSpaceAfterLineBreak()?" ":""),Q.commands.insertLineBreak={exec:function(e,t){e.commands.support(t)?(e.doc.execCommand(t,!1,null),Q.browser.autoScrollsToCaret()||e.selection.scrollIntoView()):e.commands.exec("insertHTML",Z)},state:function(){return!1}},o.commands.insertOrderedList={exec:function(e,t){o.commands.insertList.exec(e,t,"OL")},state:function(e,t){return o.commands.insertList.state(e,t,"OL")}},o.commands.insertUnorderedList={exec:function(e,t){o.commands.insertList.exec(e,t,"UL")},state:function(e,t){return o.commands.insertList.state(e,t,"UL")}},o.commands.insertList=(J=o,ee=function(e,t){if(e&&e.nodeName){"string"==typeof t&&(t=[t]);for(var n=t.length;n--;)if(e.nodeName===t[n])return!0}return!1},te=function(e,t,n){var o={el:null,other:!1};if(e){var r=J.dom.getParentElement(e,{nodeName:"LI"}),i="UL"===t?"OL":"UL";ee(e,t)?o.el=e:ee(e,i)?o={el:e,other:!0}:r&&(ee(r.parentNode,t)?o.el=r.parentNode:ee(r.parentNode,i)&&(o={el:r.parentNode,other:!0}))}return o.el&&!n.element.contains(o.el)&&(o.el=null),o},ne=function(e,t){for(var n=t.selection.getOwnRanges(),o=[],r=n.length;r--;)o=o.concat(n[r].getNodes([1],function(t){return ee(t,e)}));return o},{exec:function(e,t,n){var o,r,i,a,s,l,c,d,u,f,h,m=e.doc,p="OL"===n?"insertOrderedList":"insertUnorderedList",g=e.selection.getSelectedNode(),y=te(g,n,e);y.el?y.other?(l=y.el,d=e,u="UL"===(c=n)?"OL":"UL",d.selection.executeAndRestore(function(){for(var e=[l].concat(ne(u,d)),t=e.length;t--;)J.dom.renameElement(e[t],c.toLowerCase())})):(o=y.el,i=e,s="UL"===(r=n)?"OL":"UL",i.selection.executeAndRestore(function(){var e=ne(s,i);if(e.length)for(var t=e.length;t--;)J.dom.renameElement(e[t],r.toLowerCase());else{for(var n=(a=ne(["OL","UL"],i)).length;n--;)J.dom.resolveList(a[n],i.config.useLineBreaks);J.dom.resolveList(o,i.config.useLineBreaks)}})):e.commands.support(p)?m.execCommand(p,!1,null):(f=n,(h=e).selection.executeAndRestoreRangy(function(){var e,t,n="_wysihtml5-temp-"+(new Date).getTime(),o=h.selection.deblockAndSurround({nodeName:"div",className:n});o.innerHTML=o.innerHTML.replace(/\uFEFF/g,""),o&&(e=J.lang.array(["","<br>",J.INVISIBLE_SPACE]).contains(o.innerHTML),t=J.dom.convertToList(o,f.toLowerCase(),h.parent.config.uneditableContainerClassname),e&&h.selection.selectNode(t.querySelector("li"),!0))}))},state:function(e,t,n){var o=e.selection.getSelectedNode(),r=te(o,n,e);return!(!r.el||r.other)&&r.el}}),o.commands.italic={exec:function(e,t){o.commands.formatInline.execWithToggle(e,t,"i")},state:function(e,t){return o.commands.formatInline.state(e,t,"i")}},re="wysiwyg-text-align-center",ie=/wysiwyg-text-align-[0-9a-z]+/g,(oe=o).commands.justifyCenter={exec:function(e,t){return oe.commands.formatBlock.exec(e,"formatBlock",null,re,ie)},state:function(e,t){return oe.commands.formatBlock.state(e,"formatBlock",null,re,ie)}},se="wysiwyg-text-align-left",le=/wysiwyg-text-align-[0-9a-z]+/g,(ae=o).commands.justifyLeft={exec:function(e,t){return ae.commands.formatBlock.exec(e,"formatBlock",null,se,le)},state:function(e,t){return ae.commands.formatBlock.state(e,"formatBlock",null,se,le)}},de="wysiwyg-text-align-right",ue=/wysiwyg-text-align-[0-9a-z]+/g,(ce=o).commands.justifyRight={exec:function(e,t){return ce.commands.formatBlock.exec(e,"formatBlock",null,de,ue)},state:function(e,t){return ce.commands.formatBlock.state(e,"formatBlock",null,de,ue)}},he="wysiwyg-text-align-justify",me=/wysiwyg-text-align-[0-9a-z]+/g,(fe=o).commands.justifyFull={exec:function(e,t){return fe.commands.formatBlock.exec(e,"formatBlock",null,he,me)},state:function(e,t){return fe.commands.formatBlock.state(e,"formatBlock",null,he,me)}},ge="text-align: right;",ye=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi,(pe=o).commands.alignRightStyle={exec:function(e,t){return pe.commands.formatBlock.exec(e,"formatBlock",null,null,null,ge,ye)},state:function(e,t){return pe.commands.formatBlock.state(e,"formatBlock",null,null,null,ge,ye)}},be="text-align: left;",we=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi,(ve=o).commands.alignLeftStyle={exec:function(e,t){return ve.commands.formatBlock.exec(e,"formatBlock",null,null,null,be,we)},state:function(e,t){return ve.commands.formatBlock.state(e,"formatBlock",null,null,null,be,we)}},Ne="text-align: center;",xe=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi,(Ce=o).commands.alignCenterStyle={exec:function(e,t){return Ce.commands.formatBlock.exec(e,"formatBlock",null,null,null,Ne,xe)},state:function(e,t){return Ce.commands.formatBlock.state(e,"formatBlock",null,null,null,Ne,xe)}},o.commands.redo={exec:function(e){return e.undoManager.redo()},state:function(e){return!1}},o.commands.underline={exec:function(e,t){o.commands.formatInline.execWithToggle(e,t,"u")},state:function(e,t){return o.commands.formatInline.state(e,t,"u")}},o.commands.undo={exec:function(e){return e.undoManager.undo()},state:function(e){return!1}},o.commands.createTable={exec:function(e,t,n){var o,r,i;if(n&&n.cols&&n.rows&&parseInt(n.cols,10)>0&&parseInt(n.rows,10)>0){for(i=n.tableStyle?'<table style="'+n.tableStyle+'">':"<table>",i+="<tbody>",r=0;r<n.rows;r++){for(i+="<tr>",o=0;o<n.cols;o++)i+="<td>&nbsp;</td>";i+="</tr>"}i+="</tbody></table>",e.commands.exec("insertHTML",i)}},state:function(e,t){return!1}},o.commands.mergeTableCells={exec:function(e,t){e.tableSelection&&e.tableSelection.start&&e.tableSelection.end&&(this.state(e,t)?o.dom.table.unmergeCell(e.tableSelection.start):o.dom.table.mergeCellsBetween(e.tableSelection.start,e.tableSelection.end))},state:function(e,t){if(e.tableSelection){var n=e.tableSelection.start,r=e.tableSelection.end;if(n&&r&&n==r&&(o.dom.getAttribute(n,"colspan")&&parseInt(o.dom.getAttribute(n,"colspan"),10)>1||o.dom.getAttribute(n,"rowspan")&&parseInt(o.dom.getAttribute(n,"rowspan"),10)>1))return[n]}return!1}},o.commands.addTableCells={exec:function(e,t,n){if(e.tableSelection&&e.tableSelection.start&&e.tableSelection.end){var r=o.dom.table.orderSelectionEnds(e.tableSelection.start,e.tableSelection.end);"before"==n||"above"==n?o.dom.table.addCells(r.start,n):"after"!=n&&"below"!=n||o.dom.table.addCells(r.end,n),setTimeout(function(){e.tableSelection.select(r.start,r.end)},0)}},state:function(e,t){return!1}},o.commands.deleteTableCells={exec:function(e,t,n){if(e.tableSelection&&e.tableSelection.start&&e.tableSelection.end){var r,i=o.dom.table.orderSelectionEnds(e.tableSelection.start,e.tableSelection.end),a=o.dom.table.indexOf(i.start),s=e.tableSelection.table;o.dom.table.removeCells(i.start,n),setTimeout(function(){(r=o.dom.table.findCell(s,a))||("row"==n&&(r=o.dom.table.findCell(s,{row:a.row-1,col:a.col})),"column"==n&&(r=o.dom.table.findCell(s,{row:a.row,col:a.col-1}))),r&&e.tableSelection.select(r,r)},0)}},state:function(e,t){return!1}},o.commands.indentList={exec:function(e,t,n){var o=e.selection.getSelectionParentsByTag("LI");return!!o&&this.tryToPushLiLevel(o,e.selection)},state:function(e,t){return!1},tryToPushLiLevel:function(e,t){var n,r,i,a,s,l=!1;return t.executeAndRestoreRangy(function(){for(var t=e.length;t--;)a=e[t],n="OL"===a.parentNode.nodeName?"OL":"UL",r=a.ownerDocument.createElement(n),i=o.dom.domNode(a).prev({nodeTypes:[o.ELEMENT_NODE]}),s=i?i.querySelector("ul, ol"):null,i&&(s?s.appendChild(a):(r.appendChild(a),i.appendChild(r)),l=!0)}),l}},o.commands.outdentList={exec:function(e,t,n){var o=e.selection.getSelectionParentsByTag("LI");return!!o&&this.tryToPullLiLevel(o,e)},state:function(e,t){return!1},tryToPullLiLevel:function(e,t){var n,r,i,a,s,l=!1,c=this;return t.selection.executeAndRestoreRangy(function(){for(var d=e.length;d--;)if((a=e[d]).parentNode&&("OL"===(n=a.parentNode).tagName||"UL"===n.tagName)){if(l=!0,r=o.dom.getParentElement(n.parentNode,{nodeName:["OL","UL"]},!1,t.element),i=o.dom.getParentElement(n.parentNode,{nodeName:["LI"]},!1,t.element),r&&i)a.nextSibling&&(s=c.getAfterList(n,a),a.appendChild(s)),r.insertBefore(a,i.nextSibling);else{a.nextSibling&&(s=c.getAfterList(n,a),a.appendChild(s));for(var u=a.childNodes.length;u--;)n.parentNode.insertBefore(a.childNodes[u],n.nextSibling);n.parentNode.insertBefore(document.createElement("br"),n.nextSibling),a.parentNode.removeChild(a)}0===n.childNodes.length&&n.parentNode.removeChild(n)}}),l},getAfterList:function(e,t){for(var n=e.nodeName,o=document.createElement(n);t.nextSibling;)o.appendChild(t.nextSibling);return o}},function(e){var t="data-wysihtml5-selection-node",n="data-wysihtml5-selection-offset",o=(e.INVISIBLE_SPACE,e.INVISIBLE_SPACE,e.dom);e.UndoManager=e.lang.Dispatcher.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){var e,t=this;this.composer.sandbox.getDocument();o.observe(this.element,"keydown",function(e){if(!e.altKey&&(e.ctrlKey||e.metaKey)){var n=e.keyCode,o=90===n&&!e.shiftKey,r=90===n&&e.shiftKey||89===n;o?(t.undo(),e.preventDefault()):r&&(t.redo(),e.preventDefault())}}),o.observe(this.element,"keydown",function(n){var o=n.keyCode;o!==e&&(e=o,8!==o&&46!==o||t.transact())}),this.editor.on("newword:composer",function(){t.transact()}).on("beforecommand:composer",function(){t.transact()})},transact:function(){var o,r,i,a,s,l=this.historyStr[this.position-1],c=this.composer.getValue(!1,!1),d=this.element.offsetWidth>0&&this.element.offsetHeight>0;if(c!==l){(this.historyStr.length=this.historyDom.length=this.position)>25&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,d&&(r=(o=this.composer.selection.getRange())&&o.startContainer?o.startContainer:this.element,i=o&&o.startOffset?o.startOffset:0,r.nodeType===e.ELEMENT_NODE?a=r:(a=r.parentNode,s=this.getChildNodeIndex(a,r)),a.setAttribute(n,i),void 0!==s&&a.setAttribute(t,s));var u=this.element.cloneNode(!!c);this.historyDom.push(u),this.historyStr.push(c),a&&(a.removeAttribute(n),a.removeAttribute(t))}},undo:function(){this.transact(),this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(e){this.element.innerHTML="";for(var o,r,i,a=0,s=e.childNodes,l=e.childNodes.length;a<l;a++)this.element.appendChild(s[a].cloneNode(!0));e.hasAttribute(n)?(o=e.getAttribute(n),i=e.getAttribute(t),r=this.element):(o=(r=this.element.querySelector("["+n+"]")||this.element).getAttribute(n),i=r.getAttribute(t),r.removeAttribute(n),r.removeAttribute(t)),null!==i&&(r=this.getChildNodeByIndex(r,+i)),this.composer.selection.set(r,o)},getChildNodeIndex:function(e,t){for(var n=0,o=e.childNodes,r=o.length;n<r;n++)if(o[n]===t)return n},getChildNodeByIndex:function(e,t){return e.childNodes[t]}})}(o),o.views.View=lt.extend({constructor:function(e,t,n){this.parent=e,this.element=t,this.config=n,this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var e=this;this.parent.on("beforeload",function(){e.parent.on("change_view",function(t){t===e.name?(e.parent.currentView=e,e.show(),setTimeout(function(){e.focus()},0)):e.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(e){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),Se=(Ee=o).dom,Te=Ee.browser,Ee.views.Composer=Ee.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(e,t,n){this.base(e,t,n),this.config.noTextarea?this.editableArea=t:this.textarea=this.parent.textarea,this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=Te.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(e,t){var n=this.isEmpty()?"":Ee.quirks.getCorrectInnerHTML(this.element);return!1!==e&&(n=this.parent.parse(n,!1!==t)),n},setValue:function(e,t){t&&(e=this.parent.parse(e));try{this.element.innerHTML=e}catch(t){this.element.innerText=e}},cleanUp:function(){this.parent.parse(this.element)},show:function(){this.editableArea.style.display=this._displayStyle||"",this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=Se.getStyle("display").from(this.editableArea),"none"===this._displayStyle&&(this._displayStyle=null),this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(e){Ee.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var t=this.element.lastChild;e&&t&&this.selection&&("BR"===t.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return Se.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var e=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(e)||""===e||"<br>"===e||"<p></p>"===e||"<p><br></p>"===e||this.hasPlaceholderSet()},_initContentEditableArea:function(){var e=this;this.config.noTextarea?this.sandbox=new Se.ContentEditableArea(function(){e._create()},{},this.editableArea):(this.sandbox=new Se.ContentEditableArea(function(){e._create()}),this.editableArea=this.sandbox.getContentEditable(),Se.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var e=this;this.sandbox=new Se.Sandbox(function(){e._create()},{stylesheets:this.config.stylesheets}),this.editableArea=this.sandbox.getIframe();var t=this.textarea.element;Se.insert(this.editableArea).after(t),this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var e=document.createElement("input");e.type="hidden",e.name="_wysihtml5_mode",e.value=1,Se.insert(e).after(this.textarea.element)}},_create:function(){var e=this;this.doc=this.sandbox.getDocument(),this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body,this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1)),this.selection=new Ee.Selection(this.parent,this.element,this.config.uneditableContainerClassname),this.commands=new Ee.Commands(this.parent),this.config.noTextarea||Se.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),Se.addClass(this.element,this.config.composerClassName),this.config.style&&!this.config.contentEditableMode&&this.style(),this.observe();var t=this.config.name;t&&(Se.addClass(this.element,t),this.config.contentEditableMode||Se.addClass(this.editableArea,t)),this.enable(),!this.config.noTextarea&&this.textarea.element.disabled&&this.disable();var n="string"==typeof this.config.placeholder?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder");n&&Se.simulatePlaceholder(this.parent,this,n),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||Te.isIos()||setTimeout(function(){e.focus(!0)},100),Te.clearsContentEditableCorrectly()||Ee.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.config.noTextarea||this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var e=this,t=Te.canDisableAutoLinking(),n=Te.doesAutoLinkingInContentEditable();if(t&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink){(!n||n&&t)&&(this.parent.on("newword:composer",function(){Se.getTextContent(e.element).match(Se.autoLink.URL_REG_EXP)&&e.selection.executeAndRestore(function(t,n){for(var o=e.element.querySelectorAll("."+e.config.uneditableContainerClassname),r=!1,i=o.length;i--;)Ee.dom.contains(o[i],n)&&(r=!0);r||Se.autoLink(n.parentNode,[e.config.uneditableContainerClassname])})}),Se.observe(this.element,"blur",function(){Se.autoLink(e.element,[e.config.uneditableContainerClassname])}));var o=this.sandbox.getDocument().getElementsByTagName("a"),r=Se.autoLink.URL_REG_EXP,i=function(e){var t=Ee.lang.string(Se.getTextContent(e)).trim();return"www."===t.substr(0,4)&&(t="http://"+t),t};Se.observe(this.element,"keydown",function(t){if(o.length){var n,a=e.selection.getSelectedNode(t.target.ownerDocument),s=Se.getParentElement(a,{nodeName:"A"},4);s&&(n=i(s),setTimeout(function(){var e=i(s);e!==n&&e.match(r)&&s.setAttribute("href",e)},0))}})}},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),Te.supportsEvent("resizeend")){var e=["width","height"],t=e.length,n=this.element;Se.observe(n,"resizeend",function(o){var r,i=o.target||o.srcElement,a=i.style,s=0;if("IMG"===i.nodeName){for(;s<t;s++)a[r=e[s]]&&(i.setAttribute(r,parseInt(a[r],10)),a[r]="");Ee.quirks.redraw(n)}})}},_initUndoManager:function(){this.undoManager=new Ee.UndoManager(this.parent)},_initLineBreaking:function(){var e=this,t=["LI","P","H1","H2","H3","H4","H5","H6"],n=["UL","OL","MENU"];function o(t){var n=Se.getParentElement(t,{nodeName:["P","DIV"]},2);n&&Se.contains(e.element,n)&&e.selection.executeAndRestore(function(){e.config.useLineBreaks?Se.replaceWithChildNodes(n):"P"!==n.nodeName&&Se.renameElement(n,"p")})}this.config.useLineBreaks||Se.observe(this.element,["focus","keydown"],function(){if(e.isEmpty()){var t=e.doc.createElement("P");e.element.innerHTML="",e.element.appendChild(t),Te.displaysCaretInEmptyContentEditableCorrectly()?e.selection.selectNode(t,!0):(t.innerHTML="<br>",e.selection.setBefore(t.firstChild))}}),Se.observe(this.element,"keydown",function(r){var i=r.keyCode;if(!r.shiftKey&&(i===Ee.ENTER_KEY||i===Ee.BACKSPACE_KEY)){var a=Se.getParentElement(e.selection.getSelectedNode(),{nodeName:t},4);a?setTimeout(function(){var t=e.selection.getSelectedNode();if("LI"===a.nodeName){if(!t)return;Se.getParentElement(t,{nodeName:n},2)||o(t)}i===Ee.ENTER_KEY&&a.nodeName.match(/^H[1-6]$/)&&o(t)},0):e.config.useLineBreaks&&i===Ee.ENTER_KEY&&!Ee.browser.insertsLineBreaksOnReturn()&&(r.preventDefault(),e.commands.exec("insertLineBreak"))}})}}),Ae=(Re=o).dom,_e=document,Ie=window,Oe=_e.createElement("div"),Le=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],ke=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],De=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",Re.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],Re.views.Composer.prototype.style=function(){var e,t=this,n=_e.querySelector(":focus"),o=this.textarea.element,r=o.hasAttribute("placeholder"),i=r&&o.getAttribute("placeholder"),a=o.style.display,s=o.disabled;this.focusStylesHost=Oe.cloneNode(!1),this.blurStylesHost=Oe.cloneNode(!1),this.disabledStylesHost=Oe.cloneNode(!1),r&&o.removeAttribute("placeholder"),o===n&&o.blur(),o.disabled=!1,o.style.display=e="none",(o.getAttribute("rows")&&"auto"===Ae.getStyle("height").from(o)||o.getAttribute("cols")&&"auto"===Ae.getStyle("width").from(o))&&(o.style.display=e=a),Ae.copyStyles(ke).from(o).to(this.editableArea).andTo(this.blurStylesHost),Ae.copyStyles(Le).from(o).to(this.element).andTo(this.blurStylesHost),Ae.insertCSS(De).into(this.element.ownerDocument),o.disabled=!0,Ae.copyStyles(ke).from(o).to(this.disabledStylesHost),Ae.copyStyles(Le).from(o).to(this.disabledStylesHost),o.disabled=s,o.style.display=a,function(e){if(e.setActive)try{e.setActive()}catch(e){}else{var t=e.style,n=_e.documentElement.scrollTop||_e.body.scrollTop,o=_e.documentElement.scrollLeft||_e.body.scrollLeft,r={position:t.position,top:t.top,left:t.left,WebkitUserSelect:t.WebkitUserSelect};Ae.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(e),e.focus(),Ae.setStyles(r).on(e),Ie.scrollTo&&Ie.scrollTo(o,n)}}(o),o.style.display=e,Ae.copyStyles(ke).from(o).to(this.focusStylesHost),Ae.copyStyles(Le).from(o).to(this.focusStylesHost),o.style.display=a,Ae.copyStyles(["display"]).from(o).to(this.editableArea);var l=Re.lang.array(ke).without(["display"]);return n?n.focus():o.blur(),r&&o.setAttribute("placeholder",i),this.parent.on("focus:composer",function(){Ae.copyStyles(l).from(t.focusStylesHost).to(t.editableArea),Ae.copyStyles(Le).from(t.focusStylesHost).to(t.element)}),this.parent.on("blur:composer",function(){Ae.copyStyles(l).from(t.blurStylesHost).to(t.editableArea),Ae.copyStyles(Le).from(t.blurStylesHost).to(t.element)}),this.parent.observe("disable:composer",function(){Ae.copyStyles(l).from(t.disabledStylesHost).to(t.editableArea),Ae.copyStyles(Le).from(t.disabledStylesHost).to(t.element)}),this.parent.observe("enable:composer",function(){Ae.copyStyles(l).from(t.blurStylesHost).to(t.editableArea),Ae.copyStyles(Le).from(t.blurStylesHost).to(t.element)}),this},Be=(Me=o).dom,Pe=Me.browser,He={66:"bold",73:"italic",85:"underline"},Me.views.Composer.prototype.observe=function(){var e=this,t=this.getValue(!1,!1),n=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),o=this.element,r=Pe.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?o:this.sandbox.getWindow();if(Be.observe(n,"DOMNodeRemoved",function(){clearInterval(i),e.parent.fire("destroy:composer")}),!Pe.supportsMutationEvents())var i=setInterval(function(){Be.contains(document.documentElement,n)||(clearInterval(i),e.parent.fire("destroy:composer"))},250);Be.observe(r,["drop","paste","mouseup","focus","keyup"],function(){setTimeout(function(){e.parent.fire("interaction").fire("interaction:composer")},0)}),this.config.handleTables&&(!this.tableClickHandle&&this.doc.execCommand&&Me.browser.supportsCommand(this.doc,"enableObjectResizing")&&Me.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?this.tableClickHandle=Be.observe(n,["focus","mouseup","mouseover"],function(){e.doc.execCommand("enableObjectResizing",!1,"false"),e.doc.execCommand("enableInlineTableEditing",!1,"false"),e.tableClickHandle.stop()}):setTimeout(function(){e.doc.execCommand("enableObjectResizing",!1,"false"),e.doc.execCommand("enableInlineTableEditing",!1,"false")},0)),this.tableSelection=Me.quirks.tableCellsSelection(o,e.parent)),Be.observe(r,"focus",function(n){e.parent.fire("focus",n).fire("focus:composer",n),setTimeout(function(){t=e.getValue(!1,!1)},0)}),Be.observe(r,"blur",function(n){if(t!==e.getValue(!1,!1)){var o=n;"function"==typeof Object.create&&(o=Object.create(n,{type:{value:"change"}})),e.parent.fire("change",o).fire("change:composer",o)}e.parent.fire("blur",n).fire("blur:composer",n)}),Be.observe(o,"dragenter",function(){e.parent.fire("unset_placeholder")}),Be.observe(o,["drop","paste"],function(t){setTimeout(function(){e.parent.fire(t.type,t).fire(t.type+":composer",t)},0)}),Be.observe(o,"keyup",function(t){var n=t.keyCode;n!==Me.SPACE_KEY&&n!==Me.ENTER_KEY||e.parent.fire("newword:composer")}),this.parent.on("paste:composer",function(){setTimeout(function(){e.parent.fire("newword:composer")},0)}),Pe.canSelectImagesInContentEditable()||Be.observe(o,"mousedown",function(t){var n=t.target,r=o.querySelectorAll("img"),i=o.querySelectorAll("."+e.config.uneditableContainerClassname+" img"),a=Me.lang.array(r).without(i);"IMG"===n.nodeName&&Me.lang.array(a).contains(n)&&e.selection.selectNode(n)}),Pe.canSelectImagesInContentEditable()||Be.observe(o,"drop",function(t){setTimeout(function(){e.selection.getSelection().removeAllRanges()},0)}),Pe.hasHistoryIssue()&&Pe.supportsSelectionModify()&&Be.observe(o,"keydown",function(e){if(e.metaKey||e.ctrlKey){var t=e.keyCode,n=o.ownerDocument.defaultView.getSelection();37!==t&&39!==t||(37===t&&(n.modify("extend","left","lineboundary"),e.shiftKey||n.collapseToStart()),39===t&&(n.modify("extend","right","lineboundary"),e.shiftKey||n.collapseToEnd()),e.preventDefault())}}),Be.observe(o,"keydown",function(t){var n=t.keyCode,r=He[n];(t.ctrlKey||t.metaKey)&&!t.altKey&&r&&(e.commands.exec(r),t.preventDefault()),8===n?function(e,t,n,o){if(t.isCollapsed())if(t.caretIsInTheBeginnig("LI"))e.preventDefault(),o.commands.exec("outdentList");else if(t.caretIsInTheBeginnig())e.preventDefault();else{if(t.caretIsFirstInSelection()&&t.getPreviousNode()&&t.getPreviousNode().nodeName&&/^H\d$/gi.test(t.getPreviousNode().nodeName)){var r=t.getPreviousNode();if(e.preventDefault(),/^\s*$/.test(r.textContent||r.innerText))r.parentNode.removeChild(r);else{var i=r.ownerDocument.createRange();i.selectNodeContents(r),i.collapse(!1),t.setSelection(i)}}var a=t.caretIsBeforeUneditable();a&&(e.preventDefault(),function(e,t,n){var o=e.getPreviousNode(t,!0),r=e.getSelectedNode();if(1!==r.nodeType&&r.parentNode!==n&&(r=r.parentNode),o)if(1==r.nodeType){var i=r.firstChild;if(1==o.nodeType)for(;r.firstChild;)o.appendChild(r.firstChild);else for(;r.firstChild;)t.parentNode.insertBefore(r.firstChild,t);r.parentNode&&r.parentNode.removeChild(r),e.setBefore(i)}else 1==o.nodeType?o.appendChild(r):t.parentNode.insertBefore(r,t),e.setBefore(r)}(t,a,n))}else t.containsUneditable()&&(e.preventDefault(),t.deleteContents())}(t,e.selection,o,e):e.config.handleTabKey&&9===n&&(t.preventDefault(),function(e,t){if(e.selection.isCollapsed()){if(e.selection.caretIsInTheBeginnig("LI")&&e.commands.exec("indentList"))return}else e.selection.deleteContents();e.commands.exec("insertHTML","&emsp;")}(e))}),Be.observe(o,"keydown",function(t){var n,r=e.selection.getSelectedNode(!0),i=t.keyCode;!r||"IMG"!==r.nodeName||i!==Me.BACKSPACE_KEY&&i!==Me.DELETE_KEY||((n=r.parentNode).removeChild(r),"A"!==n.nodeName||n.firstChild||n.parentNode.removeChild(n),setTimeout(function(){Me.quirks.redraw(o)},0),t.preventDefault())}),!this.config.contentEditableMode&&Pe.hasIframeFocusIssue()&&(Be.observe(n,"focus",function(){setTimeout(function(){e.doc.querySelector(":focus")!==e.element&&e.focus()},0)}),Be.observe(this.element,"blur",function(){setTimeout(function(){e.selection.getSelection().removeAllRanges()},0)}));var a={IMG:"Image: ",A:"Link: "};Be.observe(o,"mouseover",function(e){var t,n=e.target,o=n.nodeName;"A"!==o&&"IMG"!==o||n.hasAttribute("title")||(t=a[o]+(n.getAttribute("href")||n.getAttribute("src")),n.setAttribute("title",t))})},(ze=o).views.Synchronizer=lt.extend({constructor:function(e,t,n){this.editor=e,this.textarea=t,this.composer=n,this._observe()},fromComposerToTextarea:function(e){this.textarea.setValue(ze.lang.string(this.composer.getValue(!1,!1)).trim(),e)},fromTextareaToComposer:function(e){var t=this.textarea.getValue(!1,!1);t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(e){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(e):this.fromComposerToTextarea(e)},_observe:function(){var e,t=this,n=this.textarea.element.form,o=function(){e=setInterval(function(){t.fromComposerToTextarea()},400)},r=function(){clearInterval(e),e=null};o(),n&&(ze.dom.observe(n,"submit",function(){t.sync(!0)}),ze.dom.observe(n,"reset",function(){setTimeout(function(){t.fromTextareaToComposer()},0)})),this.editor.on("change_view",function(n){"composer"!==n||e?"textarea"===n&&(t.fromComposerToTextarea(!0),r()):(t.fromTextareaToComposer(!0),o())}),this.editor.on("destroy:composer",r)}}),o.views.Textarea=o.views.View.extend({name:"textarea",constructor:function(e,t,n){this.base(e,t,n),this._observe()},clear:function(){this.element.value=""},getValue:function(e){var t=this.isEmpty()?"":this.element.value;return!1!==e&&(t=this.parent.parse(t)),t},setValue:function(e,t){t&&(e=this.parent.parse(e)),this.element.value=e},cleanUp:function(){var e=this.parent.parse(this.element.value);this.element.value=e},hasPlaceholderSet:function(){var e=o.browser.supportsPlaceholderAttributeOn(this.element),t=this.element.getAttribute("placeholder")||null,n=this.element.value;return e&&!n||n===t},isEmpty:function(){return!o.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var e=this.element,t=this.parent,n={focusin:"focus",focusout:"blur"},r=o.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];t.on("beforeload",function(){o.dom.observe(e,r,function(e){var o=n[e.type]||e.type;t.fire(o).fire(o+":textarea")}),o.dom.observe(e,["paste","drop"],function(){setTimeout(function(){t.fire("paste").fire("paste:textarea")},0)})})}}),We={name:Ve,style:!0,toolbar:Ve,showToolbarAfterInit:!0,autoLink:!0,handleTables:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},parser:(qe=o).dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",useLineBreaks:!0,stylesheets:[],placeholderText:Ve,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,uneditableContainerClassname:"wysihtml5-uneditable-container"},qe.Editor=qe.lang.Dispatcher.extend({constructor:function(e,t){if(this.editableElement="string"==typeof e?document.getElementById(e):e,this.config=qe.lang.object({}).merge(We).merge(t).get(),this._isCompatible=qe.browser.supported(),"textarea"!=this.editableElement.nodeName.toLowerCase()&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0),this.config.noTextarea||(this.textarea=new qe.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea),!this._isCompatible||!this.config.supportTouchDevices&&qe.browser.isTouchDevice()){var n=this;setTimeout(function(){n.fire("beforeload").fire("load")},0)}else qe.dom.addClass(document.body,this.config.bodyClassName),this.composer=new qe.views.Composer(this,this.editableElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea||(this.synchronizer=new qe.views.Synchronizer(this,this.textarea,this.composer)),this.config.toolbar&&(this.toolbar=new qe.toolbar.Toolbar(this,this.config.toolbar,this.config.showToolbarAfterInit))},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(e,t){return this.currentView.getValue(e,t)},setValue:function(e,t){return this.fire("unset_placeholder"),e?(this.currentView.setValue(e,t),this):this.clear()},cleanUp:function(){this.currentView.cleanUp()},focus:function(e){return this.currentView.focus(e),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(e,t){var n=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,o=this.config.parser(e,{rules:this.config.parserRules,cleanUp:this.config.cleanUp,context:n,uneditableClass:this.config.uneditableContainerClassname,clearInternals:t});return"object"==typeof e&&qe.quirks.redraw(e),o},_initParser:function(){this.on("paste:composer",function(){var e=this;e.composer.selection.executeAndRestore(function(){qe.quirks.cleanPastedHTML(e.composer.element),e.parse(e.composer.element)},!0)})}}),je=(Ue=o).dom,Fe="wysihtml5-command-dialog-opened",Ke="input, select, textarea",Ge="[data-wysihtml5-dialog-field]",$e="data-wysihtml5-dialog-field",Ue.toolbar.Dialog=Ue.lang.Dispatcher.extend({constructor:function(e,t){this.link=e,this.container=t},_observe:function(){if(!this._observed){var e=this,t=function(t){var n=e._serialize();n==e.elementToChange?e.fire("edit",n):e.fire("save",n),e.hide(),t.preventDefault(),t.stopPropagation()};je.observe(e.link,"click",function(){je.hasClass(e.link,Fe)&&setTimeout(function(){e.hide()},0)}),je.observe(this.container,"keydown",function(n){var o=n.keyCode;o===Ue.ENTER_KEY&&t(n),o===Ue.ESCAPE_KEY&&(e.fire("cancel"),e.hide())}),je.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",t),je.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(t){e.fire("cancel"),e.hide(),t.preventDefault(),t.stopPropagation()});for(var n=this.container.querySelectorAll(Ke),o=0,r=n.length,i=function(){clearInterval(e.interval)};o<r;o++)je.observe(n[o],"change",i);this._observed=!0}},_serialize:function(){for(var e=this.elementToChange||{},t=this.container.querySelectorAll(Ge),n=t.length,o=0;o<n;o++)e[t[o].getAttribute($e)]=t[o].value;return e},_interpolate:function(e){for(var t,n,o,r=document.querySelector(":focus"),i=this.container.querySelectorAll(Ge),a=i.length,s=0;s<a;s++)(t=i[s])!==r&&(e&&"hidden"===t.type||(n=t.getAttribute($e),o=this.elementToChange&&"boolean"!=typeof this.elementToChange?this.elementToChange.getAttribute(n)||"":t.defaultValue,t.value=o))},show:function(e){if(!je.hasClass(this.link,Fe)){var t=this,n=this.container.querySelector(Ke);if(this.elementToChange=e,this._observe(),this._interpolate(),e&&(this.interval=setInterval(function(){t._interpolate(!0)},500)),je.addClass(this.link,Fe),this.container.style.display="",this.fire("show"),n&&!e)try{n.focus()}catch(e){}}},hide:function(){clearInterval(this.interval),this.elementToChange=null,je.removeClass(this.link,Fe),this.container.style.display="none",this.fire("hide")}}),Ye=(Xe=o).dom,Qe={position:"relative"},Ze={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},Je={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},et={"x-webkit-speech":"",speech:""},Xe.toolbar.Speech=function(e,t){var n=document.createElement("input");if(Xe.browser.supportsSpeechApiOn(n)){var o=e.editor.textarea.element.getAttribute("lang");o&&(et.lang=o);var r=document.createElement("div");Xe.lang.object(Ze).merge({width:t.offsetWidth+"px",height:t.offsetHeight+"px"}),Ye.insert(n).into(r),Ye.insert(r).into(t),Ye.setStyles(Je).on(n),Ye.setAttributes(et).on(n),Ye.setStyles(Ze).on(r),Ye.setStyles(Qe).on(t);var i="onwebkitspeechchange"in n?"webkitspeechchange":"speechchange";Ye.observe(n,i,function(){e.execCommand("insertText",n.value),n.value=""}),Ye.observe(n,"click",function(e){Ye.hasClass(t,"wysihtml5-command-disabled")&&e.preventDefault(),e.stopPropagation()})}else t.style.display="none"},nt="wysihtml5-command-disabled",ot="wysihtml5-commands-disabled",rt="wysihtml5-command-active",it="wysihtml5-action-active",at=(tt=o).dom,tt.toolbar.Toolbar=lt.extend({constructor:function(e,t,n){this.editor=e,this.container="string"==typeof t?document.getElementById(t):t,this.composer=e.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),n&&this.show();for(var o=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),r=o.length,i=0;i<r;i++)new tt.toolbar.Speech(this,o[i])},_getLinks:function(e){for(var t,n,o,r,i,a=this[e+"Links"]=tt.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+e+"]")).get(),s=a.length,l=0,c=this[e+"Mapping"]={};l<s;l++)o=(t=a[l]).getAttribute("data-wysihtml5-"+e),r=t.getAttribute("data-wysihtml5-"+e+"-value"),n=this.container.querySelector("[data-wysihtml5-"+e+"-group='"+o+"']"),i=this._getDialog(t,o),c[o+":"+r]={link:t,group:n,name:o,value:r,dialog:i,state:!1}},_getDialog:function(e,t){var n,o,r=this,i=this.container.querySelector("[data-wysihtml5-dialog='"+t+"']");return i&&((n=tt.toolbar["Dialog_"+t]?new tt.toolbar["Dialog_"+t](e,i):new tt.toolbar.Dialog(e,i)).on("show",function(){o=r.composer.selection.getBookmark(),r.editor.fire("show:dialog",{command:t,dialogContainer:i,commandLink:e})}),n.on("save",function(n){o&&r.composer.selection.setBookmark(o),r._execCommand(t,n),r.editor.fire("save:dialog",{command:t,dialogContainer:i,commandLink:e})}),n.on("cancel",function(){r.editor.focus(!1),r.editor.fire("cancel:dialog",{command:t,dialogContainer:i,commandLink:e})})),n},execCommand:function(e,t){if(!this.commandsDisabled){var n=this.commandMapping[e+":"+t];n&&n.dialog&&!n.state?n.dialog.show():this._execCommand(e,t)}},_execCommand:function(e,t){this.editor.focus(!1),this.composer.commands.exec(e,t),this._updateLinkStates()},execAction:function(e){var t=this.editor;"change_view"===e&&t.textarea&&(t.currentView===t.textarea?t.fire("change_view","composer"):t.fire("change_view","textarea")),"showSource"==e&&t.fire("showSource")},_observe:function(){for(var e=this,t=this.editor,n=this.container,o=this.commandLinks.concat(this.actionLinks),r=o.length,i=0;i<r;i++)"A"===o[i].nodeName?at.setAttributes({href:"javascript:;",unselectable:"on"}).on(o[i]):at.setAttributes({unselectable:"on"}).on(o[i]);at.delegate(n,"[data-wysihtml5-command], [data-wysihtml5-action]","mousedown",function(e){e.preventDefault()}),at.delegate(n,"[data-wysihtml5-command]","click",function(t){var n=this.getAttribute("data-wysihtml5-command"),o=this.getAttribute("data-wysihtml5-command-value");e.execCommand(n,o),t.preventDefault()}),at.delegate(n,"[data-wysihtml5-action]","click",function(t){var n=this.getAttribute("data-wysihtml5-action");e.execAction(n),t.preventDefault()}),t.on("interaction:composer",function(){e._updateLinkStates()}),t.on("focus:composer",function(){e.bookmark=null}),this.editor.config.handleTables&&(t.on("tableselect:composer",function(){e.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display=""}),t.on("tableunselect:composer",function(){e.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display="none"})),t.on("change_view",function(o){t.textarea&&setTimeout(function(){e.commandsDisabled="composer"!==o,e._updateLinkStates(),e.commandsDisabled?at.addClass(n,ot):at.removeClass(n,ot)},0)})},_updateLinkStates:function(){var e,t,n,o,r=this.commandMapping,i=this.actionMapping;for(e in r)o=r[e],this.commandsDisabled?(t=!1,at.removeClass(o.link,rt),o.group&&at.removeClass(o.group,rt),o.dialog&&o.dialog.hide()):(t=this.composer.commands.state(o.name,o.value),at.removeClass(o.link,nt),o.group&&at.removeClass(o.group,nt)),o.state!==t&&(o.state=t,t?(at.addClass(o.link,rt),o.group&&at.addClass(o.group,rt),o.dialog&&("object"==typeof t||tt.lang.object(t).isArray()?(!o.dialog.multiselect&&tt.lang.object(t).isArray()&&(t=1!==t.length||t[0],o.state=t),o.dialog.show(t)):o.dialog.hide())):(at.removeClass(o.link,rt),o.group&&at.removeClass(o.group,rt),o.dialog&&o.dialog.hide()));for(e in i)"change_view"===(n=i[e]).name&&(n.state=this.editor.currentView===this.editor.textarea,n.state?at.addClass(n.link,it):at.removeClass(n.link,it))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}}),(st=o).toolbar.Dialog_createTable=st.toolbar.Dialog.extend({show:function(e){this.base(e)}}),function(e){e.dom;var t="[data-wysihtml5-dialog-field]",n="data-wysihtml5-dialog-field";e.toolbar.Dialog_foreColorStyle=e.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var e={},o=this.container.querySelectorAll(t),r=o.length,i=0;i<r;i++)e[o[i].getAttribute(n)]=o[i].value;return e},_interpolate:function(o){for(var r,i=document.querySelector(":focus"),a=this.container.querySelectorAll(t),s=a.length,l=0,c=this.elementToChange?e.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,d=c?c.getAttribute("style"):null,u=d?e.quirks.styleParser.parseColor(d,"color"):null;l<s;l++)(r=a[l])!==i&&(o&&"hidden"===r.type||"color"===r.getAttribute(n)&&(u?u[3]&&1!=u[3]?r.value="rgba("+u[0]+","+u[1]+","+u[2]+","+u[3]+");":r.value="rgb("+u[0]+","+u[1]+","+u[2]+");":r.value="rgb(0,0,0);"))}})}(o),function(e){e.dom;e.toolbar.Dialog_fontSizeStyle=e.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){return{size:this.container.querySelector('[data-wysihtml5-dialog-field="size"]').value}},_interpolate:function(t){var n=document.querySelector(":focus"),o=this.container.querySelector("[data-wysihtml5-dialog-field='size']"),r=this.elementToChange?e.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,i=r?r.getAttribute("style"):null,a=i?e.quirks.styleParser.parseFontSize(i):null;o&&o!==n&&a&&!/^\s*$/.test(a)&&(o.value=a)}})}(o);var ct,dt,ut,ft,ht,mt,pt=(ct=function(){"use strict";function e(e){this.string=e}return e.prototype.toString=function(){return""+this.string},e}(),dt=function(e){"use strict";function t(e){return r[e]||"&amp;"}var n={},o=ct,r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=/[&<>"'`]/g,a=/[&<>"'`]/;n.extend=function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])};var s,l=Object.prototype.toString;n.toString=l,(s=function(e){return"function"==typeof e})(/x/)&&(s=function(e){return"function"==typeof e&&"[object Function]"===l.call(e)}),n.isFunction=s;var c=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===l.call(e)};return n.isArray=c,n.escapeExpression=function(e){return e instanceof o?e.toString():e||0===e?(e=""+e,a.test(e)?e.replace(i,t):e):""},n.isEmpty=function(e){return!e&&0!==e||!(!c(e)||0!==e.length)},n}(),ut=function(){"use strict";function e(e,n){var o;n&&n.firstLine&&(e+=" - "+(o=n.firstLine)+":"+n.firstColumn);for(var r=Error.prototype.constructor.call(this,e),i=0;i<t.length;i++)this[t[i]]=r[t[i]];o&&(this.lineNumber=o,this.column=n.firstColumn)}var t=["description","fileName","lineNumber","message","name","number","stack"];return e.prototype=new Error,e}(),ft=function(e,t){"use strict";function n(e,t){var n;this.helpers=e||{},this.partials=t||{},(n=this).registerHelper("helperMissing",function(e){if(2!==arguments.length)throw new a("Missing helper: '"+e+"'")}),n.registerHelper("blockHelperMissing",function(e,t){var o=t.inverse||function(){},r=t.fn;return l(e)&&(e=e.call(this)),!0===e?r(this):!1===e||null==e?o(this):s(e)?e.length>0?n.helpers.each(e,t):o(this):r(e)}),n.registerHelper("each",function(e,t){var n,o=t.fn,r=t.inverse,i=0,a="";if(l(e)&&(e=e.call(this)),t.data&&(n=f(t.data)),e&&"object"==typeof e)if(s(e))for(var c=e.length;c>i;i++)n&&(n.index=i,n.first=0===i,n.last=i===e.length-1),a+=o(e[i],{data:n});else for(var d in e)e.hasOwnProperty(d)&&(n&&(n.key=d,n.index=i,n.first=0===i),a+=o(e[d],{data:n}),i++);return 0===i&&(a=r(this)),a}),n.registerHelper("if",function(e,t){return l(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||i.isEmpty(e)?t.inverse(this):t.fn(this)}),n.registerHelper("unless",function(e,t){return n.helpers.if.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})}),n.registerHelper("with",function(e,t){return l(e)&&(e=e.call(this)),i.isEmpty(e)?void 0:t.fn(e)}),n.registerHelper("log",function(e,t){var o=t.data&&null!=t.data.level?parseInt(t.data.level,10):1;n.log(o,e)})}function o(e,t){u.log(e,t)}var r={},i=dt,a=ut;r.VERSION="1.3.0";r.COMPILER_REVISION=4;r.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};var s=i.isArray,l=i.isFunction,c=i.toString,d="[object Object]";r.HandlebarsEnvironment=n,n.prototype={constructor:n,logger:u,log:o,registerHelper:function(e,t,n){if(c.call(e)===d){if(n||t)throw new a("Arg not supported with multiple helpers");i.extend(this.helpers,e)}else n&&(t.not=n),this.helpers[e]=t},registerPartial:function(e,t){c.call(e)===d?i.extend(this.partials,e):this.partials[e]=t}};var u={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(e,t){if(u.level<=e){var n=u.methodMap[e];"undefined"!=typeof console&&console[n]&&console[n].call(console,t)}}};r.logger=u,r.log=o;var f=function(e){var t={};return i.extend(t,e),t};return r.createFrame=f,r}(),ht=function(e,t,n){"use strict";function o(e,t,n){var o=function(e,o){return t(e,(o=o||{}).data||n)};return o.program=e,o.depth=0,o}var r={},i=dt,a=ut,s=n.COMPILER_REVISION,l=n.REVISION_CHANGES;return r.checkRevision=function(e){var t=e&&e[0]||1;if(t!==s){if(s>t){var n=l[s],o=l[t];throw new a("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+n+") or downgrade your runtime to an older version ("+o+").")}throw new a("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}},r.template=function(e,t){if(!t)throw new a("No environment passed to template");var n={escapeExpression:i.escapeExpression,invokePartial:function(e,n,o,r,i,s){var l=t.VM.invokePartial.apply(this,arguments);if(null!=l)return l;if(t.compile){var c={helpers:r,partials:i,data:s};return i[n]=t.compile(e,{data:void 0!==s},t),i[n](o,c)}throw new a("The partial "+n+" could not be compiled when running in runtime-only mode")},programs:[],program:function(e,t,n){var r=this.programs[e];return n?r=o(e,t,n):r||(r=this.programs[e]=o(e,t)),r},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n={},i.extend(n,t),i.extend(n,e)),n},programWithDepth:t.VM.programWithDepth,noop:t.VM.noop,compilerInfo:null};return function(o,r){var i,a,s=(r=r||{}).partial?r:t;r.partial||(i=r.helpers,a=r.partials);var l=e.call(n,s,o,i,a,r.data);return r.partial||t.VM.checkRevision(n.compilerInfo),l}},r.programWithDepth=function(e,t,n){var o=Array.prototype.slice.call(arguments,3),r=function(e,r){return r=r||{},t.apply(this,[e,r.data||n].concat(o))};return r.program=e,r.depth=o.length,r},r.program=o,r.invokePartial=function(e,t,n,o,r,i){var s={partial:!0,helpers:o,partials:r,data:i};if(void 0===e)throw new a("The partial "+t+" could not be found");return e instanceof Function?e(n,s):void 0},r.noop=function(){return""},r}(0,0,ft),function(e,t,n,o,r){"use strict";var i=ft,a=ct,s=ut,l=dt,c=ht,d=function(){var e=new i.HandlebarsEnvironment;return l.extend(e,i),e.SafeString=a,e.Exception=s,e.Utils=l,e.VM=c,e.template=function(t){return c.template(t,e)},e},u=d();return u.create=d,u}());this.wysihtml5=this.wysihtml5||{},this.wysihtml5.tpl=this.wysihtml5.tpl||{},this.wysihtml5.tpl.blockquote=pt.template(function(e,t,n,o,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var i,a="",s="function",l=this.escapeExpression;return a+='<li>\n  <a class="btn ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:this.noop,fn:this.program(1,function(e,t){var n,o="";return o+="btn-"+l(typeof(n=null==(n=null==(n=e&&e.options)||!1===n?n:n.toolbar)||!1===n?n:n.size)===s?n.apply(e):n)},r),data:r}))||0===i)&&(a+=i),a+=' btn-default" data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="blockquote" data-wysihtml5-display-format-name="false" tabindex="-1">\n    ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.fa,{hash:{},inverse:this.program(5,function(e,t){return'\n      <span class="glyphicon glyphicon-quote"></span>\n    '},r),fn:this.program(3,function(e,t){return' \n      <span class="fa fa-quote-left"></span>\n    '},r),data:r}))||0===i)&&(a+=i),a+="\n  </a>\n</li>\n"}),this.wysihtml5.tpl.color=pt.template(function(e,t,n,o,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var i,a="",s="function",l=this.escapeExpression;return a+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:this.noop,fn:this.program(1,function(e,t){var n,o="";return o+="btn-"+l(typeof(n=null==(n=null==(n=e&&e.options)||!1===n?n:n.toolbar)||!1===n?n:n.size)===s?n.apply(e):n)},r),data:r}))||0===i)&&(a+=i),a+='" data-toggle="dropdown" tabindex="-1">\n    <span class="current-color">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.black)===s?i.apply(t):i)+'</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="black"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="black">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.black)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="silver"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="silver">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.silver)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="gray"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="gray">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.gray)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="maroon"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="maroon">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.maroon)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="red"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="red">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.red)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="purple"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="purple">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.purple)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="green"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="green">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.green)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="olive"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="olive">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.olive)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="navy"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="navy">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.navy)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="blue"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="blue">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.blue)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="orange"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="orange">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.orange)===s?i.apply(t):i)+"</a></li>\n  </ul>\n</li>\n"}),this.wysihtml5.tpl.emphasis=pt.template(function(e,t,n,o,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var i,a="",s="function",l=this.escapeExpression,c=this;function d(e,t){var n,o="";return o+="btn-"+l(typeof(n=null==(n=null==(n=e&&e.options)||!1===n?n:n.toolbar)||!1===n?n:n.size)===s?n.apply(e):n)}return a+='<li>\n  <div class="btn-group">\n    <a class="btn ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:c.noop,fn:c.program(1,d,r),data:r}))||0===i)&&(a+=i),a+=' btn-default" data-wysihtml5-command="bold" title="CTRL+B" tabindex="-1">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.emphasis)||!1===i?i:i.bold)===s?i.apply(t):i)+'</a>\n    <a class="btn ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:c.noop,fn:c.program(1,d,r),data:r}))||0===i)&&(a+=i),a+="\n  </div>\n</li>\n"}),this.wysihtml5.tpl["font-styles"]=pt.template(function(e,t,n,o,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var i,a="",s="function",l=this.escapeExpression;return a+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:this.noop,fn:this.program(1,function(e,t){var n,o="";return o+="btn-"+l(typeof(n=null==(n=null==(n=e&&e.options)||!1===n?n:n.toolbar)||!1===n?n:n.size)===s?n.apply(e):n)},r),data:r}))||0===i)&&(a+=i),a+='" data-toggle="dropdown">\n    ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.fa,{hash:{},inverse:this.program(5,function(e,t){return'\n      <span class="glyphicon glyphicon-font"></span>\n    '},r),fn:this.program(3,function(e,t){return'\n      <span class="fa fa-font"></span>\n    '},r),data:r}))||0===i)&&(a+=i),a+='\n    <span class="current-font">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.font_styles)||!1===i?i:i.normal)===s?i.apply(t):i)+'</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="p" tabindex="-1">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.font_styles)||!1===i?i:i.normal)===s?i.apply(t):i)+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h1" tabindex="-1">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.font_styles)||!1===i?i:i.h1)===s?i.apply(t):i)+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h2" tabindex="-1">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.font_styles)||!1===i?i:i.h2)===s?i.apply(t):i)+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h3" tabindex="-1">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.font_styles)||!1===i?i:i.h3)===s?i.apply(t):i)+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h4" tabindex="-1">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.font_styles)||!1===i?i:i.h4)===s?i.apply(t):i)+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h5" tabindex="-1">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.font_styles)||!1===i?i:i.h5)===s?i.apply(t):i)+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h6" tabindex="-1">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.font_styles)||!1===i?i:i.h6)===s?i.apply(t):i)+"</a></li>\n  </ul>\n</li>\n"}),this.wysihtml5.tpl.html=pt.template(function(e,t,n,o,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var i,a="",s="function",l=this.escapeExpression;return a+='<li>\n  <div class="btn-group">\n    <a class="btn ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:this.noop,fn:this.program(1,function(e,t){var n,o="";return o+="btn-"+l(typeof(n=null==(n=null==(n=e&&e.options)||!1===n?n:n.toolbar)||!1===n?n:n.size)===s?n.apply(e):n)},r),data:r}))||0===i)&&(a+=i),a+=' btn-default" data-wysihtml5-action="change_view" title="'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.html)||!1===i?i:i.edit)===s?i.apply(t):i)+'" tabindex="-1">\n      ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.fa,{hash:{},inverse:this.program(5,function(e,t){return'\n        <span class="glyphicon glyphicon-pencil"></span>\n      '},r),fn:this.program(3,function(e,t){return'\n        <span class="fa fa-pencil"></span>\n      '},r),data:r}))||0===i)&&(a+=i),a+="\n    </a>\n  </div>\n</li>\n"}),this.wysihtml5.tpl.image=pt.template(function(e,t,n,o,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var i,a="",s="function",l=this.escapeExpression,c=this;return a+='<li>\n  <div class="bootstrap-wysihtml5-insert-image-modal modal fade" data-wysihtml5-dialog="insertImage">\n    <div class="modal-dialog ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.smallmodals,{hash:{},inverse:c.noop,fn:c.program(1,function(e,t){return"modal-sm"},r),data:r}))||0===i)&&(a+=i),a+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.image)||!1===i?i:i.insert)===s?i.apply(t):i)+'</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-image-url form-control">\n          </div> \n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.image)||!1===i?i:i.cancel)===s?i.apply(t):i)+'</a>\n          <a class="btn btn-primary" data-dismiss="modal"  data-wysihtml5-dialog-action="save" href="#">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.image)||!1===i?i:i.insert)===s?i.apply(t):i)+'</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:c.noop,fn:c.program(3,function(e,t){var n,o="";return o+="btn-"+l(typeof(n=null==(n=null==(n=e&&e.options)||!1===n?n:n.toolbar)||!1===n?n:n.size)===s?n.apply(e):n)},r),data:r}))||0===i)&&(a+=i),a+=' btn-default" data-wysihtml5-command="insertImage" title="'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.image)||!1===i?i:i.insert)===s?i.apply(t):i)+'" tabindex="-1">\n    ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.fa,{hash:{},inverse:c.program(7,function(e,t){return'\n      <span class="glyphicon glyphicon-picture"></span>\n    '},r),fn:c.program(5,function(e,t){return'\n      <span class="fa fa-file-image-o"></span>\n    '},r),data:r}))||0===i)&&(a+=i),a+="\n  </a>\n</li>\n"}),this.wysihtml5.tpl.link=pt.template(function(e,t,n,o,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var i,a="",s="function",l=this.escapeExpression;return a+='<li>\n  <div class="bootstrap-wysihtml5-insert-link-modal modal fade" data-wysihtml5-dialog="createLink">\n    <div class="modal-dialog ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.smallmodals,{hash:{},inverse:this.noop,fn:this.program(1,function(e,t){return"modal-sm"},r),data:r}))||0===i)&&(a+=i),a+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.link)||!1===i?i:i.insert)===s?i.apply(t):i)+'</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-link-url form-control" data-wysihtml5-dialog-field="href">\n          </div> \n          <div class="checkbox">\n            <label> \n              <input type="checkbox" class="bootstrap-wysihtml5-insert-link-target" checked>'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.link)||!1===i?i:i.target)===s?i.apply(t):i)+'\n            </label>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.link)||!1===i?i:i.cancel)===s?i.apply(t):i)+'</a>\n          <a href="#" class="btn btn-primary" data-dismiss="modal" data-wysihtml5-dialog-action="save">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.link)||!1===i?i:i.insert)===s?i.apply(t):i)+'</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:this.noop,fn:this.program(3,function(e,t){var n,o="";return o+="btn-"+l(typeof(n=null==(n=null==(n=e&&e.options)||!1===n?n:n.toolbar)||!1===n?n:n.size)===s?n.apply(e):n)},r),data:r}))||0===i)&&(a+=i),a+=' btn-default" data-wysihtml5-command="createLink" title="'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.link)||!1===i?i:i.insert)===s?i.apply(t):i)+'" tabindex="-1">\n    ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.fa,{hash:{},inverse:this.program(7,function(e,t){return'\n      <span class="glyphicon glyphicon-share"></span>\n    '},r),fn:this.program(5,function(e,t){return'\n      <span class="fa fa-share-square-o"></span>\n    '},r),data:r}))||0===i)&&(a+=i),a+="\n  </a>\n</li>\n"}),this.wysihtml5.tpl.lists=pt.template(function(e,t,n,o,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var i,a="",s="function",l=this.escapeExpression;function c(e,t){var n,o="";return o+="btn-"+l(typeof(n=null==(n=null==(n=e&&e.options)||!1===n?n:n.toolbar)||!1===n?n:n.size)===s?n.apply(e):n)}return a+='<li>\n  <div class="btn-group">\n    <a class="btn ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:this.noop,fn:this.program(1,c,r),data:r}))||0===i)&&(a+=i),a+=' btn-default" data-wysihtml5-command="insertUnorderedList" title="'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.lists)||!1===i?i:i.unordered)===s?i.apply(t):i)+'" tabindex="-1">\n    ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.fa,{hash:{},inverse:this.program(5,function(e,t){return'\n      <span class="glyphicon glyphicon-list"></span>\n    '},r),fn:this.program(3,function(e,t){return'\n      <span class="fa fa-list-ul"></span>\n    '},r),data:r}))||0===i)&&(a+=i),a+='\n    </a>\n    <a class="btn ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:this.noop,fn:this.program(1,c,r),data:r}))||0===i)&&(a+=i),a+=' btn-default" data-wysihtml5-command="insertOrderedList" title="'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.lists)||!1===i?i:i.ordered)===s?i.apply(t):i)+'" tabindex="-1">\n    ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.fa,{hash:{},inverse:this.program(9,function(e,t){return'\n      <span class="glyphicon glyphicon-th-list"></span>\n    '},r),fn:this.program(7,function(e,t){return'\n      <span class="fa fa-list-ol"></span>\n    '},r),data:r}))||0===i)&&(a+=i),a+="\n    </a>\n  </div>\n</li>\n"}),function(e,t){!function(e,t){"use strict";var n=function(e,n,o){if(t.tpl[e])return t.tpl[e]({locale:n,options:o})},o=function(n,o){this.el=n;var r=e.extend(!0,{},i,o);for(var a in r.customTemplates)t.tpl[a]=r.customTemplates[a];this.toolbar=this.createToolbar(n,r),this.editor=this.createEditor(r)};o.prototype={constructor:o,createEditor:function(n){n=n||{},(n=e.extend(!0,{},n)).toolbar=this.toolbar[0];var o=new t.Editor(this.el[0],n);if(o.composer.editableArea.contentDocument?this.addMoreShortcuts(o,o.composer.editableArea.contentDocument.body||o.composer.editableArea.contentDocument,n.shortcuts):this.addMoreShortcuts(o,o.composer.editableArea,n.shortcuts),n&&n.events)for(var r in n.events)o.on(r,n.events[r]);return o.on("beforeload",this.syncBootstrapDialogEvents),o},syncBootstrapDialogEvents:function(){var t=this;e.map(this.toolbar.commandMapping,function(e,t){return[e]}).filter(function(e,t,n){return e.dialog}).map(function(e,t,n){return e.dialog}).forEach(function(n,o,r){n.on("show",function(t){e(this.container).modal("show")}),n.on("hide",function(n){e(this.container).modal("hide"),t.composer.focus()}),e(n.container).on("shown.bs.modal",function(){e(this).find("input, select, textarea").first().focus()})})},createToolbar:function(t,o){var r=this,s=e("<ul/>",{class:"wysihtml5-toolbar",style:"display:none"}),l=o.locale||i.locale||"en";a.hasOwnProperty(l)||(console.debug("Locale '"+l+"' not found. Available locales are: "+Object.keys(a)+". Falling back to 'en'."),l="en");var c=e.extend(!0,{},a.en,a[l]);for(var d in o.toolbar)o.toolbar[d]&&(s.append(n(d,c,o)),"html"===d&&this.initHtml(s));return s.find('a[data-wysihtml5-command="formatBlock"]').click(function(t){var n=t.delegateTarget||t.target||t.srcElement,o=e(n),i=o.data("wysihtml5-display-format-name"),a=o.data("wysihtml5-format-name")||o.html();void 0!==i&&"true"!==i||r.toolbar.find(".current-font").text(a)}),s.find('a[data-wysihtml5-command="foreColor"]').click(function(t){var n=t.target||t.srcElement,o=e(n);r.toolbar.find(".current-color").text(o.html())}),this.el.before(s),s},initHtml:function(e){var t='a[data-wysihtml5-action="change_view"]';e.find(t).click(function(n){e.find("a.btn").not(t).toggleClass("disabled")})},addMoreShortcuts:function(e,n,o){t.dom.observe(n,"keydown",function(n){var r=n.keyCode,i=o[r];if((n.ctrlKey||n.metaKey||n.altKey)&&i&&t.commands[i]){var a=e.toolbar.commandMapping[i+":null"];a&&a.dialog&&!a.state?a.dialog.show():t.commands[i].exec(e.composer,i),n.preventDefault()}})}};var r={resetDefaults:function(){e.fn.wysihtml5.defaultOptions=e.extend(!0,{},e.fn.wysihtml5.defaultOptionsCache)},bypassDefaults:function(t){return this.each(function(){var n=e(this);n.data("wysihtml5",new o(n,t))})},shallowExtend:function(t){var n=e.extend({},e.fn.wysihtml5.defaultOptions,t||{},e(this).data());return r.bypassDefaults.apply(this,[n])},deepExtend:function(t){var n=e.extend(!0,{},e.fn.wysihtml5.defaultOptions,t||{});return r.bypassDefaults.apply(this,[n])},init:function(e){return r.shallowExtend.apply(this,[e])}};e.fn.wysihtml5=function(t){return r[t]?r[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.wysihtml5"):r.init.apply(this,arguments)},e.fn.wysihtml5.Constructor=o;var i=e.fn.wysihtml5.defaultOptions={toolbar:{"font-styles":!0,color:!1,emphasis:{small:!0},blockquote:!0,lists:!0,html:!1,link:!0,image:!0,smallmodals:!1},parserRules:{classes:{"wysiwyg-color-silver":1,"wysiwyg-color-gray":1,"wysiwyg-color-white":1,"wysiwyg-color-maroon":1,"wysiwyg-color-red":1,"wysiwyg-color-purple":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-olive":1,"wysiwyg-color-yellow":1,"wysiwyg-color-navy":1,"wysiwyg-color-blue":1,"wysiwyg-color-teal":1,"wysiwyg-color-aqua":1,"wysiwyg-color-orange":1},tags:{b:{},i:{},strong:{},em:{},p:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},blockquote:{},u:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{check_attributes:{href:"url"},set_attributes:{target:"_blank",rel:"nofollow"}},span:1,div:1,small:1,code:1,pre:1}},locale:"en",shortcuts:{83:"small"}};void 0===e.fn.wysihtml5.defaultOptionsCache&&(e.fn.wysihtml5.defaultOptionsCache=e.extend(!0,{},e.fn.wysihtml5.defaultOptions));var a=e.fn.wysihtml5.locale={}}(e,this.wysihtml5)}(jQuery),(mt=this.wysihtml5).commands.small={exec:function(e,t){return mt.commands.formatInline.exec(e,t,"small")},state:function(e,t){return mt.commands.formatInline.state(e,t,"small")}},function(e){e.fn.wysihtml5.locale.en=e.fn.wysihtml5.locale["en-US"]={font_styles:{normal:"Normal text",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6"},emphasis:{bold:"Bold",italic:"Italic",underline:"Underline",small:"Small"},lists:{unordered:"Unordered list",ordered:"Ordered list",outdent:"Outdent",indent:"Indent"},link:{insert:"Insert link",cancel:"Cancel",target:"Open link in new window"},image:{insert:"Insert image",cancel:"Cancel"},html:{edit:"Edit HTML"},colours:{black:"Black",silver:"Silver",gray:"Grey",maroon:"Maroon",red:"Red",purple:"Purple",green:"Green",olive:"Olive",navy:"Navy",blue:"Blue",orange:"Orange"}}}(jQuery);return{Init:function(){e(".wysiwyg").each(function(){e(this).parent().hasClass("stk-wysiwyg")||e(this).parent().addClass("stk-wysiwyg")}),e(".wysiwyg").wysihtml5({toolbar:{fa:!0,"font-styles":!1,emphasis:{bold:!0,italic:!1,underline:!1,small:!1},lists:!0,html:!1,link:!0,image:!1,color:!1,blockquote:!1}})}}});