define(["jquery"],function(e){var t;Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(Element.prototype,"textContent").get&&(t=Object.getOwnPropertyDescriptor(Element.prototype,"innerText"),Object.defineProperty(Element.prototype,"textContent",{get:function(){return t.get.call(this)},set:function(e){return t.set.call(this,e)}})),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var n,_={version:"0.4.13",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\ufeff",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};n=function(){var o="object",r="function",n="undefined",l=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],c=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],t=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],i=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function d(e,t){var n=typeof e[t];return n==r||!(n!=o||!e[t])||"unknown"==n}function a(e,t){return!(typeof e[t]!=o||!e[t])}function e(e,t){return typeof e[t]!=n}function s(o){return function(e,t){for(var n=t.length;n--;)if(!o(e,t[n]))return!1;return!0}}var u=s(d),f=s(a),h=s(e);function m(e){return e&&u(e,i)&&h(e,t)}function p(e){return a(e,"body")?e.body:e.getElementsByTagName("body")[0]}var g,y={},v={version:"1.3alpha.20140804",initialized:!1,supported:!0,util:{isHostMethod:d,isHostObject:a,isHostProperty:e,areHostMethods:u,areHostObjects:f,areHostProperties:h,isTextRange:m,getBody:p},features:{},modules:y,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==n||rangyAutoInitialize}};function b(e){a(window,"console")&&d(window.console,"log")&&window.console.log(e)}function w(e,t){t?window.alert(e):b(e)}function C(e){v.initialized=!0,v.supported=!1,w("Rangy is not supported on this page in your browser. Reason: "+e,v.config.alertOnFail)}v.fail=C,v.warn=function(e){w("Rangy warning: "+e,v.config.alertOnWarn)},!{}.hasOwnProperty?C("hasOwnProperty not supported"):v.util.extend=function(e,t,n){var o,r;for(var i in t)t.hasOwnProperty(i)&&(o=e[i],r=t[i],n&&null!==o&&"object"==typeof o&&null!==r&&"object"==typeof r&&v.util.extend(o,r,!0),e[i]=r);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},function(){var e=document.createElement("div");e.appendChild(document.createElement("span"));var t,n=[].slice;try{1==n.call(e.childNodes,0)[0].nodeType&&(t=function(e){return n.call(e,0)})}catch(e){}t||(t=function(e){for(var t=[],n=0,o=e.length;n<o;++n)t[n]=e[n];return t}),v.util.toArray=t}(),d(document,"addEventListener")?g=function(e,t,n){e.addEventListener(t,n,!1)}:d(document,"attachEvent")?g=function(e,t,n){e.attachEvent("on"+t,n)}:C("Document does not have required addEventListener or attachEvent method"),v.util.addListener=g;var N=[];function x(e){return e.message||e.description||String(e)}function E(){if(!v.initialized){var e,t=!1,n=!1;d(document,"createRange")&&(e=document.createRange(),u(e,c)&&h(e,l)&&(t=!0));var o=p(document);if(o&&"body"==o.nodeName.toLowerCase())if(o&&d(o,"createTextRange")&&m(e=o.createTextRange())&&(n=!0),t||n){var r;for(var i in v.initialized=!0,v.features={implementsDomRange:t,implementsTextRange:n},y)(r=y[i])instanceof T&&r.init(r,v);for(var a=0,s=N.length;a<s;++a)try{N[a](v)}catch(e){b("Rangy init listener threw an exception. Continuing. Detail: "+x(e))}}else C("Neither Range nor TextRange are available");else C("No body element found")}}v.init=E,v.addInitListener=function(e){v.initialized?e(v):N.push(e)};var S=[];function T(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function R(e,t,n,o){var r=new T(t,n,function(e){if(!e.initialized){e.initialized=!0;try{o(v,e),e.supported=!0}catch(e){b("Module '"+t+"' failed to load: "+x(e))}}});y[t]=r}function A(){}v.addShimListener=function(e){S.push(e)},v.shim=v.createMissingNativeApi=function(e){e=e||window,E();for(var t=0,n=S.length;t<n;++t)S[t](e)},T.prototype={init:function(){for(var e,t,n=this.dependencies||[],o=0,r=n.length;o<r;++o){if(t=n[o],!((e=y[t])&&e instanceof T))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){v.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){v.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},v.createModule=function(e){var t,n;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var o=R(0,e,n,t);v.initialized&&o.init()},v.createCoreModule=function(e,t,n){R(0,e,t,n)},v.RangePrototype=A,v.rangePrototype=new A,v.selectionPrototype=new function(){};var _=!1,I=function(e){_||(_=!0,!v.initialized&&v.config.autoInitialize&&E())};if(typeof window!=n){if(typeof document!=n)return d(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",I,!1),g(window,"load",I),v.createCoreModule("DomUtil",[],function(n,c){var o="undefined",r=n.util;r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||c.fail("document missing a Node creation method"),r.isHostMethod(document,"getElementsByTagName")||c.fail("document missing getElementsByTagName method");var e=document.createElement("div");r.areHostMethods(e,["insertBefore","appendChild","cloneNode"])||c.fail("Incomplete Element implementation"),r.isHostProperty(e,"innerHTML")||c.fail("Element is missing innerHTML property");var t=document.createTextNode("test");r.areHostMethods(t,["splitText","deleteData","insertData","appendData","cloneNode"])||c.fail("Incomplete Text Node implementation");var i=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1};function d(e){for(var t=0;e=e.previousSibling;)++t;return t}function u(e,t){var n,o=[];for(n=e;n;n=n.parentNode)o.push(n);for(n=t;n;n=n.parentNode)if(i(o,n))return n;return null}function a(e,t,n){for(var o=n?t:t.parentNode;o;){if(o===e)return!0;o=o.parentNode}return!1}function f(e,t,n){for(var o,r=n?e:e.parentNode;r;){if((o=r.parentNode)===t)return r;r=o}return null}function s(e){var t=e.nodeType;return 3==t||4==t||8==t}function l(e,t){var n=t.nextSibling,o=t.parentNode;return n?o.insertBefore(e,n):o.appendChild(e),e}function h(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=o)return e.ownerDocument;if(typeof e.document!=o)return e.document;if(e.parentNode)return h(e.parentNode);throw c.createError("getDocument: no document found for node")}function m(e){var t=h(e);if(typeof t.defaultView!=o)return t.defaultView;if(typeof t.parentWindow!=o)return t.parentWindow;throw c.createError("Cannot get a window object for node")}function p(e){if(typeof e.contentDocument!=o)return e.contentDocument;if(typeof e.contentWindow!=o)return e.contentWindow.document;throw c.createError("getIframeDocument: No Document object found for iframe element")}function g(e){return e&&r.isHostMethod(e,"setTimeout")&&r.isHostObject(e,"document")}var y,v=!1;function b(e){try{return e.parentNode,!1}catch(e){return!0}}function w(e){if(!e)return"[No node]";if(v&&b(e))return"[Broken node]";if(s(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+d(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function C(e){this.root=e,this._next=e}function N(e,t){this.node=e,this.offset=t}function x(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}!function(){var e=document.createElement("b");e.innerHTML="1";var t=e.firstChild;e.innerHTML="<br>",v=b(t),n.features.crashyTextNodes=v}(),typeof window.getComputedStyle!=o?y=function(e,t){return m(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=o?y=function(e,t){return e.currentStyle[t]}:c.fail("No means of obtaining computed style properties found"),C.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},N.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+w(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},(x.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24}).toString=function(){return this.message},n.dom={arrayContains:i,isHtmlNamespace:function(e){var t;return typeof e.namespaceURI==o||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t},parentElement:function(e){var t=e.parentNode;return 1==t.nodeType?t:null},getNodeIndex:d,getNodeLength:function(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}},getCommonAncestor:u,isAncestorOf:a,isOrIsAncestorOf:function(e,t){return a(e,t,!0)},getClosestAncestorIn:f,isCharacterDataNode:s,isTextOrCommentNode:function(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t},insertAfter:l,splitDataNode:function(e,t,n){var o=e.cloneNode(!1);if(o.deleteData(0,t),e.deleteData(t,e.length-t),l(o,e),n)for(var r,i=0;r=n[i++];)r.node==e&&r.offset>t?(r.node=o,r.offset-=t):r.node==e.parentNode&&r.offset>d(e)&&++r.offset;return o},getDocument:h,getWindow:m,getIframeWindow:function(e){if(typeof e.contentWindow!=o)return e.contentWindow;if(typeof e.contentDocument!=o)return e.contentDocument.defaultView;throw c.createError("getIframeWindow: No Window object found for iframe element")},getIframeDocument:p,getBody:r.getBody,isWindow:g,getContentDocument:function(e,t,n){var o;if(e?r.isHostProperty(e,"nodeType")?o=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?p(e):h(e):g(e)&&(o=e.document):o=document,!o)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return o},getRootContainer:function(e){for(var t;t=e.parentNode;)e=t;return e},comparePoints:function(e,t,n,o){var r,i,a,s,l;if(e==n)return t===o?0:t<o?-1:1;if(r=f(n,e,!0))return t<=d(r)?-1:1;if(r=f(e,n,!0))return d(r)<o?-1:1;if(!(i=u(e,n)))throw new Error("comparePoints error: nodes have no common ancestor");if((a=e===i?i:f(e,i,!0))===(s=n===i?i:f(n,i,!0)))throw c.createError("comparePoints got to case 4 and childA and childB are the same!");for(l=i.firstChild;l;){if(l===a)return-1;if(l===s)return 1;l=l.nextSibling}},isBrokenNode:b,inspectNode:w,getComputedStyleProperty:y,fragmentFromNodeChildren:function(e){for(var t,n=h(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n},createIterator:function(e){return new C(e)},DomPosition:N},n.DOMException=x}),v.createCoreModule("DomRange",["DomUtil"],function(a,e){var s=a.dom,o=a.util,t=s.DomPosition,l=a.DOMException,d=s.isCharacterDataNode,u=s.getNodeIndex,c=s.isOrIsAncestorOf,f=s.getDocument,h=s.comparePoints,m=s.splitDataNode,p=s.getClosestAncestorIn,g=s.getNodeLength,i=s.arrayContains,y=s.getRootContainer,n=a.features.crashyTextNodes;function v(e,t){return 3!=e.nodeType&&(c(e,t.startContainer)||c(e,t.endContainer))}function b(e){return e.document||f(e.startContainer)}function w(e){return new t(e.parentNode,u(e))}function C(e){return new t(e.parentNode,u(e)+1)}function r(e,t,n){var o=11==e.nodeType?e.firstChild:e;return d(t)?n==t.length?s.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:m(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),o}function N(e,t,n){if(F(e),F(t),b(t)!=b(e))throw new l("WRONG_DOCUMENT_ERR");var o=h(e.startContainer,e.startOffset,t.endContainer,t.endOffset),r=h(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?o<=0&&0<=r:o<0&&0<r}function x(e,t,n){var o,r,i,a;for(n=n||{stop:!1};i=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===t(i))return void(n.stop=!0);if(x(a=e.getSubtreeIterator(),t,n),a.detach(),n.stop)return}else for(o=s.createIterator(i);r=o.next();)if(!1===t(r))return void(n.stop=!0)}function E(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(E(t=e.getSubtreeIterator()),t.detach()):e.remove()}function S(e){for(var t,n,o=b(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(S(n)),n.detach()):e.remove(),10==t.nodeType)throw new l("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function T(e){return"["+(void 0===e.getName?"Range":e.getName())+"("+s.inspectNode(e.startContainer)+":"+e.startOffset+", "+s.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function R(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&d(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||d(this.sc)?p(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||d(this.ec)?p(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}R.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,d(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!d(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0)!=(t=n===this.ec?this.eo:n.length)&&n.deleteData(e,t-e)},isPartiallySelectedSubtree:function(){return v(this._current,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)(e=this.range.cloneRange()).collapse(!1);else{e=new fe(b(this.range));var t=this._current,n=t,o=0,r=t,i=g(t);c(t,this.sc)&&(n=this.sc,o=this.so),c(t,this.ec)&&(r=this.ec,i=this.eo),ue(e,n,o,r,i)}return new R(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var A=[1,3,4,5,7,8,10],_=[2,9,11],I=[1,3,4,5,7,8,10,11],O=[1,3,4,5,7,8];function L(r){return function(e,t){for(var n,o=t?e:e.parentNode;o;){if(n=o.nodeType,i(r,n))return o;o=o.parentNode}return null}}var k=L([9,11]),D=L([5,6,10,12]),M=L([6,10,12]);function B(e,t){if(M(e,t))throw new l("INVALID_NODE_TYPE_ERR")}function P(e,t){if(!i(t,e.nodeType))throw new l("INVALID_NODE_TYPE_ERR")}function H(e,t){if(t<0||t>(d(e)?e.length:e.childNodes.length))throw new l("INDEX_SIZE_ERR")}function z(e,t){if(k(e,!0)!==k(t,!0))throw new l("WRONG_DOCUMENT_ERR")}function q(e){if(D(e,!0))throw new l("NO_MODIFICATION_ALLOWED_ERR")}function V(e,t){if(!e)throw new l(t)}function W(e){return n&&s.isBrokenNode(e)||!i(_,e.nodeType)&&!k(e,!0)}function U(e,t){return t<=(d(e)?e.length:e.childNodes.length)}function j(e){return!!e.startContainer&&!!e.endContainer&&!W(e.startContainer)&&!W(e.endContainer)&&U(e.startContainer,e.startOffset)&&U(e.endContainer,e.endOffset)}function F(e){if(!j(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}var K=document.createElement("style"),G=!1;try{K.innerHTML="<b>x</b>",G=3==K.firstChild.nodeType}catch(e){}var $=(a.features.htmlParsingConforms=G)?function(e){var t=this.startContainer,n=f(t);if(!t)throw new l("INVALID_STATE_ERR");var o=null;return 1==t.nodeType?o=t:d(t)&&(o=s.parentElement(t)),(o=null===o||"HTML"==o.nodeName&&s.isHtmlNamespace(f(o).documentElement)&&s.isHtmlNamespace(o)?n.createElement("body"):o.cloneNode(!1)).innerHTML=e,s.fragmentFromNodeChildren(o)}:function(e){var t=b(this).createElement("body");return t.innerHTML=e,s.fragmentFromNodeChildren(t)};function X(e,t){F(e);var n=e.startContainer,o=e.startOffset,r=e.endContainer,i=e.endOffset,a=n===r;d(r)&&0<i&&i<r.length&&m(r,i,t),d(n)&&0<o&&o<n.length&&(n=m(n,o,t),a?(i-=o,r=n):r==n.parentNode&&i>=u(n)&&i++,o=0),e.setStartAndEnd(n,o,r,i)}function Y(e){F(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}var Q=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],Z=0,J=1,ee=2,te=3,ne=0,oe=1,re=2,ie=3;function ae(e){e.START_TO_START=Z,e.START_TO_END=J,e.END_TO_END=ee,e.END_TO_START=te,e.NODE_BEFORE=ne,e.NODE_AFTER=oe,e.NODE_BEFORE_AND_AFTER=re,e.NODE_INSIDE=ie}function se(e){ae(e),ae(e.prototype)}function le(a,s){return function(){F(this);var e,t=this.startContainer,n=this.startOffset,o=this.commonAncestorContainer,r=new R(this,!0);t!==o&&(t=(e=C(p(t,o,!0))).node,n=e.offset),x(r,q),r.reset();var i=a(r);return r.detach(),s(this,t,n,t,n),i}}function ce(e,c){function t(n,o){return function(e){P(e,A),P(y(e),_);var t=(n?w:C)(e);(o?r:i)(this,t.node,t.offset)}}function r(e,t,n){var o=e.endContainer,r=e.endOffset;t===e.startContainer&&n===e.startOffset||(y(t)==y(o)&&1!=h(t,n,o,r)||(o=t,r=n),c(e,t,n,o,r))}function i(e,t,n){var o=e.startContainer,r=e.startOffset;t===e.endContainer&&n===e.endOffset||(y(t)==y(o)&&-1!=h(t,n,o,r)||(o=t,r=n),c(e,o,r,t,n))}var n=function(){};n.prototype=a.rangePrototype,e.prototype=new n,o.extend(e.prototype,{setStart:function(e,t){B(e,!0),H(e,t),r(this,e,t)},setEnd:function(e,t){B(e,!0),H(e,t),i(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],n=e[1],o=t,r=n;switch(e.length){case 3:r=e[2];break;case 4:o=e[2],r=e[3]}c(this,t,n,o,r)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:t(!0,!0),setStartAfter:t(!1,!0),setEndBefore:t(!0,!1),setEndAfter:t(!1,!1),collapse:function(e){F(this),e?c(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):c(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){B(e,!0),c(this,e,0,e,g(e))},selectNode:function(e){B(e,!1),P(e,A);var t=w(e),n=C(e);c(this,t.node,t.offset,n.node,n.offset)},extractContents:le(S,c),deleteContents:le(E,c),canSurroundContents:function(){F(this),q(this.startContainer),q(this.endContainer);var e=new R(this,!0),t=e._first&&v(e._first,this)||e._last&&v(e._last,this);return e.detach(),!t},splitBoundaries:function(){X(this)},splitBoundariesPreservingPositions:function(e){X(this,e)},normalizeBoundaries:function(){F(this);var r=this.startContainer,i=this.startOffset,a=this.endContainer,s=this.endOffset,e=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(s=(a=e).length,e.appendData(t.data),t.parentNode.removeChild(t))},t=function(e){var t=e.previousSibling;if(t&&t.nodeType==e.nodeType){var n=(r=e).length;if(i=t.length,e.insertData(0,t.data),t.parentNode.removeChild(t),r==a)s+=i,a=r;else if(a==e.parentNode){var o=u(e);s==o?(a=e,s=n):o<s&&s--}}},n=!0;if(d(a))a.length==s&&e(a);else{if(0<s){var o=a.childNodes[s-1];o&&d(o)&&e(o)}n=!this.collapsed}if(n){if(d(r))0==i&&t(r);else if(i<r.childNodes.length){var l=r.childNodes[i];l&&d(l)&&t(l)}}else r=a,i=s;c(this,r,i,a,s)},collapseToPoint:function(e,t){B(e,!0),H(e,t),this.setStartAndEnd(e,t)}}),se(e)}function de(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:s.getCommonAncestor(e.startContainer,e.endContainer)}function ue(e,t,n,o,r){e.startContainer=t,e.startOffset=n,e.endContainer=o,e.endOffset=r,e.document=s.getDocument(t),de(e)}function fe(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,de(this)}o.extend(a.rangePrototype,{compareBoundaryPoints:function(e,t){var n,o,r,i;F(this),z(this.startContainer,t.startContainer);var a=e==te||e==Z?"start":"end",s=e==J||e==Z?"start":"end";return n=this[a+"Container"],o=this[a+"Offset"],r=t[s+"Container"],i=t[s+"Offset"],h(n,o,r,i)},insertNode:function(e){if(F(this),P(e,I),q(this.startContainer),c(e,this.startContainer))throw new l("HIERARCHY_REQUEST_ERR");var t=r(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){var e,t;if(F(this),this.collapsed)return b(this).createDocumentFragment();if(this.startContainer===this.endContainer&&d(this.startContainer))return(e=this.startContainer.cloneNode(!0)).data=e.data.slice(this.startOffset,this.endOffset),(t=b(this).createDocumentFragment()).appendChild(e),t;var n=new R(this,!0);return e=function e(t){for(var n,o,r,i=b(t.range).createDocumentFragment();o=t.next();){if(n=t.isPartiallySelectedSubtree(),o=o.cloneNode(!n),n&&(r=t.getSubtreeIterator(),o.appendChild(e(r)),r.detach()),10==o.nodeType)throw new l("HIERARCHY_REQUEST_ERR");i.appendChild(o)}return i}(n),n.detach(),e},canSurroundContents:function(){F(this),q(this.startContainer),q(this.endContainer);var e=new R(this,!0),t=e._first&&v(e._first,this)||e._last&&v(e._last,this);return e.detach(),!t},surroundContents:function(e){if(P(e,O),!this.canSurroundContents())throw new l("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);r(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){F(this);for(var e,t=new fe(b(this)),n=Q.length;n--;)t[e=Q[n]]=this[e];return t},toString:function(){F(this);var e=this.startContainer;if(e===this.endContainer&&d(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new R(this,!0);return x(n,function(e){3!=e.nodeType&&4!=e.nodeType||t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){F(this);var t=e.parentNode,n=u(e);if(!t)throw new l("NOT_FOUND_ERR");var o=this.comparePoint(t,n),r=this.comparePoint(t,n+1);return o<0?0<r?re:ne:0<r?oe:ie},comparePoint:function(e,t){return F(this),V(e,"HIERARCHY_REQUEST_ERR"),z(e,this.startContainer),h(e,t,this.startContainer,this.startOffset)<0?-1:0<h(e,t,this.endContainer,this.endOffset)?1:0},createContextualFragment:$,toHtml:function(){return Y(this)},intersectsNode:function(e,t){if(F(this),V(e,"NOT_FOUND_ERR"),f(e)!==b(this))return!1;var n=e.parentNode,o=u(e);V(n,"NOT_FOUND_ERR");var r=h(n,o,this.endContainer,this.endOffset),i=h(n,o+1,this.startContainer,this.startOffset);return t?r<=0&&0<=i:r<0&&0<i},isPointInRange:function(e,t){return F(this),V(e,"HIERARCHY_REQUEST_ERR"),z(e,this.startContainer),0<=h(e,t,this.startContainer,this.startOffset)&&h(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return N(this,e,!1)},intersectsOrTouchesRange:function(e){return N(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=h(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=h(this.endContainer,this.endOffset,e.endContainer,e.endOffset),o=this.cloneRange();return-1==t&&o.setStart(e.startContainer,e.startOffset),1==n&&o.setEnd(e.endContainer,e.endOffset),o}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==h(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==h(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new l("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==ie},containsNodeContents:function(e){return 0<=this.comparePoint(e,0)&&this.comparePoint(e,g(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(0<n.length){t.setStart(n[0],0);var o=n.pop();return t.setEnd(o,o.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return F(this),function(o,e,r){var i,a=!(!e||!e.length),s=!!r;a&&(i=new RegExp("^("+e.join("|")+")$"));var l=[];return x(new R(o,!1),function(e){if((!a||i.test(e.nodeType))&&(!s||r(e))){var t=o.startContainer;if(e!=t||!d(t)||o.startOffset!=t.length){var n=o.endContainer;e==n&&d(n)&&0==o.endOffset||l.push(e)}}}),l}(this,e,t)},getDocument:function(){return b(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(e){var t=b(this),n=a.createRange(t);e=e||s.getBody(t),n.selectNodeContents(e);var o=this.intersection(n),r=0,i=0;return o&&(n.setEnd(o.startContainer,o.startOffset),i=(r=n.toString().length)+o.toString().length),{start:r,end:i,containerNode:e}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var o,r,i,a,s=[t],l=!1,c=!1;!c&&(o=s.pop());)if(3==o.nodeType)r=n+o.length,!l&&e.start>=n&&e.start<=r&&(this.setStart(o,e.start-n),l=!0),l&&e.end>=n&&e.end<=r&&(this.setEnd(o,e.end-n),c=!0),n=r;else for(i=(a=o.childNodes).length;i--;)s.push(a[i])},getName:function(){return"DomRange"},equals:function(e){return fe.rangesEqual(this,e)},isValid:function(){return j(this)},inspect:function(){return T(this)},detach:function(){}}),ce(fe,ue),o.extend(fe,{rangeProperties:Q,RangeIterator:R,copyComparisonConstants:se,createPrototypeRange:ce,inspect:T,toHtml:Y,getRangeDocument:b,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),a.DomRange=fe}),v.createCoreModule("WrappedRange",["DomRange"],function(d,u){var f,e,N=d.dom,h=d.util,x=N.DomPosition,m=d.DomRange,p=N.getBody,g=N.getContentDocument,E=N.isCharacterDataNode;if(d.features.implementsDomRange&&function(){var t,n,o=m.rangeProperties;function r(e){for(var t,n=o.length;n--;)e[t=o[n]]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}f=function(e){if(!e)throw u.createError("WrappedRange: Range must be specified");this.nativeRange=e,r(this)},m.createPrototypeRange(f,function(e,t,n,o,r){var i=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==o||e.endOffset!=r,s=!e.equals(e.nativeRange);(i||a||s)&&(e.setEnd(o,r),e.setStart(t,n))}),(t=f.prototype).selectNode=function(e){this.nativeRange.selectNode(e),r(this)},t.cloneContents=function(){return this.nativeRange.cloneContents()},t.surroundContents=function(e){this.nativeRange.surroundContents(e),r(this)},t.collapse=function(e){this.nativeRange.collapse(e),r(this)},t.cloneRange=function(){return new f(this.nativeRange.cloneRange())},t.refresh=function(){r(this)},t.toString=function(){return this.nativeRange.toString()};var e=document.createTextNode("test");p(document).appendChild(e);var i=document.createRange();i.setStart(e,0),i.setEnd(e,0);try{i.setStart(e,1),t.setStart=function(e,t){this.nativeRange.setStart(e,t),r(this)},t.setEnd=function(e,t){this.nativeRange.setEnd(e,t),r(this)},n=function(t){return function(e){this.nativeRange[t](e),r(this)}}}catch(e){t.setStart=function(t,n){try{this.nativeRange.setStart(t,n)}catch(e){this.nativeRange.setEnd(t,n),this.nativeRange.setStart(t,n)}r(this)},t.setEnd=function(t,n){try{this.nativeRange.setEnd(t,n)}catch(e){this.nativeRange.setStart(t,n),this.nativeRange.setEnd(t,n)}r(this)},n=function(n,o){return function(t){try{this.nativeRange[n](t)}catch(e){this.nativeRange[o](t),this.nativeRange[n](t)}r(this)}}}t.setStartBefore=n("setStartBefore","setEndBefore"),t.setStartAfter=n("setStartAfter","setEndAfter"),t.setEndBefore=n("setEndBefore","setStartBefore"),t.setEndAfter=n("setEndAfter","setStartAfter"),t.selectNodeContents=function(e){this.setStartAndEnd(e,0,N.getNodeLength(e))},i.selectNodeContents(e),i.setEnd(e,3);var a=document.createRange();a.selectNodeContents(e),a.setEnd(e,4),a.setStart(e,2),-1==i.compareBoundaryPoints(i.START_TO_END,a)&&1==i.compareBoundaryPoints(i.END_TO_START,a)?t.compareBoundaryPoints=function(e,t){return e==(t=t.nativeRange||t).START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:t.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var s=document.createElement("div");s.innerHTML="123";var l=s.firstChild,c=p(document);c.appendChild(s),i.setStart(l,1),i.setEnd(l,2),i.deleteContents(),"13"==l.data&&(t.deleteContents=function(){this.nativeRange.deleteContents(),r(this)},t.extractContents=function(){var e=this.nativeRange.extractContents();return r(this),e}),c.removeChild(s),c=null,h.isHostMethod(i,"createContextualFragment")&&(t.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),p(document).removeChild(e),t.getName=function(){return"WrappedRange"},d.WrappedRange=f,d.createNativeRange=function(e){return(e=g(e,u,"createNativeRange")).createRange()}}(),d.features.implementsTextRange){var i=function(e,t,n,o,r){var i=e.duplicate();i.collapse(n);var a=i.parentElement();if(N.isOrIsAncestorOf(t,a)||(a=t),!a.canHaveHTML){var s=new x(a.parentNode,N.getNodeIndex(a));return{boundaryPosition:s,nodeInfo:{nodeIndex:s.offset,containerElement:s.node}}}var l=N.getDocument(a).createElement("span");l.parentNode&&l.parentNode.removeChild(l);for(var c,d,u,f,h,m=n?"StartToStart":"StartToEnd",p=r&&r.containerElement==a?r.nodeIndex:0,g=a.childNodes.length,y=g,v=y;v==g?a.appendChild(l):a.insertBefore(l,a.childNodes[v]),i.moveToElementText(l),0!=(c=i.compareEndPoints(m,e))&&p!=y;){if(-1==c){if(y==p+1)break;p=v}else y=y==p+1?p:v;v=Math.floor((p+y)/2),a.removeChild(l)}if(h=l.nextSibling,-1==c&&h&&E(h)){var b;if(i.setEndPoint(n?"EndToStart":"EndToEnd",e),/[\r\n]/.test(h.data)){var w=i.duplicate(),C=w.text.replace(/\r\n/g,"\r").length;for(b=w.moveStart("character",C);-1==(c=w.compareEndPoints("StartToEnd",w));)b++,w.moveStart("character",1)}else b=i.text.length;f=new x(h,b)}else d=(o||!n)&&l.previousSibling,f=(u=(o||n)&&l.nextSibling)&&E(u)?new x(u,0):d&&E(d)?new x(d,d.data.length):new x(a,N.getNodeIndex(l));return l.parentNode.removeChild(l),{boundaryPosition:f,nodeInfo:{nodeIndex:v,containerElement:a}}},r=function(e,t){var n,o,r,i,a=e.offset,s=N.getDocument(e.node),l=p(s).createTextRange(),c=E(e.node);return c?o=(n=e.node).parentNode:(n=a<(i=e.node.childNodes).length?i[a]:null,o=e.node),(r=s.createElement("span")).innerHTML="&#feff;",n?o.insertBefore(r,n):o.appendChild(r),l.moveToElementText(r),l.collapse(!t),o.removeChild(r),c&&l[t?"moveStart":"moveEnd"]("character",a),l};((e=function(e){this.textRange=e,this.refresh()}).prototype=new m(document)).refresh=function(){var e,t,n,o,r=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var o=n.parentElement();(n=e.duplicate()).collapse(!1);var r=n.parentElement(),i=o==r?o:N.getCommonAncestor(o,r);return i==t?i:N.getCommonAncestor(t,i)}(this.textRange);0==(o=this.textRange).compareEndPoints("StartToEnd",o)?t=e=i(this.textRange,r,!0,!0).boundaryPosition:(e=(n=i(this.textRange,r,!0,!1)).boundaryPosition,t=i(this.textRange,r,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},e.prototype.getName=function(){return"WrappedTextRange"},m.copyComparisonConstants(e);var t=function(e){if(e.collapsed)return r(new x(e.startContainer,e.startOffset),!0);var t=r(new x(e.startContainer,e.startOffset),!0),n=r(new x(e.endContainer,e.endOffset),!1),o=p(m.getRangeDocument(e)).createTextRange();return o.setEndPoint("StartToStart",t),o.setEndPoint("EndToEnd",n),o};if(e.rangeToTextRange=t,e.prototype.toTextRange=function(){return t(this)},d.WrappedTextRange=e,!d.features.implementsDomRange||d.config.preferTextRange){var n=function(){return this}();void 0===n.Range&&(n.Range=e),d.createNativeRange=function(e){return e=g(e,u,"createNativeRange"),p(e).createTextRange()},d.WrappedRange=e}}d.createRange=function(e){return e=g(e,u,"createRange"),new d.WrappedRange(d.createNativeRange(e))},d.createRangyRange=function(e){return e=g(e,u,"createRangyRange"),new m(e)},d.createIframeRange=function(e){return u.deprecationNotice("createIframeRange()","createRange(iframeEl)"),d.createRange(e)},d.createIframeRangyRange=function(e){return u.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),d.createRangyRange(e)},d.addShimListener(function(e){var t=e.document;void 0===t.createRange&&(t.createRange=function(){return d.createRange(t)}),t=e=null})}),v.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(f,l){f.config.checkSelectionRanges=!0;var r,i,e="boolean",t="number",o=f.dom,n=f.util,a=n.isHostMethod,s=f.DomRange,c=f.WrappedRange,d=f.DOMException,u=o.DomPosition,h=f.features,m="Control",p=o.getDocument,g=o.getBody,y=s.rangesEqual;function v(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function b(e,t){if(e){if(o.isWindow(e))return e;if(e instanceof F)return e.win;var n=o.getContentDocument(e,l,t);return o.getWindow(n)}return window}function w(e){return b(e,"getDocSelection").document.selection}function C(e){var t=!1;return e.anchorNode&&(t=1==o.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}var N=a(window,"getSelection"),x=n.isHostObject(document,"selection");h.implementsWinGetSelection=N;var E=(h.implementsDocSelection=x)&&(!N||f.config.preferTextRange);E?(r=w,f.isSelectionValid=function(e){var t=b(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||p(n.createRange().parentElement())==t}):N?(r=function(e){return b(e,"getWinSelection").getSelection()},f.isSelectionValid=function(){return!0}):l.fail("Neither document.selection or window.getSelection() detected.");var S=(f.getNativeSelection=r)(),T=f.createNativeRange(document),R=g(document),A=n.areHostProperties(S,["anchorNode","focusNode","anchorOffset","focusOffset"]);h.selectionHasAnchorAndFocus=A;var _=a(S,"extend");h.selectionHasExtend=_;var I=typeof S.rangeCount==t;h.selectionHasRangeCount=I;var O=!1,L=!0,k=_?function(e,t){var n=s.getRangeDocument(t),o=f.createRange(n);o.collapseToPoint(t.endContainer,t.endOffset),e.addRange(z(o)),e.extend(t.startContainer,t.startOffset)}:null;n.areHostMethods(S,["addRange","getRangeAt","removeAllRanges"])&&typeof S.rangeCount==t&&h.implementsDomRange&&function(){var e=window.getSelection();if(e){for(var t=e.rangeCount,n=1<t,o=[],r=C(e),i=0;i<t;++i)o[i]=e.getRangeAt(i);var a=g(document),s=a.appendChild(document.createElement("div"));s.contentEditable="false";var l=s.appendChild(document.createTextNode("   ")),c=document.createRange();if(c.setStart(l,1),c.collapse(!0),e.addRange(c),L=1==e.rangeCount,e.removeAllRanges(),!n){var d=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(d&&36<=parseInt(d[1]))O=!1;else{var u=c.cloneRange();c.setStart(l,0),u.setEnd(l,3),u.setStart(l,2),e.addRange(c),e.addRange(u),O=2==e.rangeCount}}for(a.removeChild(s),e.removeAllRanges(),i=0;i<t;++i)0==i&&r?k?k(e,o[i]):(f.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),e.addRange(o[i])):e.addRange(o[i])}}(),h.selectionSupportsMultipleRanges=O,h.collapsedNonEditableSelectionsSupported=L;var D,M,B=!1;function P(e,t,n){var o=n?"end":"start",r=n?"start":"end";e.anchorNode=t[o+"Container"],e.anchorOffset=t[o+"Offset"],e.focusNode=t[r+"Container"],e.focusOffset=t[r+"Offset"]}function H(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function z(e){var t;return e instanceof s?((t=f.createNativeRange(e.getDocument())).setEnd(e.endContainer,e.endOffset),t.setStart(e.startContainer,e.startOffset)):e instanceof c?t=e.nativeRange:h.implementsDomRange&&e instanceof o.getWindow(e.startContainer).Range&&(t=e),t}function q(e){var t=e.getNodes();if(!function(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;t<n;++t)if(!o.isAncestorOf(e[0],e[t]))return!1;return!0}(t))throw l.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function V(e){return!!e&&void 0!==e.text}function W(e,t){var n=new c(t);e._ranges=[n],P(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function U(e){if(e._ranges.length=0,"None"==e.docSelection.type)H(e);else{var t=e.docSelection.createRange();if(V(t))W(e,t);else{e.rangeCount=t.length;for(var n,o=p(t.item(0)),r=0;r<e.rangeCount;++r)(n=f.createRange(o)).selectNode(t.item(r)),e._ranges.push(n);e.isCollapsed=1==e.rangeCount&&e._ranges[0].collapsed,P(e,e._ranges[e.rangeCount-1],!1)}}}function j(e,t){for(var n=e.docSelection.createRange(),o=q(t),r=p(n.item(0)),i=g(r).createControlRange(),a=0,s=n.length;a<s;++a)i.add(n.item(a));try{i.add(o)}catch(e){throw l.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}i.select(),U(e)}function F(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function K(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}R&&a(R,"createControlRange")&&(D=R.createControlRange(),n.areHostProperties(D,["item","add"])&&(B=!0)),h.implementsControlRange=B,i=A?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed},a(S,"getRangeAt")?M=function(e,t){try{return e.getRangeAt(t)}catch(e){return null}}:A&&(M=function(e){var t=p(e.anchorNode),n=f.createRange(t);return n.setStartAndEnd(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset),n.collapsed!==this.isCollapsed&&n.setStartAndEnd(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset),n}),F.prototype=f.selectionPrototype;var G=[];function $(e,t){for(var n,o,r=G.length;r--;)if(o=(n=G[r]).selection,"deleteAll"==t)K(o);else if(n.win==e)return"delete"==t?(G.splice(r,1),!0):o;return"deleteAll"==t&&(G.length=0),null}var X=function(e){if(e&&e instanceof F)return e.refresh(),e;var t=$(e=b(e,"getNativeSelection")),n=r(e),o=x?w(e):null;return t?(t.nativeSelection=n,t.docSelection=o,t.refresh()):(t=new F(n,o,e),G.push({win:e,selection:t})),t};f.getSelection=X,f.getIframeSelection=function(e){return l.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),f.getSelection(o.getIframeWindow(e))};var Y,Q=F.prototype;function Z(e,t){for(var n,o=p(t[0].startContainer),r=g(o).createControlRange(),i=0,a=t.length;i<a;++i){n=q(t[i]);try{r.add(n)}catch(e){throw l.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}r.select(),U(e)}if(!E&&A&&n.areHostMethods(S,["removeAllRanges","addRange"])){Q.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),H(this)};var J=function(e,t){k(e.nativeSelection,t),e.refresh()};Q.addRange=I?function(e,t){var n;if(B&&x&&this.docSelection.type==m)j(this,e);else if(v(t)&&_)J(this,e);else if(O?n=this.rangeCount:(this.removeAllRanges(),n=0),this.nativeSelection.addRange(z(e).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==n+1){if(f.config.checkSelectionRanges){var o=M(this.nativeSelection,this.rangeCount-1);o&&!y(o,e)&&(e=new c(o))}this._ranges[this.rangeCount-1]=e,P(this,e,ee(this.nativeSelection)),this.isCollapsed=i(this)}else this.refresh()}:function(e,t){v(t)&&_?J(this,e):(this.nativeSelection.addRange(z(e)),this.refresh())},Q.setRanges=function(e){if(B&&x&&1<e.length)Z(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(a(S,"empty")&&a(T,"select")&&B&&E))return l.fail("No means of selecting a Range or TextRange was found"),!1;Q.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=p(this.anchorNode);else if(this.docSelection.type==m){var t=this.docSelection.createRange();t.length&&(e=p(t.item(0)))}if(e)g(e).createTextRange().select(),this.docSelection.empty()}}catch(e){}H(this)},Q.addRange=function(e){this.docSelection.type==m?j(this,e):(f.WrappedTextRange.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,P(this,e,!1))},Q.setRanges=function(e){this.removeAllRanges();var t=e.length;1<t?Z(this,e):t&&this.addRange(e[0])}}if(Q.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new d("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()},E)Y=function(e){var t;f.isSelectionValid(e.win)?t=e.docSelection.createRange():(t=g(e.win.document).createTextRange()).collapse(!0),e.docSelection.type==m?U(e):V(t)?W(e,t):H(e)};else if(a(S,"getRangeAt")&&typeof S.rangeCount==t)Y=function(e){if(B&&x&&e.docSelection.type==m)U(e);else if(e._ranges.length=e.rangeCount=e.nativeSelection.rangeCount,e.rangeCount){for(var t=0,n=e.rangeCount;t<n;++t)e._ranges[t]=new f.WrappedRange(e.nativeSelection.getRangeAt(t));P(e,e._ranges[e.rangeCount-1],ee(e.nativeSelection)),e.isCollapsed=i(e)}else H(e)};else{if(!A||typeof S.isCollapsed!=e||typeof T.collapsed!=e||!h.implementsDomRange)return l.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;Y=function(e){var t,n,o,r=e.nativeSelection;r.anchorNode?(t=M(r,0),e._ranges=[t],e.rangeCount=1,o=(n=e).nativeSelection,n.anchorNode=o.anchorNode,n.anchorOffset=o.anchorOffset,n.focusNode=o.focusNode,n.focusOffset=o.focusOffset,e.isCollapsed=i(e)):H(e)}}Q.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,o=this.anchorOffset;if(Y(this),e){var r=t.length;if(r!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=o)return!0;for(;r--;)if(!y(t[r],this._ranges[r]))return!0;return!1}};var ee,te=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var o=0,r=n.length;o<r;++o)y(t,n[o])||e.addRange(n[o]);e.rangeCount||H(e)};function ne(e,t){if(e.win.document!=p(t))throw new d("WRONG_DOCUMENT_ERR")}function oe(o){return function(e,t){var n;this.rangeCount?(n=this.getRangeAt(0))["set"+(o?"Start":"End")](e,t):(n=f.createRange(this.win.document)).setStartAndEnd(e,t),this.setSingleRange(n,this.isBackward())}}function re(e){var t=[],n=new u(e.anchorNode,e.anchorOffset),o=new u(e.focusNode,e.focusOffset),r="function"==typeof e.getName?e.getName():"Selection";if(void 0!==e.rangeCount)for(var i=0,a=e.rangeCount;i<a;++i)t[i]=s.inspect(e.getRangeAt(i));return"["+r+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+o.inspect()+"]"}Q.removeRange=B&&x?function(e){if(this.docSelection.type==m){for(var t=this.docSelection.createRange(),n=q(e),o=p(t.item(0)),r=g(o).createControlRange(),i=!1,a=0,s=t.length;a<s;++a)t.item(a)!==n||i?r.add(t.item(a)):i=!0;r.select(),U(this)}else te(this,e)}:function(e){te(this,e)},!E&&A&&h.implementsDomRange?(ee=C,Q.isBackward=function(){return ee(this)}):ee=Q.isBackward=function(){return!1},Q.isBackwards=Q.isBackward,Q.toString=function(){for(var e=[],t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},Q.collapse=function(e,t){ne(this,e);var n=f.createRange(e);n.collapseToPoint(e,t),this.setSingleRange(n),this.isCollapsed=!0},Q.collapseToStart=function(){if(!this.rangeCount)throw new d("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},Q.collapseToEnd=function(){if(!this.rangeCount)throw new d("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},Q.selectAllChildren=function(e){ne(this,e);var t=f.createRange(e);t.selectNodeContents(e),this.setSingleRange(t)},Q.deleteFromDocument=function(){if(B&&x&&this.docSelection.type==m){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var o=0,r=n.length;o<r;++o)n[o].deleteContents();this.addRange(n[r-1])}}},Q.eachRange=function(e,t){for(var n=0,o=this._ranges.length;n<o;++n)if(e(this.getRangeAt(n)))return t},Q.getAllRanges=function(){var t=[];return this.eachRange(function(e){t.push(e)}),t},Q.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},Q.callMethodOnEachRange=function(t,n){var o=[];return this.eachRange(function(e){o.push(e[t].apply(e,n))}),o},Q.setStart=oe(!0),Q.setEnd=oe(!1),f.rangePrototype.select=function(e){X(this.getDocument()).setSingleRange(this,e)},Q.changeEachRange=function(t){var n=[],e=this.isBackward();this.eachRange(function(e){t(e),n.push(e)}),this.removeAllRanges(),e&&1==n.length?this.addRange(n[0],"backward"):this.setRanges(n)},Q.containsNode=function(t,n){return this.eachRange(function(e){return e.containsNode(t,n)},!0)||!1},Q.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},Q.moveToBookmark=function(e){for(var t,n,o=[],r=0;t=e.rangeBookmarks[r++];)(n=f.createRange(this.win)).moveToBookmark(t),o.push(n);e.backward?this.setSingleRange(o[0],"backward"):this.setRanges(o)},Q.toHtml=function(){var t=[];return this.eachRange(function(e){t.push(s.toHtml(e))}),t.join("")},h.implementsTextRange&&(Q.getNativeTextRange=function(){var e;if(e=this.docSelection){var t=e.createRange();if(V(t))return t;throw l.createError("getNativeTextRange: selection is a control selection")}if(0<this.rangeCount)return f.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw l.createError("getNativeTextRange: selection contains no range")}),Q.getName=function(){return"WrappedSelection"},Q.inspect=function(){return re(this)},Q.detach=function(){$(this.win,"delete"),K(this)},F.detachAll=function(){$(null,"deleteAll")},F.inspect=re,F.isDirectionBackward=v,f.Selection=F,f.selectionPrototype=Q,f.addShimListener(function(e){void 0===e.getSelection&&(e.getSelection=function(){return X(e)}),e=null})}),v;C("No document found")}else C("No window found")},this.rangy=n(),function(e){e.createModule("SaveRestore",["WrappedRange"],function(s,a){var l=s.dom,c="\ufeff";function d(e,t){return(t||document).getElementById(e)}function i(e,t){var n,o="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),r=l.getDocument(e.startContainer),i=e.cloneRange();return i.collapse(t),(n=r.createElement("span")).id=o,n.style.lineHeight="0",n.style.display="none",n.className="rangySelectionBoundary",n.appendChild(r.createTextNode(c)),i.insertNode(n),n}function u(e,t,n,o){var r=d(n,e);r?(t[o?"setStartBefore":"setEndBefore"](r),r.parentNode.removeChild(r)):a.warn("Marker element has been removed. Cannot restore selection.")}function f(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function h(e,t){var n,o=s.DomRange.getRangeDocument(e),r=e.toString();return e.collapsed?{document:o,markerId:(n=i(e,!1)).id,collapsed:!0}:(n=i(e,!1),{document:o,startMarkerId:i(e,!0).id,endMarkerId:n.id,collapsed:!1,backward:t,toString:function(){return"original text: '"+r+"', new text: '"+e.toString()+"'"}})}function o(e,t){var n=e.document;void 0===t&&(t=!0);var o=s.createRange(n);if(e.collapsed){var r=d(e.markerId,n);if(r){r.style.display="inline";var i=r.previousSibling;i&&3==i.nodeType?(r.parentNode.removeChild(r),o.collapseToPoint(i,i.length)):(o.collapseBefore(r),r.parentNode.removeChild(r))}else a.warn("Marker element has been removed. Cannot restore selection.")}else u(n,o,e.startMarkerId,!0),u(n,o,e.endMarkerId,!1);return t&&o.normalizeBoundaries(),o}function m(e,t){var n,o,r=[];(e=e.slice(0)).sort(f);for(var i=0,a=e.length;i<a;++i)r[i]=h(e[i],t);for(i=a-1;0<=i;--i)n=e[i],o=s.DomRange.getRangeDocument(n),n.collapsed?n.collapseAfter(d(r[i].markerId,o)):(n.setEndBefore(d(r[i].endMarkerId,o)),n.setStartAfter(d(r[i].startMarkerId,o)));return r}function p(e){for(var t=[],n=e.length-1;0<=n;n--)t[n]=o(e[n],!0);return t}function g(e,t){var n=d(t,e);n&&n.parentNode.removeChild(n)}s.util.extend(s,{saveRange:h,restoreRange:o,saveRanges:m,restoreRanges:p,saveSelection:function(e){if(!s.isSelectionValid(e))return a.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var t=s.getSelection(e),n=t.getAllRanges(),o=1==n.length&&t.isBackward(),r=m(n,o);return o?t.setSingleRange(n[0],"backward"):t.setRanges(n),{win:e,rangeInfos:r,restored:!1}},restoreSelection:function(e,t){if(!e.restored){var n=e.rangeInfos,o=s.getSelection(e.win),r=p(n);1==n.length&&t&&s.features.selectionHasExtend&&n[0].backward?(o.removeAllRanges(),o.addRange(r[0],!0)):o.setRanges(r),e.restored=!0}},removeMarkerElement:g,removeMarkers:function(e){for(var t,n=e.rangeInfos,o=0,r=n.length;o<r;++o)(t=n[o]).collapsed?g(e.doc,t.markerId):(g(e.doc,t.startMarkerId),g(e.doc,t.endMarkerId))}})})}(this.rangy);var o,r,i,a,s,l,d,u,f,h,m,p,g,y,v,b,w,C,N,x,E,S,T,R,A,I,O,L,k,D,M,B,P,H,z,q,V,W,U,j,F,K,G,$,X,Y,Q,Z,J,ee,te,ne,oe,re,ie,ae,se,le,ce,de,ue,fe,he,me,pe,ge,ye,ve,be,we,Ce,Ne,xe,Ee,Se,Te,Re,Ae,_e,Ie,Oe,Le,ke,De,Me,Be,Pe,He,ze,qe,Ve,We,Ue,je,Fe,Ke,Ge,$e,Xe,Ye,Qe,Ze,Je,et,tt,nt,ot,rt,it,at,st,lt,ct,dt,ut,ft,ht,mt,pt,gt,yt,vt,bt,wt,Ct,Nt,xt,Et,St,Tt,Rt,At,_t,It,Ot=function(){};Ot.extend=function(e,t){var n=Ot.prototype.extend;Ot._prototyping=!0;var o=new this;n.call(o,e),o.base=function(){},delete Ot._prototyping;var r=o.constructor,i=o.constructor=function(){if(!Ot._prototyping)if(this._constructing||this.constructor==i)this._constructing=!0,r.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||n).call(arguments[0],o)};return i.ancestor=this,i.extend=this.extend,i.forEach=this.forEach,i.implement=this.implement,i.prototype=o,i.toString=this.toString,i.valueOf=function(e){return"object"==e?i:r.valueOf()},n.call(i,t),"function"==typeof i.init&&i.init(),i},Ot.prototype={extend:function(e,t){if(1<arguments.length){var n=this[e];if(n&&"function"==typeof t&&(!n.valueOf||n.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)){var o=t.valueOf();(t=function(){var e=this.base||Ot.prototype.base;this.base=n;var t=o.apply(this,arguments);return this.base=e,t}).valueOf=function(e){return"object"==e?t:o},t.toString=Ot.toString}this[e]=t}else if(e){var r=Ot.prototype.extend;Ot._prototyping||"function"==typeof this||(r=this.extend||r);for(var i={toSource:null},a=["constructor","toString","valueOf"],s=Ot._prototyping?0:1;l=a[s++];)e[l]!=i[l]&&r.call(this,l,e[l]);for(var l in e)i[l]||r.call(this,l,e[l])}return this}},Ot=Ot.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,n){for(var o in e)void 0===this.prototype[o]&&t.call(n,e[o],o,e)},implement:function(){for(var e=0;e<arguments.length;e++)"function"==typeof arguments[e]?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return String(this.valueOf())}}),_.browser=function(){var n,o,t=navigator.userAgent,a=document.createElement("div"),e=-1!==t.indexOf("Gecko")&&-1===t.indexOf("KHTML"),r=-1!==t.indexOf("AppleWebKit/"),i=-1!==t.indexOf("Chrome/"),s=-1!==t.indexOf("Opera/");function l(e,t){var n,o=-1;return"Microsoft Internet Explorer"==navigator.appName?n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):"Netscape"==navigator.appName&&(n=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")),n&&null!=n.exec(navigator.userAgent)&&(o=parseFloat(RegExp.$1)),-1!==o&&(!e||(t?"<"===t?e<o:">"===t?o<e:"<="===t?e<=o:">="===t?o<=e:void 0:e===o))}return{USER_AGENT:t,supported:function(){var e,t=this.USER_AGENT.toLowerCase(),n="contentEditable"in a,o=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,r=document.querySelector&&document.querySelectorAll,i=this.isIos()&&+(/ipad|iphone|ipod/.test(e=t)&&e.match(/ os (\d+).+? like mac os x/)||[void 0,0])[1]<5||this.isAndroid()&&+(t.match(/android (\d+)/)||[void 0,0])[1]<4||-1!==t.indexOf("opera mobi")||-1!==t.indexOf("hpwos/");return n&&o&&r&&!i},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},supportsSandboxedIframes:function(){return l()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return l()},hasCurrentStyleProperty:function(){return"currentStyle"in a},hasHistoryIssue:function(){return e&&"Mac"===navigator.platform.substr(0,3)},insertsLineBreaksOnReturn:function(){return e},supportsPlaceholderAttributeOn:function(e){return"placeholder"in e},supportsEvent:function(e){return"on"+e in a||(a.setAttribute("on"+e,"return;"),"function"==typeof a["on"+e])},supportsEventsInIframeCorrectly:function(){return!s},supportsHTML5Tags:function(e){var t=e.createElement("div"),n="<article>foo</article>";return t.innerHTML=n,t.innerHTML.toLowerCase()===n},supportsCommand:(n={formatBlock:l(10,"<="),insertUnorderedList:l(),insertOrderedList:l()},o={insertHTML:e},function(e,t){if(!n[t]){try{return e.queryCommandSupported(t)}catch(e){}try{return e.queryCommandEnabled(t)}catch(e){return!!o[t]}}return!1}),doesAutoLinkingInContentEditable:function(){return l()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return e||s||r},supportsGetAttributeCorrectly:function(){return"1"!=document.createElement("td").getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return e||l()||s},autoScrollsToCaret:function(){return!r},autoClosesUnclosedTags:function(){var e,t,n=a.cloneNode(!1);return n.innerHTML="<p><div></div>",t=n.innerHTML.toLowerCase(),e="<p></p><div></div>"===t||"<p><div></div></p>"===t,this.autoClosesUnclosedTags=function(){return e},e},supportsNativeGetElementsByClassName:function(){return-1!==String(document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return s},supportsSpeechApiOn:function(e){return 11<=(t.match(/Chrome\/(\d+)/)||[void 0,0])[1]&&("onwebkitspeechchange"in e||"speech"in e)},crashesWhenDefineProperty:function(e){return l(9)&&("XMLHttpRequest"===e||"XDomainRequest"===e)},doesAsyncFocus:function(){return l()},hasProblemsSettingCaretAfterImg:function(){return l()},hasUndoInContextMenu:function(){return e||i||s},hasInsertNodeIssue:function(){return s},hasIframeFocusIssue:function(){return l()},createsNestedInvalidMarkupAfterPaste:function(){return r},supportsMutationEvents:function(){return"MutationEvent"in window}}}(),_.lang.array=function(i){return{contains:function(e){if(Array.isArray(e)){for(var t=e.length;t--;)if(-1!==_.lang.array(i).indexOf(e[t]))return!0;return!1}return-1!==_.lang.array(i).indexOf(e)},indexOf:function(e){if(i.indexOf)return i.indexOf(e);for(var t=0,n=i.length;t<n;t++)if(i[t]===e)return t;return-1},without:function(e){e=_.lang.array(e);for(var t=[],n=0,o=i.length;n<o;n++)e.contains(i[n])||t.push(i[n]);return t},get:function(){for(var e=0,t=i.length,n=[];e<t;e++)n.push(i[e]);return n},map:function(e,t){if(Array.prototype.map)return i.map(e,t);for(var n=i.length>>>0,o=new Array(n),r=0;r<n;r++)o[r]=e.call(t,i[r],r,i);return o},unique:function(){for(var e=[],t=i.length,n=0;n<t;)_.lang.array(e).contains(i[n])||e.push(i[n]),n++;return e}}},_.lang.Dispatcher=Ot.extend({on:function(e,t){return this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t),this},off:function(e,t){this.events=this.events||{};var n,o,r=0;if(e){for(n=this.events[e]||[],o=[];r<n.length;r++)n[r]!==t&&t&&o.push(n[r]);this.events[e]=o}else this.events={};return this},fire:function(e,t){this.events=this.events||{};for(var n=this.events[e]||[],o=0;o<n.length;o++)n[o].call(this,t);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),_.lang.object=function(n){return{merge:function(e){for(var t in e)n[t]=e[t];return this},get:function(){return n},clone:function(){var e,t={};for(e in n)t[e]=n[e];return t},isArray:function(){return"[object Array]"===Object.prototype.toString.call(n)}}},o=/^\s+/,r=/\s+$/,i=/[&<>"]/g,a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},_.lang.string=function(n){return n=String(n),{trim:function(){return n.replace(o,"").replace(r,"")},interpolate:function(e){for(var t in e)n=this.replace("#{"+t+"}").by(e[t]);return n},replace:function(t){return{by:function(e){return n.split(t).join(e)}}},escapeHTML:function(){return n.replace(i,function(e){return a[e]})}}},l=(s=_).lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),d=/((https?:\/\/|www\.)[^\s<]{3,})/gi,u=/([^\w\/\-](,?))$/i,f=100,h={")":"(","]":"[","}":"{"},s.dom.autoLink=function(e,t){return function(e,t){for(var n;e.parentNode;){if(e=e.parentNode,n=e.nodeName,e.className&&s.lang.array(e.className.split(" ")).contains(t))return!0;if(l.contains(n))return!0;if("body"===n)return!1}return!1}(e,t)?e:(e===e.ownerDocument.documentElement&&(e=e.ownerDocument.body),function e(t,n){if(!(l.contains(t.nodeName)||t.className&&s.lang.array(t.className.split(" ")).contains(n))){if(t.nodeType!==s.TEXT_NODE||!t.data.match(d)){for(var o=s.lang.array(t.childNodes).get(),r=o.length,i=0;i<r;i++)e(o[i],n);return t}!function(e){var t,n,o=e.parentNode,r=s.lang.string(e.data).escapeHTML(),i=(t=o.ownerDocument,(n=t._wysihtml5_tempElement)||(n=t._wysihtml5_tempElement=t.createElement("div")),n);for(i.innerHTML="<span></span>"+r.replace(d,function(e,t){var n=(t.match(u)||[])[1]||"",o=h[n];(t=t.replace(u,"")).split(o).length>t.split(n).length&&(t+=n,n="");var r=t,i=t;return t.length>f&&(i=i.substr(0,f)+"..."),"www."===r.substr(0,4)&&(r="http://"+r),'<a href="'+r+'">'+i+"</a>"+n}),i.removeChild(i.firstChild);i.firstChild;)o.insertBefore(i.firstChild,e);o.removeChild(e)}(t)}}(e,t))},s.dom.autoLink.URL_REG_EXP=d,(m=_.dom).addClass=function(e,t){var n=e.classList;if(n)return n.add(t);m.hasClass(e,t)||(e.className+=" "+t)},m.removeClass=function(e,t){var n=e.classList;if(n)return n.remove(t);e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ")},m.hasClass=function(e,t){var n=e.classList;if(n)return n.contains(t);var o=e.className;return 0<o.length&&(o==t||new RegExp("(^|\\s)"+t+"(\\s|$)").test(o))},_.dom.contains=(p=document.documentElement).contains?function(e,t){return t.nodeType!==_.ELEMENT_NODE&&(t=t.parentNode),e!==t&&e.contains(t)}:p.compareDocumentPosition?function(e,t){return!!(16&e.compareDocumentPosition(t))}:void 0,_.dom.convertToList=function(){function y(e,t){var n=e.createElement("li");return t.appendChild(n),n}return function(e,t,n){if("UL"===e.nodeName||"OL"===e.nodeName||"MENU"===e.nodeName)return e;var o,r,i,a,s,l,c,d,u,f,h=e.ownerDocument,m=(f=t,h.createElement(f)),p=e.querySelectorAll("br"),g=p.length;for(u=0;u<g;u++)for(a=p[u];(s=a.parentNode)&&s!==e&&s.lastChild===a;){if("block"===_.dom.getStyle("display").from(s)){s.removeChild(a);break}_.dom.insert(a).after(a.parentNode)}for(r=(o=_.lang.array(e.childNodes).get()).length,u=0;u<r;u++)d=d||y(h,m),i=o[u],l="block"===_.dom.getStyle("display").from(i),c="BR"===i.nodeName,!l||n&&_.dom.hasClass(i,n)?c?d=d.firstChild?null:d:d.appendChild(i):((d=d.firstChild?y(h,m):d).appendChild(i),d=null);return 0===o.length&&y(h,m),e.parentNode.replaceChild(m,e),m}}(),_.dom.copyAttributes=function(i){return{from:function(r){return{to:function(e){for(var t,n=0,o=i.length;n<o;n++)t=i[n],void 0!==r[t]&&""!==r[t]&&(e[t]=r[t]);return{andTo:arguments.callee}}}}}},g=_.dom,y=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],v=function(e){for(var t=0,n=y.length;t<n;t++)if("border-box"===g.getStyle(y[t]).from(e))return y[t]},g.copyStyles=function(a){return{from:function(e){var t;v(t=e)&&parseInt(g.getStyle("width").from(t),10)<t.offsetWidth&&(a=_.lang.array(a).without(y));for(var n,o="",r=a.length,i=0;i<r;i++)n=a[i],o+=n+":"+g.getStyle(n).from(e)+";";return{to:function(e){return g.setStyles(o).on(e),{andTo:arguments.callee}}}}}},(b=_).dom.delegate=function(o,r,e,i){return b.dom.observe(o,e,function(e){for(var t=e.target,n=b.lang.array(o.querySelectorAll(r));t&&t!==o;){if(n.contains(t)){i.call(t,e);break}t=t.parentNode}})},(w=_).dom.domNode=function(o){var r=[w.ELEMENT_NODE,w.TEXT_NODE],i=function(e){return e.nodeType===w.TEXT_NODE&&/^\s*$/g.test(e.data)};return{prev:function(e){var t=o.previousSibling,n=e&&e.nodeTypes?e.nodeTypes:r;return t?!w.lang.array(n).contains(t.nodeType)||e&&e.ignoreBlankTexts&&i(t)?w.dom.domNode(t).prev(e):t:null},next:function(e){var t=o.nextSibling,n=e&&e.nodeTypes?e.nodeTypes:r;return t?!w.lang.array(n).contains(t.nodeType)||e&&e.ignoreBlankTexts&&i(t)?w.dom.domNode(t).next(e):t:null}}},_.dom.getAsDom=(C=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"],function(e,t){var n;return t=t||document,"object"==typeof e&&e.nodeType?(n=t.createElement("div")).appendChild(e):_.browser.supportsHTML5Tags(t)?(n=t.createElement("div")).innerHTML=e:(function(e){if(!e._wysihtml5_supportsHTML5Tags){for(var t=0,n=C.length;t<n;t++)e.createElement(C[t]);e._wysihtml5_supportsHTML5Tags=!0}}(t),n=function(e,t){var n=t.createElement("div");n.style.display="none",t.body.appendChild(n);try{n.innerHTML=e}catch(e){}return t.body.removeChild(n),n}(e,t)),n}),_.dom.getParentElement=function(e,t,n,o){var r,i,a,s,l,c,d,u,f,h,m=t.cssStyle||t.styleRegExp,p=t.className||t.classRegExp;for(n=n||50;n--&&e&&"BODY"!==e.nodeName&&(!o||e!==o);){if(e.nodeType===_.ELEMENT_NODE&&(f=e.nodeName,!(h=t.nodeName)||!h.length||("string"==typeof h?f===h:_.lang.array(h).contains(f)))&&(!m||(l=e,c=t.cssStyle,d=t.styleRegExp,u=(l.getAttribute("style")||"").match(d)||[],c?u[u.length-1]===c:u.length))&&(!p||(r=e,i=t.className,a=t.classRegExp,s=(r.className||"").match(a)||[],i?s[s.length-1]===i:s.length)))return e;e=e.parentNode}return null},_.dom.getStyle=(N={float:"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},x=/\-[a-z]/g,function(d){return{from:function(e){if(e.nodeType===_.ELEMENT_NODE){var t=e.ownerDocument,n=N[d]||d.replace(x,function(e){return e.charAt(1).toUpperCase()}),o=e.style,r=e.currentStyle,i=o[n];if(i)return i;if(r)try{return r[n]}catch(e){}var a,s,l=t.defaultView||t.parentWindow,c=("height"===d||"width"===d)&&"TEXTAREA"===e.nodeName;return l.getComputedStyle?(c&&(a=o.overflow,o.overflow="hidden"),s=l.getComputedStyle(e,null).getPropertyValue(d),c&&(o.overflow=a||""),s):void 0}}}}),_.dom.getTextNodes=function(e,t){var n=[];for(e=e.firstChild;e;e=e.nextSibling)3==e.nodeType?t&&/^\s*$/.test(e.innerText||e.textContent)||n.push(e):n=n.concat(_.dom.getTextNodes(e,t));return n},_.dom.hasElementWithTagName=(E={},S=1,function(e,t){var n,o=((n=e)._wysihtml5_identifier||(n._wysihtml5_identifier=S++))+":"+t,r=E[o];return r||(r=E[o]=e.getElementsByTagName(t)),0<r.length}),R={},A=1,(T=_).dom.hasElementWithClassName=function(e,t){if(!T.browser.supportsNativeGetElementsByClassName())return!!e.querySelector("."+t);var n,o=((n=e)._wysihtml5_identifier||(n._wysihtml5_identifier=A++))+":"+t,r=R[o];return r||(r=R[o]=e.getElementsByClassName(t)),0<r.length},_.dom.insert=function(t){return{after:function(e){e.parentNode.insertBefore(t,e.nextSibling)},before:function(e){e.parentNode.insertBefore(t,e)},into:function(e){e.appendChild(t)}}},_.dom.insertCSS=function(r){return r=r.join("\n"),{into:function(e){var t=e.createElement("style");t.type="text/css",t.styleSheet?t.styleSheet.cssText=r:t.appendChild(e.createTextNode(r));var n=e.querySelector("head link");if(n)n.parentNode.insertBefore(t,n);else{var o=e.querySelector("head");o&&o.appendChild(t)}}}},(I=_).dom.lineBreaks=function(r){function o(e){return"BR"===e.nodeName}function i(e){return!!o(e)||"block"===I.dom.getStyle("display").from(e)}return{add:function(e){var t=r.ownerDocument,n=I.dom.domNode(r).next({ignoreBlankTexts:!0}),o=I.dom.domNode(r).prev({ignoreBlankTexts:!0});n&&!i(n)&&I.dom.insert(t.createElement("br")).after(r),o&&!i(o)&&I.dom.insert(t.createElement("br")).before(r)},remove:function(e){var t=I.dom.domNode(r).next({ignoreBlankTexts:!0}),n=I.dom.domNode(r).prev({ignoreBlankTexts:!0});t&&o(t)&&t.parentNode.removeChild(t),n&&o(n)&&n.parentNode.removeChild(n)}}},_.dom.observe=function(o,r,i){for(var a,e,t=0,n=(r="string"==typeof r?[r]:r).length;t<n;t++)e=r[t],o.addEventListener?o.addEventListener(e,i,!1):(a=function(e){"target"in e||(e.target=e.srcElement),e.preventDefault=e.preventDefault||function(){this.returnValue=!1},e.stopPropagation=e.stopPropagation||function(){this.cancelBubble=!0},i.call(o,e)},o.attachEvent("on"+e,a));return{stop:function(){for(var e,t=0,n=r.length;t<n;t++)e=r[t],o.removeEventListener?o.removeEventListener(e,i,!1):o.detachEvent("on"+e,a)}}},_.dom.parse=function(){var u={1:function(e,t){var n,o,r=E.tags,i=e.nodeName.toLowerCase(),a=e.scopeName;if(e._wysihtml5)return null;if(e._wysihtml5=1,"wysihtml5-temp"===e.className)return null;a&&"HTML"!=a&&(i=a+":"+i);"outerHTML"in e&&(_.browser.autoClosesUnclosedTags()||"P"!==e.nodeName||"</p>"===e.outerHTML.slice(-4).toLowerCase()||(i="div"));if(i in r){if(!(n=r[i])||n.remove)return null;if(n.unwrap)return!1;n="string"==typeof n?{rename_tag:n}:n}else{if(!e.firstChild)return null;n={rename_tag:f}}if(o=e.ownerDocument.createElement(n.rename_tag||i),function(e,t,n,o){var r,i,a,s,l,c,d,u={},f=n.set_class,h=n.add_class,m=n.add_style,p=n.set_attributes,g=n.check_attributes,y=E.classes,v=0,b=[],w=[],C=[],N=[];if(p&&(u=_.lang.object(p).clone()),g)for(s in g)(c=T[g[s]])&&((d=S(e,s))||"alt"===s&&"IMG"==e.nodeName)&&"string"==typeof(l=c(d))&&(u[s]=l);if(f&&b.push(f),h)for(s in h)(c=A[h[s]])&&"string"==typeof(a=c(S(e,s)))&&b.push(a);if(m)for(s in m)(c=R[m[s]])&&(newStyle=c(S(e,s)),"string"==typeof newStyle&&w.push(newStyle));if("string"==typeof y&&"any"===y&&e.getAttribute("class"))u.class=e.getAttribute("class");else{for(o||(y["_wysihtml5-temp-placeholder"]=1,y._rangySelectionBoundary=1,y["wysiwyg-tmp-selected-cell"]=1),(N=e.getAttribute("class"))&&(b=b.concat(N.split(x))),r=b.length;v<r;v++)i=b[v],y[i]&&C.push(i);C.length&&(u.class=_.lang.array(C).unique().join(" "))}for(s in u.class&&o&&(u.class=u.class.replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(u.class)&&delete u.class),w.length&&(u.style=_.lang.array(w).unique().join(" ")),u)try{t.setAttribute(s,u[s])}catch(e){}u.src&&(void 0!==u.width&&t.setAttribute("width",u.width),void 0!==u.height&&t.setAttribute("height",u.height))}(e,o,n,t),function(e,t,n){var o;if(n&&n.keep_styles)for(o in n.keep_styles)n.keep_styles.hasOwnProperty(o)&&("float"==o?(e.style.styleFloat&&(t.style.styleFloat=e.style.styleFloat),e.style.cssFloat&&(t.style.cssFloat=e.style.cssFloat)):e.style[o]&&(t.style[o]=e.style[o]))}(e,o,n),n.one_of_type&&!function(e,t,n,o){var r,i;if("SPAN"===e.nodeName&&!o&&("_wysihtml5-temp-placeholder"===e.className||"rangySelectionBoundary"===e.className))return!0;for(i in n)if(n.hasOwnProperty(i)&&t.type_definitions&&t.type_definitions[i]&&(r=t.type_definitions[i],s(e,r)))return!0;return!1}(e,E,n.one_of_type,t))return(!n.remove_action||"unwrap"!=n.remove_action)&&null;e=null,o.normalize&&o.normalize();return o},3:function(e){var t=e.nextSibling;{if(!t||t.nodeType!==_.TEXT_NODE){var n=e.data.replace(o,"");return e.ownerDocument.createTextNode(n)}t.data=e.data.replace(o,"")+t.data.replace(o,"")}},8:function(e){if(E.comments)return e.ownerDocument.createComment(e.nodeValue)}},f="span",x=/\s+/,c={tags:{},classes:{}},E={},h=!1;function m(e,t,n){var o,r,i,a=e.nodeType,s=e.childNodes,l=s.length,c=u[a],d=0;if(h&&1===a&&_.dom.hasClass(e,h))return e;if(!(r=c&&c(e,n))){if(!1===r){for(o=e.ownerDocument.createDocumentFragment(),d=l;d--;)s[d]&&(i=m(s[d],t,n))&&(s[d]===i&&d--,o.insertBefore(i,o.firstChild));return _.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(e.nodeName.toLowerCase())&&e.parentNode.lastChild!==e&&(e.nextSibling&&3===e.nextSibling.nodeType&&/^\s/.test(e.nextSibling.nodeValue)||o.appendChild(e.ownerDocument.createTextNode(" "))),o.normalize&&o.normalize(),o}return null}for(d=0;d<l;d++)s[d]&&(i=m(s[d],t,n))&&(s[d]===i&&d--,r.appendChild(i));if(t&&r.nodeName.toLowerCase()===f&&(!r.childNodes.length||/^\s*$/gi.test(r.innerHTML)&&(n||"_wysihtml5-temp-placeholder"!==e.className&&"rangySelectionBoundary"!==e.className)||!r.attributes.length)){for(o=r.ownerDocument.createDocumentFragment();r.firstChild;)o.appendChild(r.firstChild);return o.normalize&&o.normalize(),o}return r.normalize&&r.normalize(),r}function s(e,t){var n,o,r,i,a,s=e.getAttribute("class"),l=e.getAttribute("style");if(t.methods)for(var c in t.methods)if(t.methods.hasOwnProperty(c)&&C[c]&&C[c](e))return!0;if(s&&t.classes){n=(s=s.replace(/^\s+/g,"").replace(/\s+$/g,"").split(x)).length;for(var d=0;d<n;d++)if(t.classes[s[d]])return!0}if(l&&t.styles)for(o in l=l.split(";"),t.styles)if(t.styles.hasOwnProperty(o))for(var u=l.length;u--;)if((a=l[u].split(":"))[0].replace(/\s/g,"").toLowerCase()===o&&(!0===t.styles[o]||1===t.styles[o]||_.lang.array(t.styles[o]).contains(a[1].replace(/\s/g,"").toLowerCase())))return!0;if(t.attrs)for(r in t.attrs)if(t.attrs.hasOwnProperty(r)&&"string"==typeof(i=S(e,r))&&-1<i.search(t.attrs[r]))return!0;return!1}var n=!_.browser.supportsGetAttributeCorrectly();function S(e,t){return t=t.toLowerCase(),"IMG"==e.nodeName&&"src"==t&&!0===function(t){try{return t.complete&&!t.mozMatchesSelector(":-moz-broken")}catch(e){if(t.complete&&"complete"===t.readyState)return!0}}(e)?e.src:n&&"outerHTML"in e?-1!=e.outerHTML.toLowerCase().indexOf(" "+t+"=")?e.getAttribute(t):null:e.getAttribute(t)}var o=/\uFEFF/g;var t,r,i,a,l,d,p,g,y,v,b,w,T={url:(l=/^https?:\/\//i,function(e){return e&&e.match(l)?e.replace(l,function(e){return e.toLowerCase()}):null}),src:(a=/^(\/|https?:\/\/)/i,function(e){return e&&e.match(a)?e.replace(a,function(e){return e.toLowerCase()}):null}),href:(i=/^(#|\/|https?:\/\/|mailto:)/i,function(e){return e&&e.match(i)?e.replace(i,function(e){return e.toLowerCase()}):null}),alt:(r=/[^ a-z0-9_\-]/gi,function(e){return e?e.replace(r,""):""}),numbers:(t=/\D/g,function(e){return(e=(e||"").replace(t,""))||null}),any:function(e){return e}},R={align_text:(d={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"},function(e){return d[String(e).toLowerCase()]})},A={align_img:(v={left:"wysiwyg-float-left",right:"wysiwyg-float-right"},function(e){return v[String(e).toLowerCase()]}),align_text:(y={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"},function(e){return y[String(e).toLowerCase()]}),clear_br:(g={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"},function(e){return g[String(e).toLowerCase()]}),size_font:(p={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"},function(e){return p[String(e).charAt(0)]})},C={has_visible_contet:(w=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"],function(e){if((b=(e.innerText||e.textContent).replace(/\s/g,""))&&0<b.length)return!0;for(var t=w.length;t--;)if(e.querySelector(w[t]))return!0;return!!(e.offsetWidth&&0<e.offsetWidth&&e.offsetHeight&&0<e.offsetHeight)})};return function(e,t){_.lang.object(E).merge(c).merge(t.rules).get();var n,o,r,i=t.context||e.ownerDocument||document,a=i.createDocumentFragment(),s="string"==typeof e,l=!1;for(!0===t.clearInternals&&(l=!0),t.uneditableClass&&(h=t.uneditableClass),n=s?_.dom.getAsDom(e,i):e;n.firstChild;)(o=m(r=n.firstChild,t.cleanUp,l))&&a.appendChild(o),r!==o&&n.removeChild(r);return n.innerHTML="",n.appendChild(a),s?_.quirks.getCorrectInnerHTML(n):n}}(),_.dom.removeEmptyTextNodes=function(e){for(var t,n=_.lang.array(e.childNodes).get(),o=n.length,r=0;r<o;r++)(t=n[r]).nodeType===_.TEXT_NODE&&""===t.data&&t.parentNode.removeChild(t)},_.dom.renameElement=function(e,t){for(var n,o=e.ownerDocument.createElement(t);n=e.firstChild;)o.appendChild(n);return _.dom.copyAttributes(["align","className"]).from(e).to(o),e.parentNode.replaceChild(o,e),o},_.dom.replaceWithChildNodes=function(e){if(e.parentNode)if(e.firstChild){for(var t=e.ownerDocument.createDocumentFragment();e.firstChild;)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e),e=t=null}else e.parentNode.removeChild(e)},function(t){function d(e){return"block"===t.getStyle("display").from(e)}function u(e){return"BR"===e.nodeName}function f(e){var t=e.ownerDocument.createElement("br");e.appendChild(t)}t.resolveList=function(e,t){if(e.nodeName.match(/^(MENU|UL|OL)$/)){var n,o,r,i,a,s=e.ownerDocument,l=s.createDocumentFragment(),c=_.dom.domNode(e).prev({ignoreBlankTexts:!0});if(t)for(!c||d(c)||u(c)||f(l);a=e.firstElementChild||e.firstChild;){for(o=a.lastChild;n=a.firstChild;)r=n===o&&!d(n)&&!u(n),l.appendChild(n),r&&f(l);a.parentNode.removeChild(a)}else for(;a=e.firstElementChild||e.firstChild;){if(a.querySelector&&a.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;n=a.firstChild;)l.appendChild(n);else{for(i=s.createElement("p");n=a.firstChild;)i.appendChild(n);l.appendChild(i)}a.parentNode.removeChild(a)}e.parentNode.replaceChild(l,e)}}}(_.dom),O=_,L=document,k=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],D=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],M=["referrer","write","open","close"],O.dom.Sandbox=Ot.extend({constructor:function(e,t){this.callback=e||O.EMPTY_FUNCTION,this.config=O.lang.object({}).merge(t).get(),this.editableArea=this._createIframe()},insertInto:function(e){"string"==typeof e&&(e=L.getElementById(e)),e.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var e=this.getIframe();e.parentNode.removeChild(e)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var e=this,t=L.createElement("iframe");return t.className="wysihtml5-sandbox",O.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(t),O.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(t.src="javascript:'<html></html>'"),t.onload=function(){t.onreadystatechange=t.onload=null,e._onLoadIframe(t)},t.onreadystatechange=function(){/loaded|complete/.test(t.readyState)&&(t.onreadystatechange=t.onload=null,e._onLoadIframe(t))},t},_onLoadIframe:function(e){if(O.dom.contains(L.documentElement,e)){var t=this,n=e.contentWindow,o=e.contentWindow.document,r=L.characterSet||L.charset||"utf-8",i=this._getHtml({charset:r,stylesheets:this.config.stylesheets});if(o.open("text/html","replace"),o.write(i),o.close(),this.getWindow=function(){return e.contentWindow},this.getDocument=function(){return e.contentWindow.document},n.onerror=function(e,t,n){throw new Error("wysihtml5.Sandbox: "+e,t,n)},!O.browser.supportsSandboxedIframes()){var a,s;for(a=0,s=k.length;a<s;a++)this._unset(n,k[a]);for(a=0,s=D.length;a<s;a++)this._unset(n,D[a],O.EMPTY_FUNCTION);for(a=0,s=M.length;a<s;a++)this._unset(o,M[a]);this._unset(o,"cookie","",!0)}this.loaded=!0,setTimeout(function(){t.callback(t)},0)}},_getHtml:function(e){var t,n=e.stylesheets,o="",r=0;if(n="string"==typeof n?[n]:n)for(t=n.length;r<t;r++)o+='<link rel="stylesheet" href="'+n[r]+'">';return e.stylesheets=o,O.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(e)},_unset:function(e,t,n,o){try{e[t]=n}catch(e){}try{e.__defineGetter__(t,function(){return n})}catch(e){}if(o)try{e.__defineSetter__(t,function(){})}catch(e){}if(!O.browser.crashesWhenDefineProperty(t))try{var r={get:function(){return n}};o&&(r.set=function(){}),Object.defineProperty(e,t,r)}catch(e){}}}),B=_,P=document,B.dom.ContentEditableArea=Ot.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView},getDocument:function(){return this.element.ownerDocument},constructor:function(e,t,n){this.callback=e||B.EMPTY_FUNCTION,this.config=B.lang.object({}).merge(t).get(),this.element=n?this._bindElement(n):this._createElement()},_createElement:function(){var e=P.createElement("div");return e.className="wysihtml5-sandbox",this._loadElement(e),e},_bindElement:function(e){return e.className=e.className&&""!=e.className?e.className+" wysihtml5-sandbox":"wysihtml5-sandbox",this._loadElement(e,!0),e},_loadElement:function(e,t){var n=this;if(!t){var o=this._getHtml();e.innerHTML=o}this.getWindow=function(){return e.ownerDocument.defaultView},this.getDocument=function(){return e.ownerDocument},this.loaded=!0,setTimeout(function(){n.callback(n)},0)},_getHtml:function(e){return""}}),H={className:"class"},_.dom.setAttributes=function(n){return{on:function(e){for(var t in n)e.setAttribute(H[t]||t,n[t])}}},_.dom.setStyles=function(o){return{on:function(e){var t=e.style;if("string"!=typeof o)for(var n in o)"float"===n?(t.cssFloat=o[n],t.styleFloat=o[n]):t[n]=o[n];else t.cssText+=";"+o}}},(z=_.dom).simulatePlaceholder=function(e,t,n){var o="placeholder",r=function(){var e=0<t.element.offsetWidth&&0<t.element.offsetHeight;t.hasPlaceholderSet()&&(t.clear(),t.element.focus(),e&&setTimeout(function(){var e=t.selection.getSelection();e.focusNode&&e.anchorNode||t.selection.selectNode(t.element.firstChild||t.element)},0)),t.placeholderSet=!1,z.removeClass(t.element,o)},i=function(){t.isEmpty()&&(t.placeholderSet=!0,t.setValue(n),z.addClass(t.element,o))};e.on("set_placeholder",i).on("unset_placeholder",r).on("focus:composer",r).on("paste:composer",r).on("blur:composer",i),i()},q=_.dom,"textContent"in(V=document.documentElement)?(q.setTextContent=function(e,t){e.textContent=t},q.getTextContent=function(e){return e.textContent}):"innerText"in V?(q.setTextContent=function(e,t){e.innerText=t},q.getTextContent=function(e){return e.innerText}):(q.setTextContent=function(e,t){e.nodeValue=t},q.getTextContent=function(e){return e.nodeValue}),_.dom.getAttribute=function(e,t){var n=!_.browser.supportsGetAttributeCorrectly();return t=t.toLowerCase(),"IMG"==e.nodeName&&"src"==t&&!0===_isLoadedImage(e)?e.src:n&&"outerHTML"in e?-1!=e.outerHTML.toLowerCase().indexOf(" "+t+"=")?e.getAttribute(t):null:e.getAttribute(t)},function(r){var u=r.dom,f=function(e){this.el=e,this.isColspan=!1,this.isRowspan=!1,this.firstCol=!0,this.lastCol=!0,this.firstRow=!0,this.lastRow=!0,this.isReal=!0,this.spanCollection=[],this.modified=!1},n=function(e,t){e?(this.cell=e,this.table=u.getParentElement(e,{nodeName:["TABLE"]})):t&&(this.table=t,this.cell=this.table.querySelectorAll("th, td")[0])};function i(e,t){for(var n,o=[],r=0,i=e.length;r<i;r++)if(n=e[r].querySelectorAll(t))for(var a=n.length;a--;o.unshift(n[a]));return o}function l(e){e.parentNode.removeChild(e)}function h(e,t){e.parentNode.insertBefore(t,e.nextSibling)}function m(e,t){for(var n=e.nextSibling;1!=n.nodeType;)if(n=n.nextSibling,!t||t==n.tagName.toLowerCase())return n;return null}n.prototype={addSpannedCellToMap:function(e,t,n,o,r,i){for(var a=[],s=n+(i?parseInt(i,10)-1:0),l=o+(r?parseInt(r,10)-1:0),c=n;c<=s;c++){void 0===t[c]&&(t[c]=[]);for(var d=o;d<=l;d++)t[c][d]=new f(e),t[c][d].isColspan=r&&1<parseInt(r,10),t[c][d].isRowspan=i&&1<parseInt(i,10),t[c][d].firstCol=d==o,t[c][d].lastCol=d==l,t[c][d].firstRow=c==n,t[c][d].lastRow=c==s,t[c][d].isReal=d==o&&c==n,(t[c][d].spanCollection=a).push(t[c][d])}},setCellAsModified:function(e){if(e.modified=!0,0<e.spanCollection.length)for(var t=0,n=e.spanCollection.length;t<n;t++)e.spanCollection[t].modified=!0},setTableMap:function(){var e,t,n,o,r,i,a,s,l=[],c=this.getTableRows();for(e=0;e<c.length;e++)for(t=c[e],n=this.getRowCells(t),void(i=0)===l[e]&&(l[e]=[]),o=0;o<n.length;o++){for(r=n[o];void 0!==l[e][i];)i++;a=u.getAttribute(r,"colspan"),s=u.getAttribute(r,"rowspan"),a||s?(this.addSpannedCellToMap(r,l,e,i,a,s),i+=a?parseInt(a,10):1):(l[e][i]=new f(r),i++)}return this.map=l},getRowCells:function(e){var t=this.table.querySelectorAll("table"),n=t?i(t,"th, td"):[],o=e.querySelectorAll("th, td");return 0<n.length?r.lang.array(o).without(n):o},getTableRows:function(){var e=this.table.querySelectorAll("table"),t=e?i(e,"tr"):[],n=this.table.querySelectorAll("tr");return 0<t.length?r.lang.array(n).without(t):n},getMapIndex:function(e){for(var t=this.map.length,n=this.map&&this.map[0]?this.map[0].length:0,o=0;o<t;o++)for(var r=0;r<n;r++)if(this.map[o][r].el===e)return{row:o,col:r};return!1},getElementAtIndex:function(e){return this.setTableMap(),this.map[e.row]&&this.map[e.row][e.col]&&this.map[e.row][e.col].el?this.map[e.row][e.col].el:null},getMapElsTo:function(e){var t=[];if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(e),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var n=this.idx_start;this.idx_start=this.idx_end,this.idx_end=n}if(this.idx_start.col>this.idx_end.col){var o=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=o}if(null!=this.idx_start&&null!=this.idx_end)for(var r=this.idx_start.row,i=this.idx_end.row;r<=i;r++)for(var a=this.idx_start.col,s=this.idx_end.col;a<=s;a++)t.push(this.map[r][a].el);return t},orderSelectionEnds:function(e){if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(e),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var t=this.idx_start;this.idx_start=this.idx_end,this.idx_end=t}if(this.idx_start.col>this.idx_end.col){var n=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=n}return{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(e,t,n){for(var o,r=this.table.ownerDocument,i=r.createDocumentFragment(),a=0;a<t;a++){if(o=r.createElement(e),n)for(var s in n)n.hasOwnProperty(s)&&o.setAttribute(s,n[s]);o.appendChild(document.createTextNode(" ")),i.appendChild(o)}return i},correctColIndexForUnreals:function(e,t){for(var n=this.map[t],o=-1,r=0;r<e;r++)n[r].isReal&&o++;return o},getLastNewCellOnRow:function(e,t){for(var n,o,r=this.getRowCells(e),i=0,a=r.length;i<a;i++)if(n=r[i],!1===(o=this.getMapIndex(n))||void 0!==t&&o.row!=t)return n;return null},removeEmptyTable:function(){var e=this.table.querySelectorAll("td, th");return(!e||0==e.length)&&(l(this.table),!0)},splitRowToCells:function(e){if(e.isColspan){var t=parseInt(u.getAttribute(e.el,"colspan")||1,10),n=e.el.tagName.toLowerCase();if(1<t){var o=this.createCells(n,t-1);h(e.el,o)}e.el.removeAttribute("colspan")}},getRealRowEl:function(e,t){var n=null,o=null;t=t||this.idx;for(var r=0,i=this.map[t.row].length;r<i;r++)if((o=this.map[t.row][r]).isReal&&(n=u.getParentElement(o.el,{nodeName:["TR"]})))return n;return null===n&&e&&(n=u.getParentElement(this.map[t.row][t.col].el,{nodeName:["TR"]})||null),n},injectRowAt:function(e,t,n,o,r){var i=this.getRealRowEl(!1,{row:e,col:t}),a=this.createCells(o,n);if(i){var s=this.correctColIndexForUnreals(t,e);0<=s?h(this.getRowCells(i)[s],a):i.insertBefore(a,i.firstChild)}else{var l=this.table.ownerDocument.createElement("tr");l.appendChild(a),h(u.getParentElement(r.el,{nodeName:["TR"]}),l)}},canMerge:function(e){if(this.to=e,this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(this.to),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var t=this.idx_start;this.idx_start=this.idx_end,this.idx_end=t}if(this.idx_start.col>this.idx_end.col){var n=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=n}for(var o=this.idx_start.row,r=this.idx_end.row;o<=r;o++)for(var i=this.idx_start.col,a=this.idx_end.col;i<=a;i++)if(this.map[o][i].isColspan||this.map[o][i].isRowspan)return!1;return!0},decreaseCellSpan:function(e,t){var n=parseInt(u.getAttribute(e.el,t),10)-1;1<=n?e.el.setAttribute(t,n):(e.el.removeAttribute(t),"colspan"==t&&(e.isColspan=!1),"rowspan"==t&&(e.isRowspan=!1),e.firstCol=!0,e.lastCol=!0,e.firstRow=!0,e.lastRow=!0,e.isReal=!0)},removeSurplusLines:function(){var e,t,n,o,r,i,a;if(this.setTableMap(),this.map){for(n=0,o=this.map.length;n<o;n++){for(a=!0,r=0,i=(e=this.map[n]).length;r<i;r++)if(t=e[r],!(u.getAttribute(t.el,"rowspan")&&1<parseInt(u.getAttribute(t.el,"rowspan"),10)&&!0!==t.firstRow)){a=!1;break}if(a)for(r=0;r<i;r++)this.decreaseCellSpan(e[r],"rowspan")}var s=this.getTableRows();for(n=0,o=s.length;n<o;n++)0==(e=s[n]).childNodes.length&&/^\s*$/.test(e.textContent||e.innerText)&&l(e)}},fillMissingCells:function(){var e=0,t=0,n=null;if(this.setTableMap(),this.map){e=this.map.length;for(var o=0;o<e;o++)this.map[o].length>t&&(t=this.map[o].length);for(var r=0;r<e;r++)for(var i=0;i<t;i++)this.map[r]&&!this.map[r][i]&&0<i&&(this.map[r][i]=new f(this.createCells("td",1)),(n=this.map[r][i-1])&&n.el&&n.el.parent&&h(this.map[r][i-1].el,this.map[r][i].el))}},rectify:function(){return!this.removeEmptyTable()&&(this.removeSurplusLines(),this.fillMissingCells(),!0)},unmerge:function(){if(this.rectify()&&(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx)){var e=this.map[this.idx.row][this.idx.col],t=u.getAttribute(e.el,"colspan")?parseInt(u.getAttribute(e.el,"colspan"),10):1,n=e.el.tagName.toLowerCase();if(e.isRowspan){var o=parseInt(u.getAttribute(e.el,"rowspan"),10);if(1<o)for(var r=1,i=o-1;r<=i;r++)this.injectRowAt(this.idx.row+r,this.idx.col,t,n,e);e.el.removeAttribute("rowspan")}this.splitRowToCells(e)}},merge:function(e){if(this.rectify())if(this.canMerge(e)){for(var t=this.idx_end.row-this.idx_start.row+1,n=this.idx_end.col-this.idx_start.col+1,o=this.idx_start.row,r=this.idx_end.row;o<=r;o++)for(var i=this.idx_start.col,a=this.idx_end.col;i<=a;i++)o==this.idx_start.row&&i==this.idx_start.col?(1<t&&this.map[o][i].el.setAttribute("rowspan",t),1<n&&this.map[o][i].el.setAttribute("colspan",n)):(/^\s*<br\/?>\s*$/.test(this.map[o][i].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[o][i].el.innerHTML),l(this.map[o][i].el));this.rectify()}else window.console&&console.log("Do not know how to merge allready merged cells.")},collapseCellToNextRow:function(e){var t=this.getMapIndex(e.el),n=t.row+1,o={row:n,col:t.col};if(n<this.map.length){var r=this.getRealRowEl(!1,o);if(null!==r){var i=this.correctColIndexForUnreals(o.col,o.row);if(0<=i)h(this.getRowCells(r)[i],e.el);else{var a=this.getLastNewCellOnRow(r,n);null!==a?h(a,e.el):r.insertBefore(e.el,r.firstChild)}2<parseInt(u.getAttribute(e.el,"rowspan"),10)?e.el.setAttribute("rowspan",parseInt(u.getAttribute(e.el,"rowspan"),10)-1):e.el.removeAttribute("rowspan")}}},removeRowCell:function(e){e.isReal?e.isRowspan?this.collapseCellToNextRow(e):l(e.el):2<parseInt(u.getAttribute(e.el,"rowspan"),10)?e.el.setAttribute("rowspan",parseInt(u.getAttribute(e.el,"rowspan"),10)-1):e.el.removeAttribute("rowspan")},getRowElementsByCell:function(){var e=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(var t=this.map[this.idx.row],n=0,o=t.length;n<o;n++)t[n].isReal&&e.push(t[n].el);return e},getColumnElementsByCell:function(){var e=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(var t=0,n=this.map.length;t<n;t++)this.map[t][this.idx.col]&&this.map[t][this.idx.col].isReal&&e.push(this.map[t][this.idx.col].el);return e},removeRow:function(){var e=u.getParentElement(this.cell,{nodeName:["TR"]});if(e){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(var t=this.map[this.idx.row],n=0,o=t.length;n<o;n++)t[n].modified||(this.setCellAsModified(t[n]),this.removeRowCell(t[n]));l(e)}},removeColCell:function(e){e.isColspan?2<parseInt(u.getAttribute(e.el,"colspan"),10)?e.el.setAttribute("colspan",parseInt(u.getAttribute(e.el,"colspan"),10)-1):e.el.removeAttribute("colspan"):e.isReal&&l(e.el)},removeColumn:function(){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(var e=0,t=this.map.length;e<t;e++)this.map[e][this.idx.col].modified||(this.setCellAsModified(this.map[e][this.idx.col]),this.removeColCell(this.map[e][this.idx.col]))},remove:function(e){if(this.rectify()){switch(e){case"row":this.removeRow();break;case"column":this.removeColumn()}this.rectify()}},addRow:function(e){var t=this.table.ownerDocument;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"below"==e&&u.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(u.getAttribute(this.cell,"rowspan"),10)-1),!1!==this.idx){for(var n=this.map[this.idx.row],o=t.createElement("tr"),r=0,i=n.length;r<i;r++)n[r].modified||(this.setCellAsModified(n[r]),this.addRowCell(n[r],o,e));switch(e){case"below":h(this.getRealRowEl(!0),o);break;case"above":var a=u.getParentElement(this.map[this.idx.row][this.idx.col].el,{nodeName:["TR"]});a&&a.parentNode.insertBefore(o,a)}}},addRowCell:function(e,t,n){var o=e.isColspan?{colspan:u.getAttribute(e.el,"colspan")}:null;e.isReal?"above"!=n&&e.isRowspan?e.el.setAttribute("rowspan",parseInt(u.getAttribute(e.el,"rowspan"),10)+1):t.appendChild(this.createCells("td",1,o)):"above"!=n&&e.isRowspan&&e.lastRow?t.appendChild(this.createCells("td",1,o)):c.isRowspan&&e.el.attr("rowspan",parseInt(u.getAttribute(e.el,"rowspan"),10)+1)},add:function(e){this.rectify()&&("below"!=e&&"above"!=e||this.addRow(e),"before"!=e&&"after"!=e||this.addColumn(e))},addColCell:function(e,t,n){var o,r=e.el.tagName.toLowerCase();switch(n){case"before":o=!e.isColspan||e.firstCol;break;case"after":o=!e.isColspan||e.lastCol||e.isColspan&&c.el==this.cell}if(o){switch(n){case"before":e.el.parentNode.insertBefore(this.createCells(r,1),e.el);break;case"after":h(e.el,this.createCells(r,1))}e.isRowspan&&this.handleCellAddWithRowspan(e,t+1,n)}else e.el.setAttribute("colspan",parseInt(u.getAttribute(e.el,"colspan"),10)+1)},addColumn:function(e){var t,n;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"after"==e&&u.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(u.getAttribute(this.cell,"colspan"),10)-1),!1!==this.idx)for(var o=0,r=this.map.length;o<r;o++)(t=this.map[o])[this.idx.col]&&((n=t[this.idx.col]).modified||(this.setCellAsModified(n),this.addColCell(n,o,e)))},handleCellAddWithRowspan:function(e,t,n){for(var o,r,i,a=parseInt(u.getAttribute(this.cell,"rowspan"),10)-1,s=u.getParentElement(e.el,{nodeName:["TR"]}),l=e.el.tagName.toLowerCase(),c=this.table.ownerDocument,d=0;d<a;d++)if(o=this.correctColIndexForUnreals(this.idx.col,t+d),s=m(s,"tr"))if(0<o)switch(n){case"before":r=this.getRowCells(s),0<o&&this.map[t+d][this.idx.col].el!=r[o]&&o==r.length-1?h(r[o],this.createCells(l,1)):r[o].parentNode.insertBefore(this.createCells(l,1),r[o]);break;case"after":h(this.getRowCells(s)[o],this.createCells(l,1))}else s.insertBefore(this.createCells(l,1),s.firstChild);else(i=c.createElement("tr")).appendChild(this.createCells(l,1)),this.table.appendChild(i)}},u.table={getCellsBetween:function(e,t){return new n(e).getMapElsTo(t)},addCells:function(e,t){new n(e).add(t)},removeCells:function(e,t){new n(e).remove(t)},mergeCellsBetween:function(e,t){new n(e).merge(t)},unmergeCell:function(e){new n(e).unmerge()},orderSelectionEnds:function(e,t){return new n(e).orderSelectionEnds(t)},indexOf:function(e){var t=new n(e);return t.setTableMap(),t.getMapIndex(e)},findCell:function(e,t){return new n(null,e).getElementAtIndex(t)},findRowByCell:function(e){return new n(e).getRowElementsByCell()},findColumnByCell:function(e){return new n(e).getColumnElementsByCell()},canMerge:function(e,t){return new n(e).canMerge(t)}}}(_),_.dom.query=function(e,t){var n,o=[];e.nodeType&&(e=[e]);for(var r=0,i=e.length;r<i;r++)if(n=e[r].querySelectorAll(t))for(var a=n.length;a--;o.unshift(n[a]));return o},_.dom.compareDocumentPosition=document.documentElement.compareDocumentPosition?function(e,t){return e.compareDocumentPosition(t)}:function(e,t){var n,o;if(n=9===e.nodeType?e:e.ownerDocument,o=9===t.nodeType?t:t.ownerDocument,e===t)return 0;if(e===t.ownerDocument)return 20;if(e.ownerDocument===t)return 10;if(n!==o)return 1;if(2===e.nodeType&&e.childNodes&&-1!==_.lang.array(e.childNodes).indexOf(t))return 20;if(2===t.nodeType&&t.childNodes&&-1!==_.lang.array(t.childNodes).indexOf(e))return 10;for(var r=e,i=[],a=null;r;){if(r==t)return 10;i.push(r),r=r.parentNode}for(r=t,a=null;r;){if(r==e)return 20;var s=_.lang.array(i).indexOf(r);if(-1!==s){var l=i[s],c=_.lang.array(l.childNodes).indexOf(i[s-1]);return _.lang.array(l.childNodes).indexOf(a)<c?2:4}r=(a=r).parentNode}return 1},_.dom.unwrap=function(e){if(e.parentNode){for(;e.lastChild;)_.dom.insert(e.lastChild).after(e);e.parentNode.removeChild(e)}},_.quirks.cleanPastedHTML=(W={"a u":_.dom.replaceWithChildNodes},function(e,t,n){t=t||W,n=n||e.ownerDocument||document;var o,r,i,a,s,l,c="string"==typeof e,d=0;for(s in o=c?_.dom.getAsDom(e,n):e,t)for(i=o.querySelectorAll(s),r=t[s],a=i.length;d<a;d++)r(i[d]);var u=_.dom.getTextNodes(o);for(l=u.length;l--;)u[l].nodeValue=u[l].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ");return i=e=t=null,c?o.innerHTML:o}),_.quirks.ensureProperClearing=(U=function(){var t=this;setTimeout(function(){var e=t.innerHTML.toLowerCase();"<p>&nbsp;</p>"!=e&&"<p>&nbsp;</p><p>&nbsp;</p>"!=e||(t.innerHTML="")},0)},function(e){_.dom.observe(e.element,["cut","keydown"],U)}),(j=_).quirks.getCorrectInnerHTML=function(e){var t=e.innerHTML;if(-1===t.indexOf("%7E"))return t;var n,o,r,i,a=e.querySelectorAll("[href*='~'], [src*='~']");for(i=0,r=a.length;i<r;i++)n=a[i].href||a[i].src,o=j.lang.string(n).replace("~").by("%7E"),t=j.lang.string(t).replace(o).by(n);return t},K="wysihtml5-quirks-redraw",(F=_).quirks.redraw=function(e){F.dom.addClass(e,K),F.dom.removeClass(e,K);try{var t=e.ownerDocument;t.execCommand("italic",!1,null),t.execCommand("italic",!1,null)}catch(e){}},_.quirks.tableCellsSelection=function(o,r){var i=_.dom,a={table:null,start:null,end:null,cells:null,select:function(e,t){a.start=e,a.end=t,a.table=i.getParentElement(a.start,{nodeName:["TABLE"]}),selectedCells=i.table.getCellsBetween(a.start,a.end),u(selectedCells),n(),r.fire("tableselect").fire("tableselect:composer")}},s="wysiwyg-tmp-selected-cell",l=null,c=null;function d(){if(o){var e=o.querySelectorAll("."+s);if(0<e.length)for(var t=0;t<e.length;t++)i.removeClass(e[t],s)}}function u(e){for(var t=0;t<e.length;t++)i.addClass(e[t],s)}function f(e){var t,n=null,o=i.getParentElement(e.target,{nodeName:["TD","TH"]});o&&a.table&&a.start&&(n=i.getParentElement(o,{nodeName:["TABLE"]}))&&n===a.table&&(d(),t=a.end,a.end=o,a.cells=i.table.getCellsBetween(a.start,o),1<a.cells.length&&r.composer.selection.deselect(),u(a.cells),a.end!==t&&r.fire("tableselectchange").fire("tableselectchange:composer"))}function h(e){l.stop(),c.stop(),r.fire("tableselect").fire("tableselect:composer"),setTimeout(function(){n()},0)}function n(){var t=i.observe(o.ownerDocument,"click",function(e){t.stop(),i.getParentElement(e.target,{nodeName:["TABLE"]})!=a.table&&(d(),a.table=null,a.start=null,a.end=null,r.fire("tableunselect").fire("tableunselect:composer"))})}return i.observe(o,"mousedown",function(e){var t,n=_.dom.getParentElement(e.target,{nodeName:["TD","TH"]});n&&(t=n,a.start=t,a.end=t,a.cells=[t],a.table=i.getParentElement(a.start,{nodeName:["TABLE"]}),a.table&&(d(),i.addClass(t,s),l=i.observe(o,"mousemove",f),c=i.observe(o,"mouseup",h),r.fire("tableselectstart").fire("tableselectstart:composer")))}),a},$=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,X=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,Y=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,Q=/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,Z=function(e){return new RegExp("(^|\\s|;)"+e+"\\s*:\\s*[^;$]+","gi")},(G=_).quirks.styleParser={parseColor:function(e,t){var n,o,r=Z(t),i=e.match(r),a=10;if(i){for(var s=i.length;s--;)i[s]=G.lang.string(i[s].split(":")[1]).trim();if(n=i[i.length-1],$.test(n))o=n.match($);else if(X.test(n))o=n.match(X);else if(Y.test(n))o=n.match(Y),a=16;else if(Q.test(n))return(o=n.match(Q)).shift(),o.push(1),G.lang.array(o).map(function(e,t){return t<3?16*parseInt(e,16)+parseInt(e,16):parseFloat(e)});if(o)return o.shift(),o[3]||o.push(1),G.lang.array(o).map(function(e,t){return t<3?parseInt(e,a):parseFloat(e)})}return!1},unparseColor:function(e,t){if(t){if("hex"==t)return e[0].toString(16).toUpperCase()+e[1].toString(16).toUpperCase()+e[2].toString(16).toUpperCase();if("hash"==t)return"#"+e[0].toString(16).toUpperCase()+e[1].toString(16).toUpperCase()+e[2].toString(16).toUpperCase();if("rgb"==t)return"rgb("+e[0]+","+e[1]+","+e[2]+")";if("rgba"==t)return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")";if("csv"==t)return e[0]+","+e[1]+","+e[2]+","+e[3]}return e[3]&&1!==e[3]?"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")":"rgb("+e[0]+","+e[1]+","+e[2]+")"},parseFontSize:function(e){var t=e.match(Z("font-size"));return!!t&&G.lang.string(t[t.length-1].split(":")[1]).trim()}},function(y){var v=y.dom;function r(e,t){for(var n=0;t!==e;)if(n++,!(t=t.parentNode))throw new Error("not a descendant of ancestor!");return n}function t(e){if(!e.canSurroundContents())for(var t=e.commonAncestorContainer,n=r(t,e.startContainer),o=r(t,e.endContainer);!e.canSurroundContents();)o<n?(e.setStartBefore(e.startContainer),n=r(t,e.startContainer)):(e.setEndAfter(e.endContainer),o=r(t,e.endContainer))}y.Selection=Ot.extend({constructor:function(e,t,n){window.rangy.init(),this.editor=e,this.composer=e.composer,this.doc=this.composer.doc,this.contain=t,this.unselectableClass=n||!1},getBookmark:function(){var e=this.getRange();return e&&t(e),e&&e.cloneRange()},setBookmark:function(e){e&&this.setSelection(e)},setBefore:function(e){var t=rangy.createRange(this.doc);return t.setStartBefore(e),t.setEndBefore(e),this.setSelection(t)},setAfter:function(e){var t=rangy.createRange(this.doc);return t.setStartAfter(e),t.setEndAfter(e),this.setSelection(t)},selectNode:function(e,t){var n=rangy.createRange(this.doc),o=e.nodeType===y.ELEMENT_NODE,r="canHaveHTML"in e?e.canHaveHTML:"IMG"!==e.nodeName,i=o?e.innerHTML:e.data,a=""===i||i===y.INVISIBLE_SPACE,s=v.getStyle("display").from(e),l="block"===s||"list-item"===s;if(a&&o&&r&&!t)try{e.innerHTML=y.INVISIBLE_SPACE}catch(e){}r?n.selectNodeContents(e):n.selectNode(e),r&&a&&o?n.collapse(l):r&&a&&(n.setStartAfter(e),n.setEndAfter(e)),this.setSelection(n)},getSelectedNode:function(e){var t,n;return e&&this.doc.selection&&"Control"===this.doc.selection.type&&(n=this.doc.selection.createRange())&&n.length?n.item(0):(t=this.getSelection(this.doc)).focusNode===t.anchorNode?t.focusNode:(n=this.getRange(this.doc))?n.commonAncestorContainer:this.doc.body},fixSelBorders:function(){var e=this.getRange();t(e),this.setSelection(e)},getSelectedOwnNodes:function(e){for(var t=this.getOwnRanges(),n=[],o=0,r=t.length;o<r;o++)n.push(t[o].commonAncestorContainer||this.doc.body);return n},findNodesInSelection:function(t){for(var e,n=this.getOwnRanges(),o=[],r=0,i=n.length;r<i;r++)e=n[r].getNodes([1],function(e){return y.lang.array(t).contains(e.nodeName)}),o=o.concat(e);return o},containsUneditable:function(){for(var e=this.getOwnUneditables(),t=this.getSelection(),n=0,o=e.length;n<o;n++)if(t.containsNode(e[n]))return!0;return!1},deleteContents:function(){for(var e=this.getOwnRanges(),t=e.length;t--;)e[t].deleteContents();this.setSelection(e[0])},getPreviousNode:function(e,t){e||(e=this.getSelection().anchorNode);if(e===this.contain)return!1;var n,o=e.previousSibling;return o!==this.contain&&(o&&3!==o.nodeType&&1!==o.nodeType?o=this.getPreviousNode(o,t):o&&3===o.nodeType&&/^\s*$/.test(o.textContent)?o=this.getPreviousNode(o,t):t&&o&&1===o.nodeType&&!y.lang.array(["BR","HR","IMG"]).contains(o.nodeName)&&/^[\s]*$/.test(o.innerHTML)?o=this.getPreviousNode(o,t):o||e===this.contain||(n=e.parentNode)!==this.contain&&(o=this.getPreviousNode(n,t)),o!==this.contain&&o)},getSelectionParentsByTag:function(e){for(var t,n=this.getSelectedOwnNodes(),o=[],r=0,i=n.length;r<i;r++)(t=n[r].nodeName&&"LI"===n[r].nodeName?n[r]:y.dom.getParentElement(n[r],{nodeName:["LI"]},!1,this.contain))&&o.push(t);return o.length?o:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var e=this.getRange(),t=e.startContainer,n=e.startOffset,o=rangy.createRange(this.doc);return o.selectNodeContents(t),o.setStart(t,n),o}},caretIsLastInSelection:function(){rangy.createRange(this.doc),this.getSelection();var e=this.getRangeToNodeEnd().cloneContents().textContent;return/^\s*$/.test(e)},caretIsFirstInSelection:function(){var e=rangy.createRange(this.doc),t=this.getSelection(),n=this.getRange(),o=n.startContainer;return o.nodeType===y.TEXT_NODE?this.isCollapsed()&&o.nodeType===y.TEXT_NODE&&/^\s*$/.test(o.data.substr(0,n.startOffset)):(e.selectNodeContents(this.getRange().commonAncestorContainer),e.collapse(!0),this.isCollapsed()&&(e.startContainer===t.anchorNode||e.endContainer===t.anchorNode)&&e.startOffset===t.anchorOffset)},caretIsInTheBeginnig:function(e){var t=this.getSelection(),n=t.anchorNode,o=t.anchorOffset;return e?0===o&&(n.nodeName&&n.nodeName===e.toUpperCase()||y.dom.getParentElement(n.parentNode,{nodeName:e},1)):0===o&&!this.getPreviousNode(n,!0)},caretIsBeforeUneditable:function(){var e=this.getSelection(),t=e.anchorNode;if(0===e.anchorOffset){var n=this.getPreviousNode(t,!0);if(n)for(var o=this.getOwnUneditables(),r=0,i=o.length;r<i;r++)if(n===o[r])return o[r]}return!1},executeAndRestoreRangy:function(e,t){var n=this.doc.defaultView||this.doc.parentWindow,o=rangy.saveSelection(n);if(o)try{e()}catch(e){setTimeout(function(){throw e},0)}else e();rangy.restoreSelection(o)},executeAndRestore:function(e,t){var n,o,r,i,a,s,l,c,d=this.doc.body,u=t&&d.scrollTop,f=t&&d.scrollLeft,h="_wysihtml5-temp-placeholder",m='<span class="'+h+'">'+y.INVISIBLE_SPACE+"</span>",p=this.getRange(!0);if(p){p.collapsed||(s=(l=p.cloneRange()).createContextualFragment(m),l.collapse(!1),l.insertNode(s),l.detach()),a=p.createContextualFragment(m),p.insertNode(a),s&&(n=this.contain.querySelectorAll("."+h),p.setStartBefore(n[0]),p.setEndAfter(n[n.length-1])),this.setSelection(p);try{e(p.startContainer,p.endContainer)}catch(e){setTimeout(function(){throw e},0)}if((n=this.contain.querySelectorAll("."+h))&&n.length){c=rangy.createRange(this.doc),r=n[0].nextSibling,1<n.length&&(i=n[n.length-1].previousSibling),i&&r?(c.setStartBefore(r),c.setEndAfter(i)):(o=this.doc.createTextNode(y.INVISIBLE_SPACE),v.insert(o).after(n[0]),c.setStartBefore(o),c.setEndAfter(o)),this.setSelection(c);for(var g=n.length;g--;)n[g].parentNode.removeChild(n[g])}else this.contain.focus();t&&(d.scrollTop=u,d.scrollLeft=f);try{n.parentNode.removeChild(n)}catch(e){}}else e(d,d)},set:function(e,t){var n=rangy.createRange(this.doc);n.setStart(e,t||0),this.setSelection(n)},insertHTML:function(e){var t=rangy.createRange(this.doc).createContextualFragment(e),n=t.lastChild;this.insertNode(t),n&&this.setAfter(n)},insertNode:function(e){var t=this.getRange();t&&t.insertNode(e)},surround:function(e){var t,n=this.getOwnRanges(),o=[];if(0==n.length)return o;for(var r=n.length;r--;){t=this.doc.createElement(e.nodeName),o.push(t),e.className&&(t.className=e.className),e.cssStyle&&t.setAttribute("style",e.cssStyle);try{n[r].surroundContents(t),this.selectNode(t)}catch(e){t.appendChild(n[r].extractContents()),n[r].insertNode(t)}}return o},deblockAndSurround:function(e){var t,n,o,r=this.doc.createElement("div"),i=rangy.createRange(this.doc);if(r.className=e.className,this.composer.commands.exec("formatBlock",e.nodeName,e.className),(t=this.contain.querySelectorAll("."+e.className))[0])for(t[0].parentNode.insertBefore(r,t[0]),i.setStartBefore(t[0]),i.setEndAfter(t[t.length-1]),n=i.extractContents();n.firstChild;)if(1==(o=n.firstChild).nodeType&&y.dom.hasClass(o,e.className)){for(;o.firstChild;)r.appendChild(o.firstChild);"BR"!==o.nodeName&&r.appendChild(this.doc.createElement("br")),n.removeChild(o)}else r.appendChild(o);else r=null;return r},scrollIntoView:function(){var e,t,n=this.doc,o=n.documentElement.scrollHeight>n.documentElement.offsetHeight,r=n._wysihtml5ScrollIntoViewElement=n._wysihtml5ScrollIntoViewElement||((t=n.createElement("span")).innerHTML=y.INVISIBLE_SPACE,t);o&&(this.insertNode(r),e=function(e){var t=0;if(e.parentNode)for(;t+=e.offsetTop||0,e=e.offsetParent;);return t}(r),r.parentNode.removeChild(r),e>=n.body.scrollTop+n.documentElement.offsetHeight-5&&(n.body.scrollTop=e))},selectLine:function(){y.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var e=this.doc.defaultView.getSelection();e.modify("move","left","lineboundary"),e.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var e,t,n,o,r,i=this.doc.selection.createRange(),a=i.boundingTop,s=this.doc.body.scrollWidth;if(i.moveToPoint){for(0===a&&(n=this.doc.createElement("span"),this.insertNode(n),a=n.offsetTop,n.parentNode.removeChild(n)),a+=1,o=-10;o<s;o+=2)try{i.moveToPoint(o,a);break}catch(e){}for(e=a,t=this.doc.selection.createRange(),r=s;0<=r;r--)try{t.moveToPoint(r,e);break}catch(e){}i.setEndPoint("EndToEnd",t),i.select()}},getText:function(){var e=this.getSelection();return e?e.toString():""},getNodes:function(e,t){var n=this.getRange();return n?n.getNodes([e],t):[]},fixRangeOverflow:function(e){if(this.contain&&this.contain.firstChild&&e){var t=e.compareNode(this.contain);if(2!==t)1===t&&e.setStartBefore(this.contain.firstChild),0===t&&e.setEndAfter(this.contain.lastChild),3===t&&(e.setStartBefore(this.contain.firstChild),e.setEndAfter(this.contain.lastChild));else if(this._detectInlineRangeProblems(e)){var n=e.endContainer.previousElementSibling;n&&e.setEnd(n,this._endOffsetForNode(n))}}},_endOffsetForNode:function(e){var t=document.createRange();return t.selectNodeContents(e),t.endOffset},_detectInlineRangeProblems:function(e){var t=v.compareDocumentPosition(e.startContainer,e.endContainer);return 0==e.endOffset&&4&t},getRange:function(e){var t=this.getSelection(),n=t&&t.rangeCount&&t.getRangeAt(0);return!0!==e&&this.fixRangeOverflow(n),n},getOwnUneditables:function(){var e=v.query(this.contain,"."+this.unselectableClass),t=v.query(e,"."+this.unselectableClass);return y.lang.array(e).without(t)},getOwnRanges:function(){var e,t=[],n=this.getRange();if(n&&t.push(n),this.unselectableClass&&this.contain&&n){var o,r=this.getOwnUneditables();if(0<r.length)for(var i=0,a=r.length;i<a;i++){e=[];for(var s=0,l=t.length;s<l;s++){if(t[s])switch(t[s].compareNode(r[i])){case 2:break;case 3:(o=t[s].cloneRange()).setEndBefore(r[i]),e.push(o),(o=t[s].cloneRange()).setStartAfter(r[i]),e.push(o);break;default:e.push(t[s])}t=e}}}return t},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(e){var t=this.doc.defaultView||this.doc.parentWindow;return rangy.getSelection(t).setSingleRange(e)},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},isEndToEndInNode:function(e){var t=this.getRange(),n=t.commonAncestorContainer,o=t.startContainer,r=t.endContainer;if(n.nodeType===y.TEXT_NODE&&(n=n.parentNode),o.nodeType===y.TEXT_NODE&&!/^\s*$/.test(o.data.substr(t.startOffset)))return!1;if(r.nodeType===y.TEXT_NODE&&!/^\s*$/.test(r.data.substr(t.endOffset)))return!1;for(;o&&o!==n;){if(o.nodeType!==y.TEXT_NODE&&!y.dom.contains(n,o))return!1;if(y.dom.domNode(o).prev({ignoreBlankTexts:!0}))return!1;o=o.parentNode}for(;r&&r!==n;){if(r.nodeType!==y.TEXT_NODE&&!y.dom.contains(n,r))return!1;if(y.dom.domNode(r).next({ignoreBlankTexts:!0}))return!1;r=r.parentNode}return!!y.lang.array(e).contains(n.nodeName)&&n},deselect:function(){var e=this.getSelection();e&&e.removeAllRanges()}})}(_),function(c,d){var o=/\s+/g;function n(e,t,n){if(!e.className)return!1;var o=e.className.match(n)||[];return o[o.length-1]===t}function r(e,t){if(!e.getAttribute||!e.getAttribute("style"))return!1;e.getAttribute("style").match(t);return!!e.getAttribute("style").match(t)}function f(e,t,n){e.getAttribute("style")?(m(e,n),e.getAttribute("style")&&!/^\s*$/.test(e.getAttribute("style"))?e.setAttribute("style",t+";"+e.getAttribute("style")):e.setAttribute("style",t)):e.setAttribute("style",t)}function h(e,t){e.className&&(e.className=e.className.replace(t,""))}function m(e,t){var n,o=[];if(e.getAttribute("style")){for(var r=(n=e.getAttribute("style").split(";")).length;r--;)n[r].match(t)||/^\s*$/.test(n[r])||o.push(n[r]);o.length?e.setAttribute("style",o.join(";")):e.removeAttribute("style")}}function p(e,t){var n=[],o=t.split(";"),r=e.getAttribute("style");if(r){r=r.replace(/\s/gi,"").toLowerCase(),n.push(new RegExp("(^|\\s|;)"+t.replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var i=o.length;0<i--;)/^\s*$/.test(o[i])||n.push(new RegExp("(^|\\s|;)"+o[i].replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var a=0,s=n.length;a<s;a++)if(r.match(n[a]))return n[a]}return!1}function i(e,t,n,o){for(var r=e.length;r--;)if(i=e[r],a=t,l=o,!((s=n)?p(i,s):l?c.dom.hasClass(i,l):d.dom.arrayContains(a,i.tagName.toLowerCase())))return!1;var i,a,s,l;return!!e.length}function g(e,t){return d.dom.isCharacterDataNode(e)?0==t?!!e.previousSibling:t!=e.length||!!e.nextSibling:0<t&&t<e.childNodes.length}function y(e,t,n,o){var r;if(d.dom.isCharacterDataNode(t)&&(0==n?(n=d.dom.getNodeIndex(t),t=t.parentNode):n==t.length?(n=d.dom.getNodeIndex(t)+1,t=t.parentNode):r=d.dom.splitDataNode(t,n)),!(r||o&&t===o)){var i;for((r=t.cloneNode(!1)).id&&r.removeAttribute("id");i=t.childNodes[n];)r.appendChild(i);d.dom.insertAfter(r,t)}return t==e?r:y(e,r.parentNode,d.dom.getNodeIndex(r),o)}function v(e){this.isElementMerge=e.nodeType==c.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?e.lastChild:e,this.textNodes=[this.firstTextNode]}function e(e,t,n,o,r,i,a){this.tagNames=e||["span"],this.cssClass=t||!1!==t&&"",this.similarClassRegExp=n,this.cssStyle=r||"",this.similarStyleRegExp=i,this.normalize=o,this.applyToAnyTagName=!1,this.container=a}v.prototype={doMerge:function(){for(var e,t,n,o=[],r=0,i=this.textNodes.length;r<i;++r)t=(e=this.textNodes[r]).parentNode,o[r]=e.data,r&&(t.removeChild(e),t.hasChildNodes()||t.parentNode.removeChild(t));return this.firstTextNode.data=n=o.join(""),n},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){for(var e=[],t=0,n=this.textNodes.length;t<n;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}},e.prototype={getAncestorWithClass:function(e){for(var t;e;){if(t=this.cssClass?n(e,this.cssClass,this.similarClassRegExp):""===this.cssStyle,e.nodeType==c.ELEMENT_NODE&&"false"!=e.getAttribute("contenteditable")&&d.dom.arrayContains(this.tagNames,e.tagName.toLowerCase())&&t)return e;e=e.parentNode}return!1},getAncestorWithStyle:function(e){for(var t;e;){if(t=!!this.cssStyle&&r(e,this.similarStyleRegExp),e.nodeType==c.ELEMENT_NODE&&"false"!=e.getAttribute("contenteditable")&&d.dom.arrayContains(this.tagNames,e.tagName.toLowerCase())&&t)return e;e=e.parentNode}return!1},getMatchingAncestor:function(e){var t=this.getAncestorWithClass(e),n=!1;return t?this.cssStyle&&(n="class"):(t=this.getAncestorWithStyle(e))&&(n="style"),{element:t,type:n}},postApply:function(e,t){for(var n,o,r,i=e[0],a=e[e.length-1],s=[],l=i,c=a,d=0,u=a.length,f=0,h=e.length;f<h;++f)r=null,(o=e[f])&&o.parentNode&&(r=this.getAdjacentMergeableTextNode(o.parentNode,!1)),r?(n||(n=new v(r),s.push(n)),n.textNodes.push(o),o===i&&(d=(l=n.firstTextNode).length),o===a&&(c=n.firstTextNode,u=n.getLength())):n=null;if(a&&a.parentNode){var m=this.getAdjacentMergeableTextNode(a.parentNode,!0);m&&(n||(n=new v(a),s.push(n)),n.textNodes.push(m))}if(s.length){for(f=0,h=s.length;f<h;++f)s[f].doMerge();t.setStart(l,d),t.setEnd(c,u)}},getAdjacentMergeableTextNode:function(e,t){var n,o=e.nodeType==c.TEXT_NODE,r=o?e.parentNode:e,i=t?"nextSibling":"previousSibling";if(o){if((n=e[i])&&n.nodeType==c.TEXT_NODE)return n}else if((n=r[i])&&this.areElementsMergeable(e,n))return n[t?"firstChild":"lastChild"];return null},areElementsMergeable:function(e,t){return d.dom.arrayContains(this.tagNames,(e.tagName||"").toLowerCase())&&d.dom.arrayContains(this.tagNames,(t.tagName||"").toLowerCase())&&(n=t,e.className.replace(o," ")==n.className.replace(o," "))&&function(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,o,r,i=0,a=e.attributes.length;i<a;++i)if("class"!=(r=(n=e.attributes[i]).name)){if(o=t.attributes.getNamedItem(r),n.specified!=o.specified)return!1;if(n.specified&&n.nodeValue!==o.nodeValue)return!1}return!0}(e,t);var n},createContainer:function(e){var t=e.createElement(this.tagNames[0]);return this.cssClass&&(t.className=this.cssClass),this.cssStyle&&t.setAttribute("style",this.cssStyle),t},applyToTextNode:function(e){var t,n,o,r=e.parentNode;if(1==r.childNodes.length&&d.dom.arrayContains(this.tagNames,r.tagName.toLowerCase()))this.cssClass&&(t=r,n=this.cssClass,o=this.similarClassRegExp,t.className?(h(t,o),t.className+=" "+n):t.className=n),this.cssStyle&&f(r,this.cssStyle,this.similarStyleRegExp);else{var i=this.createContainer(d.dom.getDocument(e));e.parentNode.insertBefore(i,e),i.appendChild(e)}},isRemovable:function(e){return d.dom.arrayContains(this.tagNames,e.tagName.toLowerCase())&&""===c.lang.string(e.className).trim()&&(!e.getAttribute("style")||""===c.lang.string(e.getAttribute("style")).trim())},undoToTextNode:function(e,t,n,o){var r,i,a,s,l=!n,c=n||o,d=!1;if(!t.containsNode(c)){var u=t.cloneRange();u.selectNode(c),u.isPointInRange(t.endContainer,t.endOffset)&&g(t.endContainer,t.endOffset)&&(y(c,t.endContainer,t.endOffset,this.container),t.setEndAfter(c)),u.isPointInRange(t.startContainer,t.startOffset)&&g(t.startContainer,t.startOffset)&&(c=y(c,t.startContainer,t.startOffset,this.container))}!l&&this.similarClassRegExp&&h(c,this.similarClassRegExp),l&&this.similarStyleRegExp&&(d="change"==(r=c,i=this.cssStyle,a=this.similarStyleRegExp,(s=p(r,i))?(m(r,s),"remove"):(f(r,i,a),"change"))),this.isRemovable(c)&&!d&&function(e){for(var t=e.parentNode;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}(c)},applyToRange:function(e){for(var t,n=e.length;n--;){if(!(t=e[n].getNodes([c.TEXT_NODE])).length)try{var o=this.createContainer(e[n].endContainer.ownerDocument);return e[n].surroundContents(o),void this.selectNode(e[n],o)}catch(e){}if(e[n].splitBoundaries(),(t=e[n].getNodes([c.TEXT_NODE])).length){for(var r,i=0,a=t.length;i<a;++i)r=t[i],this.getMatchingAncestor(r).element||this.applyToTextNode(r);e[n].setStart(t[0],0),r=t[t.length-1],e[n].setEnd(r,r.length),this.normalize&&this.postApply(t,e[n])}}},undoToRange:function(e){for(var t,n,o,r=e.length;r--;){if((t=e[r].getNodes([c.TEXT_NODE])).length)e[r].splitBoundaries(),t=e[r].getNodes([c.TEXT_NODE]);else{var i=e[r].endContainer.ownerDocument.createTextNode(c.INVISIBLE_SPACE);e[r].insertNode(i),e[r].selectNode(i),t=[i]}for(var a=0,s=t.length;a<s;++a)e[r].isValid()&&(n=t[a],"style"===(o=this.getMatchingAncestor(n)).type?this.undoToTextNode(n,e[r],!1,o.element):o.element&&this.undoToTextNode(n,e[r],o.element));1==s?this.selectNode(e[r],t[0]):(e[r].setStart(t[0],0),n=t[t.length-1],e[r].setEnd(n,n.length),this.normalize&&this.postApply(t,e[r]))}},selectNode:function(e,t){var n=t.nodeType===c.ELEMENT_NODE,o=!("canHaveHTML"in t)||t.canHaveHTML,r=n?t.innerHTML:t.data,i=""===r||r===c.INVISIBLE_SPACE;if(i&&n&&o)try{t.innerHTML=c.INVISIBLE_SPACE}catch(e){}e.selectNodeContents(t),i&&n?e.collapse(!1):i&&(e.setStartAfter(t),e.setEndAfter(t))},getTextSelectedByRange:function(e,t){var n=t.cloneRange();n.selectNodeContents(e);var o=n.intersection(t),r=o?o.toString():"";return n.detach(),r},isAppliedToRange:function(e){for(var t,n,o=[],r="full",i=e.length;i--;){if(!(n=e[i].getNodes([c.TEXT_NODE])).length)return!!(t=this.getMatchingAncestor(e[i].startContainer).element)&&{elements:[t],coverage:r};for(var a,s=0,l=n.length;s<l;++s)a=this.getTextSelectedByRange(n[s],e[i]),(t=this.getMatchingAncestor(n[s]).element)&&""!=a?(o.push(t),1===c.dom.getTextNodes(t,!0).length?r="full":"full"===r&&(r="inline")):t||(r="partial")}return!!o.length&&{elements:o,coverage:r}},toggleRange:function(e){var t,n=this.isAppliedToRange(e);n?"full"===n.coverage?this.undoToRange(e):"inline"===n.coverage?(t=i(n.elements,this.tagNames,this.cssStyle,this.cssClass),this.undoToRange(e),t||this.applyToRange(e)):(i(n.elements,this.tagNames,this.cssStyle,this.cssClass)||this.undoToRange(e),this.applyToRange(e)):this.applyToRange(e)}},c.selection.HTMLApplier=e}(_,rangy),_.Commands=Ot.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},support:function(e){return _.browser.supportsCommand(this.doc,e)},exec:function(e,t){var n=_.commands[e],o=_.lang.array(arguments).get(),r=n&&n.exec,i=null;if(this.editor.fire("beforecommand:composer"),r)o.unshift(this.composer),i=r.apply(n,o);else try{i=this.doc.execCommand(e,!1,t)}catch(e){}return this.editor.fire("aftercommand:composer"),i},state:function(e,t){var n=_.commands[e],o=_.lang.array(arguments).get(),r=n&&n.state;if(r)return o.unshift(this.composer),r.apply(n,o);try{return this.doc.queryCommandState(e)}catch(e){return!1}},stateValue:function(e){var t=_.commands[e],n=_.lang.array(arguments).get(),o=t&&t.stateValue;return!!o&&(n.unshift(this.composer),o.apply(t,n))}}),_.commands.bold={exec:function(e,t){_.commands.formatInline.execWithToggle(e,t,"b")},state:function(e,t){return _.commands.formatInline.state(e,t,"b")}},te=(J=_).dom,J.commands.createLink={exec:function(e,t,n){var o=this.state(e,t);o?e.selection.executeAndRestore(function(){!function(e,t,n){for(var o,r=t.length;r--;){for(var i=(o=t[r].attributes).length;i--;)t[r].removeAttribute(o.item(i).name);for(var a in n)n.hasOwnProperty(a)&&t[r].setAttribute(a,n[a])}}(0,o,n)}):function(e,t){var n,o,r,i,a,s,l,c,d,u=e.doc,f="_wysihtml5-temp-"+ +new Date,h=0;for(J.commands.formatInline.exec(e,ee,"A",f,/non-matching-class/g,ee,ee,!0,!0),n=(o=u.querySelectorAll("A."+f)).length;h<n;h++)for(d in(r=o[h]).removeAttribute("class"),t)"text"!==d&&r.setAttribute(d,t[d]);s=r,1===n&&(l=te.getTextContent(r),i=!!r.querySelector("*"),a=""===l||l===J.INVISIBLE_SPACE,!i&&a&&(te.setTextContent(r,t.text||r.href),c=u.createTextNode(" "),e.selection.setAfter(r),te.insert(c).after(r),s=c)),e.selection.setAfter(s)}(e,n="object"==typeof n?n:{href:n})},state:function(e,t){return J.commands.formatInline.state(e,t,"A")}},oe=(ne=_).dom,ne.commands.removeLink={exec:function(e,t){var n=this.state(e,t);n&&e.selection.executeAndRestore(function(){!function(e,t){for(var n,o,r=t.length,i=0;i<r;i++)n=t[i],o=oe.getParentElement(n,{nodeName:"code"}),oe.getTextContent(n).match(oe.autoLink.URL_REG_EXP)&&!o?o=oe.renameElement(n,"code"):oe.replaceWithChildNodes(n)}(0,n)})},state:function(e,t){return ne.commands.formatInline.state(e,t,"A")}},ie=/wysiwyg-font-size-[0-9a-z\-]+/g,(re=_).commands.fontSize={exec:function(e,t,n){re.commands.formatInline.execWithToggle(e,t,"span","wysiwyg-font-size-"+n,ie)},state:function(e,t,n){return re.commands.formatInline.state(e,t,"span","wysiwyg-font-size-"+n,ie)}},se=/(\s|^)font-size\s*:\s*[^;\s]+;?/gi,(ae=_).commands.fontSizeStyle={exec:function(e,t,n){n="object"==typeof n?n.size:n,/^\s*$/.test(n)||ae.commands.formatInline.execWithToggle(e,t,"span",!1,!1,"font-size:"+n,se)},state:function(e,t,n){return ae.commands.formatInline.state(e,t,"span",!1,!1,"font-size",se)},stateValue:function(e,t){var n,o=this.state(e,t);return o&&ae.lang.object(o).isArray()&&(o=o[0]),!(!o||!(n=o.getAttribute("style")))&&ae.quirks.styleParser.parseFontSize(n)}},ce=/wysiwyg-color-[0-9a-z]+/g,(le=_).commands.foreColor={exec:function(e,t,n){le.commands.formatInline.execWithToggle(e,t,"span","wysiwyg-color-"+n,ce)},state:function(e,t,n){return le.commands.formatInline.state(e,t,"span","wysiwyg-color-"+n,ce)}},ue=/(\s|^)color\s*:\s*[^;\s]+;?/gi,(de=_).commands.foreColorStyle={exec:function(e,t,n){var o,r=de.quirks.styleParser.parseColor("object"==typeof n?"color:"+n.color:"color:"+n,"color");r&&(o="color: rgb("+r[0]+","+r[1]+","+r[2]+");",1!==r[3]&&(o+="color: rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+");"),de.commands.formatInline.execWithToggle(e,t,"span",!1,!1,o,ue))},state:function(e,t){return de.commands.formatInline.state(e,t,"span",!1,!1,"color",ue)},stateValue:function(e,t,n){var o,r=this.state(e,t);return r&&de.lang.object(r).isArray()&&(r=r[0]),!!(r&&(o=r.getAttribute("style"))&&o)&&(val=de.quirks.styleParser.parseColor(o,"color"),de.quirks.styleParser.unparseColor(val,n))}},he=/(\s|^)background-color\s*:\s*[^;\s]+;?/gi,(fe=_).commands.bgColorStyle={exec:function(e,t,n){var o,r=fe.quirks.styleParser.parseColor("object"==typeof n?"background-color:"+n.color:"background-color:"+n,"background-color");r&&(o="background-color: rgb("+r[0]+","+r[1]+","+r[2]+");",1!==r[3]&&(o+="background-color: rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+");"),fe.commands.formatInline.execWithToggle(e,t,"span",!1,!1,o,he))},state:function(e,t){return fe.commands.formatInline.state(e,t,"span",!1,!1,"background-color",he)},stateValue:function(e,t,n){var o,r=this.state(e,t),i=!1;return r&&fe.lang.object(r).isArray()&&(r=r[0]),!(!r||!(o=r.getAttribute("style")))&&(i=fe.quirks.styleParser.parseColor(o,"background-color"),fe.quirks.styleParser.unparseColor(i,n))}},function(b){var w=b.dom,C=["H1","H2","H3","H4","H5","H6","P","PRE","DIV"];function N(e,t){var n=t.test(e.className);return e.className=e.className.replace(t,""),""==b.lang.string(e.className).trim()&&e.removeAttribute("class"),n}function x(e,t){var n=t.test(e.getAttribute("style"));return e.setAttribute("style",(e.getAttribute("style")||"").replace(t,"")),""==b.lang.string(e.getAttribute("style")||"").trim()&&e.removeAttribute("style"),n}b.commands.formatBlock={exec:function(a,e,s,l,c,d,u){a.doc;var f,i,h,m,p,g=this.state(a,e,s,l,c,d,u),y=a.config.useLineBreaks,v=y?"DIV":"P";s="string"==typeof s?s.toUpperCase():s,g.length?a.selection.executeAndRestoreRangy(function(){for(var e=g.length;e--;){if(c&&(i=N(g[e],c)),u&&(m=x(g[e],u)),(m||i)&&null===s&&g[e].nodeName!=v)return;var t=(r=g[e],!!b.lang.string(r.className).trim()),n=(o=g[e],!!b.lang.string(o.getAttribute("style")||"").trim());t||n||!y&&"P"!==s?w.renameElement(g[e],"P"===s?"DIV":v):(b.dom.lineBreaks(g[e]).add(),w.replaceWithChildNodes(g[e]))}var o,r}):(null===s||b.lang.array(C).contains(s))&&(f=a.selection.findNodesInSelection(C).concat(a.selection.getSelectedOwnNodes()),a.selection.executeAndRestoreRangy(function(){for(var e=f.length;e--;)(p=w.getParentElement(f[e],{nodeName:C}))==a.element&&(p=null),p&&(s&&(p=w.renameElement(p,s)),l&&(r=l,i=c,(o=p).className?(N(o,i),o.className=b.lang.string(o.className+" "+r).trim()):o.className=r),d&&(n=d,x(t=p,u),t.getAttribute("style")?t.setAttribute("style",b.lang.string(t.getAttribute("style")+" "+n).trim()):t.setAttribute("style",n)),h=!0);var t,n,o,r,i}),h)||function(e,t){e.selection.isCollapsed()&&e.selection.selectLine();for(var n,o,r=e.selection.surround(t),i=0,a=r.length;i<a;i++)b.dom.lineBreaks(r[i]).remove(),n=r[i],o=void 0,(o=n.lastChild)&&"BR"===o.nodeName&&o.parentNode.removeChild(o)}(a,{nodeName:s||v,className:l||null,cssStyle:d||null})},state:function(e,t,n,o,r,i,a){var s,l=e.selection.getSelectedOwnNodes(),c=[];n="string"==typeof n?n.toUpperCase():n;for(var d=0,u=l.length;d<u;d++)(s=w.getParentElement(l[d],{nodeName:n,className:o,classRegExp:r,cssStyle:i,styleRegExp:a}))&&-1==b.lang.array(c).indexOf(s)&&c.push(s);return 0!=c.length&&c}}}(_),_.commands.formatCode={exec:function(e,t,n){var o,r,i,a=this.state(e);a?e.selection.executeAndRestore(function(){o=a.querySelector("code"),_.dom.replaceWithChildNodes(a),o&&_.dom.replaceWithChildNodes(o)}):(i=(r=e.selection.getRange()).extractContents(),a=e.doc.createElement("pre"),o=e.doc.createElement("code"),n&&(o.className=n),a.appendChild(o),o.appendChild(i),r.insertNode(a),e.selection.selectNode(a))},state:function(e){var t=e.selection.getSelectedNode();return t&&t.nodeName&&"PRE"==t.nodeName&&t.firstChild&&t.firstChild.nodeName&&"CODE"==t.firstChild.nodeName?t:_.dom.getParentElement(t,{nodeName:"CODE"})&&_.dom.getParentElement(t,{nodeName:"PRE"})}},function(u){var f={strong:"b",em:"i",b:"strong",i:"em"},c={};function h(e,t,n,o,r,i){var a,s,l=e;return t&&(l+=":"+t),o&&(l+=":"+o),c[l]||(c[l]=new u.selection.HTMLApplier((s=f[a=e])?[a.toLowerCase(),s.toLowerCase()]:[a.toLowerCase()],t,n,!0,o,r,i)),c[l]}u.commands.formatInline={exec:function(e,t,n,o,r,i,a,s,l){var c=e.selection.createRange(),d=e.selection.getOwnRanges();if(!d||0==d.length)return!1;e.selection.getSelection().removeAllRanges(),h(n,o,r,i,a,e.element).toggleRange(d),s?l||e.cleanUp():(c.setStart(d[0].startContainer,d[0].startOffset),c.setEnd(d[d.length-1].endContainer,d[d.length-1].endOffset),e.selection.setSelection(c),e.selection.executeAndRestore(function(){l||e.cleanUp()},!0,!0))},execWithToggle:function(e,t,n,o,r,i,a){if(this.state(e,t,n,o,r,i,a)&&e.selection.isCollapsed()&&!e.selection.caretIsLastInSelection()&&!e.selection.caretIsFirstInSelection()){var s=this.state(e,t,n,o,r)[0];e.selection.executeAndRestoreRangy(function(){s.parentNode;e.selection.selectNode(s,!0),u.commands.formatInline.exec(e,t,n,o,r,i,a,!0,!0)})}else this.state(e,t,n,o,r,i,a)&&!e.selection.isCollapsed()?e.selection.executeAndRestoreRangy(function(){u.commands.formatInline.exec(e,t,n,o,r,i,a,!0,!0)}):u.commands.formatInline.exec(e,t,n,o,r,i,a)},state:function(e,t,n,o,r,i,a){var s,l,c=e.doc,d=f[n]||n;return!(!u.dom.hasElementWithTagName(c,n)&&!u.dom.hasElementWithTagName(c,d))&&(!(o&&!u.dom.hasElementWithClassName(c,o))&&(!(!(s=e.selection.getOwnRanges())||0===s.length)&&(!(!(l=h(n,o,r,i,a,e.element).isAppliedToRange(s))||!l.elements)&&l.elements)))}}}(_),(me=_).commands.insertBlockQuote={exec:function(t,e){var n=this.state(t,e),o=t.selection.isEndToEndInNode(["H1","H2","H3","H4","H5","H6","P"]);t.selection.executeAndRestore(function(){if(n)t.config.useLineBreaks&&me.dom.lineBreaks(n).add(),me.dom.unwrap(n);else if(t.selection.isCollapsed()&&t.selection.selectLine(),o){var e=o.ownerDocument.createElement("blockquote");me.dom.insert(e).after(o),e.appendChild(o)}else t.selection.surround({nodeName:"blockquote"})})},state:function(e,t){var n=e.selection.getSelectedNode(),o=me.dom.getParentElement(n,{nodeName:"BLOCKQUOTE"},!1,e.element);return o||!1}},_.commands.insertHTML={exec:function(e,t,n){e.commands.support(t)?e.doc.execCommand(t,!1,n):e.selection.insertHTML(n)},state:function(){return!1}},(pe=_).commands.insertImage={exec:function(e,t,n){n="object"==typeof n?n:{src:n};var o,r,i=e.doc,a=this.state(e);if(a)return e.selection.setBefore(a),(r=a.parentNode).removeChild(a),pe.dom.removeEmptyTextNodes(r),"A"!==r.nodeName||r.firstChild||(e.selection.setAfter(r),r.parentNode.removeChild(r)),void pe.quirks.redraw(e.element);for(var s in a=i.createElement("IMG"),n)a.setAttribute("className"===s?"class":s,n[s]);e.selection.insertNode(a),pe.browser.hasProblemsSettingCaretAfterImg()?(o=i.createTextNode(pe.INVISIBLE_SPACE),e.selection.insertNode(o),e.selection.setAfter(o)):e.selection.setAfter(a)},state:function(e){var t,n,o,r=e.doc;return!!pe.dom.hasElementWithTagName(r,"IMG")&&!!(t=e.selection.getSelectedNode())&&("IMG"===t.nodeName?t:t.nodeType===pe.ELEMENT_NODE&&(n=e.selection.getText(),!(n=pe.lang.string(n).trim())&&1===(o=e.selection.getNodes(pe.ELEMENT_NODE,function(e){return"IMG"===e.nodeName})).length&&o[0]))}},ye="<br>"+((ge=_).browser.needsSpaceAfterLineBreak()?" ":""),ge.commands.insertLineBreak={exec:function(e,t){e.commands.support(t)?(e.doc.execCommand(t,!1,null),ge.browser.autoScrollsToCaret()||e.selection.scrollIntoView()):e.commands.exec("insertHTML",ye)},state:function(){return!1}},_.commands.insertOrderedList={exec:function(e,t){_.commands.insertList.exec(e,t,"OL")},state:function(e,t){return _.commands.insertList.state(e,t,"OL")}},_.commands.insertUnorderedList={exec:function(e,t){_.commands.insertList.exec(e,t,"UL")},state:function(e,t){return _.commands.insertList.state(e,t,"UL")}},_.commands.insertList=(ve=_,be=function(e,t){if(e&&e.nodeName){"string"==typeof t&&(t=[t]);for(var n=t.length;n--;)if(e.nodeName===t[n])return!0}return!1},we=function(e,t,n){var o={el:null,other:!1};if(e){var r=ve.dom.getParentElement(e,{nodeName:"LI"}),i="UL"===t?"OL":"UL";be(e,t)?o.el=e:be(e,i)?o={el:e,other:!0}:r&&(be(r.parentNode,t)?o.el=r.parentNode:be(r.parentNode,i)&&(o={el:r.parentNode,other:!0}))}return o.el&&!n.element.contains(o.el)&&(o.el=null),o},Ce=function(t,e){for(var n=e.selection.getOwnRanges(),o=[],r=n.length;r--;)o=o.concat(n[r].getNodes([1],function(e){return be(e,t)}));return o},{exec:function(e,t,n){var o,r,i,a,s,l,c,d,u,f,h,m=e.doc,p="OL"===n?"insertOrderedList":"insertUnorderedList",g=e.selection.getSelectedNode(),y=we(g,n,e);y.el?y.other?(l=y.el,u="UL"===(c=n)?"OL":"UL",(d=e).selection.executeAndRestore(function(){for(var e=[l].concat(Ce(u,d)),t=e.length;t--;)ve.dom.renameElement(e[t],c.toLowerCase())})):(o=y.el,s="UL"===(r=n)?"OL":"UL",(i=e).selection.executeAndRestore(function(){var e=Ce(s,i);if(e.length)for(var t=e.length;t--;)ve.dom.renameElement(e[t],r.toLowerCase());else{for(var n=(a=Ce(["OL","UL"],i)).length;n--;)ve.dom.resolveList(a[n],i.config.useLineBreaks);ve.dom.resolveList(o,i.config.useLineBreaks)}})):e.commands.support(p)?m.execCommand(p,!1,null):(f=n,(h=e).selection.executeAndRestoreRangy(function(){var e,t,n="_wysihtml5-temp-"+(new Date).getTime(),o=h.selection.deblockAndSurround({nodeName:"div",className:n});o.innerHTML=o.innerHTML.replace(/\uFEFF/g,""),o&&(e=ve.lang.array(["","<br>",ve.INVISIBLE_SPACE]).contains(o.innerHTML),t=ve.dom.convertToList(o,f.toLowerCase(),h.parent.config.uneditableContainerClassname),e&&h.selection.selectNode(t.querySelector("li"),!0))}))},state:function(e,t,n){var o=e.selection.getSelectedNode(),r=we(o,n,e);return!(!r.el||r.other)&&r.el}}),_.commands.italic={exec:function(e,t){_.commands.formatInline.execWithToggle(e,t,"i")},state:function(e,t){return _.commands.formatInline.state(e,t,"i")}},xe="wysiwyg-text-align-center",Ee=/wysiwyg-text-align-[0-9a-z]+/g,(Ne=_).commands.justifyCenter={exec:function(e,t){return Ne.commands.formatBlock.exec(e,"formatBlock",null,xe,Ee)},state:function(e,t){return Ne.commands.formatBlock.state(e,"formatBlock",null,xe,Ee)}},Te="wysiwyg-text-align-left",Re=/wysiwyg-text-align-[0-9a-z]+/g,(Se=_).commands.justifyLeft={exec:function(e,t){return Se.commands.formatBlock.exec(e,"formatBlock",null,Te,Re)},state:function(e,t){return Se.commands.formatBlock.state(e,"formatBlock",null,Te,Re)}},_e="wysiwyg-text-align-right",Ie=/wysiwyg-text-align-[0-9a-z]+/g,(Ae=_).commands.justifyRight={exec:function(e,t){return Ae.commands.formatBlock.exec(e,"formatBlock",null,_e,Ie)},state:function(e,t){return Ae.commands.formatBlock.state(e,"formatBlock",null,_e,Ie)}},Le="wysiwyg-text-align-justify",ke=/wysiwyg-text-align-[0-9a-z]+/g,(Oe=_).commands.justifyFull={exec:function(e,t){return Oe.commands.formatBlock.exec(e,"formatBlock",null,Le,ke)},state:function(e,t){return Oe.commands.formatBlock.state(e,"formatBlock",null,Le,ke)}},Me="text-align: right;",Be=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi,(De=_).commands.alignRightStyle={exec:function(e,t){return De.commands.formatBlock.exec(e,"formatBlock",null,null,null,Me,Be)},state:function(e,t){return De.commands.formatBlock.state(e,"formatBlock",null,null,null,Me,Be)}},He="text-align: left;",ze=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi,(Pe=_).commands.alignLeftStyle={exec:function(e,t){return Pe.commands.formatBlock.exec(e,"formatBlock",null,null,null,He,ze)},state:function(e,t){return Pe.commands.formatBlock.state(e,"formatBlock",null,null,null,He,ze)}},Ve="text-align: center;",We=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi,(qe=_).commands.alignCenterStyle={exec:function(e,t){return qe.commands.formatBlock.exec(e,"formatBlock",null,null,null,Ve,We)},state:function(e,t){return qe.commands.formatBlock.state(e,"formatBlock",null,null,null,Ve,We)}},_.commands.redo={exec:function(e){return e.undoManager.redo()},state:function(e){return!1}},_.commands.underline={exec:function(e,t){_.commands.formatInline.execWithToggle(e,t,"u")},state:function(e,t){return _.commands.formatInline.state(e,t,"u")}},_.commands.undo={exec:function(e){return e.undoManager.undo()},state:function(e){return!1}},_.commands.createTable={exec:function(e,t,n){var o,r,i;if(n&&n.cols&&n.rows&&0<parseInt(n.cols,10)&&0<parseInt(n.rows,10)){for(i=n.tableStyle?'<table style="'+n.tableStyle+'">':"<table>",i+="<tbody>",r=0;r<n.rows;r++){for(i+="<tr>",o=0;o<n.cols;o++)i+="<td>&nbsp;</td>";i+="</tr>"}i+="</tbody></table>",e.commands.exec("insertHTML",i)}},state:function(e,t){return!1}},_.commands.mergeTableCells={exec:function(e,t){e.tableSelection&&e.tableSelection.start&&e.tableSelection.end&&(this.state(e,t)?_.dom.table.unmergeCell(e.tableSelection.start):_.dom.table.mergeCellsBetween(e.tableSelection.start,e.tableSelection.end))},state:function(e,t){if(e.tableSelection){var n=e.tableSelection.start,o=e.tableSelection.end;if(n&&o&&n==o&&(_.dom.getAttribute(n,"colspan")&&1<parseInt(_.dom.getAttribute(n,"colspan"),10)||_.dom.getAttribute(n,"rowspan")&&1<parseInt(_.dom.getAttribute(n,"rowspan"),10)))return[n]}return!1}},_.commands.addTableCells={exec:function(e,t,n){if(e.tableSelection&&e.tableSelection.start&&e.tableSelection.end){var o=_.dom.table.orderSelectionEnds(e.tableSelection.start,e.tableSelection.end);"before"==n||"above"==n?_.dom.table.addCells(o.start,n):"after"!=n&&"below"!=n||_.dom.table.addCells(o.end,n),setTimeout(function(){e.tableSelection.select(o.start,o.end)},0)}},state:function(e,t){return!1}},_.commands.deleteTableCells={exec:function(e,t,n){if(e.tableSelection&&e.tableSelection.start&&e.tableSelection.end){var o,r=_.dom.table.orderSelectionEnds(e.tableSelection.start,e.tableSelection.end),i=_.dom.table.indexOf(r.start),a=e.tableSelection.table;_.dom.table.removeCells(r.start,n),setTimeout(function(){(o=_.dom.table.findCell(a,i))||("row"==n&&(o=_.dom.table.findCell(a,{row:i.row-1,col:i.col})),"column"==n&&(o=_.dom.table.findCell(a,{row:i.row,col:i.col-1}))),o&&e.tableSelection.select(o,o)},0)}},state:function(e,t){return!1}},_.commands.indentList={exec:function(e,t,n){var o=e.selection.getSelectionParentsByTag("LI");return!!o&&this.tryToPushLiLevel(o,e.selection)},state:function(e,t){return!1},tryToPushLiLevel:function(t,e){var n,o,r,i,a,s=!1;return e.executeAndRestoreRangy(function(){for(var e=t.length;e--;)i=t[e],n="OL"===i.parentNode.nodeName?"OL":"UL",o=i.ownerDocument.createElement(n),r=_.dom.domNode(i).prev({nodeTypes:[_.ELEMENT_NODE]}),a=r?r.querySelector("ul, ol"):null,r&&(a?a.appendChild(i):(o.appendChild(i),r.appendChild(o)),s=!0)}),s}},_.commands.outdentList={exec:function(e,t,n){var o=e.selection.getSelectionParentsByTag("LI");return!!o&&this.tryToPullLiLevel(o,e)},state:function(e,t){return!1},tryToPullLiLevel:function(n,o){var r,i,a,s,l,c=!1,d=this;return o.selection.executeAndRestoreRangy(function(){for(var e=n.length;e--;)if((s=n[e]).parentNode&&("OL"===(r=s.parentNode).tagName||"UL"===r.tagName)){if(c=!0,i=_.dom.getParentElement(r.parentNode,{nodeName:["OL","UL"]},!1,o.element),a=_.dom.getParentElement(r.parentNode,{nodeName:["LI"]},!1,o.element),i&&a)s.nextSibling&&(l=d.getAfterList(r,s),s.appendChild(l)),i.insertBefore(s,a.nextSibling);else{s.nextSibling&&(l=d.getAfterList(r,s),s.appendChild(l));for(var t=s.childNodes.length;t--;)r.parentNode.insertBefore(s.childNodes[t],r.nextSibling);r.parentNode.insertBefore(document.createElement("br"),r.nextSibling),s.parentNode.removeChild(s)}0===r.childNodes.length&&r.parentNode.removeChild(r)}}),c},getAfterList:function(e,t){for(var n=e.nodeName,o=document.createElement(n);t.nextSibling;)o.appendChild(t.nextSibling);return o}},je="data-wysihtml5-selection-node",Fe="data-wysihtml5-selection-offset",(Ue=_).INVISIBLE_SPACE,Ue.INVISIBLE_SPACE,Ke=Ue.dom,Ue.UndoManager=Ue.lang.Dispatcher.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){var n,r=this;this.composer.sandbox.getDocument(),Ke.observe(this.element,"keydown",function(e){if(!e.altKey&&(e.ctrlKey||e.metaKey)){var t=e.keyCode,n=90===t&&!e.shiftKey,o=90===t&&e.shiftKey||89===t;n?(r.undo(),e.preventDefault()):o&&(r.redo(),e.preventDefault())}}),Ke.observe(this.element,"keydown",function(e){var t=e.keyCode;t!==n&&(8!==(n=t)&&46!==t||r.transact())}),this.editor.on("newword:composer",function(){r.transact()}).on("beforecommand:composer",function(){r.transact()})},transact:function(){var e,t,n,o,r,i=this.historyStr[this.position-1],a=this.composer.getValue(!1,!1),s=0<this.element.offsetWidth&&0<this.element.offsetHeight;if(a!==i){25<(this.historyStr.length=this.historyDom.length=this.position)&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,s&&(t=(e=this.composer.selection.getRange())&&e.startContainer?e.startContainer:this.element,n=e&&e.startOffset?e.startOffset:0,t.nodeType===Ue.ELEMENT_NODE?o=t:(o=t.parentNode,r=this.getChildNodeIndex(o,t)),o.setAttribute(Fe,n),void 0!==r&&o.setAttribute(je,r));var l=this.element.cloneNode(!!a);this.historyDom.push(l),this.historyStr.push(a),o&&(o.removeAttribute(Fe),o.removeAttribute(je))}},undo:function(){this.transact(),this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return 1<this.position},redoPossible:function(){return this.position<this.historyStr.length},set:function(e){this.element.innerHTML="";for(var t,n,o,r=0,i=e.childNodes,a=e.childNodes.length;r<a;r++)this.element.appendChild(i[r].cloneNode(!0));e.hasAttribute(Fe)?(t=e.getAttribute(Fe),o=e.getAttribute(je),n=this.element):(t=(n=this.element.querySelector("["+Fe+"]")||this.element).getAttribute(Fe),o=n.getAttribute(je),n.removeAttribute(Fe),n.removeAttribute(je)),null!==o&&(n=this.getChildNodeByIndex(n,+o)),this.composer.selection.set(n,t)},getChildNodeIndex:function(e,t){for(var n=0,o=e.childNodes,r=o.length;n<r;n++)if(o[n]===t)return n},getChildNodeByIndex:function(e,t){return e.childNodes[t]}}),_.views.View=Ot.extend({constructor:function(e,t,n){this.parent=e,this.element=t,this.config=n,this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var t=this;this.parent.on("beforeload",function(){t.parent.on("change_view",function(e){e===t.name?((t.parent.currentView=t).show(),setTimeout(function(){t.focus()},0)):t.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(e){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),$e=(Ge=_).dom,Xe=Ge.browser,Ge.views.Composer=Ge.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(e,t,n){this.base(e,t,n),this.config.noTextarea?this.editableArea=t:this.textarea=this.parent.textarea,this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=Xe.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(e,t){var n=this.isEmpty()?"":Ge.quirks.getCorrectInnerHTML(this.element);return!1!==e&&(n=this.parent.parse(n,!1!==t)),n},setValue:function(t,e){e&&(t=this.parent.parse(t));try{this.element.innerHTML=t}catch(e){this.element.innerText=t}},cleanUp:function(){this.parent.parse(this.element)},show:function(){this.editableArea.style.display=this._displayStyle||"",this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=$e.getStyle("display").from(this.editableArea),"none"===this._displayStyle&&(this._displayStyle=null),this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(e){Ge.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var t=this.element.lastChild;e&&t&&this.selection&&("BR"===t.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return $e.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var e=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(e)||""===e||"<br>"===e||"<p></p>"===e||"<p><br></p>"===e||this.hasPlaceholderSet()},_initContentEditableArea:function(){var e=this;this.config.noTextarea?this.sandbox=new $e.ContentEditableArea(function(){e._create()},{},this.editableArea):(this.sandbox=new $e.ContentEditableArea(function(){e._create()}),this.editableArea=this.sandbox.getContentEditable(),$e.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var e=this;this.sandbox=new $e.Sandbox(function(){e._create()},{stylesheets:this.config.stylesheets}),this.editableArea=this.sandbox.getIframe();var t=this.textarea.element;$e.insert(this.editableArea).after(t),this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var e=document.createElement("input");e.type="hidden",e.name="_wysihtml5_mode",e.value=1,$e.insert(e).after(this.textarea.element)}},_create:function(){var e=this;this.doc=this.sandbox.getDocument(),this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body,this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1)),this.selection=new Ge.Selection(this.parent,this.element,this.config.uneditableContainerClassname),this.commands=new Ge.Commands(this.parent),this.config.noTextarea||$e.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),$e.addClass(this.element,this.config.composerClassName),this.config.style&&!this.config.contentEditableMode&&this.style(),this.observe();var t=this.config.name;t&&($e.addClass(this.element,t),this.config.contentEditableMode||$e.addClass(this.editableArea,t)),this.enable(),!this.config.noTextarea&&this.textarea.element.disabled&&this.disable();var n="string"==typeof this.config.placeholder?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder");n&&$e.simulatePlaceholder(this.parent,this,n),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||Xe.isIos()||setTimeout(function(){e.focus(!0)},100),Xe.clearsContentEditableCorrectly()||Ge.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.config.noTextarea||this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var i=this,e=Xe.canDisableAutoLinking(),t=Xe.doesAutoLinkingInContentEditable();if(e&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink){(!t||t&&e)&&(this.parent.on("newword:composer",function(){$e.getTextContent(i.element).match($e.autoLink.URL_REG_EXP)&&i.selection.executeAndRestore(function(e,t){for(var n=i.element.querySelectorAll("."+i.config.uneditableContainerClassname),o=!1,r=n.length;r--;)Ge.dom.contains(n[r],t)&&(o=!0);o||$e.autoLink(t.parentNode,[i.config.uneditableContainerClassname])})}),$e.observe(this.element,"blur",function(){$e.autoLink(i.element,[i.config.uneditableContainerClassname])}));var r=this.sandbox.getDocument().getElementsByTagName("a"),a=$e.autoLink.URL_REG_EXP,s=function(e){var t=Ge.lang.string($e.getTextContent(e)).trim();return"www."===t.substr(0,4)&&(t="http://"+t),t};$e.observe(this.element,"keydown",function(e){if(r.length){var t,n=i.selection.getSelectedNode(e.target.ownerDocument),o=$e.getParentElement(n,{nodeName:"A"},4);o&&(t=s(o),setTimeout(function(){var e=s(o);e!==t&&e.match(a)&&o.setAttribute("href",e)},0))}})}},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),Xe.supportsEvent("resizeend")){var i=["width","height"],a=i.length,s=this.element;$e.observe(s,"resizeend",function(e){var t,n=e.target||e.srcElement,o=n.style,r=0;if("IMG"===n.nodeName){for(;r<a;r++)o[t=i[r]]&&(n.setAttribute(t,parseInt(o[t],10)),o[t]="");Ge.quirks.redraw(s)}})}},_initUndoManager:function(){this.undoManager=new Ge.UndoManager(this.parent)},_initLineBreaking:function(){var o=this,r=["LI","P","H1","H2","H3","H4","H5","H6"],i=["UL","OL","MENU"];function a(e){var t=$e.getParentElement(e,{nodeName:["P","DIV"]},2);t&&$e.contains(o.element,t)&&o.selection.executeAndRestore(function(){o.config.useLineBreaks?$e.replaceWithChildNodes(t):"P"!==t.nodeName&&$e.renameElement(t,"p")})}this.config.useLineBreaks||$e.observe(this.element,["focus","keydown"],function(){if(o.isEmpty()){var e=o.doc.createElement("P");o.element.innerHTML="",o.element.appendChild(e),Xe.displaysCaretInEmptyContentEditableCorrectly()?o.selection.selectNode(e,!0):(e.innerHTML="<br>",o.selection.setBefore(e.firstChild))}}),$e.observe(this.element,"keydown",function(e){var t=e.keyCode;if(!e.shiftKey&&(t===Ge.ENTER_KEY||t===Ge.BACKSPACE_KEY)){var n=$e.getParentElement(o.selection.getSelectedNode(),{nodeName:r},4);n?setTimeout(function(){var e=o.selection.getSelectedNode();if("LI"===n.nodeName){if(!e)return;$e.getParentElement(e,{nodeName:i},2)||a(e)}t===Ge.ENTER_KEY&&n.nodeName.match(/^H[1-6]$/)&&a(e)},0):o.config.useLineBreaks&&t===Ge.ENTER_KEY&&!Ge.browser.insertsLineBreaksOnReturn()&&(e.preventDefault(),o.commands.exec("insertLineBreak"))}})}}),Qe=(Ye=_).dom,Ze=document,Je=window,et=Ze.createElement("div"),tt=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],nt=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],ot=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",Ye.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],Ye.views.Composer.prototype.style=function(){var e,t=this,n=Ze.querySelector(":focus"),o=this.textarea.element,r=o.hasAttribute("placeholder"),i=r&&o.getAttribute("placeholder"),a=o.style.display,s=o.disabled;this.focusStylesHost=et.cloneNode(!1),this.blurStylesHost=et.cloneNode(!1),this.disabledStylesHost=et.cloneNode(!1),r&&o.removeAttribute("placeholder"),o===n&&o.blur(),o.disabled=!1,o.style.display=e="none",(o.getAttribute("rows")&&"auto"===Qe.getStyle("height").from(o)||o.getAttribute("cols")&&"auto"===Qe.getStyle("width").from(o))&&(o.style.display=e=a),Qe.copyStyles(nt).from(o).to(this.editableArea).andTo(this.blurStylesHost),Qe.copyStyles(tt).from(o).to(this.element).andTo(this.blurStylesHost),Qe.insertCSS(ot).into(this.element.ownerDocument),o.disabled=!0,Qe.copyStyles(nt).from(o).to(this.disabledStylesHost),Qe.copyStyles(tt).from(o).to(this.disabledStylesHost),o.disabled=s,o.style.display=a,function(e){if(e.setActive)try{e.setActive()}catch(e){}else{var t=e.style,n=Ze.documentElement.scrollTop||Ze.body.scrollTop,o=Ze.documentElement.scrollLeft||Ze.body.scrollLeft,r={position:t.position,top:t.top,left:t.left,WebkitUserSelect:t.WebkitUserSelect};Qe.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(e),e.focus(),Qe.setStyles(r).on(e),Je.scrollTo&&Je.scrollTo(o,n)}}(o),o.style.display=e,Qe.copyStyles(nt).from(o).to(this.focusStylesHost),Qe.copyStyles(tt).from(o).to(this.focusStylesHost),o.style.display=a,Qe.copyStyles(["display"]).from(o).to(this.editableArea);var l=Ye.lang.array(nt).without(["display"]);return n?n.focus():o.blur(),r&&o.setAttribute("placeholder",i),this.parent.on("focus:composer",function(){Qe.copyStyles(l).from(t.focusStylesHost).to(t.editableArea),Qe.copyStyles(tt).from(t.focusStylesHost).to(t.element)}),this.parent.on("blur:composer",function(){Qe.copyStyles(l).from(t.blurStylesHost).to(t.editableArea),Qe.copyStyles(tt).from(t.blurStylesHost).to(t.element)}),this.parent.observe("disable:composer",function(){Qe.copyStyles(l).from(t.disabledStylesHost).to(t.editableArea),Qe.copyStyles(tt).from(t.disabledStylesHost).to(t.element)}),this.parent.observe("enable:composer",function(){Qe.copyStyles(l).from(t.blurStylesHost).to(t.editableArea),Qe.copyStyles(tt).from(t.blurStylesHost).to(t.element)}),this},it=(rt=_).dom,at=rt.browser,st={66:"bold",73:"italic",85:"underline"},rt.views.Composer.prototype.observe=function(){var i=this,n=this.getValue(!1,!1),e=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),a=this.element,t=at.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?a:this.sandbox.getWindow();if(it.observe(e,"DOMNodeRemoved",function(){clearInterval(o),i.parent.fire("destroy:composer")}),!at.supportsMutationEvents())var o=setInterval(function(){it.contains(document.documentElement,e)||(clearInterval(o),i.parent.fire("destroy:composer"))},250);it.observe(t,["drop","paste","mouseup","focus","keyup"],function(){setTimeout(function(){i.parent.fire("interaction").fire("interaction:composer")},0)}),this.config.handleTables&&(!this.tableClickHandle&&this.doc.execCommand&&rt.browser.supportsCommand(this.doc,"enableObjectResizing")&&rt.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?this.tableClickHandle=it.observe(e,["focus","mouseup","mouseover"],function(){i.doc.execCommand("enableObjectResizing",!1,"false"),i.doc.execCommand("enableInlineTableEditing",!1,"false"),i.tableClickHandle.stop()}):setTimeout(function(){i.doc.execCommand("enableObjectResizing",!1,"false"),i.doc.execCommand("enableInlineTableEditing",!1,"false")},0)),this.tableSelection=rt.quirks.tableCellsSelection(a,i.parent)),it.observe(t,"focus",function(e){i.parent.fire("focus",e).fire("focus:composer",e),setTimeout(function(){n=i.getValue(!1,!1)},0)}),it.observe(t,"blur",function(e){if(n!==i.getValue(!1,!1)){var t=e;"function"==typeof Object.create&&(t=Object.create(e,{type:{value:"change"}})),i.parent.fire("change",t).fire("change:composer",t)}i.parent.fire("blur",e).fire("blur:composer",e)}),it.observe(a,"dragenter",function(){i.parent.fire("unset_placeholder")}),it.observe(a,["drop","paste"],function(e){setTimeout(function(){i.parent.fire(e.type,e).fire(e.type+":composer",e)},0)}),it.observe(a,"keyup",function(e){var t=e.keyCode;t!==rt.SPACE_KEY&&t!==rt.ENTER_KEY||i.parent.fire("newword:composer")}),this.parent.on("paste:composer",function(){setTimeout(function(){i.parent.fire("newword:composer")},0)}),at.canSelectImagesInContentEditable()||it.observe(a,"mousedown",function(e){var t=e.target,n=a.querySelectorAll("img"),o=a.querySelectorAll("."+i.config.uneditableContainerClassname+" img"),r=rt.lang.array(n).without(o);"IMG"===t.nodeName&&rt.lang.array(r).contains(t)&&i.selection.selectNode(t)}),at.canSelectImagesInContentEditable()||it.observe(a,"drop",function(e){setTimeout(function(){i.selection.getSelection().removeAllRanges()},0)}),at.hasHistoryIssue()&&at.supportsSelectionModify()&&it.observe(a,"keydown",function(e){if(e.metaKey||e.ctrlKey){var t=e.keyCode,n=a.ownerDocument.defaultView.getSelection();37!==t&&39!==t||(37===t&&(n.modify("extend","left","lineboundary"),e.shiftKey||n.collapseToStart()),39===t&&(n.modify("extend","right","lineboundary"),e.shiftKey||n.collapseToEnd()),e.preventDefault())}}),it.observe(a,"keydown",function(e){var t=e.keyCode,n=st[t];(e.ctrlKey||e.metaKey)&&!e.altKey&&n&&(i.commands.exec(n),e.preventDefault()),8===t?function(e,t,n,o){if(t.isCollapsed())if(t.caretIsInTheBeginnig("LI"))e.preventDefault(),o.commands.exec("outdentList");else if(t.caretIsInTheBeginnig())e.preventDefault();else{if(t.caretIsFirstInSelection()&&t.getPreviousNode()&&t.getPreviousNode().nodeName&&/^H\d$/gi.test(t.getPreviousNode().nodeName)){var r=t.getPreviousNode();if(e.preventDefault(),/^\s*$/.test(r.textContent||r.innerText))r.parentNode.removeChild(r);else{var i=r.ownerDocument.createRange();i.selectNodeContents(r),i.collapse(!1),t.setSelection(i)}}var a=t.caretIsBeforeUneditable();a&&(e.preventDefault(),function(e,t,n){var o=e.getPreviousNode(t,!0),r=e.getSelectedNode();if(1!==r.nodeType&&r.parentNode!==n&&(r=r.parentNode),o)if(1==r.nodeType){var i=r.firstChild;if(1==o.nodeType)for(;r.firstChild;)o.appendChild(r.firstChild);else for(;r.firstChild;)t.parentNode.insertBefore(r.firstChild,t);r.parentNode&&r.parentNode.removeChild(r),e.setBefore(i)}else 1==o.nodeType?o.appendChild(r):t.parentNode.insertBefore(r,t),e.setBefore(r)}(t,a,n))}else t.containsUneditable()&&(e.preventDefault(),t.deleteContents())}(e,i.selection,a,i):i.config.handleTabKey&&9===t&&(e.preventDefault(),function(e,t){if(e.selection.isCollapsed()){if(e.selection.caretIsInTheBeginnig("LI")&&e.commands.exec("indentList"))return}else e.selection.deleteContents();e.commands.exec("insertHTML","&emsp;")}(i))}),it.observe(a,"keydown",function(e){var t,n=i.selection.getSelectedNode(!0),o=e.keyCode;!n||"IMG"!==n.nodeName||o!==rt.BACKSPACE_KEY&&o!==rt.DELETE_KEY||((t=n.parentNode).removeChild(n),"A"!==t.nodeName||t.firstChild||t.parentNode.removeChild(t),setTimeout(function(){rt.quirks.redraw(a)},0),e.preventDefault())}),!this.config.contentEditableMode&&at.hasIframeFocusIssue()&&(it.observe(e,"focus",function(){setTimeout(function(){i.doc.querySelector(":focus")!==i.element&&i.focus()},0)}),it.observe(this.element,"blur",function(){setTimeout(function(){i.selection.getSelection().removeAllRanges()},0)}));var r={IMG:"Image: ",A:"Link: "};it.observe(a,"mouseover",function(e){var t,n=e.target,o=n.nodeName;"A"!==o&&"IMG"!==o||n.hasAttribute("title")||(t=r[o]+(n.getAttribute("href")||n.getAttribute("src")),n.setAttribute("title",t))})},(lt=_).views.Synchronizer=Ot.extend({constructor:function(e,t,n){this.editor=e,this.textarea=t,this.composer=n,this._observe()},fromComposerToTextarea:function(e){this.textarea.setValue(lt.lang.string(this.composer.getValue(!1,!1)).trim(),e)},fromTextareaToComposer:function(e){var t=this.textarea.getValue(!1,!1);t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(e){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(e):this.fromComposerToTextarea(e)},_observe:function(){var t,n=this,e=this.textarea.element.form,o=function(){t=setInterval(function(){n.fromComposerToTextarea()},400)},r=function(){clearInterval(t),t=null};o(),e&&(lt.dom.observe(e,"submit",function(){n.sync(!0)}),lt.dom.observe(e,"reset",function(){setTimeout(function(){n.fromTextareaToComposer()},0)})),this.editor.on("change_view",function(e){"composer"!==e||t?"textarea"===e&&(n.fromComposerToTextarea(!0),r()):(n.fromTextareaToComposer(!0),o())}),this.editor.on("destroy:composer",r)}}),_.views.Textarea=_.views.View.extend({name:"textarea",constructor:function(e,t,n){this.base(e,t,n),this._observe()},clear:function(){this.element.value=""},getValue:function(e){var t=this.isEmpty()?"":this.element.value;return!1!==e&&(t=this.parent.parse(t)),t},setValue:function(e,t){t&&(e=this.parent.parse(e)),this.element.value=e},cleanUp:function(){var e=this.parent.parse(this.element.value);this.element.value=e},hasPlaceholderSet:function(){var e=_.browser.supportsPlaceholderAttributeOn(this.element),t=this.element.getAttribute("placeholder")||null,n=this.element.value;return e&&!n||n===t},isEmpty:function(){return!_.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var e=this.element,n=this.parent,o={focusin:"focus",focusout:"blur"},t=_.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];n.on("beforeload",function(){_.dom.observe(e,t,function(e){var t=o[e.type]||e.type;n.fire(t).fire(t+":textarea")}),_.dom.observe(e,["paste","drop"],function(){setTimeout(function(){n.fire("paste").fire("paste:textarea")},0)})})}}),ut={name:dt,style:!0,toolbar:dt,showToolbarAfterInit:!0,autoLink:!0,handleTables:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},parser:(ct=_).dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",useLineBreaks:!0,stylesheets:[],placeholderText:dt,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,uneditableContainerClassname:"wysihtml5-uneditable-container"},ct.Editor=ct.lang.Dispatcher.extend({constructor:function(e,t){if(this.editableElement="string"==typeof e?document.getElementById(e):e,this.config=ct.lang.object({}).merge(ut).merge(t).get(),this._isCompatible=ct.browser.supported(),"textarea"!=this.editableElement.nodeName.toLowerCase()&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0),this.config.noTextarea||(this.textarea=new ct.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea),!this._isCompatible||!this.config.supportTouchDevices&&ct.browser.isTouchDevice()){var n=this;setTimeout(function(){n.fire("beforeload").fire("load")},0)}else ct.dom.addClass(document.body,this.config.bodyClassName),this.composer=new ct.views.Composer(this,this.editableElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea||(this.synchronizer=new ct.views.Synchronizer(this,this.textarea,this.composer)),this.config.toolbar&&(this.toolbar=new ct.toolbar.Toolbar(this,this.config.toolbar,this.config.showToolbarAfterInit))},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(e,t){return this.currentView.getValue(e,t)},setValue:function(e,t){return this.fire("unset_placeholder"),e?(this.currentView.setValue(e,t),this):this.clear()},cleanUp:function(){this.currentView.cleanUp()},focus:function(e){return this.currentView.focus(e),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(e,t){var n=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,o=this.config.parser(e,{rules:this.config.parserRules,cleanUp:this.config.cleanUp,context:n,uneditableClass:this.config.uneditableContainerClassname,clearInternals:t});return"object"==typeof e&&ct.quirks.redraw(e),o},_initParser:function(){this.on("paste:composer",function(){var e=this;e.composer.selection.executeAndRestore(function(){ct.quirks.cleanPastedHTML(e.composer.element),e.parse(e.composer.element)},!0)})}}),ht=(ft=_).dom,mt="wysihtml5-command-dialog-opened",pt="input, select, textarea",gt="[data-wysihtml5-dialog-field]",yt="data-wysihtml5-dialog-field",ft.toolbar.Dialog=ft.lang.Dispatcher.extend({constructor:function(e,t){this.link=e,this.container=t},_observe:function(){if(!this._observed){var n=this,o=function(e){var t=n._serialize();t==n.elementToChange?n.fire("edit",t):n.fire("save",t),n.hide(),e.preventDefault(),e.stopPropagation()};ht.observe(n.link,"click",function(){ht.hasClass(n.link,mt)&&setTimeout(function(){n.hide()},0)}),ht.observe(this.container,"keydown",function(e){var t=e.keyCode;t===ft.ENTER_KEY&&o(e),t===ft.ESCAPE_KEY&&(n.fire("cancel"),n.hide())}),ht.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",o),ht.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(e){n.fire("cancel"),n.hide(),e.preventDefault(),e.stopPropagation()});for(var e=this.container.querySelectorAll(pt),t=0,r=e.length,i=function(){clearInterval(n.interval)};t<r;t++)ht.observe(e[t],"change",i);this._observed=!0}},_serialize:function(){for(var e=this.elementToChange||{},t=this.container.querySelectorAll(gt),n=t.length,o=0;o<n;o++)e[t[o].getAttribute(yt)]=t[o].value;return e},_interpolate:function(e){for(var t,n,o,r=document.querySelector(":focus"),i=this.container.querySelectorAll(gt),a=i.length,s=0;s<a;s++)(t=i[s])!==r&&(e&&"hidden"===t.type||(n=t.getAttribute(yt),o=this.elementToChange&&"boolean"!=typeof this.elementToChange?this.elementToChange.getAttribute(n)||"":t.defaultValue,t.value=o))},show:function(e){if(!ht.hasClass(this.link,mt)){var t=this,n=this.container.querySelector(pt);if(this.elementToChange=e,this._observe(),this._interpolate(),e&&(this.interval=setInterval(function(){t._interpolate(!0)},500)),ht.addClass(this.link,mt),this.container.style.display="",this.fire("show"),n&&!e)try{n.focus()}catch(e){}}},hide:function(){clearInterval(this.interval),this.elementToChange=null,ht.removeClass(this.link,mt),this.container.style.display="none",this.fire("hide")}}),bt=(vt=_).dom,wt={position:"relative"},Ct={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},Nt={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},xt={"x-webkit-speech":"",speech:""},vt.toolbar.Speech=function(e,t){var n=document.createElement("input");if(vt.browser.supportsSpeechApiOn(n)){var o=e.editor.textarea.element.getAttribute("lang");o&&(xt.lang=o);var r=document.createElement("div");vt.lang.object(Ct).merge({width:t.offsetWidth+"px",height:t.offsetHeight+"px"}),bt.insert(n).into(r),bt.insert(r).into(t),bt.setStyles(Nt).on(n),bt.setAttributes(xt).on(n),bt.setStyles(Ct).on(r),bt.setStyles(wt).on(t);var i="onwebkitspeechchange"in n?"webkitspeechchange":"speechchange";bt.observe(n,i,function(){e.execCommand("insertText",n.value),n.value=""}),bt.observe(n,"click",function(e){bt.hasClass(t,"wysihtml5-command-disabled")&&e.preventDefault(),e.stopPropagation()})}else t.style.display="none"},St="wysihtml5-command-disabled",Tt="wysihtml5-commands-disabled",Rt="wysihtml5-command-active",At="wysihtml5-action-active",_t=(Et=_).dom,Et.toolbar.Toolbar=Ot.extend({constructor:function(e,t,n){this.editor=e,this.container="string"==typeof t?document.getElementById(t):t,this.composer=e.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),n&&this.show();for(var o=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),r=o.length,i=0;i<r;i++)new Et.toolbar.Speech(this,o[i])},_getLinks:function(e){for(var t,n,o,r,i,a=this[e+"Links"]=Et.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+e+"]")).get(),s=a.length,l=0,c=this[e+"Mapping"]={};l<s;l++)o=(t=a[l]).getAttribute("data-wysihtml5-"+e),r=t.getAttribute("data-wysihtml5-"+e+"-value"),n=this.container.querySelector("[data-wysihtml5-"+e+"-group='"+o+"']"),i=this._getDialog(t,o),c[o+":"+r]={link:t,group:n,name:o,value:r,dialog:i,state:!1}},_getDialog:function(t,n){var e,o,r=this,i=this.container.querySelector("[data-wysihtml5-dialog='"+n+"']");return i&&((e=Et.toolbar["Dialog_"+n]?new Et.toolbar["Dialog_"+n](t,i):new Et.toolbar.Dialog(t,i)).on("show",function(){o=r.composer.selection.getBookmark(),r.editor.fire("show:dialog",{command:n,dialogContainer:i,commandLink:t})}),e.on("save",function(e){o&&r.composer.selection.setBookmark(o),r._execCommand(n,e),r.editor.fire("save:dialog",{command:n,dialogContainer:i,commandLink:t})}),e.on("cancel",function(){r.editor.focus(!1),r.editor.fire("cancel:dialog",{command:n,dialogContainer:i,commandLink:t})})),e},execCommand:function(e,t){if(!this.commandsDisabled){var n=this.commandMapping[e+":"+t];n&&n.dialog&&!n.state?n.dialog.show():this._execCommand(e,t)}},_execCommand:function(e,t){this.editor.focus(!1),this.composer.commands.exec(e,t),this._updateLinkStates()},execAction:function(e){var t=this.editor;"change_view"===e&&t.textarea&&(t.currentView===t.textarea?t.fire("change_view","composer"):t.fire("change_view","textarea")),"showSource"==e&&t.fire("showSource")},_observe:function(){for(var o=this,t=this.editor,n=this.container,e=this.commandLinks.concat(this.actionLinks),r=e.length,i=0;i<r;i++)"A"===e[i].nodeName?_t.setAttributes({href:"javascript:;",unselectable:"on"}).on(e[i]):_t.setAttributes({unselectable:"on"}).on(e[i]);_t.delegate(n,"[data-wysihtml5-command], [data-wysihtml5-action]","mousedown",function(e){e.preventDefault()}),_t.delegate(n,"[data-wysihtml5-command]","click",function(e){var t=this.getAttribute("data-wysihtml5-command"),n=this.getAttribute("data-wysihtml5-command-value");o.execCommand(t,n),e.preventDefault()}),_t.delegate(n,"[data-wysihtml5-action]","click",function(e){var t=this.getAttribute("data-wysihtml5-action");o.execAction(t),e.preventDefault()}),t.on("interaction:composer",function(){o._updateLinkStates()}),t.on("focus:composer",function(){o.bookmark=null}),this.editor.config.handleTables&&(t.on("tableselect:composer",function(){o.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display=""}),t.on("tableunselect:composer",function(){o.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display="none"})),t.on("change_view",function(e){t.textarea&&setTimeout(function(){o.commandsDisabled="composer"!==e,o._updateLinkStates(),o.commandsDisabled?_t.addClass(n,Tt):_t.removeClass(n,Tt)},0)})},_updateLinkStates:function(){var e,t,n,o,r=this.commandMapping,i=this.actionMapping;for(e in r)o=r[e],this.commandsDisabled?(t=!1,_t.removeClass(o.link,Rt),o.group&&_t.removeClass(o.group,Rt),o.dialog&&o.dialog.hide()):(t=this.composer.commands.state(o.name,o.value),_t.removeClass(o.link,St),o.group&&_t.removeClass(o.group,St)),o.state!==t&&((o.state=t)?(_t.addClass(o.link,Rt),o.group&&_t.addClass(o.group,Rt),o.dialog&&("object"==typeof t||Et.lang.object(t).isArray()?(!o.dialog.multiselect&&Et.lang.object(t).isArray()&&(t=1!==t.length||t[0],o.state=t),o.dialog.show(t)):o.dialog.hide())):(_t.removeClass(o.link,Rt),o.group&&_t.removeClass(o.group,Rt),o.dialog&&o.dialog.hide()));for(e in i)"change_view"===(n=i[e]).name&&(n.state=this.editor.currentView===this.editor.textarea,n.state?_t.addClass(n.link,At):_t.removeClass(n.link,At))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}}),(It=_).toolbar.Dialog_createTable=It.toolbar.Dialog.extend({show:function(e){this.base(e)}}),function(c){c.dom;var d="[data-wysihtml5-dialog-field]",u="data-wysihtml5-dialog-field";c.toolbar.Dialog_foreColorStyle=c.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var e={},t=this.container.querySelectorAll(d),n=t.length,o=0;o<n;o++)e[t[o].getAttribute(u)]=t[o].value;return e},_interpolate:function(e){for(var t,n=document.querySelector(":focus"),o=this.container.querySelectorAll(d),r=o.length,i=0,a=this.elementToChange?c.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,s=a?a.getAttribute("style"):null,l=s?c.quirks.styleParser.parseColor(s,"color"):null;i<r;i++)(t=o[i])!==n&&(e&&"hidden"===t.type||"color"===t.getAttribute(u)&&(l?l[3]&&1!=l[3]?t.value="rgba("+l[0]+","+l[1]+","+l[2]+","+l[3]+");":t.value="rgb("+l[0]+","+l[1]+","+l[2]+");":t.value="rgb(0,0,0);"))}})}(_),function(a){a.dom;a.toolbar.Dialog_fontSizeStyle=a.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){return{size:this.container.querySelector('[data-wysihtml5-dialog-field="size"]').value}},_interpolate:function(e){var t=document.querySelector(":focus"),n=this.container.querySelector("[data-wysihtml5-dialog-field='size']"),o=this.elementToChange?a.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,r=o?o.getAttribute("style"):null,i=r?a.quirks.styleParser.parseFontSize(r):null;n&&n!==t&&i&&!/^\s*$/.test(i)&&(n.value=i)}})}(_);var Lt,kt,Dt,Mt,Bt,Pt,Ht=(Lt=function(){"use strict";function e(e){this.string=e}return e.prototype.toString=function(){return""+this.string},e}(),kt=function(e){"use strict";function t(e){return r[e]||"&amp;"}var n={},o=Lt,r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=/[&<>"'`]/g,a=/[&<>"'`]/;n.extend=function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])};var s,l=Object.prototype.toString;n.toString=l,(s=function(e){return"function"==typeof e})(/x/)&&(s=function(e){return"function"==typeof e&&"[object Function]"===l.call(e)}),n.isFunction=s;var c=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===l.call(e)};return n.isArray=c,n.escapeExpression=function(e){return e instanceof o?e.toString():e||0===e?(e=""+e,a.test(e)?e.replace(i,t):e):""},n.isEmpty=function(e){return!e&&0!==e||!(!c(e)||0!==e.length)},n}(),Dt=function(){"use strict";function e(e,t){var n;t&&t.firstLine&&(e+=" - "+(n=t.firstLine)+":"+t.firstColumn);for(var o=Error.prototype.constructor.call(this,e),r=0;r<i.length;r++)this[i[r]]=o[i[r]];n&&(this.lineNumber=n,this.column=t.firstColumn)}var i=["description","fileName","lineNumber","message","name","number","stack"];return e.prototype=new Error,e}(),Mt=function(e,t){"use strict";function n(e,t){var r;this.helpers=e||{},this.partials=t||{},(r=this).registerHelper("helperMissing",function(e){if(2!==arguments.length)throw new a("Missing helper: '"+e+"'")}),r.registerHelper("blockHelperMissing",function(e,t){var n=t.inverse||function(){},o=t.fn;return d(e)&&(e=e.call(this)),!0===e?o(this):!1===e||null==e?n(this):c(e)?0<e.length?r.helpers.each(e,t):n(this):o(e)}),r.registerHelper("each",function(e,t){var n,o=t.fn,r=t.inverse,i=0,a="";if(d(e)&&(e=e.call(this)),t.data&&(n=f(t.data)),e&&"object"==typeof e)if(c(e))for(var s=e.length;i<s;i++)n&&(n.index=i,n.first=0===i,n.last=i===e.length-1),a+=o(e[i],{data:n});else for(var l in e)e.hasOwnProperty(l)&&(n&&(n.key=l,n.index=i,n.first=0===i),a+=o(e[l],{data:n}),i++);return 0===i&&(a=r(this)),a}),r.registerHelper("if",function(e,t){return d(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||i.isEmpty(e)?t.inverse(this):t.fn(this)}),r.registerHelper("unless",function(e,t){return r.helpers.if.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})}),r.registerHelper("with",function(e,t){return d(e)&&(e=e.call(this)),i.isEmpty(e)?void 0:t.fn(e)}),r.registerHelper("log",function(e,t){var n=t.data&&null!=t.data.level?parseInt(t.data.level,10):1;r.log(n,e)})}function o(e,t){u.log(e,t)}var r={},i=kt,a=Dt;r.VERSION="1.3.0";r.COMPILER_REVISION=4;r.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};var c=i.isArray,d=i.isFunction,s=i.toString,l="[object Object]";(r.HandlebarsEnvironment=n).prototype={constructor:n,logger:u,log:o,registerHelper:function(e,t,n){if(s.call(e)===l){if(n||t)throw new a("Arg not supported with multiple helpers");i.extend(this.helpers,e)}else n&&(t.not=n),this.helpers[e]=t},registerPartial:function(e,t){s.call(e)===l?i.extend(this.partials,e):this.partials[e]=t}};var u={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(e,t){if(u.level<=e){var n=u.methodMap[e];"undefined"!=typeof console&&console[n]&&console[n].call(console,t)}}};r.logger=u,r.log=o;var f=function(e){var t={};return i.extend(t,e),t};return r.createFrame=f,r}(),Bt=function(e,t,n){"use strict";function r(e,n,o){var t=function(e,t){return n(e,(t=t||{}).data||o)};return t.program=e,t.depth=0,t}var o={},i=kt,c=Dt,a=n.COMPILER_REVISION,s=n.REVISION_CHANGES;return o.checkRevision=function(e){var t=e&&e[0]||1;if(t!==a){if(t<a){var n=s[a],o=s[t];throw new c("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+n+") or downgrade your runtime to an older version ("+o+").")}throw new c("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}},o.template=function(a,l){if(!l)throw new c("No environment passed to template");var s={escapeExpression:i.escapeExpression,invokePartial:function(e,t,n,o,r,i){var a=l.VM.invokePartial.apply(this,arguments);if(null!=a)return a;if(l.compile){var s={helpers:o,partials:r,data:i};return r[t]=l.compile(e,{data:void 0!==i},l),r[t](n,s)}throw new c("The partial "+t+" could not be compiled when running in runtime-only mode")},programs:[],program:function(e,t,n){var o=this.programs[e];return n?o=r(e,t,n):o||(o=this.programs[e]=r(e,t)),o},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n={},i.extend(n,t),i.extend(n,e)),n},programWithDepth:l.VM.programWithDepth,noop:l.VM.noop,compilerInfo:null};return function(e,t){var n,o,r=(t=t||{}).partial?t:l;t.partial||(n=t.helpers,o=t.partials);var i=a.call(s,r,e,n,o,t.data);return t.partial||l.VM.checkRevision(s.compilerInfo),i}},o.programWithDepth=function(e,n,o){var r=Array.prototype.slice.call(arguments,3),t=function(e,t){return t=t||{},n.apply(this,[e,t.data||o].concat(r))};return t.program=e,t.depth=r.length,t},o.program=r,o.invokePartial=function(e,t,n,o,r,i){var a={partial:!0,helpers:o,partials:r,data:i};if(void 0===e)throw new c("The partial "+t+" could not be found");return e instanceof Function?e(n,a):void 0},o.noop=function(){return""},o}(0,0,Mt),function(e,t,n,o,r){"use strict";var i=Mt,a=Lt,s=Dt,l=kt,c=Bt,d=function(){var t=new i.HandlebarsEnvironment;return l.extend(t,i),t.SafeString=a,t.Exception=s,t.Utils=l,t.VM=c,t.template=function(e){return c.template(e,t)},t},u=d();return u.create=d,u}());this.wysihtml5=this.wysihtml5||{},this.wysihtml5.tpl=this.wysihtml5.tpl||{},this.wysihtml5.tpl.blockquote=Ht.template(function(e,t,n,o,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var i,a="",s="function",l=this.escapeExpression;return a+='<li>\n  <a class="btn ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:this.noop,fn:this.program(1,function(e,t){var n,o="";return o+="btn-"+l(typeof(n=null==(n=null==(n=e&&e.options)||!1===n?n:n.toolbar)||!1===n?n:n.size)===s?n.apply(e):n)},r),data:r}))||0===i)&&(a+=i),a+=' btn-default" data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="blockquote" data-wysihtml5-display-format-name="false" tabindex="-1">\n    ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.fa,{hash:{},inverse:this.program(5,function(e,t){return'\n      <span class="glyphicon glyphicon-quote"></span>\n    '},r),fn:this.program(3,function(e,t){return' \n      <span class="fa fa-quote-left"></span>\n    '},r),data:r}))||0===i)&&(a+=i),a+="\n  </a>\n</li>\n"}),this.wysihtml5.tpl.color=Ht.template(function(e,t,n,o,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var i,a="",s="function",l=this.escapeExpression;return a+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:this.noop,fn:this.program(1,function(e,t){var n,o="";return o+="btn-"+l(typeof(n=null==(n=null==(n=e&&e.options)||!1===n?n:n.toolbar)||!1===n?n:n.size)===s?n.apply(e):n)},r),data:r}))||0===i)&&(a+=i),a+='" data-toggle="dropdown" tabindex="-1">\n    <span class="current-color">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.black)===s?i.apply(t):i)+'</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="black"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="black">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.black)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="silver"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="silver">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.silver)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="gray"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="gray">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.gray)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="maroon"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="maroon">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.maroon)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="red"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="red">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.red)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="purple"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="purple">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.purple)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="green"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="green">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.green)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="olive"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="olive">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.olive)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="navy"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="navy">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.navy)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="blue"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="blue">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.blue)===s?i.apply(t):i)+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="orange"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="orange">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.colours)||!1===i?i:i.orange)===s?i.apply(t):i)+"</a></li>\n  </ul>\n</li>\n"}),this.wysihtml5.tpl.emphasis=Ht.template(function(e,t,n,o,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var i,a="",s="function",l=this.escapeExpression,c=this;function d(e,t){var n,o="";return o+="btn-"+l(typeof(n=null==(n=null==(n=e&&e.options)||!1===n?n:n.toolbar)||!1===n?n:n.size)===s?n.apply(e):n)}return a+='<li>\n  <div class="btn-group">\n    <a class="btn ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:c.noop,fn:c.program(1,d,r),data:r}))||0===i)&&(a+=i),a+=' btn-default" data-wysihtml5-command="bold" title="CTRL+B" tabindex="-1">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.emphasis)||!1===i?i:i.bold)===s?i.apply(t):i)+'</a>\n    <a class="btn ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:c.noop,fn:c.program(1,d,r),data:r}))||0===i)&&(a+=i),a+="\n  </div>\n</li>\n"}),this.wysihtml5.tpl["font-styles"]=Ht.template(function(e,t,n,o,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var i,a="",s="function",l=this.escapeExpression;return a+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:this.noop,fn:this.program(1,function(e,t){var n,o="";return o+="btn-"+l(typeof(n=null==(n=null==(n=e&&e.options)||!1===n?n:n.toolbar)||!1===n?n:n.size)===s?n.apply(e):n)},r),data:r}))||0===i)&&(a+=i),a+='" data-toggle="dropdown">\n    ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.fa,{hash:{},inverse:this.program(5,function(e,t){return'\n      <span class="glyphicon glyphicon-font"></span>\n    '},r),fn:this.program(3,function(e,t){return'\n      <span class="fa fa-font"></span>\n    '},r),data:r}))||0===i)&&(a+=i),a+='\n    <span class="current-font">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.font_styles)||!1===i?i:i.normal)===s?i.apply(t):i)+'</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="p" tabindex="-1">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.font_styles)||!1===i?i:i.normal)===s?i.apply(t):i)+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h1" tabindex="-1">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.font_styles)||!1===i?i:i.h1)===s?i.apply(t):i)+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h2" tabindex="-1">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.font_styles)||!1===i?i:i.h2)===s?i.apply(t):i)+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h3" tabindex="-1">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.font_styles)||!1===i?i:i.h3)===s?i.apply(t):i)+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h4" tabindex="-1">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.font_styles)||!1===i?i:i.h4)===s?i.apply(t):i)+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h5" tabindex="-1">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.font_styles)||!1===i?i:i.h5)===s?i.apply(t):i)+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h6" tabindex="-1">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.font_styles)||!1===i?i:i.h6)===s?i.apply(t):i)+"</a></li>\n  </ul>\n</li>\n"}),this.wysihtml5.tpl.html=Ht.template(function(e,t,n,o,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var i,a="",s="function",l=this.escapeExpression;return a+='<li>\n  <div class="btn-group">\n    <a class="btn ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:this.noop,fn:this.program(1,function(e,t){var n,o="";return o+="btn-"+l(typeof(n=null==(n=null==(n=e&&e.options)||!1===n?n:n.toolbar)||!1===n?n:n.size)===s?n.apply(e):n)},r),data:r}))||0===i)&&(a+=i),a+=' btn-default" data-wysihtml5-action="change_view" title="'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.html)||!1===i?i:i.edit)===s?i.apply(t):i)+'" tabindex="-1">\n      ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.fa,{hash:{},inverse:this.program(5,function(e,t){return'\n        <span class="glyphicon glyphicon-pencil"></span>\n      '},r),fn:this.program(3,function(e,t){return'\n        <span class="fa fa-pencil"></span>\n      '},r),data:r}))||0===i)&&(a+=i),a+="\n    </a>\n  </div>\n</li>\n"}),this.wysihtml5.tpl.image=Ht.template(function(e,t,n,o,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var i,a="",s="function",l=this.escapeExpression,c=this;return a+='<li>\n  <div class="bootstrap-wysihtml5-insert-image-modal modal fade" data-wysihtml5-dialog="insertImage">\n    <div class="modal-dialog ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.smallmodals,{hash:{},inverse:c.noop,fn:c.program(1,function(e,t){return"modal-sm"},r),data:r}))||0===i)&&(a+=i),a+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.image)||!1===i?i:i.insert)===s?i.apply(t):i)+'</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-image-url form-control">\n          </div> \n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.image)||!1===i?i:i.cancel)===s?i.apply(t):i)+'</a>\n          <a class="btn btn-primary" data-dismiss="modal"  data-wysihtml5-dialog-action="save" href="#">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.image)||!1===i?i:i.insert)===s?i.apply(t):i)+'</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:c.noop,fn:c.program(3,function(e,t){var n,o="";return o+="btn-"+l(typeof(n=null==(n=null==(n=e&&e.options)||!1===n?n:n.toolbar)||!1===n?n:n.size)===s?n.apply(e):n)},r),data:r}))||0===i)&&(a+=i),a+=' btn-default" data-wysihtml5-command="insertImage" title="'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.image)||!1===i?i:i.insert)===s?i.apply(t):i)+'" tabindex="-1">\n    ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.fa,{hash:{},inverse:c.program(7,function(e,t){return'\n      <span class="glyphicon glyphicon-picture"></span>\n    '},r),fn:c.program(5,function(e,t){return'\n      <span class="fa fa-file-image-o"></span>\n    '},r),data:r}))||0===i)&&(a+=i),a+="\n  </a>\n</li>\n"}),this.wysihtml5.tpl.link=Ht.template(function(e,t,n,o,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var i,a="",s="function",l=this.escapeExpression;return a+='<li>\n  <div class="bootstrap-wysihtml5-insert-link-modal modal fade" data-wysihtml5-dialog="createLink">\n    <div class="modal-dialog ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.smallmodals,{hash:{},inverse:this.noop,fn:this.program(1,function(e,t){return"modal-sm"},r),data:r}))||0===i)&&(a+=i),a+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.link)||!1===i?i:i.insert)===s?i.apply(t):i)+'</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-link-url form-control" data-wysihtml5-dialog-field="href">\n          </div> \n          <div class="checkbox">\n            <label> \n              <input type="checkbox" class="bootstrap-wysihtml5-insert-link-target" checked>'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.link)||!1===i?i:i.target)===s?i.apply(t):i)+'\n            </label>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.link)||!1===i?i:i.cancel)===s?i.apply(t):i)+'</a>\n          <a href="#" class="btn btn-primary" data-dismiss="modal" data-wysihtml5-dialog-action="save">'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.link)||!1===i?i:i.insert)===s?i.apply(t):i)+'</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:this.noop,fn:this.program(3,function(e,t){var n,o="";return o+="btn-"+l(typeof(n=null==(n=null==(n=e&&e.options)||!1===n?n:n.toolbar)||!1===n?n:n.size)===s?n.apply(e):n)},r),data:r}))||0===i)&&(a+=i),a+=' btn-default" data-wysihtml5-command="createLink" title="'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.link)||!1===i?i:i.insert)===s?i.apply(t):i)+'" tabindex="-1">\n    ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.fa,{hash:{},inverse:this.program(7,function(e,t){return'\n      <span class="glyphicon glyphicon-share"></span>\n    '},r),fn:this.program(5,function(e,t){return'\n      <span class="fa fa-share-square-o"></span>\n    '},r),data:r}))||0===i)&&(a+=i),a+="\n  </a>\n</li>\n"}),this.wysihtml5.tpl.lists=Ht.template(function(e,t,n,o,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var i,a="",s="function",l=this.escapeExpression;function c(e,t){var n,o="";return o+="btn-"+l(typeof(n=null==(n=null==(n=e&&e.options)||!1===n?n:n.toolbar)||!1===n?n:n.size)===s?n.apply(e):n)}return a+='<li>\n  <div class="btn-group">\n    <a class="btn ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:this.noop,fn:this.program(1,c,r),data:r}))||0===i)&&(a+=i),a+=' btn-default" data-wysihtml5-command="insertUnorderedList" title="'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.lists)||!1===i?i:i.unordered)===s?i.apply(t):i)+'" tabindex="-1">\n    ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.fa,{hash:{},inverse:this.program(5,function(e,t){return'\n      <span class="glyphicon glyphicon-list"></span>\n    '},r),fn:this.program(3,function(e,t){return'\n      <span class="fa fa-list-ul"></span>\n    '},r),data:r}))||0===i)&&(a+=i),a+='\n    </a>\n    <a class="btn ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.size,{hash:{},inverse:this.noop,fn:this.program(1,c,r),data:r}))||0===i)&&(a+=i),a+=' btn-default" data-wysihtml5-command="insertOrderedList" title="'+l(typeof(i=null==(i=null==(i=t&&t.locale)||!1===i?i:i.lists)||!1===i?i:i.ordered)===s?i.apply(t):i)+'" tabindex="-1">\n    ',((i=n.if.call(t,null==(i=null==(i=t&&t.options)||!1===i?i:i.toolbar)||!1===i?i:i.fa,{hash:{},inverse:this.program(9,function(e,t){return'\n      <span class="glyphicon glyphicon-th-list"></span>\n    '},r),fn:this.program(7,function(e,t){return'\n      <span class="fa fa-list-ol"></span>\n    '},r),data:r}))||0===i)&&(a+=i),a+="\n    </a>\n  </div>\n</li>\n"}),function(e,t){!function(s,a){"use strict";var l=function(e,t,n){if(a.tpl[e])return a.tpl[e]({locale:t,options:n})},n=function(e,t){this.el=e;var n=s.extend(!0,{},c,t);for(var o in n.customTemplates)a.tpl[o]=n.customTemplates[o];this.toolbar=this.createToolbar(e,n),this.editor=this.createEditor(n)};n.prototype={constructor:n,createEditor:function(e){e=e||{},(e=s.extend(!0,{},e)).toolbar=this.toolbar[0];var t=new a.Editor(this.el[0],e);if(t.composer.editableArea.contentDocument?this.addMoreShortcuts(t,t.composer.editableArea.contentDocument.body||t.composer.editableArea.contentDocument,e.shortcuts):this.addMoreShortcuts(t,t.composer.editableArea,e.shortcuts),e&&e.events)for(var n in e.events)t.on(n,e.events[n]);return t.on("beforeload",this.syncBootstrapDialogEvents),t},syncBootstrapDialogEvents:function(){var o=this;s.map(this.toolbar.commandMapping,function(e,t){return[e]}).filter(function(e,t,n){return e.dialog}).map(function(e,t,n){return e.dialog}).forEach(function(e,t,n){e.on("show",function(e){s(this.container).modal("show")}),e.on("hide",function(e){s(this.container).modal("hide"),o.composer.focus()}),s(e.container).on("shown.bs.modal",function(){s(this).find("input, select, textarea").first().focus()})})},createToolbar:function(e,t){var i=this,n=s("<ul/>",{class:"wysihtml5-toolbar",style:"display:none"}),o=t.locale||c.locale||"en";d.hasOwnProperty(o)||(console.debug("Locale '"+o+"' not found. Available locales are: "+Object.keys(d)+". Falling back to 'en'."),o="en");var r=s.extend(!0,{},d.en,d[o]);for(var a in t.toolbar)t.toolbar[a]&&(n.append(l(a,r,t)),"html"===a&&this.initHtml(n));return n.find('a[data-wysihtml5-command="formatBlock"]').click(function(e){var t=e.delegateTarget||e.target||e.srcElement,n=s(t),o=n.data("wysihtml5-display-format-name"),r=n.data("wysihtml5-format-name")||n.html();void 0!==o&&"true"!==o||i.toolbar.find(".current-font").text(r)}),n.find('a[data-wysihtml5-command="foreColor"]').click(function(e){var t=e.target||e.srcElement,n=s(t);i.toolbar.find(".current-color").text(n.html())}),this.el.before(n),n},initHtml:function(t){var n='a[data-wysihtml5-action="change_view"]';t.find(n).click(function(e){t.find("a.btn").not(n).toggleClass("disabled")})},addMoreShortcuts:function(r,e,i){a.dom.observe(e,"keydown",function(e){var t=e.keyCode,n=i[t];if((e.ctrlKey||e.metaKey||e.altKey)&&n&&a.commands[n]){var o=r.toolbar.commandMapping[n+":null"];o&&o.dialog&&!o.state?o.dialog.show():a.commands[n].exec(r.composer,n),e.preventDefault()}})}};var o={resetDefaults:function(){s.fn.wysihtml5.defaultOptions=s.extend(!0,{},s.fn.wysihtml5.defaultOptionsCache)},bypassDefaults:function(t){return this.each(function(){var e=s(this);e.data("wysihtml5",new n(e,t))})},shallowExtend:function(e){var t=s.extend({},s.fn.wysihtml5.defaultOptions,e||{},s(this).data());return o.bypassDefaults.apply(this,[t])},deepExtend:function(e){var t=s.extend(!0,{},s.fn.wysihtml5.defaultOptions,e||{});return o.bypassDefaults.apply(this,[t])},init:function(e){return o.shallowExtend.apply(this,[e])}};s.fn.wysihtml5=function(e){return o[e]?o[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void s.error("Method "+e+" does not exist on jQuery.wysihtml5"):o.init.apply(this,arguments)},s.fn.wysihtml5.Constructor=n;var c=s.fn.wysihtml5.defaultOptions={toolbar:{"font-styles":!0,color:!1,emphasis:{small:!0},blockquote:!0,lists:!0,html:!1,link:!0,image:!0,smallmodals:!1},parserRules:{classes:{"wysiwyg-color-silver":1,"wysiwyg-color-gray":1,"wysiwyg-color-white":1,"wysiwyg-color-maroon":1,"wysiwyg-color-red":1,"wysiwyg-color-purple":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-olive":1,"wysiwyg-color-yellow":1,"wysiwyg-color-navy":1,"wysiwyg-color-blue":1,"wysiwyg-color-teal":1,"wysiwyg-color-aqua":1,"wysiwyg-color-orange":1},tags:{b:{},i:{},strong:{},em:{},p:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},blockquote:{},u:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{check_attributes:{href:"url"},set_attributes:{target:"_blank",rel:"nofollow"}},span:1,div:1,small:1,code:1,pre:1}},locale:"en",shortcuts:{83:"small"}};void 0===s.fn.wysihtml5.defaultOptionsCache&&(s.fn.wysihtml5.defaultOptionsCache=s.extend(!0,{},s.fn.wysihtml5.defaultOptions));var d=s.fn.wysihtml5.locale={}}(e,this.wysihtml5)}(jQuery),(Pt=this.wysihtml5).commands.small={exec:function(e,t){return Pt.commands.formatInline.exec(e,t,"small")},state:function(e,t){return Pt.commands.formatInline.state(e,t,"small")}},function(e){e.fn.wysihtml5.locale.en=e.fn.wysihtml5.locale["en-US"]={font_styles:{normal:"Normal text",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6"},emphasis:{bold:"Bold",italic:"Italic",underline:"Underline",small:"Small"},lists:{unordered:"Unordered list",ordered:"Ordered list",outdent:"Outdent",indent:"Indent"},link:{insert:"Insert link",cancel:"Cancel",target:"Open link in new window"},image:{insert:"Insert image",cancel:"Cancel"},html:{edit:"Edit HTML"},colours:{black:"Black",silver:"Silver",gray:"Grey",maroon:"Maroon",red:"Red",purple:"Purple",green:"Green",olive:"Olive",navy:"Navy",blue:"Blue",orange:"Orange"}}}(jQuery);return{Init:function(){e(".wysiwyg").each(function(){e(this).parent().hasClass("stk-wysiwyg")||e(this).parent().addClass("stk-wysiwyg")}),e(".wysiwyg").wysihtml5({toolbar:{fa:!0,"font-styles":!1,emphasis:{bold:!0,italic:!1,underline:!1,small:!1},lists:!0,html:!1,link:!0,image:!1,color:!1,blockquote:!1}})}}});