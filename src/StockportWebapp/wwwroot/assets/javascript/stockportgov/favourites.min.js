define(["jquery","matchboxconfig"],function(t,e){var a=0,r=!0,i=!1,o=function(e,i){t.get("/favourites/add?slug="+e+"&type="+i,function(t,e){r&&(a++,c())})},n=function(o,n){t.get("/favourites/remove?slug="+o+"&type="+n,function(n,s){r&&(a--,c()),i&&(t("#item-card-"+o).remove(),0===t(".group-card").length&&(t("#no-results").show(),t("#favourites-list").hide()),e.Init())})},s=function(){t(".add-favourite").on("click",function(){var e=t(this).attr("data-slug"),a=t(this).attr("data-type");o(e,a),t("#add-favourite-"+e).addClass("hidden"),t("#remove-favourite-"+e).removeClass("hidden"),t("#print-favourite-group-item-"+e).removeClass("hidden")}),t(".remove-favourite").on("click",function(){var e=t(this).attr("data-slug"),a=t(this).attr("data-type");n(e,a),t("#add-favourite-"+e).removeClass("hidden"),t("#remove-favourite-"+e).addClass("hidden"),t("#print-favourite-group-item-"+e).addClass("hidden")})},u=function(){var t=window.location.href.toLowerCase().replace("http://","").replace("https://",""),e=t.split("/");if(e.length>1){var a=e[1];return"organisations"===a?"groups":a}return""},f=function(){var t=window.location.href.toLowerCase().replace("http://","").replace("https://",""),e=t.split("/");if(e.length>1){var a=e[1];if(e.length>2&&("favourites"===e[2]||"manage"===e[2]))return"favourites"===e[2]&&(i=!0),r=!1,""}switch(a){case"groups":return"StockportWebapp.Models.Group";case"organisations":return"StockportWebapp.Models.Group"}return""},d=function(){var e=f();if(""!==e&&v("favourites")){var r=t.parseJSON(unescape(v("favourites"))),i=r[e];"undefined"!=typeof i&&(a=i.length,c())}},c=function(){0==a?t("#favourites-bar").hide():t("#favourites-bar").length>0?(t(".count","#favourites-bar").html(a),t("#favourites-bar").show()):(t("body").append('<div id="favourites-bar"><div class="grid-container grid-100"><i class="fa fa-star"></i><u><span class="count">'+a+"</span><span>&nbsp;favourites</span></u></div></div>"),t("#favourites-bar").animate({bottom:0},500).animate({bottom:-7},100).animate({bottom:0},100),t("#favourites-bar").on("click",function(){window.location.href="/"+u()+"/favourites"}))},v=function(t){for(var e=t+"=",a=document.cookie.split(";"),r=0;r<a.length;r++){for(var i=a[r];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(e))return i.substring(e.length,i.length)}return""},l=function(){s(),d()};return{Init:l}});