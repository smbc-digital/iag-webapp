define(["jquery","refinebybar"],function($,refinebybar){var locationDefaults={Name:"Stockport",Latitude:53.405817,Longitude:-2.158046,CurrentLocationError:"We couldn't find your current location -- please check the location settings on your device.",LocationLookupError:"We couldn't find this location -- please check the location and try again.",NoLocationError:"No location entered -- please enter a location and try again."},location={Name:locationDefaults.Name,Latitude:locationDefaults.Latitude,Longitude:locationDefaults.Longitude,HasBeenUpdated:!1,ShowLocationError:function(o){$("#location-autocomplete").css("border","1px solid #C83725"),$("#locationError").html(o),$("#locationError").show()},HideLocationError:function(){$("#location-autocomplete").css("border","1px solid #D8D8D8"),$("#locationError").hide()},SetLocationValues:function(){$("#postcode").val(this.Name);var controlId=$("#locationControlId").val();$("#"+controlId).length&&$("#"+controlId).val(this.Name),$("#address").val(this.Name);var longitudeControlId=$("#longitudeControlId").val();longitudeControlId="undefined"==typeof longitudeControlId||""===longitudeControlId?"longitude":longitudeControlId,$("#"+longitudeControlId).length&&$("#"+longitudeControlId).val(this.Longitude);var latitudeControlId=$("#latitudeControlId").val();latitudeControlId="undefined"==typeof latitudeControlId||""===latitudeControlId?"latitude":latitudeControlId,$("#"+latitudeControlId).length&&$("#"+latitudeControlId).val(this.Latitude),""===$("#callback").val()?(updateLocationFieldSize(),$("#getLocation").hide()):eval($("#callback").val())},SetLocation:function(o,t,e){this.Name=o,this.Longitude=e,this.Latitude=t,this.HasBeenUpdated=!0},GetLocationInputValue:function(){return $("#location-autocomplete").val()},SetLocationInputValue:function(o){$("#location-autocomplete").val(o)}},extractFromAdress=function(o,t){for(var e=0;e<o.length;e++)for(var n=0;n<o[e].types.length;n++)if(o[e].types[n]===t)return o[e].long_name;return""},updateLocationFieldSize=function(){$("#hiddenSelectLocation").html("<option>"+$("#postcode").val()+"</option>"),$("#postcode").width($("#hiddenSelectLocation").width())},buildLocation=function(o){var t=extractFromAdress(o,"route"),e=extractFromAdress(o,"postal_code"),n=extractFromAdress(o,"locality"),a=extractFromAdress(o,"country"),i=(t+" "+e+" "+n).trim();return""===i&&(i=a),i},addValidationErrorToMeetingLocationField=function(){$("#address").hasClass("input-validation-error")&&$("#location-autocomplete").addClass("input-validation-error")},locationLookupNonAutocomplete=function(){var address=location.GetLocationInputValue(),geocoder=new google.maps.Geocoder;geocoder.geocode({address:address+", UK"},function(results,status){status===google.maps.GeocoderStatus.OK?""===$("#callback").val()?(location.SetLocation(buildLocation(results[0].address_components),results[0].geometry.location.lat(),results[0].geometry.location.lng()),location.SetLocationValues(),location.HideLocationError()):eval($("#callback").val()):location.ShowLocationError(locationDefaults.LocationLookupError)})},setSelectBoxes=function(){$(window).width()>767&&($("#hiddenSelectCategory").html("<option>"+$("#selectCategory").find(":selected").text()+"</option>"),$("#selectCategory").width($("#hiddenSelectCategory").width()),$("#hiddenSelectOrder").html("<option>"+$("#selectOrder").find(":selected").text()+"</option>"),$("#selectOrder").width($("#hiddenSelectOrder").width()),$("#hiddenSelectLocation").html("<option>"+$("#postcode").val()+"</option>"),$("#postcode").width($("#hiddenSelectLocation").width()))},init=function(){if($("#selectCategory").change(function(){$("#hiddenSelectCategory").html("<option>"+$("#selectCategory").find(":selected").text()+"</option>"),$("#selectCategory").width($("#hiddenSelectCategory").width())}),$("#selectOrder").change(function(){$("#hiddenSelectOrder").html("<option>"+$("#selectOrder").find(":selected").text()+"</option>"),$("#selectOrder").width($("#hiddenSelectOrder").width())}),$("#postcode").change(function(){$("#hiddenSelectLocation").html("<option>"+$("#postcode").val()+"</option>"),$("#postcode").width($("#hiddenSelectLocation").width())}),$("#selectOrderMobile").change(function(){var o=$("#selectOrderMobile").find(":selected").text();$("#selectOrder").val(o),$("#filterButton").click()}),$("#postcode").click(function(){$("#getLocation").toggle()}),$(".location-search-input-autoset").length&&$(".location-search-input-autoset").val($("#address").val()),$("#currentLocation").click(function(){return navigator.geolocation.getCurrentPosition(function(o){var t=new google.maps.Geocoder,e=new google.maps.LatLng(o.coords.latitude,o.coords.longitude);t.geocode({latLng:e},function(o,t){if(t===google.maps.GeocoderStatus.OK){var e=buildLocation(o[0].address_components);location.SetLocationInputValue(e),location.SetLocation(e,o[0].geometry.location.lat(),o[0].geometry.location.lng()),location.HideLocationError()}else location.ShowLocationError(locationDefaults.CurrentLocationError)})},function(){location.ShowLocationError(locationDefaults.CurrentLocationError)},{maximumAge:1e4,timeout:6e3,enableHighAccuracy:!0}),!1}),$("#allLocations").click(function(){$("#location").val("Stockport"),$("#longitude").val("-2.158046"),$("#latitude").val("53.405817"),$(".location-search-input").val("Stockport"),location.SetLocation("Stockport","53.405817","-2.158046")}),$("#btnLocationAutoComplete").click(function(o){o.preventDefault();var t=location.GetLocationInputValue();return""===t?(location.ShowLocationError(locationDefaults.NoLocationError),!1):void(location.HasBeenUpdated===!0?(location.SetLocationValues(),location.HideLocationError()):locationLookupNonAutocomplete())}),$(".location-search-input-autoset").length&&(addValidationErrorToMeetingLocationField(),$(".location-search-input-autoset").on("change",function(){$("#address").val("");var o=$("#latitudeControlId").val();o="undefined"==typeof o||""===o?"latitude":o,$("#"+o).length&&$("#"+o).val(location.Latitude);var t=$("#longitudeControlId").val();t="undefined"==typeof t||""===t?"longitude":t,$("#"+t).length&&$("#"+t).val(location.Longitude)}),$("form").on("invalid-form.validate",function(o,t){for(var e=0;e<t.errorList.length;e++)"address"==t.errorList[e].element.id&&($("#location-autocomplete").addClass("input-validation-error"),$("[data-valmsg-for='Address']").show())})),$(".primary-filter-form-autocomplete").length||$(".location-search-input").length){var o=new google.maps.LatLngBounds(new google.maps.LatLng(53.3435829465,-2.2532923571),new google.maps.LatLng(53.4410365421,-2.0231358656)),t={bounds:o,types:["locality","postal_code","sublocality","country","administrative_area_level_1","administrative_area_level_2"],componentRestrictions:{country:"gb"}},e=new google.maps.places.SearchBox(document.getElementById("location-autocomplete"),t);e.addListener("places_changed",function(){var o=e.getPlaces();if(0!==o.length){var t=o[0].name;$(".location-search-input-autoset").length&&("undefined"!=typeof o[0].formatted_address&&(t=o[0].formatted_address.replace(", UK","").replace(", United Kingdom",""),t.indexOf(o[0].name)<0&&(t=o[0].name+", "+t)),$("#location-autocomplete").removeClass("input-validation-error"),$("[data-valmsg-for='Address']").hide()),location.SetLocation(t,o[0].geometry.location.lat(),o[0].geometry.location.lng()),location.HideLocationError(),$(".location-search-input-autoset").length&&location.SetLocationValues()}})}};return setSelectBoxes(),{Init:function(){init(),$(window).resize(function(){setSelectBoxes()})}}});