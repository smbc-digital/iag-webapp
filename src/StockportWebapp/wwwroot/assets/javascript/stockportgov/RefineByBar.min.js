define(["jquery","utils"],function(e,i){var n=[],t=!1,r=e(window).width(),a=function(i){e(".link","#listing-refine-bar").each(function(){this!==i&&e(this).closest(".refine").hasClass("open")&&o(this)})},l=function(i){var t=e(i).parent();e(t).hasClass("open")?o(i):e(t).addClass("open"),n=[],e("input[type=checkbox]",t).each(function(){n.push(e(this).prop("checked"))})},o=function(i){var r=e(i).closest(".refine");e("input[type=checkbox]",e(r)).each(function(i){e(this).prop("checked",n[i])}),e(r).removeClass("open"),t&&e("#favourites-bar").show(),c()},c=function(){e(".badge","#listing-refine-bar").css("visibility","hidden");var i=0;e(".refine","#listing-refine-bar").each(function(){var n=0;if(e("input[type=checkbox]",e(this)).each(function(){e(this).prop("checked")&&(n++,i++)}),e(".refine-filters.location",e(this)).length){var t=e("input[name=latitude]",e("#refine-by-bar-container"));1==t.length&&""!==t.val()&&"0"!==t.val()&&(n++,i++)}n>0?(e(".badge",e(this)).html("<span>"+n+"</span>").css("visibility","visible"),e(".none-selected-error",this).length&&(e(".none-selected-error",this).hide(),e(".apply",this).removeClass("disabled").off("click").on("click",function(){s()}),e(".update-button","#listing-refine-bar").removeClass("disabled").prop("disabled",""))):e(".none-selected-error",this).length&&(e(".none-selected-error",this).show(),e(".apply",this).addClass("disabled").off("click"),e(".update-button","#listing-refine-bar").addClass("disabled").prop("disabled","disabled"))}),i>0&&e(".refine-all .badge","#listing-refine-bar").html("<span>"+i+"</span>").css("visibility","visible")},s=function(){var n=window.location.href;n=i.StripParamFromQueryString(n,"page"),n=i.StripParamFromQueryString(n,"keeptag"),n=i.StripParamFromQueryString(n,"fromsearch"),n=i.StripParamFromQueryString(n,"tag"),n=i.StripParamFromQueryString(n,"price"),n=i.StripParamFromQueryString(n,"getinvolved"),n=i.StripParamFromQueryString(n,"subcategories"),"1"!==e("#KeepLocationQueryValues").val()&&(n=i.StripParamFromQueryString(n,"longitude"),n=i.StripParamFromQueryString(n,"latitude"),n=i.StripParamFromQueryString(n,"location"));var t=f();"undefined"==typeof t&&(t=""),n+=n.indexOf("?")<0?"?keeptag="+t+"&fromsearch=true":"&keeptag="+t+"&fromsearch=true",e("input:checked","#listing-refine-bar").each(function(){n+="&"+e(this).prop("name")+"="+e(this).val()}),e("input[name=longitude]","#refine-by-bar-container").each(function(){n+="&longitude="+e(this).val()}),e("input[name=latitude]","#refine-by-bar-container").each(function(){n+="&latitude="+e(this).val()}),e("input[name=location]","#refine-by-bar-container").each(function(){n+="&location="+e(this).val()}),window.location.href=n},f=function(){return e("input[name=tag]","#listing-refine-bar").val()},h=function(){var i=e(window).width();e("#refine-slider").css("left",i);var n=e("#location").val();""!==n?(e(".location-search-input").val(n),e(".search-all","#listing-refine-bar").show(),e(".search-all","#primary-filter-listing-refine-bar").show()):e(".search-all","#listing-refine-bar").hide()},u=function(){e("#location").val(""),e("#longitude").val("0"),e("#latitude").val("0"),e(".location-search-input").val("All locations"),c()},d=function(){var i=e(window).height()-e(".update-cancel-bar","#listing-refine-bar").height();e("#refine-slider").height(i+50),e(".scroller","#refine-slider").height(i+50)},p=function(){t=e("#favourites-bar:visible").length,e("#favourites-bar").hide(),e("#refine-slider").removeClass("hide-on-mobile").animate({left:0},250),d(),e("body").css("overflow-y","hidden"),n=[],e("input[type=checkbox]","#listing-refine-bar").each(function(){n.push(e(this).prop("checked"))}),r=e(window).width()},b=function(){e(".scroller","#refine-slider").height(""),e("#refine-slider").height("")},g=function(){var i=e(window).width();e("#refine-slider").animate({left:i},250,"swing",function(){e("#refine-slider").addClass("hide-on-mobile")}),e("#refine-slider").height(""),e(".scroller","#refine-slider").height(""),e("body").css("overflow-y","scroll"),e("input[type=checkbox]","#listing-refine-bar").each(function(i){e(this).prop("checked",n[i])}),c()},v=function(){e("input[type=checkbox]","#listing-refine-bar").each(function(){e(this).prop("checked",!1)}),u()},m=function(){c(),s()},y=function(i){e("label.toggle",e(i).parent().parent().parent()).toggle(),e(i).toggleClass("show-more"),e(i).text(e(i).html().indexOf(" all ")>0?e(i).text().replace(" all "," fewer "):e(i).text().replace(" fewer "," all "))};return{Init:function(){c(),h(),e("#listing-refine-bar").show(),e(".link","#listing-refine-bar").on("click",function(){a(this),l(this)}),e(".cancel","#listing-refine-bar").on("click",function(){o(this)}),e(".apply","#listing-refine-bar").on("click",function(){s()}),e("input[type=checkbox]","#listing-refine-bar").on("click",function(){c()}),e("#reveal-refine-by").click(function(){p()}),e(".update-cancel-bar .cancel","#listing-refine-bar").on("click",function(){g()}),e(".update-cancel-bar .apply","#listing-refine-bar").on("click",function(){e("#btnLocationAutoComplete").click()}),e(".clear-all-filters a","#listing-refine-bar").on("click",function(){v(),c()}),e(".search-all","#listing-refine-bar").on("click",function(){u()}),e(".show","#listing-refine-bar").on("click",function(){y(this)}),e(window).on("resize",function(){b(),r!==e(window).width()?g():d()})},ApplyLocation:m}});