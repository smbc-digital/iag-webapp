define(["jquery","utils"],function(e,i){var n=[],t=!1,r=e(window).width(),a=function(i){var r=e(i).closest(".refine");e("input[type=checkbox]",e(r)).each(function(i){e(this).prop("checked",n[i])}),e(r).removeClass("open"),t&&e(".favourites-bar").show(),l()},l=function(){e(".badge","#listing-refine-bar").css("visibility","hidden");var i=0;e(".refine","#listing-refine-bar").each(function(){var n=0;if(e("input[type=checkbox]",e(this)).each(function(){e(this).prop("checked")&&(n++,i++)}),e(".refine-filters.location",e(this)).length){var t=e("input[name=latitude]",e("#refine-by-bar-container"));1==t.length&&""!==t.val()&&"0"!==t.val()&&(n++,i++)}n>0?(e(".badge",e(this)).html("<span>"+n+"</span>").css("visibility","visible"),e(".none-selected-error",this).length&&(e(".none-selected-error",this).hide(),e(".apply",this).removeClass("disabled").off("click").on("click",function(){o()}),e(".update-button","#listing-refine-bar").removeClass("disabled").prop("disabled",""))):e(".none-selected-error",this).length&&(e(".none-selected-error",this).show(),e(".apply",this).addClass("disabled").off("click"),e(".update-button","#listing-refine-bar").addClass("disabled").prop("disabled","disabled"))}),i>0&&e(".refine-all .badge","#listing-refine-bar").html("<span>"+i+"</span>").css("visibility","visible")},o=function(){var n=window.location.href;n=i.StripParamFromQueryString(n,"page"),n=i.StripParamFromQueryString(n,"keeptag"),n=i.StripParamFromQueryString(n,"fromsearch"),n=i.StripParamFromQueryString(n,"tag"),n=i.StripParamFromQueryString(n,"price"),n=i.StripParamFromQueryString(n,"getinvolved"),n=i.StripParamFromQueryString(n,"subcategories"),n=i.StripParamFromQueryString(n,"organisation"),"1"!==e("#KeepLocationQueryValues").val()&&(n=i.StripParamFromQueryString(n,"longitude"),n=i.StripParamFromQueryString(n,"latitude"),n=i.StripParamFromQueryString(n,"location"));var t=c();void 0===t&&(t=""),n.indexOf("?")<0?n+="?keeptag="+t+"&fromsearch=true":n+="&keeptag="+t+"&fromsearch=true",e("input:checked","#listing-refine-bar").each(function(){n+="&"+e(this).prop("name")+"="+e(this).val()}),e("input[name=longitude]","#refine-by-bar-container").each(function(){n+="&longitude="+e(this).val()}),e("input[name=latitude]","#refine-by-bar-container").each(function(){n+="&latitude="+e(this).val()}),e("input[name=location]","#refine-by-bar-container").each(function(){n+="&location="+e(this).val()}),window.location.href=n},c=function(){return e("input[name=tag]","#listing-refine-bar").val()},s=function(){e("#location").val(""),e("#longitude").val("0"),e("#latitude").val("0"),e(".location-search-input").val("All locations"),l()},h=function(){var i,a;t=e(".favourites-bar:visible").length,e(".favourites-bar").hide(),e("#refine-slider").removeClass("hide-on-mobile").animate({left:0},250),i=e(".update-cancel-bar","#listing-refine-bar").outerHeight(),a=e(window).height()-i,e(".scroller","#refine-slider").height(a),e("body").css("overflow-y","hidden"),n=[],e("input[type=checkbox]","#listing-refine-bar").each(function(){n.push(e(this).prop("checked"))}),r=e(window).width()},f=function(){var i=e(window).width();e("#refine-slider").animate({left:i},250,"swing",function(){e("#refine-slider").addClass("hide-on-mobile")}),e("#refine-slider").height(""),e(".scroller","#refine-slider").height(""),e("body").css("overflow-y","scroll"),e("input[type=checkbox]","#listing-refine-bar").each(function(i){e(this).prop("checked",n[i])}),l()};return{Init:function(){l(),function(){var i=e(window).width();e("#refine-slider").css("left",i);var n=e("#location").val();""!==n?(e(".location-search-input").val(n),e(".search-all","#listing-refine-bar").show(),e(".search-all","#primary-filter-listing-refine-bar").show()):e(".search-all","#listing-refine-bar").hide()}(),e("#listing-refine-bar").show(),e(".link","#listing-refine-bar").on("click",function(){var i,t,r;i=this,e(".link","#listing-refine-bar").each(function(){this!==i&&e(this).closest(".refine").hasClass("open")&&a(this)}),r=e(t=this).parent(),e(r).hasClass("open")?a(t):e(r).addClass("open"),n=[],e("input[type=checkbox]",r).each(function(){n.push(e(this).prop("checked"))})}),e(".cancel","#listing-refine-bar").on("click",function(){a(this)}),e(".apply","#listing-refine-bar").on("click",function(){o()}),e("input[type=checkbox]","#listing-refine-bar").on("click",function(){l()}),e("#reveal-refine-by").click(function(){h()}),e(".update-cancel-bar .cancel","#listing-refine-bar").on("click",function(){f()}),e(".update-cancel-bar .apply","#listing-refine-bar").on("click",function(){e("#btnLocationAutoComplete").click()}),e(".clear-all-filters a","#listing-refine-bar").on("click",function(){e("input[type=checkbox]","#listing-refine-bar").each(function(){e(this).prop("checked",!1)}),s(),l()}),e(".search-all","#listing-refine-bar").on("click",function(){s()}),e(".show","#listing-refine-bar").on("click",function(){var i;e("label.toggle",e(i=this).parent().parent().parent()).toggle(),e(i).toggleClass("show-more"),e(i).html().indexOf(" all ")>0?e(i).text(e(i).text().replace(" all "," fewer ")):e(i).text(e(i).text().replace(" fewer "," all "))}),e(window).on("resize",function(){e(".scroller","#refine-slider").height(""),r!==e(window).width()&&f()})},ApplyLocation:function(){l(),o()}}});