define(["jquery","utils"],function(e,i){var n=[],t=e(window).width(),r=function(i){e(".link","#event-listing-refine-bar").each(function(){this!==i&&e(this).closest(".refine").hasClass("open")&&o(this)})},a=function(i){var t=e(i).parent();e(t).hasClass("open")?o(i):e(t).addClass("open"),n=[],e("input[type=checkbox]",t).each(function(){n.push(e(this).prop("checked"))})},o=function(i){var t=e(i).closest(".refine");e("input[type=checkbox]",e(t)).each(function(i){e(this).prop("checked",n[i])}),e(t).removeClass("open"),c()},c=function(){e(".badge","#event-listing-refine-bar").css("visibility","hidden");var i=0;e(".refine","#event-listing-refine-bar").each(function(){var n=0;e("input[type=checkbox]",e(this)).each(function(){e(this).prop("checked")&&(n++,i++)});var t=e("input[name=latitude]",e(this));1==t.length&&""!==t.val()&&"0"!==t.val()&&(n++,i++),n>0?(e(".badge",e(this)).html("<span>"+n+"</span>").css("visibility","visible"),e(".none-selected-error",this).length&&(e(".none-selected-error",this).hide(),e(".apply",this).removeClass("disabled").off("click").on("click",function(){l()}),e(".update-button","#event-listing-refine-bar").removeClass("disabled").prop("disabled",""))):e(".none-selected-error",this).length&&(e(".none-selected-error",this).show(),e(".apply",this).addClass("disabled").off("click"),e(".update-button","#event-listing-refine-bar").addClass("disabled").prop("disabled","disabled"))}),i>0&&e(".refine-all .badge","#event-listing-refine-bar").html("<span>"+i+"</span>").css("visibility","visible")},l=function(){var n=window.location.href;n=i.StripParamFromQueryString(n,"page"),n=i.StripParamFromQueryString(n,"keeptag"),n=i.StripParamFromQueryString(n,"fromsearch"),n=i.StripParamFromQueryString(n,"tag"),n=i.StripParamFromQueryString(n,"price"),n=i.StripParamFromQueryString(n,"longitude"),n=i.StripParamFromQueryString(n,"latitude"),n=i.StripParamFromQueryString(n,"location");var t=s();"undefined"==typeof t&&(t=""),n+=n.indexOf("?")<0?"?keeptag="+t+"&fromsearch=true":"&keeptag="+t+"&fromsearch=true",e("input:checked","#event-listing-refine-bar").each(function(){n+="&"+e(this).prop("name")+"="+e(this).val()}),e("input[name=longitude]","#event-listing-refine-bar").each(function(){n+="&longitude="+e(this).val()}),e("input[name=latitude]","#event-listing-refine-bar").each(function(){n+="&latitude="+e(this).val()}),e("input[name=location]","#event-listing-refine-bar").each(function(){n+="&location="+e(this).val()}),window.location.href=n},s=function(){return e("input[name=tag]","#event-listing-refine-bar").val()},f=function(){var i=e(window).width();e("#refine-slider").css("left",i);var n=e("#location").val();""!==n?(e(".location-search-input").val(n),e(".search-all","#event-listing-refine-bar").show()):e(".search-all","#event-listing-refine-bar").hide()},h=function(){e("#location").val(""),e("#longitude").val("0"),e("#latitude").val("0"),e(".location-search-input").val("All locations"),c()},u=function(){var i=e(document).scrollTop();e("#refine-slider").css("top",i).removeClass("hide-on-mobile").animate({left:0},250);var r=e("#refine-slider").height()-e(".update-cancel-bar","#event-listing-refine-bar").height();e(".scroller","#refine-slider").height(r),e("body").css("overflow-y","hidden"),n=[],e("input[type=checkbox]","#event-listing-refine-bar").each(function(){n.push(e(this).prop("checked"))}),t=e(window).width()},d=function(){e(".scroller","#refine-slider").height("")},p=function(){var i=e(window).width();e("#refine-slider").animate({left:i},250,"swing",function(){e("#refine-slider").addClass("hide-on-mobile")}),e("body").css("overflow-y","scroll"),e("input[type=checkbox]","#event-listing-refine-bar").each(function(i){e(this).prop("checked",n[i])}),c()},v=function(){e("input[type=checkbox]","#event-listing-refine-bar").each(function(){e(this).prop("checked",!1)}),h()},b=function(){c(),l()};return{Init:function(){c(),f(),e("#event-listing-refine-bar").show(),e(".link","#event-listing-refine-bar").on("click",function(){r(this),a(this)}),e(".cancel","#event-listing-refine-bar").on("click",function(){o(this)}),e(".apply","#event-listing-refine-bar").on("click",function(){l()}),e("input[type=checkbox]","#event-listing-refine-bar").on("click",function(){c()}),e("#reveal-refine-by").click(function(){u()}),e(".update-cancel-bar .cancel","#event-listing-refine-bar").on("click",function(){p()}),e(".update-cancel-bar .apply","#event-listing-refine-bar").on("click",function(){e("#btnLocationAutoComplete").click()}),e(".clear-all-filters a","#event-listing-refine-bar").on("click",function(){v(),c()}),e(".search-all","#event-listing-refine-bar").on("click",function(){h()}),e(window).on("resize",function(){d(),t!==e(window).width()&&p()})},ApplyLocation:b}});