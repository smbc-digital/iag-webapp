define(["jquery","utils"],function(i,e){var n=[],t=!1,r=i(window).width(),a=function(e){i(".link","#listing-refine-bar").each(function(){this!==e&&i(this).closest(".refine").hasClass("open")&&l(this)})},o=function(e){var t=i(e).parent();i(t).hasClass("open")?l(e):i(t).addClass("open"),n=[],i("input[type=checkbox]",t).each(function(){n.push(i(this).prop("checked"))})},l=function(e){var r=i(e).closest(".refine");i("input[type=checkbox]",i(r)).each(function(e){i(this).prop("checked",n[e])}),i(r).removeClass("open"),t&&i("#favourites-bar").show(),c()},c=function(){i(".badge","#listing-refine-bar").css("visibility","hidden");var e=0;i(".refine","#listing-refine-bar").each(function(){var n=0;i("input[type=checkbox]",i(this)).each(function(){i(this).prop("checked")&&(n++,e++)});var t=i("input[name=latitude]",i("#refine-by-bar-container"));1==t.length&&""!==t.val()&&"0"!==t.val()&&(n++,e++),n>0?(i(".badge",i(this)).html("<span>"+n+"</span>").css("visibility","visible"),i(".none-selected-error",this).length&&(i(".none-selected-error",this).hide(),i(".apply",this).removeClass("disabled").off("click").on("click",function(){s()}),i(".update-button","#listing-refine-bar").removeClass("disabled").prop("disabled",""))):i(".none-selected-error",this).length&&(i(".none-selected-error",this).show(),i(".apply",this).addClass("disabled").off("click"),i(".update-button","#listing-refine-bar").addClass("disabled").prop("disabled","disabled"))}),e>0&&i(".refine-all .badge","#listing-refine-bar").html("<span>"+e+"</span>").css("visibility","visible")},s=function(){var n=window.location.href;n=e.StripParamFromQueryString(n,"page"),n=e.StripParamFromQueryString(n,"keeptag"),n=e.StripParamFromQueryString(n,"fromsearch"),n=e.StripParamFromQueryString(n,"tag"),n=e.StripParamFromQueryString(n,"price"),n=e.StripParamFromQueryString(n,"getinvolved"),n=e.StripParamFromQueryString(n,"subcategories"),n=e.StripParamFromQueryString(n,"organisation"),"1"!==i("#KeepLocationQueryValues").val()&&(n=e.StripParamFromQueryString(n,"longitude"),n=e.StripParamFromQueryString(n,"latitude"),n=e.StripParamFromQueryString(n,"location"));var t=f();"undefined"==typeof t&&(t=""),n+=n.indexOf("?")<0?"?keeptag="+t+"&fromsearch=true":"&keeptag="+t+"&fromsearch=true",i("input:checked","#listing-refine-bar").each(function(){n+="&"+i(this).prop("name")+"="+i(this).val()}),i("input[name=longitude]","#refine-by-bar-container").each(function(){n+="&longitude="+i(this).val()}),i("input[name=latitude]","#refine-by-bar-container").each(function(){n+="&latitude="+i(this).val()}),i("input[name=location]","#refine-by-bar-container").each(function(){n+="&location="+i(this).val()}),window.location.href=n},f=function(){return i("input[name=tag]","#listing-refine-bar").val()},h=function(){var e=i(window).width();i("#refine-slider").css("left",e);var n=i("#location").val();""!==n?(i(".location-search-input").val(n),i(".search-all","#listing-refine-bar").show(),i(".search-all","#primary-filter-listing-refine-bar").show()):i(".search-all","#listing-refine-bar").hide()},u=function(){i("#location").val(""),i("#longitude").val("0"),i("#latitude").val("0"),i(".location-search-input").val("All locations"),c()},d=function(){var e=i(window).height()-i(".update-cancel-bar","#listing-refine-bar").height();i("#refine-slider").height(e+50),i(".scroller","#refine-slider").height(e+50)},p=function(){t=i("#favourites-bar:visible").length,i("#favourites-bar").hide(),i("#refine-slider").removeClass("hide-on-mobile").animate({left:0},250),d(),i("body").css("overflow-y","hidden"),n=[],i("input[type=checkbox]","#listing-refine-bar").each(function(){n.push(i(this).prop("checked"))}),r=i(window).width()},b=function(){i(".scroller","#refine-slider").height(""),i("#refine-slider").height("")},g=function(){var e=i(window).width();i("#refine-slider").animate({left:e},250,"swing",function(){i("#refine-slider").addClass("hide-on-mobile")}),i("#refine-slider").height(""),i(".scroller","#refine-slider").height(""),i("body").css("overflow-y","scroll"),i("input[type=checkbox]","#listing-refine-bar").each(function(e){i(this).prop("checked",n[e])}),c()},m=function(){i("input[type=checkbox]","#listing-refine-bar").each(function(){i(this).prop("checked",!1)}),u()},v=function(){c(),s()},y=function(e){i("label.toggle",i(e).parent().parent().parent()).toggle(),i(e).toggleClass("show-more"),i(e).text(i(e).html().indexOf(" all ")>0?i(e).text().replace(" all "," fewer "):i(e).text().replace(" fewer "," all "))};return{Init:function(){c(),h(),i("#listing-refine-bar").show(),i(".link","#listing-refine-bar").on("click",function(){a(this),o(this)}),i(".cancel","#listing-refine-bar").on("click",function(){l(this)}),i(".apply","#listing-refine-bar").on("click",function(){s()}),i("input[type=checkbox]","#listing-refine-bar").on("click",function(){c()}),i("#reveal-refine-by").click(function(){p()}),i(".update-cancel-bar .cancel","#listing-refine-bar").on("click",function(){g()}),i(".update-cancel-bar .apply","#listing-refine-bar").on("click",function(){i("#btnLocationAutoComplete").click()}),i(".clear-all-filters a","#listing-refine-bar").on("click",function(){m(),c()}),i(".search-all","#listing-refine-bar").on("click",function(){u()}),i(".show","#listing-refine-bar").on("click",function(){y(this)}),i(window).on("resize",function(){b(),r!==i(window).width()?g():d()})},ApplyLocation:v}});