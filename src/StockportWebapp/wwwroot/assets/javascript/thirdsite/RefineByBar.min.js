define(["jquery","utils"],function(t,n){var r=[],a=t(window).width(),l=function(e){var i=t(e).closest(".refine");t("input[type=checkbox]",t(i)).each(function(e){t(this).prop("checked",r[e])}),t(i).removeClass("open"),o()},o=function(){t(".badge","#event-listing-refine-bar").css("visibility","hidden");var n=0;t(".refine","#event-listing-refine-bar").each(function(){var e=0;t("input[type=checkbox]",t(this)).each(function(){t(this).prop("checked")&&(e++,n++)});var i=t("input[name=latitude]",t(this));1==i.length&&""!==i.val()&&"0"!==i.val()&&(e++,n++),0<e?(t(".badge",t(this)).html("<span>"+e+"</span>").css("visibility","visible"),t(".none-selected-error",this).length&&(t(".none-selected-error",this).hide(),t(".apply",this).removeClass("disabled").off("click").on("click",function(){c()}),t(".update-button","#event-listing-refine-bar").removeClass("disabled").prop("disabled",""))):t(".none-selected-error",this).length&&(t(".none-selected-error",this).show(),t(".apply",this).addClass("disabled").off("click"),t(".update-button","#event-listing-refine-bar").addClass("disabled").prop("disabled","disabled"))}),0<n&&t(".refine-all .badge","#event-listing-refine-bar").html("<span>"+n+"</span>").css("visibility","visible")},c=function(){var e=window.location.href;e=n.StripParamFromQueryString(e,"page"),e=n.StripParamFromQueryString(e,"keeptag"),e=n.StripParamFromQueryString(e,"fromsearch"),e=n.StripParamFromQueryString(e,"tag"),e=n.StripParamFromQueryString(e,"price"),e=n.StripParamFromQueryString(e,"longitude"),e=n.StripParamFromQueryString(e,"latitude"),e=n.StripParamFromQueryString(e,"location");var i=s();void 0===i&&(i=""),e.indexOf("?")<0?e+="?keeptag="+i+"&fromsearch=true":e+="&keeptag="+i+"&fromsearch=true",t("input:checked","#event-listing-refine-bar").each(function(){e+="&"+t(this).prop("name")+"="+t(this).val()}),t("input[name=longitude]","#event-listing-refine-bar").each(function(){e+="&longitude="+t(this).val()}),t("input[name=latitude]","#event-listing-refine-bar").each(function(){e+="&latitude="+t(this).val()}),t("input[name=location]","#event-listing-refine-bar").each(function(){e+="&location="+t(this).val()}),window.location.href=e},s=function(){return t("input[name=tag]","#event-listing-refine-bar").val()},e=function(){t("#location").val(""),t("#longitude").val("0"),t("#latitude").val("0"),t(".location-search-input").val("All locations"),o()},i=function(){var e=t(window).width();t("#refine-slider").animate({left:e},250,"swing",function(){t("#refine-slider").addClass("hide-on-mobile")}),t("body").css("overflow-y","scroll"),t("input[type=checkbox]","#event-listing-refine-bar").each(function(e){t(this).prop("checked",r[e])}),o()};return{Init:function(){o(),function(){var e=t(window).width();t("#refine-slider").css("left",e);var i=t("#location").val();""!==i?(t(".location-search-input").val(i),t(".search-all","#event-listing-refine-bar").show(),t(".search-all","#primary-filter-listing-refine-bar").show()):t(".search-all","#event-listing-refine-bar").hide()}(),t("#event-listing-refine-bar").show(),t(".link","#event-listing-refine-bar").on("click",function(){var e,i,n;e=this,t(".link","#event-listing-refine-bar").each(function(){this!==e&&t(this).closest(".refine").hasClass("open")&&l(this)}),n=t(i=this).parent(),t(n).hasClass("open")?l(i):t(n).addClass("open"),r=[],t("input[type=checkbox]",n).each(function(){r.push(t(this).prop("checked"))})}),t(".cancel","#event-listing-refine-bar").on("click",function(){l(this)}),t(".apply","#event-listing-refine-bar").on("click",function(){c()}),t("input[type=checkbox]","#event-listing-refine-bar").on("click",function(){o()}),t("#reveal-refine-by").click(function(){!function(){var e=t(document).scrollTop();t("#refine-slider").css("top",e).removeClass("hide-on-mobile").animate({left:0},250);var i=t("#refine-slider").height()-t(".update-cancel-bar","#event-listing-refine-bar").height();t(".scroller","#refine-slider").height(i),t("body").css("overflow-y","hidden"),r=[],t("input[type=checkbox]","#event-listing-refine-bar").each(function(){r.push(t(this).prop("checked"))}),a=t(window).width()}()}),t(".update-cancel-bar .cancel","#event-listing-refine-bar").on("click",function(){i()}),t(".update-cancel-bar .apply","#event-listing-refine-bar").on("click",function(){t("#btnLocationAutoComplete").click()}),t(".clear-all-filters a","#event-listing-refine-bar").on("click",function(){t("input[type=checkbox]","#event-listing-refine-bar").each(function(){t(this).prop("checked",!1)}),e(),o()}),t(".search-all","#event-listing-refine-bar").on("click",function(){e()}),t(window).on("resize",function(){t(".scroller","#refine-slider").height(""),a!==t(window).width()&&i()})},ApplyLocation:function(){o(),c()}}});