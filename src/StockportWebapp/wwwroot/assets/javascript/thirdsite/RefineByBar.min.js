define(["jquery","utils"],function(e,i){var n=[],t=e(window).width(),r=function(i){var t=e(i).closest(".refine");e("input[type=checkbox]",e(t)).each(function(i){e(this).prop("checked",n[i])}),e(t).removeClass("open"),a()},a=function(){e(".badge","#event-listing-refine-bar").css("visibility","hidden");var i=0;e(".refine","#event-listing-refine-bar").each(function(){var n=0;e("input[type=checkbox]",e(this)).each(function(){e(this).prop("checked")&&(n++,i++)});var t=e("input[name=latitude]",e(this));1==t.length&&""!==t.val()&&"0"!==t.val()&&(n++,i++),n>0?(e(".badge",e(this)).html("<span>"+n+"</span>").css("visibility","visible"),e(".none-selected-error",this).length&&(e(".none-selected-error",this).hide(),e(".apply",this).removeClass("disabled").off("click").on("click",function(){l()}),e(".update-button","#event-listing-refine-bar").removeClass("disabled").prop("disabled",""))):e(".none-selected-error",this).length&&(e(".none-selected-error",this).show(),e(".apply",this).addClass("disabled").off("click"),e(".update-button","#event-listing-refine-bar").addClass("disabled").prop("disabled","disabled"))}),i>0&&e(".refine-all .badge","#event-listing-refine-bar").html("<span>"+i+"</span>").css("visibility","visible")},l=function(){var n=window.location.href;n=i.StripParamFromQueryString(n,"page"),n=i.StripParamFromQueryString(n,"keeptag"),n=i.StripParamFromQueryString(n,"fromsearch"),n=i.StripParamFromQueryString(n,"tag"),n=i.StripParamFromQueryString(n,"price"),n=i.StripParamFromQueryString(n,"longitude"),n=i.StripParamFromQueryString(n,"latitude"),n=i.StripParamFromQueryString(n,"location");var t=o();void 0===t&&(t=""),n.indexOf("?")<0?n+="?keeptag="+t+"&fromsearch=true":n+="&keeptag="+t+"&fromsearch=true",e("input:checked","#event-listing-refine-bar").each(function(){n+="&"+e(this).prop("name")+"="+e(this).val()}),e("input[name=longitude]","#event-listing-refine-bar").each(function(){n+="&longitude="+e(this).val()}),e("input[name=latitude]","#event-listing-refine-bar").each(function(){n+="&latitude="+e(this).val()}),e("input[name=location]","#event-listing-refine-bar").each(function(){n+="&location="+e(this).val()}),window.location.href=n},o=function(){return e("input[name=tag]","#event-listing-refine-bar").val()},c=function(){e("#location").val(""),e("#longitude").val("0"),e("#latitude").val("0"),e(".location-search-input").val("All locations"),a()},s=function(){var i=e(window).width();e("#refine-slider").animate({left:i},250,"swing",function(){e("#refine-slider").addClass("hide-on-mobile")}),e("body").css("overflow-y","scroll"),e("input[type=checkbox]","#event-listing-refine-bar").each(function(i){e(this).prop("checked",n[i])}),a()};return{Init:function(){a(),function(){var i=e(window).width();e("#refine-slider").css("left",i);var n=e("#location").val();""!==n?(e(".location-search-input").val(n),e(".search-all","#event-listing-refine-bar").show(),e(".search-all","#primary-filter-listing-refine-bar").show()):e(".search-all","#event-listing-refine-bar").hide()}(),e("#event-listing-refine-bar").show(),e(".link","#event-listing-refine-bar").on("click",function(){var i,t,a;i=this,e(".link","#event-listing-refine-bar").each(function(){this!==i&&e(this).closest(".refine").hasClass("open")&&r(this)}),a=e(t=this).parent(),e(a).hasClass("open")?r(t):e(a).addClass("open"),n=[],e("input[type=checkbox]",a).each(function(){n.push(e(this).prop("checked"))})}),e(".cancel","#event-listing-refine-bar").on("click",function(){r(this)}),e(".apply","#event-listing-refine-bar").on("click",function(){l()}),e("input[type=checkbox]","#event-listing-refine-bar").on("click",function(){a()}),e("#reveal-refine-by").click(function(){!function(){var i=e(document).scrollTop();e("#refine-slider").css("top",i).removeClass("hide-on-mobile").animate({left:0},250);var r=e("#refine-slider").height()-e(".update-cancel-bar","#event-listing-refine-bar").height();e(".scroller","#refine-slider").height(r),e("body").css("overflow-y","hidden"),n=[],e("input[type=checkbox]","#event-listing-refine-bar").each(function(){n.push(e(this).prop("checked"))}),t=e(window).width()}()}),e(".update-cancel-bar .cancel","#event-listing-refine-bar").on("click",function(){s()}),e(".update-cancel-bar .apply","#event-listing-refine-bar").on("click",function(){e("#btnLocationAutoComplete").click()}),e(".clear-all-filters a","#event-listing-refine-bar").on("click",function(){e("input[type=checkbox]","#event-listing-refine-bar").each(function(){e(this).prop("checked",!1)}),c(),a()}),e(".search-all","#event-listing-refine-bar").on("click",function(){c()}),e(window).on("resize",function(){e(".scroller","#refine-slider").height(""),t!==e(window).width()&&s()})},ApplyLocation:function(){a(),l()}}});