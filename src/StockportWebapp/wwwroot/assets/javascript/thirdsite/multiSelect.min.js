define(["jquery"],function(o){var h,c,r=3,s="",f=function(){var e=o("."+s+"-remove");o(e).show();var i=-1,l=0,n=o("."+s+"-div:visible"),t=o("select",o(n));o(t).each(function(e){null!==o(this).val()&&""!==o(this).val()&&(-1===i&&(i=e),l++)}),1===l&&o(o(e)[i]).hide(),1===n.length&&o(o(e)[0]).hide()},d=function(){for(var e=o("."+s+"-div:visible"),i="",l=0;l<e.length;l++){0<l&&(i+=",");var n=o("select",o(e)[l]);i+=o(n).val()}o("#"+s).val(i)},u=function(){var e=!0;return o("."+s+"-select:visible").each(function(){e=e&&null!==o(this).val()&&""!==o(this).val()}),e},g=function(){h=o("#"+s).val(),c=h.split(",");var e=h.length>r?r:h.length;e=0===e?e=1:e,c=c.slice(0,e),o("."+s+"-div").hide(),o("."+s+"-add").hide(),o("."+s+"-remove").hide(),o("."+s+"-select").val(""),o('option[value=""]',"."+s+"-select").show();for(var i=0;i<c.length;i++){var l=o("."+s+"-div")[i];if(void 0!==l){o(l).show();var n=o("."+s+"-select")[i];null!==c[i]&&0<c[i].length&&(o('option[value=""]',n).hide(),o(n).val(c[i])),o(n).off("change").on("change",function(){var e,i;e=o("."+s+"-add","."+s+"-div:visible"),i=e[e.length-1],u()?o(i).show():o(i).hide(),d(),g()})}}o('option[value!=""]',"."+s+"-select").show(),o("."+s+"-select").each(function(e){var i=e,l=o(this).val();o("."+s+"-select").each(function(e){i!==e&&o('option[value="'+l+'"]',this).hide()})});var t=o("."+s+"-div:visible");for(i=0;i<t.length;i++){var v=o("."+s+"-add")[i];i===t.length-1&&t.length<r&&(u()&&o(v).show(),o(v).off("click").on("click",function(){var e;e=o("#"+s).val()+",",o("#"+s).val(e),g()}));var a=o("."+s+"-remove-link")[i];o(a).off("click").on("click",function(){o(this).parent().parent().hide(),d(),g()}),f()}};return{Init:function(e){r=o("#"+(s=e)+"-limit").val(),g()}}});