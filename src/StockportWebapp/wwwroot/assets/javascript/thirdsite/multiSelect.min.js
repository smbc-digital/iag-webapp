define(["jquery"],function(e){var i,n,l=3,t="",v=function(i){var n=e("."+t+"-add","."+t+"-div:visible"),l=n[n.length-1];h()?e(l).show():e(l).hide(),c(),r()},a=function(i){var n=e("#"+t).val()+",";e("#"+t).val(n),r()},o=function(){var i=e("."+t+"-remove");e(i).show();var n=-1,l=0,v=e("."+t+"-div:visible"),a=e("select",e(v));e(a).each(function(i){null!==e(this).val()&&""!==e(this).val()&&(-1===n&&(n=i),l++)}),1===l&&e(e(i)[n]).hide(),1===v.length&&e(e(i)[0]).hide()},c=function(){for(var i=e("."+t+"-div:visible"),n="",l=0;l<i.length;l++){l>0&&(n+=",");var v=e("select",e(i)[l]);n+=e(v).val()}e("#"+t).val(n)},h=function(){var i=!0;return e("."+t+"-select:visible").each(function(){i=i&&null!==e(this).val()&&""!==e(this).val()}),i},r=function(){i=e("#"+t).val(),n=i.split(",");var s=i.length>l?l:i.length;s=0===s?s=1:s,n=n.slice(0,s),e("."+t+"-div").hide(),e("."+t+"-add").hide(),e("."+t+"-remove").hide(),e("."+t+"-select").val(""),e('option[value=""]',"."+t+"-select").show();for(var f=0;f<n.length;f++){var u=e("."+t+"-div")[f];if(void 0!==u){e(u).show();var d=e("."+t+"-select")[f];null!==n[f]&&n[f].length>0&&(e('option[value=""]',d).hide(),e(d).val(n[f])),e(d).off("change").on("change",function(){v()})}}e('option[value!=""]',"."+t+"-select").show(),e("."+t+"-select").each(function(i){var n=i,l=e(this).val();e("."+t+"-select").each(function(i){n!==i&&e('option[value="'+l+'"]',this).hide()})});var g=e("."+t+"-div:visible");for(f=0;f<g.length;f++){var p=e("."+t+"-add")[f];f===g.length-1&&g.length<l&&(h()&&e(p).show(),e(p).off("click").on("click",function(){a()}));var w=e("."+t+"-remove-link")[f];e(w).off("click").on("click",function(){e(this).parent().parent().hide(),c(),r()}),o()}};return{Init:function(i){l=e("#"+(t=i)+"-limit").val(),r()}}});