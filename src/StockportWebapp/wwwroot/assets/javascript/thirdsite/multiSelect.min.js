define(["jquery"],function(e){var i,n,t=3,l="",v=function(i){var n=e("."+l+"-add","."+l+"-div:visible"),t=n[n.length-1];f()?e(t).show():e(t).hide(),s(),r()},a=function(i){e(i).parent().parent().hide(),s(),r()},o=function(i){var n=e("#"+l).val()+",";e("#"+l).val(n),r()},c=function(){e('option[value!=""]',"."+l+"-select").show(),e("."+l+"-select").each(function(i){var n=this,t=i,v=e(n).val();e("."+l+"-select").each(function(i){var n=this,l=i;t!==l&&e('option[value="'+v+'"]',n).hide()})})},h=function(){var i=e("."+l+"-remove");e(i).show();var n=-1,t=0,v=e("."+l+"-div:visible"),a=e("select",e(v));e(a).each(function(i){null!==e(this).val()&&""!==e(this).val()&&(-1===n&&(n=i),t++)}),1===t&&e(e(i)[n]).hide(),1===v.length&&e(e(i)[0]).hide()},s=function(){for(var i=e("."+l+"-div:visible"),n="",t=0;t<i.length;t++){t>0&&(n+=",");var v=e("select",e(i)[t]);n+=e(v).val()}e("#"+l).val(n)},f=function(){var i=!0;return e("."+l+"-select:visible").each(function(){i=i&&null!==e(this).val()&&""!==e(this).val()}),i},r=function(){i=e("#"+l).val(),n=i.split(",");var s=i.length>t?t:i.length;s=0===s?s=1:s,n=n.slice(0,s),e("."+l+"-div").hide(),e("."+l+"-add").hide(),e("."+l+"-remove").hide(),e("."+l+"-select").val(""),e('option[value=""]',"."+l+"-select").show();for(var r=0;r<n.length;r++){var u=e("."+l+"-div")[r];if("undefined"!=typeof u){e(u).show();var d=e("."+l+"-select")[r];null!==n[r]&&n[r].length>0&&(e('option[value=""]',d).hide(),e(d).val(n[r])),e(d).off("change").on("change",function(){v(this)})}}c();for(var g=e("."+l+"-div:visible"),r=0;r<g.length;r++){var p=e("."+l+"-add")[r];r===g.length-1&&g.length<t&&(f()&&e(p).show(),e(p).off("click").on("click",function(){o(this)}));var w=e("."+l+"-remove-link")[r];e(w).off("click").on("click",function(){a(this)}),h()}};return{Init:function(i){l=i,t=e("#"+l+"-limit").val(),r()}}});