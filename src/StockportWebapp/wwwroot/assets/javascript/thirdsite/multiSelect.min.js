define(["jquery"],function(e){var i,l,n=3,t="",v=function(){var i=e("."+t+"-remove");e(i).show();var l=-1,n=0,v=e("."+t+"-div:visible"),a=e("select",e(v));e(a).each(function(i){null!==e(this).val()&&""!==e(this).val()&&(-1===l&&(l=i),n++)}),1===n&&e(e(i)[l]).hide(),1===v.length&&e(e(i)[0]).hide()},a=function(){for(var i=e("."+t+"-div:visible"),l="",n=0;n<i.length;n++){n>0&&(l+=",");var v=e("select",e(i)[n]);l+=e(v).val()}e("#"+t).val(l)},o=function(){var i=!0;return e("."+t+"-select:visible").each(function(){i=i&&null!==e(this).val()&&""!==e(this).val()}),i},h=function(){i=e("#"+t).val(),l=i.split(",");var c=i.length>n?n:i.length;c=0===c?c=1:c,l=l.slice(0,c),e("."+t+"-div").hide(),e("."+t+"-add").hide(),e("."+t+"-remove").hide(),e("."+t+"-select").val(""),e('option[value=""]',"."+t+"-select").show();for(var r=0;r<l.length;r++){var s=e("."+t+"-div")[r];if(void 0!==s){e(s).show();var f=e("."+t+"-select")[r];null!==l[r]&&l[r].length>0&&(e('option[value=""]',f).hide(),e(f).val(l[r])),e(f).off("change").on("change",function(){var i,l;i=e("."+t+"-add","."+t+"-div:visible"),l=i[i.length-1],o()?e(l).show():e(l).hide(),a(),h()})}}e('option[value!=""]',"."+t+"-select").show(),e("."+t+"-select").each(function(i){var l=i,n=e(this).val();e("."+t+"-select").each(function(i){l!==i&&e('option[value="'+n+'"]',this).hide()})});var d=e("."+t+"-div:visible");for(r=0;r<d.length;r++){var u=e("."+t+"-add")[r];r===d.length-1&&d.length<n&&(o()&&e(u).show(),e(u).off("click").on("click",function(){var i;i=e("#"+t).val()+",",e("#"+t).val(i),h()}));var g=e("."+t+"-remove-link")[r];e(g).off("click").on("click",function(){e(this).parent().parent().hide(),a(),h()}),v()}};return{Init:function(i){n=e("#"+(t=i)+"-limit").val(),h()}}});