define(["jquery","utils"],function(t,n){function r(e){e=t(e).closest(".refine"),t("input[type=checkbox]",t(e)).each(function(e){t(this).prop("checked",c[e])}),t(e).removeClass("open"),s&&t(".favourites-bar").show(),f()}function a(){var e=window.location.href,e=n.StripParamFromQueryString(e,"page"),i=(e=n.StripParamFromQueryString(e,"keeptag"),e=n.StripParamFromQueryString(e,"fromsearch"),e=n.StripParamFromQueryString(e,"tag"),e=n.StripParamFromQueryString(e,"price"),e=n.StripParamFromQueryString(e,"getinvolved"),e=n.StripParamFromQueryString(e,"subcategories"),e=n.StripParamFromQueryString(e,"organisation"),"1"!==t("#KeepLocationQueryValues").val()&&(e=n.StripParamFromQueryString(e,"longitude"),e=n.StripParamFromQueryString(e,"latitude"),e=n.StripParamFromQueryString(e,"location")),u());void 0===i&&(i=""),e.indexOf("?")<0?e+="?keeptag="+i+"&fromsearch=true":e+="&keeptag="+i+"&fromsearch=true",t("input:checked","#listing-refine-bar").each(function(){e+="&"+t(this).prop("name")+"="+t(this).val()}),t("input[name=longitude]","#refine-by-bar-container").each(function(){e+="&longitude="+t(this).val()}),t("input[name=latitude]","#refine-by-bar-container").each(function(){e+="&latitude="+t(this).val()}),t("input[name=location]","#refine-by-bar-container").each(function(){e+="&location="+t(this).val()}),window.location.href=e}function i(){t("#location").val(""),t("#longitude").val("0"),t("#latitude").val("0"),t(".location-search-input").val("All locations"),f()}function l(){var e;s=t(".favourites-bar:visible").length,t(".favourites-bar").hide(),t("#refine-slider").removeClass("hide-on-mobile").animate({left:0},250),e=t(".update-cancel-bar","#listing-refine-bar").outerHeight(),e=t(window).height()-e,t(".scroller","#refine-slider").height(e),t("body").css("overflow-y","hidden"),c=[],t("input[type=checkbox]","#listing-refine-bar").each(function(){c.push(t(this).prop("checked"))}),h=t(window).width()}function o(){var e=t(window).width();t("#refine-slider").animate({left:e},250,"swing",function(){t("#refine-slider").addClass("hide-on-mobile")}),t("#refine-slider").height(""),t(".scroller","#refine-slider").height(""),t("body").css("overflow-y","scroll"),t("input[type=checkbox]","#listing-refine-bar").each(function(e){t(this).prop("checked",c[e])}),f()}var c=[],s=!1,h=t(window).width(),f=function(){t(".badge","#listing-refine-bar").css("visibility","hidden");var n=0;t(".refine","#listing-refine-bar").each(function(){var e,i=0;t("input[type=checkbox]",t(this)).each(function(){t(this).prop("checked")&&(i++,n++)}),t(".refine-filters.location",t(this)).length&&1==(e=t("input[name=latitude]",t("#refine-by-bar-container"))).length&&""!==e.val()&&"0"!==e.val()&&(i++,n++),0<i?(t(".badge",t(this)).html("<span>"+i+"</span>").css("visibility","visible"),t(".none-selected-error",this).length&&(t(".none-selected-error",this).hide(),t(".apply",this).removeClass("disabled").off("click").on("click",function(){a()}),t(".update-button","#listing-refine-bar").removeClass("disabled").prop("disabled",""))):t(".none-selected-error",this).length&&(t(".none-selected-error",this).show(),t(".apply",this).addClass("disabled").off("click"),t(".update-button","#listing-refine-bar").addClass("disabled").prop("disabled","disabled"))}),0<n&&t(".refine-all .badge","#listing-refine-bar").html("<span>"+n+"</span>").css("visibility","visible")},u=function(){return t("input[name=tag]","#listing-refine-bar").val()};return{Init:function(){var e;f(),e=t(window).width(),t("#refine-slider").css("left",e),""!==(e=t("#location").val())?(t(".location-search-input").val(e),t(".search-all","#listing-refine-bar").show(),t(".search-all","#primary-filter-listing-refine-bar").show()):t(".search-all","#listing-refine-bar").hide(),t("#listing-refine-bar").show(),t(".link","#listing-refine-bar").on("click",function(){var e,i,n;e=this,t(".link","#listing-refine-bar").each(function(){this!==e&&t(this).closest(".refine").hasClass("open")&&r(this)}),n=t(i=this).parent(),t(n).hasClass("open")?r(i):t(n).addClass("open"),c=[],t("input[type=checkbox]",n).each(function(){c.push(t(this).prop("checked"))})}),t(".cancel","#listing-refine-bar").on("click",function(){r(this)}),t(".apply","#listing-refine-bar").on("click",function(){a()}),t("input[type=checkbox]","#listing-refine-bar").on("click",function(){f()}),t("#reveal-refine-by").click(function(){l()}),t(".update-cancel-bar .cancel","#listing-refine-bar").on("click",function(){o()}),t(".update-cancel-bar .apply","#listing-refine-bar").on("click",function(){t("#btnLocationAutoComplete").click()}),t(".clear-all-filters a","#listing-refine-bar").on("click",function(){t("input[type=checkbox]","#listing-refine-bar").each(function(){t(this).prop("checked",!1)}),i(),f()}),t(".search-all","#listing-refine-bar").on("click",function(){i()}),t(".show","#listing-refine-bar").on("click",function(){var e;t("label.toggle",t(e=this).parent().parent().parent()).toggle(),t(e).toggleClass("show-more"),0<t(e).html().indexOf(" all ")?t(e).text(t(e).text().replace(" all "," fewer ")):t(e).text(t(e).text().replace(" fewer "," all "))}),t(window).on("resize",function(){t(".scroller","#refine-slider").height(""),h!==t(window).width()&&o()})},ApplyLocation:function(){f(),a()}}});